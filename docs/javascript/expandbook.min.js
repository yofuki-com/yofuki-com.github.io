var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,g){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,g):$jscomp.polyfillUnisolated(a,b,c,g))};$jscomp.polyfillUnisolated=function(a,b,c,g){c=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var h=a[g];if(!(h in c))return;c=c[h]}a=a[a.length-1];g=c[a];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,g){var h=a.split(".");a=1===h.length;g=h[0];g=!a&&g in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var n=0;n<h.length-1;n++){var p=h[n];if(!(p in g))return;g=g[p]}h=h[h.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?g[h]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,h,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[h]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[h]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(h):$jscomp.POLYFILL_PREFIX+c+"$"+h),$jscomp.defineProperty(g,$jscomp.propertyToPolyfillSymbol[h],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(n,p){this.$jscomp$symbol$id_=n;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:p})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",g=0,h=function(n){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new b(c+(n||"")+"_"+g++,n)};return h},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var g=$jscomp.global[b[c]];"function"===typeof g&&"function"!=typeof g.prototype[a]&&$jscomp.defineProperty(g.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var g=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(g);if(!g.done)return this.context_.stop_(),g;var h=g.value}catch(n){return this.context_.yieldAllIterator_=null,this.context_.throw_(n),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,h);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(g){return a.next(g)}function c(g){return a.throw(g)}return new Promise(function(g,h){function n(p){p.done?g(p.value):Promise.resolve(p.value).then(b,c).then(n,h)}n(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(p){return p instanceof h?p:new h(function(z,r){z(p)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(p){if(null==this.batch_){this.batch_=[];var z=this;this.asyncExecuteFunction(function(){z.executeBatch_()})}this.batch_.push(p)};
var g=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(p){g(p,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var p=this.batch_;this.batch_=[];for(var z=0;z<p.length;++z){var r=p[z];p[z]=null;try{r()}catch(A){this.asyncThrow_(A)}}}this.batch_=null};b.prototype.asyncThrow_=function(p){this.asyncExecuteFunction(function(){throw p;})};var h=function(p){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var z=this.createResolveAndReject_();
try{p(z.resolve,z.reject)}catch(r){z.reject(r)}};h.prototype.createResolveAndReject_=function(){function p(A){return function(D){r||(r=!0,A.call(z,D))}}var z=this,r=!1;return{resolve:p(this.resolveTo_),reject:p(this.reject_)}};h.prototype.resolveTo_=function(p){if(p===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(p instanceof h)this.settleSameAsPromise_(p);else{a:switch(typeof p){case "object":var z=null!=p;break a;case "function":z=!0;break a;default:z=!1}z?this.resolveToNonPromiseObj_(p):
this.fulfill_(p)}};h.prototype.resolveToNonPromiseObj_=function(p){var z=void 0;try{z=p.then}catch(r){this.reject_(r);return}"function"==typeof z?this.settleSameAsThenable_(z,p):this.fulfill_(p)};h.prototype.reject_=function(p){this.settle_(2,p)};h.prototype.fulfill_=function(p){this.settle_(1,p)};h.prototype.settle_=function(p,z){if(0!=this.state_)throw Error("Cannot settle("+p+", "+z+"): Promise already settled in state"+this.state_);this.state_=p;this.result_=z;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};h.prototype.scheduleUnhandledRejectionCheck_=function(){var p=this;g(function(){if(p.notifyUnhandledRejection_()){var z=$jscomp.global.console;"undefined"!==typeof z&&z.error(p.result_)}},1)};h.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var p=$jscomp.global.CustomEvent,z=$jscomp.global.Event,r=$jscomp.global.dispatchEvent;if("undefined"===typeof r)return!0;"function"===typeof p?p=new p("unhandledrejection",{cancelable:!0}):
"function"===typeof z?p=new z("unhandledrejection",{cancelable:!0}):(p=$jscomp.global.document.createEvent("CustomEvent"),p.initCustomEvent("unhandledrejection",!1,!0,p));p.promise=this;p.reason=this.result_;return r(p)};h.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var p=0;p<this.onSettledCallbacks_.length;++p)n.asyncExecute(this.onSettledCallbacks_[p]);this.onSettledCallbacks_=null}};var n=new b;h.prototype.settleSameAsPromise_=function(p){var z=this.createResolveAndReject_();
p.callWhenSettled_(z.resolve,z.reject)};h.prototype.settleSameAsThenable_=function(p,z){var r=this.createResolveAndReject_();try{p.call(z,r.resolve,r.reject)}catch(A){r.reject(A)}};h.prototype.then=function(p,z){function r(Q,ca){return"function"==typeof Q?function(V){try{A(Q(V))}catch(da){D(da)}}:ca}var A,D,M=new h(function(Q,ca){A=Q;D=ca});this.callWhenSettled_(r(p,A),r(z,D));return M};h.prototype.catch=function(p){return this.then(void 0,p)};h.prototype.callWhenSettled_=function(p,z){function r(){switch(A.state_){case 1:p(A.result_);
break;case 2:z(A.result_);break;default:throw Error("Unexpected state: "+A.state_);}}var A=this;null==this.onSettledCallbacks_?n.asyncExecute(r):this.onSettledCallbacks_.push(r);this.isRejectionHandled_=!0};h.resolve=c;h.reject=function(p){return new h(function(z,r){r(p)})};h.race=function(p){return new h(function(z,r){for(var A=$jscomp.makeIterator(p),D=A.next();!D.done;D=A.next())c(D.value).callWhenSettled_(z,r)})};h.all=function(p){var z=$jscomp.makeIterator(p),r=z.next();return r.done?c([]):new h(function(A,
D){function M(V){return function(da){Q[V]=da;ca--;0==ca&&A(Q)}}var Q=[],ca=0;do Q.push(void 0),ca++,c(r.value).callWhenSettled_(M(Q.length-1),D),r=z.next();while(!r.done)})};return h},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var g=arguments[c];if(g)for(var h in g)$jscomp.owns(g,h)&&(a[h]=g[h])}return a};
$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,g=!1,h={next:function(){if(!g&&c<a.length){var n=c++;return{value:b(n,a[n]),done:!1}}g=!0;return{done:!0,value:void 0}}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(a){return a?a:function(){return[]}},"es6","es5");$jscomp.polyfill("Reflect.ownKeys",function(a){return a?a:function(b){var c=[],g=Object.getOwnPropertyNames(b);b=Object.getOwnPropertySymbols(b);for(var h=0;h<g.length;h++)("jscomp_symbol_"==g[h].substring(0,14)?b:c).push(g[h]);return c.concat(b)}},"es6","es5");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var g=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var h=g.length,n=b.length;c=Math.max(0,Math.min(c|0,g.length));for(var p=0;p<n&&c<h;)if(g[c++]!=b[p++])return!1;return p>=n}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
$jscomp.polyfill("String.prototype.matchAll",function(a){return a?a:function(b){if(b instanceof RegExp&&!b.global)throw new TypeError("RegExp passed into String.prototype.matchAll() must have global tag.");var c=new RegExp(b,b instanceof RegExp?void 0:"g"),g=this,h=!1,n={next:function(){if(h)return{value:void 0,done:!0};var p=c.exec(g);if(!p)return h=!0,{value:void 0,done:!0};""===p[0]&&(c.lastIndex+=1);return{value:p,done:!1}}};n[Symbol.iterator]=function(){return n};return n}},"es_2020","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var g=a.length,h=0;h<g;h++){var n=a[h];if(b.call(c,n,h,a))return{i:h,v:n}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,g,h){return c==a&&"q"==g&&h==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var A=Object.seal({}),D=Object.seal({}),M=new a([[A,2],[D,3]]);if(2!=M.get(A)||3!=M.get(D))return!1;M.delete(A);M.set(D,4);return!M.has(A)&&4==M.get(D)}catch(Q){return!1}}function c(){}function g(A){var D=typeof A;return"object"===D&&null!==A||"function"===D}function h(A){if(!$jscomp.owns(A,p)){var D=new c;$jscomp.defineProperty(A,p,{value:D})}}function n(A){if(!$jscomp.ISOLATE_POLYFILLS){var D=Object[A];D&&(Object[A]=
function(M){if(M instanceof c)return M;Object.isExtensible(M)&&h(M);return D(M)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var p="$jscomp_hidden_"+Math.random();n("freeze");n("preventExtensions");n("seal");var z=0,r=function(A){this.id_=(z+=Math.random()+1).toString();if(A){A=$jscomp.makeIterator(A);for(var D;!(D=A.next()).done;)D=D.value,this.set(D[0],D[1])}};r.prototype.set=function(A,D){if(!g(A))throw Error("Invalid WeakMap key");
h(A);if(!$jscomp.owns(A,p))throw Error("WeakMap key fail: "+A);A[p][this.id_]=D;return this};r.prototype.get=function(A){return g(A)&&$jscomp.owns(A,p)?A[p][this.id_]:void 0};r.prototype.has=function(A){return g(A)&&$jscomp.owns(A,p)&&$jscomp.owns(A[p],this.id_)};r.prototype.delete=function(A){return g(A)&&$jscomp.owns(A,p)&&$jscomp.owns(A[p],this.id_)?delete A[p][this.id_]:!1};return r},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var r=Object.seal({x:4}),A=new a($jscomp.makeIterator([[r,"s"]]));if("s"!=A.get(r)||1!=A.size||A.get({x:4})||A.set({x:4},"t")!=A||2!=A.size)return!1;var D=A.entries(),M=D.next();if(M.done||M.value[0]!=r||"s"!=M.value[1])return!1;M=D.next();return M.done||4!=M.value[0].x||"t"!=M.value[1]||!D.next().done?!1:!0}catch(Q){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,g=function(r){this.data_={};this.head_=p();this.size=0;if(r){r=$jscomp.makeIterator(r);for(var A;!(A=r.next()).done;)A=A.value,this.set(A[0],A[1])}};g.prototype.set=function(r,A){r=0===r?0:r;var D=h(this,r);D.list||(D.list=this.data_[D.id]=[]);D.entry?D.entry.value=A:(D.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:r,value:A},D.list.push(D.entry),
this.head_.previous.next=D.entry,this.head_.previous=D.entry,this.size++);return this};g.prototype.delete=function(r){r=h(this,r);return r.entry&&r.list?(r.list.splice(r.index,1),r.list.length||delete this.data_[r.id],r.entry.previous.next=r.entry.next,r.entry.next.previous=r.entry.previous,r.entry.head=null,this.size--,!0):!1};g.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=p();this.size=0};g.prototype.has=function(r){return!!h(this,r).entry};g.prototype.get=function(r){return(r=
h(this,r).entry)&&r.value};g.prototype.entries=function(){return n(this,function(r){return[r.key,r.value]})};g.prototype.keys=function(){return n(this,function(r){return r.key})};g.prototype.values=function(){return n(this,function(r){return r.value})};g.prototype.forEach=function(r,A){for(var D=this.entries(),M;!(M=D.next()).done;)M=M.value,r.call(A,M[1],M[0],this)};g.prototype[Symbol.iterator]=g.prototype.entries;var h=function(r,A){var D=A&&typeof A;"object"==D||"function"==D?c.has(A)?D=c.get(A):
(D=""+ ++z,c.set(A,D)):D="p_"+A;var M=r.data_[D];if(M&&$jscomp.owns(r.data_,D))for(r=0;r<M.length;r++){var Q=M[r];if(A!==A&&Q.key!==Q.key||A===Q.key)return{id:D,list:M,index:r,entry:Q}}return{id:D,list:M,index:-1,entry:void 0}},n=function(r,A){var D=r.head_;return $jscomp.iteratorPrototype(function(){if(D){for(;D.head!=r.head_;)D=D.previous;for(;D.next!=D.head;)return D=D.next,{done:!1,value:A(D)};D=null}return{done:!0,value:void 0}})},p=function(){var r={};return r.previous=r.next=r.head=r},z=0;
return g},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var g=this;g instanceof String&&(g=String(g));var h=g.length;c=c||0;for(0>c&&(c=Math.max(c+h,0));c<h;c++){var n=g[c];if(n===b||Object.is(n,b))return!0}return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"!=typeof globalThis?globalThis:a||self).Dexie=b()})(this,function(){function a(d,e,f){if(f||2===arguments.length)for(var k,l=0,m=e.length;l<m;l++)!k&&l in e||((k=k||Array.prototype.slice.call(e,0,l))[l]=e[l]);return d.concat(k||Array.prototype.slice.call(e))}function b(d,e){return"object"!=typeof e||ja(e).forEach(function(f){d[f]=e[f]}),d}function c(d,
e){"function"==typeof e&&(e=e(Xa(d)));("undefined"==typeof Reflect?ja:Reflect.ownKeys)(e).forEach(function(f){g(d,f,e[f])})}function g(d,e,f,k){tc(d,e,b(f&&ua.call(f,"get")&&"function"==typeof f.get?{get:f.get,set:f.set,configurable:!0}:{value:f,configurable:!0,writable:!0},k))}function h(d){return{from:function(e){return d.prototype=Object.create(e.prototype),g(d.prototype,"constructor",d),{extend:c.bind(null,d.prototype)}}}}function n(d,e){return Wc(d,e)||(d=Xa(d))&&n(d,e)}function p(d,e){return e(d)}
function z(d){if(!d)throw Error("Assertion Failed");}function r(d){ea.setImmediate?setImmediate(d):setTimeout(d,0)}function A(d,e){return d.reduce(function(f,k,l){l=e(k,l);return l&&(f[l[0]]=l[1]),f},{})}function D(d,e){if(ua.call(d,e))return d[e];if(!e)return d;if("string"!=typeof e){for(var f=[],k=0,l=e.length;k<l;++k){var m=D(d,e[k]);f.push(m)}return f}f=e.indexOf(".");if(-1!==f)return d=d[e.substr(0,f)],void 0===d?void 0:D(d,e.substr(f+1))}function M(d,e,f){if(d&&void 0!==e&&!("isFrozen"in Object&&
Object.isFrozen(d)))if("string"!=typeof e&&"length"in e){z("string"!=typeof f&&"length"in f);for(var k=0,l=e.length;k<l;++k)M(d,e[k],f[k])}else{var m=e.indexOf(".");-1!==m?(k=e.substr(0,m),""===(l=e.substr(m+1))?void 0===f?pa(d)&&!isNaN(parseInt(k))?d.splice(k,1):delete d[k]:d[k]=f:M((m=d[k])&&ua.call(d,k)?m:d[k]={},l,f)):void 0===f?pa(d)&&!isNaN(parseInt(e))?d.splice(e,1):delete d[e]:d[e]=f}}function Q(d){var e,f={};for(e in d)ua.call(d,e)&&(f[e]=d[e]);return f}function ca(d){Ca="undefined"!=typeof WeakMap&&
new WeakMap;d=function k(f){if(!f||"object"!=typeof f)return f;var l=Ca&&Ca.get(f);if(l)return l;if(pa(f)){l=[];Ca&&Ca.set(f,l);for(var m=0,q=f.length;m<q;++m)l.push(k(f[m]))}else if(0<=Xc.indexOf(f.constructor))l=f;else for(m in q=Xa(f),l=q===Object.prototype?{}:Object.create(q),Ca&&Ca.set(f,l),f)ua.call(f,m)&&(l[m]=k(f[m]));return l}(d);return Ca=null,d}function V(d){var e,f,k;if(1===arguments.length){if(pa(d))return d.slice();if(this===Pa&&"string"==typeof d)return[d];if(k=Yc(d)){for(f=[];!(e=
k.next()).done;)f.push(e.value);return f}if(null==d||"number"!=typeof(e=d.length))return[d];for(f=Array(e);e--;)f[e]=d[e];return f}e=arguments.length;for(f=Array(e);e--;)f[e]=arguments[e];return f}function da(d,e){wa=d;uc=e}function na(){if(Zc)try{throw Error();}catch(d){return d}return Error()}function sa(d,e){var f=d.stack;return f?(e=e||0,0===f.indexOf(d.name)&&(e+=(d.name+d.message).split("\n").length),f.split("\n").slice(e).filter(uc).map(function(k){return"\n"+k}).join("")):""}function aa(d,
e){this._e=na();this.name=d;this.message=e}function vc(d,e){return d+". Errors: "+Object.keys(e).map(function(f){return e[f].toString()}).filter(function(f,k,l){return l.indexOf(f)===k}).join("\n")}function mb(d,e,f,k){this._e=na();this.failures=e;this.failedKeys=k;this.successCount=f;this.message=vc(d,e)}function Ya(d,e){this._e=na();this.name="BulkError";this.failures=Object.keys(e).map(function(f){return e[f]});this.failuresByPos=e;this.message=vc(d,e)}function ba(){}function Za(d){return d}function $c(d,
e){return null==d||d===Za?e:function(f){return e(d(f))}}function Ha(d,e){return function(){d.apply(this,arguments);e.apply(this,arguments)}}function ad(d,e){return d===ba?e:function(){var f=d.apply(this,arguments);void 0!==f&&(arguments[0]=f);var k=this.onsuccess,l=this.onerror;this.onerror=this.onsuccess=null;var m=e.apply(this,arguments);return k&&(this.onsuccess=this.onsuccess?Ha(k,this.onsuccess):k),l&&(this.onerror=this.onerror?Ha(l,this.onerror):l),void 0!==m?m:f}}function bd(d,e){return d===
ba?e:function(){d.apply(this,arguments);var f=this.onsuccess,k=this.onerror;this.onsuccess=this.onerror=null;e.apply(this,arguments);f&&(this.onsuccess=this.onsuccess?Ha(f,this.onsuccess):f);k&&(this.onerror=this.onerror?Ha(k,this.onerror):k)}}function cd(d,e){return d===ba?e:function(f){var k=d.apply(this,arguments);b(f,k);var l=this.onsuccess,m=this.onerror;this.onerror=this.onsuccess=null;f=e.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?Ha(l,this.onsuccess):l),m&&(this.onerror=
this.onerror?Ha(m,this.onerror):m),void 0===k?void 0===f?void 0:f:b(k,f)}}function dd(d,e){return d===ba?e:function(){return!1!==e.apply(this,arguments)&&d.apply(this,arguments)}}function Lb(d,e){return d===ba?e:function(){var f=d.apply(this,arguments);if(f&&"function"==typeof f.then){for(var k=this,l=arguments.length,m=Array(l);l--;)m[l]=arguments[l];return f.then(function(){return e.apply(k,m)})}return e.apply(this,arguments)}}function N(d,e,f){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");
this._listeners=[];this.onuncatched=ba;this._lib=!1;var k=this._PSD=O;if(wa&&(this._stackHolder=na(),this._prev=null,this._numPrev=0),"function"!=typeof d){if(d!==$a)throw new TypeError("Not a function");return this._state=e,this._value=f,void(!1===this._state&&Mb(this,this._value))}this._value=this._state=null;++k.ref;(function u(m,q){try{q(function(w){if(null===m._state){if(w===m)throw new TypeError("A promise cannot be resolved with itself.");var v=m._lib&&ab();w&&"function"==typeof w.then?u(m,
function(x,t){w instanceof N?w._then(x,t):w.then(x,t)}):(m._state=!0,m._value=w,wc(m));v&&bb()}},Mb.bind(null,m))}catch(w){Mb(m,w)}})(this,d)}function xc(d,e,f,k,l){this.onFulfilled="function"==typeof d?d:null;this.onRejected="function"==typeof e?e:null;this.resolve=f;this.reject=k;this.psd=l}function Mb(d,e){var f;nb.push(e);null===d._state&&(f=d._lib&&ab(),e=Nb(e),d._state=!1,d._value=e,wa&&null!==e&&"object"==typeof e&&!e._promise&&function(k,l,m){try{k.apply(null,m)}catch(q){l&&l(q)}}(function(){var k=
n(e,"stack");e._promise=d;g(e,"stack",{get:function(){return Ob?k&&(k.get?k.get.apply(e):k.value):d.stack}})}),Ia.some(function(k){return k._value===d._value})||Ia.push(d),wc(d),f&&bb())}function wc(d){var e=d._listeners;d._listeners=[];for(var f=0,k=e.length;f<k;++f)Pb(d,e[f]);d=d._PSD;--d.ref||d.finalize();0===Ja&&(++Ja,cb(function(){0==--Ja&&Qb()},[]))}function Pb(d,e){if(null!==d._state){var f=d._state?e.onFulfilled:e.onRejected;if(null===f)return(d._state?e.resolve:e.reject)(d._value);++e.psd.ref;
++Ja;cb(ed,[f,d,e])}else d._listeners.push(e)}function ed(d,e,f){try{var k=(Rb=e)._value;if(e._state)var l=d(k);else if(nb.length&&(nb=[]),l=d(k),-1===nb.indexOf(k))a:for(var m=Ia.length;m;)if(Ia[--m]._value===e._value){Ia.splice(m,1);break a}f.resolve(l)}catch(q){f.reject(q)}finally{Rb=null,0==--Ja&&Qb(),--f.psd.ref||f.psd.finalize()}}function yc(d,e){var f=e?e._numPrev+1:0;100>f&&(d._prev=e,d._numPrev=f)}function ob(){ab()&&bb()}function ab(){var d=Sb;return pb=Sb=!1,d}function bb(){var d;do for(;0<
db.length;){var e=db;db=[];var f=e.length;for(d=0;d<f;++d){var k=e[d];k[0].apply(null,k[1])}}while(0<db.length);pb=Sb=!0}function Qb(){var d=Ia;Ia=[];d.forEach(function(f){f._PSD.onunhandled.call(null,f._value,f)});d=qb.slice(0);for(var e=d.length;e;)d[--e]()}function rb(d){return new N($a,!1,d)}function fa(d,e){var f=O;return function(){var k=ab(),l=O;try{return Da(f,!0),d.apply(this,arguments)}catch(m){e&&e(m)}finally{Da(l,!1),k&&bb()}}}function Ea(d,e,f,k){var l=O,m=Object.create(l);m.parent=l;
m.ref=0;m.global=!1;m.id=++fd;var q=Qa.env;m.env=Tb?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject,nthen:zc(q.nthen,m),gthen:zc(q.gthen,m)}:{};e&&b(m,e);++l.ref;m.finalize=function(){--this.parent.ref||this.parent.finalize()};k=Ra(m,d,f,k);return 0===m.ref&&m.finalize(),k}function Sa(){return oa.id||(oa.id=++gd),++oa.awaits,oa.echoes+=100,oa.id}function Aa(){return!!oa.awaits&&(0==--oa.awaits&&
(oa.id=0),oa.echoes=100*oa.awaits,!0)}function sb(d){return oa.echoes&&d&&d.constructor===tb?(Sa(),d.then(function(e){return Aa(),e},function(e){return Aa(),la(e)})):d}function hd(){var d=ub[ub.length-1];ub.pop();Da(d,!1)}function Da(d,e){var f,k=O;(e?!oa.echoes||Ub++&&d===O:!Ub||--Ub&&d===O)||Vb.call(vb,e?function(l){++wb;oa.echoes&&0!=--oa.echoes||(oa.echoes=oa.id=0);ub.push(O);Da(l,!0)}.bind(null,d):hd);d!==O&&(O=d,k===Qa&&(Qa.env=Ac()),Tb&&(f=Qa.env.Promise,e=d.env,xb.then=e.nthen,f.prototype.then=
e.gthen,(k.global||d.global)&&(Object.defineProperty(ea,"Promise",e.PromiseProp),f.all=e.all,f.race=e.race,f.resolve=e.resolve,f.reject=e.reject,e.allSettled&&(f.allSettled=e.allSettled),e.any&&(f.any=e.any))))}function Ac(){var d=ea.Promise;return Tb?{Promise:d,PromiseProp:Object.getOwnPropertyDescriptor(ea,"Promise"),all:d.all,race:d.race,allSettled:d.allSettled,any:d.any,resolve:d.resolve,reject:d.reject,nthen:xb.then,gthen:d.prototype.then}:{}}function Ra(d,e,f,k,l){var m=O;try{return Da(d,!0),
e(f,k,l)}finally{Da(m,!1)}}function yb(d,e,f,k){return"function"!=typeof d?d:function(){var l=O;f&&Sa();Da(e,!0);try{return d.apply(this,arguments)}finally{Da(l,!1),k&&Vb.call(vb,Aa)}}}function zc(d,e){return function(f,k){return d.call(this,yb(f,e),yb(k,e))}}function Bc(d,e){try{var f=e.onuncatched(d)}catch(l){}if(!1!==f)try{var k;e={promise:e,reason:d};if(ea.document&&document.createEvent?((k=document.createEvent("Event")).initEvent(Cc,!0,!0),b(k,e)):ea.CustomEvent&&b(k=new CustomEvent(Cc,{detail:e}),
e),k&&ea.dispatchEvent&&(dispatchEvent(k),!ea.PromiseRejectionEvent&&ea.onunhandledrejection))try{ea.onunhandledrejection(k)}catch(l){}wa&&k&&!k.defaultPrevented&&console.warn("Unhandled rejection: "+(d.stack||d))}catch(l){}}function Dc(d){return!/(dexie\.js|dexie\.min\.js)/.test(d)}function Ka(d,e){return d?e?function(){return d.apply(this,arguments)&&e.apply(this,arguments)}:d:e}function zb(d){return"string"!=typeof d||/\./.test(d)?function(e){return e}:function(e){return void 0===e[d]&&d in e&&
delete (e=ca(e))[d],e}}function ha(){}function eb(d){function e(q,u){if(u){for(var w=arguments.length,v=Array(w-1);--w;)v[w-1]=arguments[w];return k[q].subscribe.apply(null,v),d}if("string"==typeof q)return k[q]}function f(q,u,w){if("object"!=typeof q){u=u||dd;var v={subscribers:[],fire:w=w||ba,subscribe:function(x){-1===v.subscribers.indexOf(x)&&(v.subscribers.push(x),v.fire=u(v.fire,x))},unsubscribe:function(x){v.subscribers=v.subscribers.filter(function(t){return t!==x});v.fire=v.subscribers.reduce(u,
w)}};return k[q]=e[q]=v}ja(q).forEach(function(x){var t=q[x];if(pa(t))f(x,q[x][0],q[x][1]);else{if("asap"!==t)throw new S.InvalidArgument("Invalid event config");var C=f(x,Za,function(){for(var y=arguments.length,B=Array(y);y--;)B[y]=arguments[y];C.subscribers.forEach(function(G){r(function(){G.apply(null,B)})})})}})}var k={};e.addEventType=f;for(var l=1,m=arguments.length;l<m;++l)f(arguments[l]);return e}function fb(d,e){return h(e).from({prototype:d}),e}function Ta(d,e){return!(d.filter||d.algorithm||
d.or)&&(e?d.justLimit:!d.replayFilter)}function Wb(d,e){d.filter=Ka(d.filter,e)}function Xb(d,e,f){var k=d.replayFilter;d.replayFilter=k?function(){return Ka(k(),e())}:e;d.justLimit=f&&!k}function Ab(d,e){if(d.isPrimKey)return e.primaryKey;var f=e.getIndexByKeyPath(d.index);if(!f)throw new S.Schema("KeyPath "+d.index+" on object store "+e.name+" is not indexed");return f}function Ec(d,e,f){var k=Ab(d,e.schema);return e.openCursor({trans:f,values:!d.keysOnly,reverse:"prev"===d.dir,unique:!!d.unique,
query:{index:k,range:d.range}})}function Bb(d,e,f,k){var l=d.replayFilter?Ka(d.filter,d.replayFilter()):d.filter;if(d.or){var m={},q=function(u,w,v){var x,t;l&&!l(w,v,function(C){return w.stop(C)},function(C){return w.fail(C)})||("[object ArrayBuffer]"===(t=""+(x=w.primaryKey))&&(t=""+new Uint8Array(x)),ua.call(m,t)||(m[t]=!0,e(u,w,v)))};return Promise.all([d.or._iterate(q,f),Fc(Ec(d,k,f),d.algorithm,q,!d.keysOnly&&d.valueMapper)])}return Fc(Ec(d,k,f),Ka(d.algorithm,l),e,!d.keysOnly&&d.valueMapper)}
function Fc(d,e,f,k){var l=fa(k?function(m,q,u){return f(k(m),q,u)}:f);return d.then(function(m){if(m)return m.start(function(){var q=function(){return m.continue()};e&&!e(m,function(u){return q=u},function(u){m.stop(u);q=ba},function(u){m.fail(u);q=ba})||l(m.value,m,function(u){return q=u});q()})})}function ra(d,e){try{var f=Gc(d),k=Gc(e);if(f!==k)return"Array"===f?1:"Array"===k?-1:"binary"===f?1:"binary"===k?-1:"string"===f?1:"string"===k?-1:"Date"===f?1:"Date"!==k?NaN:-1;switch(f){case "number":case "Date":case "string":return e<
d?1:d<e?-1:0;case "binary":return function(l,m){for(var q=l.length,u=m.length,w=q<u?q:u,v=0;v<w;++v)if(l[v]!==m[v])return l[v]<m[v]?-1:1;return q===u?0:q<u?-1:1}(Hc(d),Hc(e));case "Array":return function(l,m){for(var q=l.length,u=m.length,w=q<u?q:u,v=0;v<w;++v){var x=ra(l[v],m[v]);if(0!==x)return x}return q===u?0:q<u?-1:1}(d,e)}}catch(l){}return NaN}function Gc(d){var e=typeof d;if("object"!=e)return e;if(ArrayBuffer.isView(d))return"binary";d=Yb.call(d).slice(8,-1);return"ArrayBuffer"===d?"binary":
d}function Hc(d){return d instanceof Uint8Array?d:ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d)}function Z(){}function id(d,e){return d<e?-1:d===e?0:1}function jd(d,e){return e<d?-1:d===e?0:1}function va(d,e,f){d=d instanceof Ic?new d.Collection(d):d;return d._ctx.error=new (f||TypeError)(e),d}function Ua(d){return(new d.Collection(d,function(){return{type:1,lower:"",upper:""}})).limit(0)}function Cb(d,e,f,k){function l(B){m="next"===B?function(F){return F.toUpperCase()}:
function(F){return F.toLowerCase()};q="next"===B?function(F){return F.toLowerCase()}:function(F){return F.toUpperCase()};u="next"===B?id:jd;var G=f.map(function(F){return{lower:q(F),upper:m(F)}}).sort(function(F,E){return u(F.lower,E.lower)});w=G.map(function(F){return F.upper});v=G.map(function(F){return F.lower});t="next"===(x=B)?"":k}var m,q,u,w,v,x,t,C=f.length;if(!f.every(function(B){return"string"==typeof B}))return va(d,"String expected.");l("next");d=new d.Collection(d,function(){return Fa(w[0],
v[C-1]+k)});d._ondirectionchange=function(B){l(B)};var y=0;return d._addAlgorithm(function(B,G,F){var E=B.key;if("string"!=typeof E)return!1;var H=q(E);if(e(H,v,y))return!0;for(var I=null,J=y;J<C;++J){var K=function(L,P,R,W,qa,ka){for(var T=Math.min(L.length,W.length),U=-1,X=0;X<T;++X){var Va=P[X];if(Va!==W[X])return 0>qa(L[X],R[X])?L.substr(0,X)+R[X]+R.substr(X+1):0>qa(L[X],W[X])?L.substr(0,X)+W[X]+R.substr(X+1):0<=U?L.substr(0,U)+P[U]+R.substr(U+1):null;0>qa(L[X],Va)&&(U=X)}return T<W.length&&"next"===
ka?L+R.substr(L.length):T<L.length&&"prev"===ka?L.substr(0,R.length):0>U?null:L.substr(0,U)+W[U]+R.substr(U+1)}(E,H,w[J],v[J],u,x);null===K&&null===I?y=J+1:(null===I||0<u(I,K))&&(I=K)}return G(null!==I?function(){B.continue(I+t)}:F),!1}),d}function Fa(d,e,f,k){return{type:2,lower:d,upper:e,lowerOpen:f,upperOpen:k}}function ma(){}function xa(d){return fa(function(e){return gb(e),d(e.target.error),!1})}function gb(d){d.stopPropagation&&d.stopPropagation();d.preventDefault&&d.preventDefault()}function ya(){}
function Zb(d,e,f,k,l,m,q){return{name:d,keyPath:e,unique:f,multi:k,auto:l,compound:m,src:(f&&!q?"&":"")+(k?"*":"")+(l?"++":"")+Jc(e)}}function Jc(d){return"string"==typeof d?d:d?"["+[].join.call(d,"+")+"]":""}function Kc(d,e,f){return{name:d,primKey:e,indexes:f,mappedClass:null,idxByName:A(f,function(k){return[k.name,k]})}}function $b(d){return null==d?function(){}:"string"==typeof d?1===(e=d).split(".").length?function(f){return f[e]}:function(f){return D(f,e)}:function(f){return D(f,d)};var e}
function hb(d){return null==d?":id":"string"==typeof d?d:"["+d.join("+")+"]"}function kd(d,e,f){function k(v){if(3===v.type)return null;if(4===v.type)throw Error("Cannot convert never type to IDBKeyRange");var x=v.lower,t=v.upper,C=v.lowerOpen;v=v.upperOpen;return void 0===x?void 0===t?null:e.upperBound(t,!!v):void 0===t?e.lowerBound(x,!!C):e.bound(x,t,!!C,!!v)}var l,m,q=(l=f,m=[].slice.call(d.objectStoreNames),{schema:{name:d.name,tables:m.map(function(v){return l.objectStore(v)}).map(function(v){var x=
v.keyPath,t=v.autoIncrement,C=pa(x),y={};t={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==x,compound:C,keyPath:x,autoIncrement:t,unique:!0,extractKey:$b(x)},indexes:[].slice.call(v.indexNames).map(function(B){return v.index(B)}).map(function(B){var G=B.name,F=B.unique,E=B.multiEntry;B=B.keyPath;E={name:G,compound:pa(B),keyPath:B,unique:F,multiEntry:E,extractKey:$b(B)};return y[hb(B)]=E}),getIndexByKeyPath:function(B){return y[hb(B)]}};return y[":id"]=t.primaryKey,null!=x&&(y[hb(x)]=
t.primaryKey),t})},hasGetAll:0<m.length&&"getAll"in l.objectStore(m[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&604>[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1])});f=q.schema;var u=q.hasGetAll;q=f.tables.map(function(v){var x=v.name;return{name:x,schema:v,mutate:function(t){var C=t.trans,y=t.type,B=t.keys,G=t.values,F=t.range;return new Promise(function(E,H){function I(U){++ka;gb(U)}function J(U){U=U.target.result;
W.forEach(function(X,Va){return null!=X.error&&(qa[Va]=X.error)});E({numFailures:ka,failures:qa,results:"delete"===y?B:W.map(function(X){return X.result}),lastResult:U})}E=fa(E);H=C.objectStore(x);var K=null==H.keyPath,L="put"===y||"add"===y;if(!L&&"delete"!==y&&"deleteRange"!==y)throw Error("Invalid operation type: "+y);var P,R=(B||G||{length:1}).length;if(B&&G&&B.length!==G.length)throw Error("Given keys array must have same length as given values array.");if(0===R)return E({numFailures:0,failures:{},
results:[],lastResult:void 0});var W=[],qa=[],ka=0;if("deleteRange"===y){if(4===F.type)return E({numFailures:ka,failures:qa,results:[],lastResult:void 0});3===F.type?W.push(P=H.clear()):W.push(P=H.delete(k(F)))}else{K=L?K?[G,B]:[G,null]:[B,null];var T=K[0];K=K[1];if(L)for(L=0;L<R;++L)W.push(P=K&&void 0!==K[L]?H[y](T[L],K[L]):H[y](T[L])),P.onerror=I;else for(L=0;L<R;++L)W.push(P=H[y](T[L])),P.onerror=I}P.onerror=function(U){I(U);J(U)};P.onsuccess=J})},getMany:function(t){var C=t.trans,y=t.keys;return new Promise(function(B,
G){B=fa(B);var F,E=C.objectStore(x),H=y.length,I=Array(H),J=0,K=0,L=function(R){R=R.target;I[R._pos]=R.result;++K===J&&B(I)};G=xa(G);for(var P=0;P<H;++P)null!=y[P]&&((F=E.get(y[P]))._pos=P,F.onsuccess=L,F.onerror=G,++J);0===J&&B(I)})},get:function(t){var C=t.trans,y=t.key;return new Promise(function(B,G){B=fa(B);var F=C.objectStore(x).get(y);F.onsuccess=function(E){return B(E.target.result)};F.onerror=xa(G)})},query:function(t){return new Promise(function(C,y){C=fa(C);var B,G,F,E=t.trans,H=t.values,
I=t.limit,J=t.query,K=I===1/0?void 0:I,L=J.index;J=J.range;E=E.objectStore(x);L=L.isPrimaryKey?E:E.index(L.name);J=k(J);if(0===I)return C({result:[]});u?((K=H?L.getAll(J,K):L.getAllKeys(J,K)).onsuccess=function(P){return C({result:P.target.result})},K.onerror=xa(y)):(B=0,G=!H&&"openKeyCursor"in L?L.openKeyCursor(J):L.openCursor(J),F=[],G.onsuccess=function(P){return(P=G.result)?(F.push(H?P.value:P.primaryKey),++B===I?C({result:F}):void P.continue()):C({result:F})},G.onerror=xa(y))})},openCursor:function(t){var C=
t.trans,y=t.values,B=t.query,G=t.reverse,F=t.unique;return new Promise(function(E,H){E=fa(E);var I=B.index,J=B.range,K=C.objectStore(x);K=I.isPrimaryKey?K:K.index(I.name);I=G?F?"prevunique":"prev":F?"nextunique":"next";var L=!y&&"openKeyCursor"in K?K.openKeyCursor(k(J),I):K.openCursor(k(J),I);L.onerror=xa(H);L.onsuccess=fa(function(P){var R,W,qa,ka,T=L.result;T?(T.___id=++ld,T.done=!1,R=T.continue.bind(T),W=(W=T.continuePrimaryKey)&&W.bind(T),qa=T.advance.bind(T),ka=function(){throw Error("Cursor not stopped");
},T.trans=C,T.stop=T.continue=T.continuePrimaryKey=T.advance=function(){throw Error("Cursor not started");},T.fail=fa(H),T.next=function(){var U=this,X=1;return this.start(function(){return X--?U.continue():U.stop()}).then(function(){return U})},T.start=function(U){function X(){if(L.result)try{U()}catch(Wa){T.fail(Wa)}else T.done=!0,T.start=function(){throw Error("Cursor behind last entry");},T.stop()}var Va=new Promise(function(Wa,Lc){Wa=fa(Wa);L.onerror=xa(Lc);T.fail=Lc;T.stop=function(md){T.stop=
T.continue=T.continuePrimaryKey=T.advance=ka;Wa(md)}});return L.onsuccess=fa(function(Wa){L.onsuccess=X;X()}),T.continue=R,T.continuePrimaryKey=W,T.advance=qa,X(),Va},E(T)):E(null)},H)})},count:function(t){var C=t.query,y=t.trans,B=C.index,G=C.range;return new Promise(function(F,E){var H=y.objectStore(x),I=B.isPrimaryKey?H:H.index(B.name);I=(H=k(G))?I.count(H):I.count();I.onsuccess=fa(function(J){return F(J.target.result)});I.onerror=xa(E)})}}});var w={};return q.forEach(function(v){return w[v.name]=
v}),{stack:"dbcore",transaction:d.transaction.bind(d),table:function(v){if(!w[v])throw Error("Table '"+v+"' not found");return w[v]},MIN_KEY:-1/0,MAX_KEY:ib(e),schema:f}}function nd(d,e,f,k){var l=f.IDBKeyRange;return f.indexedDB,{dbcore:(k=kd(e,l,k),d.dbcore.reduce(function(m,q){q=q.create;return Y(Y({},m),q(m))},k))}}function ac(d,e){var f=d._novip;d=e.db;e=nd(f._middlewares,d,f._deps,e);f.core=e.dbcore;f.tables.forEach(function(k){var l=k.name;f.core.schema.tables.some(function(m){return m.name===
l})&&(k.core=f.core.table(l),f[l]instanceof f.Table&&(f[l].core=k.core))})}function Db(d,e,f,k){var l=d._novip;f.forEach(function(m){var q=k[m];e.forEach(function(u){var w=n(u,m);(!w||"value"in w&&void 0===w.value)&&(u===l.Transaction.prototype||u instanceof l.Transaction?g(u,m,{get:function(){return this.table(m)},set:function(v){tc(this,m,{value:v,writable:!0,configurable:!0,enumerable:!0})}}):u[m]=new l.Table(m,q))})})}function bc(d,e){var f=d._novip;e.forEach(function(k){for(var l in k)k[l]instanceof
f.Table&&delete k[l]})}function od(d,e){return d._cfg.version-e._cfg.version}function pd(d,e,f,k){var l=d._dbSchema,m=d._createTransaction("readwrite",d._storeNames,l);m.create(f);m._completion.catch(k);var q=m._reject.bind(m),u=O.transless||O;Ea(function(){var w,v,x,t,C;O.trans=m;O.transless=u;0===e?(ja(l).forEach(function(y){cc(f,y,l[y].primKey,l[y].indexes)}),ac(d,f),N.follow(function(){return d.on.populate.fire(m)}).catch(q)):(v=(w=d)._novip,x=[],w=v._versions,t=v._dbSchema=dc(0,v.idbdb,f),C=
!1,w.filter(function(y){return y._cfg.version>=e}).forEach(function(y){x.push(function(){var B=t,G=y._cfg.dbschema;ec(v,B,f);ec(v,G,f);t=v._dbSchema=G;var F=Mc(B,G);F.add.forEach(function(K){cc(f,K[0],K[1].primKey,K[1].indexes)});F.change.forEach(function(K){if(K.recreate)throw new S.Upgrade("Not yet support for changing primary key");var L=f.objectStore(K.name);K.add.forEach(function(P){return fc(L,P)});K.change.forEach(function(P){L.deleteIndex(P.name);fc(L,P)});K.del.forEach(function(P){return L.deleteIndex(P)})});
var E=y._cfg.contentUpgrade;if(E&&y._cfg.version>e){ac(v,f);m._memoizedTables={};C=!0;var H=Q(G);F.del.forEach(function(K){H[K]=B[K]});bc(v,[v.Transaction.prototype]);Db(v,[v.Transaction.prototype],ja(H),H);m.schema=H;var I,J=gc(E);J&&Sa();F=N.follow(function(){var K;(I=E(m))&&J&&(K=Aa.bind(null,null),I.then(K,K))});return I&&"function"==typeof I.then?N.resolve(I):F.then(function(){return I})}});x.push(function(B){var G;C&&qd||(G=y._cfg.dbschema,[].slice.call(B.db.objectStoreNames).forEach(function(F){return null==
G[F]&&B.db.deleteObjectStore(F)}));bc(v,[v.Transaction.prototype]);Db(v,[v.Transaction.prototype],v._storeNames,v._dbSchema);m.schema=v._dbSchema})}),function B(){return x.length?N.resolve(x.shift()(m.idbtrans)).then(B):N.resolve()}().then(function(){var B;ja(B=t).forEach(function(G){f.db.objectStoreNames.contains(G)||cc(f,G,B[G].primKey,B[G].indexes)})}).catch(q))})}function Mc(d,e){var f,k={del:[],add:[],change:[]};for(f in d)e[f]||k.del.push(f);for(f in e){var l=d[f],m=e[f];if(l){var q={name:f,
def:m,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||l.primKey.auto!==m.primKey.auto&&!Eb)q.recreate=!0,k.change.push(q);else{l=l.idxByName;m=m.idxByName;var u=void 0;for(u in l)m[u]||q.del.push(u);for(u in m){var w=l[u],v=m[u];w?w.src!==v.src&&q.change.push(v):q.add.push(v)}(0<q.del.length||0<q.add.length||0<q.change.length)&&k.change.push(q)}}else k.add.push([f,m])}return k}function cc(d,e,f,k){var l=d.db.createObjectStore(e,f.keyPath?{keyPath:f.keyPath,
autoIncrement:f.auto}:{autoIncrement:f.auto});return k.forEach(function(m){return fc(l,m)}),l}function fc(d,e){d.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function dc(d,e,f){var k={};return Fb.call(e.objectStoreNames,0,void 0).forEach(function(l){for(var m=f.objectStore(l),q=Zb(Jc(x=m.keyPath),x||"",!1,!1,!!m.autoIncrement,x&&"string"!=typeof x,!0),u=[],w=0;w<m.indexNames.length;++w){var v=m.index(m.indexNames[w]),x=v.keyPath;v=Zb(v.name,x,!!v.unique,!!v.multiEntry,!1,x&&
"string"!=typeof x,!1);u.push(v)}k[l]=Kc(l,q,u)}),k}function ec(d,e,f){d=d._novip;for(var k=f.db.objectStoreNames,l=0;l<k.length;++l){var m=k[l],q=f.objectStore(m);d._hasGetAll="getAll"in q;for(var u=0;u<q.indexNames.length;++u){var w=q.indexNames[u],v=q.index(w).keyPath,x="string"==typeof v?v:"["+Fb.call(v,void 0,void 0).join("+")+"]";!e[m]||(v=e[m].idxByName[x])&&(v.name=w,delete e[m].idxByName[x],e[m].idxByName[w]=v)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&
ea.WorkerGlobalScope&&ea instanceof ea.WorkerGlobalScope&&604>[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]&&(d._hasGetAll=!1)}function Gb(){}function hc(d,e){var f=d._dbNamesDB;return f||(f=d._dbNamesDB=new La("__dbnames",{addons:[],indexedDB:d,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),f.table("dbnames")}function ic(d){return d&&"function"==typeof d.databases}function jc(d){return Ea(function(){return O.letThrough=!0,d()})}function rd(d){function e(){if(f.openCanceller!==l)throw new S.DatabaseClosed("db.open() was cancelled");
}var f=d._state,k=d._deps.indexedDB;if(f.isBeingOpened||d.idbdb)return f.dbReadyPromise.then(function(){return f.dbOpenError?la(f.dbOpenError):d});wa&&(f.openCanceller._stackHolder=na());f.isBeingOpened=!0;f.dbOpenError=null;f.openComplete=!1;var l=f.openCanceller,m,q=f.dbReadyResolve,u=null,w=!1;return N.race([l,("undefined"==typeof navigator?N.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?(new Promise(function(v){function x(){return indexedDB.databases().finally(v)}
m=setInterval(x,100);x()})).finally(function(){return clearInterval(m)}):Promise.resolve()).then(function(){return new N(function(v,x){if(e(),!k)throw new S.MissingAPI;var t=d.name,C=f.autoSchema?k.open(t):k.open(t,Math.round(10*d.verno));if(!C)throw new S.MissingAPI;C.onerror=xa(x);C.onblocked=fa(d._fireOnBlocked);C.onupgradeneeded=fa(function(y){var B;u=C.transaction;f.autoSchema&&!d._options.allowEmptyDB?(C.onerror=gb,u.abort(),C.result.close(),(B=k.deleteDatabase(t)).onsuccess=B.onerror=fa(function(){x(new S.NoSuchDatabase("Database "+
t+" doesnt exist"))})):(u.onerror=xa(x),y=y.oldVersion>Math.pow(2,62)?0:y.oldVersion,w=1>y,d._novip.idbdb=C.result,pd(d,y/10,u,x))},x);C.onsuccess=fa(function(){u=null;var y,B,G,F,E=d._novip.idbdb=C.result,H=Fb.call(E.objectStoreNames,void 0,void 0);if(0<H.length)try{var I=E.transaction(1===H.length?H[0]:H,"readonly");f.autoSchema?(B=E,G=I,(y=(y=d)._novip).verno=B.version/10,G=y._dbSchema=dc(0,B,G),y._storeNames=Fb.call(B.objectStoreNames,0,void 0),Db(y,[y._allTables],ja(G),G)):(ec(d,d._dbSchema,
I),((F=Mc(dc(0,(F=d).idbdb,I),F._dbSchema)).add.length||F.change.some(function(J){return J.add.length||J.change.length}))&&console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail."));ac(d,I)}catch(J){}jb.push(d);E.onversionchange=fa(function(J){f.vcFired=!0;d.on("versionchange").fire(J)});E.onclose=fa(function(J){d.on("close").fire(J)});w&&(F=d._deps,I=t,E=F.indexedDB,F=F.IDBKeyRange,ic(E)||"__dbnames"===I||hc(E,F).put({name:I}).catch(ba));
v()},x)})})]).then(function(){return e(),f.onReadyBeingFired=[],N.resolve(jc(function(){return d.on.ready.fire(d.vip)})).then(function x(){if(0<f.onReadyBeingFired.length){var t=f.onReadyBeingFired.reduce(Lb,ba);return f.onReadyBeingFired=[],N.resolve(jc(function(){return t(d.vip)})).then(x)}})}).finally(function(){f.onReadyBeingFired=null;f.isBeingOpened=!1}).then(function(){return d}).catch(function(v){f.dbOpenError=v;try{u&&u.abort()}catch(x){}return l===f.openCanceller&&d._close(),la(v)}).finally(function(){f.openComplete=
!0;q()})}function kc(d){function e(m){return d.next(m)}function f(m){return function(q){var u=m(q);q=u.value;return u.done?q:q&&"function"==typeof q.then?q.then(k,l):pa(q)?Promise.all(q).then(k,l):k(q)}}var k=f(e),l=f(function(m){return d.throw(m)});return f(e)()}function Hb(d,e,f){d=pa(d)?d.slice():[d];for(var k=0;k<f;++k)d.push(e);return d}function lc(d,e,f,k){return f=f||{},k=k||"",ja(d).forEach(function(l){var m,q,u;ua.call(e,l)?(m=d[l],q=e[l],"object"==typeof m&&"object"==typeof q&&m&&q?(u=Yb.call(m).slice(8,
-1))!==Yb.call(q).slice(8,-1)?f[k+l]=e[l]:"Object"===u?lc(m,q,f,k+l+"."):m!==q&&(f[k+l]=e[l]):m!==q&&(f[k+l]=e[l])):f[k+l]=void 0}),ja(e).forEach(function(l){ua.call(d,l)||(f[k+l]=e[l])}),f}function Nc(d,e,f){try{if(!e||e.keys.length<d.length)return null;for(var k=[],l=0,m=0;l<e.keys.length&&m<d.length;++l)0===ra(e.keys[l],d[m])&&(k.push(f?ca(e.values[l]):e.values[l]),++m);return k.length===d.length?k:null}catch(q){return null}}function kb(d,e,f){var k=ra(e,f);if(!isNaN(k)){if(0<k)throw RangeError();
if(!("from"in d))return b(d,{from:e,to:f,d:1});var l=d.l;k=d.r;if(0>ra(f,d.from))return l?kb(l,e,f):d.l={from:e,to:f,d:1,l:null,r:null},Oc(d);if(0<ra(e,d.to))return k?kb(k,e,f):d.r={from:e,to:f,d:1,l:null,r:null},Oc(d);0>ra(e,d.from)&&(d.from=e,d.l=null,d.d=k?k.d+1:1);0<ra(f,d.to)&&(d.to=f,d.r=null,d.d=d.l?d.l.d+1:1);f=!d.r;l&&!d.l&&lb(d,l);k&&f&&lb(d,k)}}function lb(d,e){"from"in e&&function m(k,l){var q=l.from,u=l.to,w=l.l;l=l.r;kb(k,q,u);w&&m(k,w);l&&m(k,l)}(d,e)}function Pc(d,e){e=mc(e);var f=
e.next();if(f.done)return!1;var k=f.value;d=mc(d);for(var l=d.next(k.from),m=l.value;!f.done&&!l.done;){if(0>=ra(m.from,k.to)&&0<=ra(m.to,k.from))return!0;0>ra(k.from,m.from)?k=(f=e.next(m.from)).value:m=(l=d.next(k.from)).value}return!1}function mc(d){var e="from"in d?{s:0,n:d}:null;return{next:function(f){for(var k=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,k)for(;e.n.l&&0>ra(f,e.n.from);)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!k||0>=ra(f,e.n.to))return{value:e.n,
done:!1};case 2:if(e.n.r){e.s=3;e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Oc(d){var e,f,k=((null===(e=d.r)||void 0===e?void 0:e.d)||0)-((null===(f=d.l)||void 0===f?void 0:f.d)||0),l=1<k?"r":-1>k?"l":"";l&&(e="r"==l?"l":"r",f=Y({},d),k=d[l],d.from=k.from,d.to=k.to,d[l]=k[l],f[l]=k[e],(d[e]=f).d=Qc(f));d.d=Qc(d)}function Qc(d){var e=d.r;d=d.l;return(e?d?Math.max(e.d,d.d):e.d:d?d.d:0)+1}function ia(d,e){var f=this;this._middlewares={};this.verno=0;var k=ia.dependencies;this._options=
e=Y({addons:ia.addons,autoOpen:!0,indexedDB:k.indexedDB,IDBKeyRange:k.IDBKeyRange},e);this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};k=e.addons;this._dbSchema={};this._versions=[];this._storeNames=[];this._allTables={};this.idbdb=null;this._novip=this;var l,m,q,u,w,v={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ba,dbReadyPromise:null,cancelOpen:ba,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};v.dbReadyPromise=new N(function(x){v.dbReadyResolve=
x});v.openCanceller=new N(function(x,t){v.cancelOpen=t});this._state=v;this.name=d;this.on=eb(this,"populate","blocked","versionchange","close",{ready:[Lb,ba]});this.on.ready.subscribe=p(this.on.ready.subscribe,function(x){return function(t,C){ia.vip(function(){var y=f._state;y.openComplete?(y.dbOpenError||N.resolve().then(t),C&&x(t)):y.onReadyBeingFired?(y.onReadyBeingFired.push(t),C&&x(t)):(x(t),C||x(function G(){f.on.ready.unsubscribe(t);f.on.ready.unsubscribe(G)}))})}});this.Collection=(l=this,
fb(sd.prototype,function(x,t){this.db=l;var C=Rc,y=null;if(t)try{C=t()}catch(G){y=G}var B=x._ctx;t=B.table;x=t.hook.reading.fire;this._ctx={table:t,index:B.index,isPrimKey:!B.index||t.schema.primKey.keyPath&&B.index===t.schema.primKey.name,range:C,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:y,or:B.or,valueMapper:x!==Za?x:null}}));this.Table=(m=this,fb(td.prototype,function(x,t,C){this.db=m;this._tx=C;this.name=x;
this.schema=t;this.hook=m._allTables[x]?m._allTables[x].hook:eb(null,{creating:[ad,ba],reading:[$c,Za],updating:[cd,ba],deleting:[bd,ba]})}));this.Transaction=(q=this,fb(ud.prototype,function(x,t,C,y,B){var G=this;this.db=q;this.mode=x;this.storeNames=t;this.schema=C;this.chromeTransactionDurability=y;this.idbtrans=null;this.on=eb(this,"complete","error","abort");this.parent=B||null;this.active=!0;this._reculock=0;this._blockedFuncs=[];this._waitingQueue=this._waitingFor=this._reject=this._resolve=
null;this._spinCount=0;this._completion=new N(function(F,E){G._resolve=F;G._reject=E});this._completion.then(function(){G.active=!1;G.on.complete.fire()},function(F){var E=G.active;return G.active=!1,G.on.error.fire(F),G.parent?G.parent._reject(F):E&&G.idbtrans&&G.idbtrans.abort(),la(F)})}));this.Version=(u=this,fb(vd.prototype,function(x){this.db=u;this._cfg={version:x,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}));this.WhereClause=(w=this,fb(Ic.prototype,function(x,t,C){this.db=
w;this._ctx={table:x,index:":id"===t?null:t,or:C};var y=w._deps.indexedDB;if(!y)throw new S.MissingAPI;this._cmp=this._ascending=y.cmp.bind(y);this._descending=function(B,G){return y.cmp(G,B)};this._max=function(B,G){return 0<y.cmp(B,G)?B:G};this._min=function(B,G){return 0>y.cmp(B,G)?B:G};this._IDBKeyRange=w._deps.IDBKeyRange}));this.on("versionchange",function(x){0<x.newVersion?console.warn("Another connection wants to upgrade database '"+f.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+
f.name+"'. Closing db now to resume the delete request.");f.close()});this.on("blocked",function(x){!x.newVersion||x.newVersion<x.oldVersion?console.warn("Dexie.delete('"+f.name+"') was blocked"):console.warn("Upgrade '"+f.name+"' blocked by other connection holding version "+x.oldVersion/10)});this._maxKey=ib(e.IDBKeyRange);this._createTransaction=function(x,t,C,y){return new f.Transaction(x,t,C,f._options.chromeTransactionDurability,y)};this._fireOnBlocked=function(x){f.on("blocked").fire(x);jb.filter(function(t){return t.name===
f.name&&t!==f&&!t._state.vcFired}).map(function(t){return t.on("versionchange").fire(x)})};this.use(wd);this.use(xd);this.use(yd);this.use(zd);this.vip=Object.create(this,{_vip:{value:!0}});k.forEach(function(x){return x(f)})}function nc(d){this._subscribe=d}function Sc(d,e){return ja(e).forEach(function(f){lb(d[f]||(d[f]=new za),e[f])}),d}function Tc(d){var e=!1,f=void 0,k=new Ad(function(l){function m(){return ja(v).some(function(G){return w[G]&&Pc(w[G],v[G])})}var q=gc(d),u=!1,w={},v={},x={get closed(){return u},
unsubscribe:function(){u=!0;Ga.storagemutated.unsubscribe(y)}};l.start&&l.start(x);var t=!1,C=!1,y=function(G){Sc(w,G);m()&&B()},B=function(){var G,F;t||u||(w={},F=function(E){q&&Sa();var H=function(){return Ea(d,{subscr:E,trans:null})};H=O.trans?Ra(O.transless,H):H();return q&&H.then(Aa,Aa),H}(G={}),C||(Ga("storagemutated",y),C=!0),t=!0,Promise.resolve(F).then(function(E){f=E;t=!(e=!0);u||(m()?B():(w={},v=G,l.next&&l.next(E)))},function(E){e=t=!1;l.error&&l.error(E);x.unsubscribe()}))};return B(),
x});return k.hasValue=function(){return e},k.getValue=function(){return f},k}function Ib(d){var e=Ba;try{Ba=!0,Ga.storagemutated.fire(d)}finally{Ba=e}}var Y=function(){return(Y=Object.assign||function(d){for(var e,f=1,k=arguments.length;f<k;f++)for(var l in e=arguments[f])Object.prototype.hasOwnProperty.call(e,l)&&(d[l]=e[l]);return d}).apply(this,arguments)},ea="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ja=Object.keys,pa=Array.isArray;
"undefined"==typeof Promise||ea.Promise||(ea.Promise=Promise);var Xa=Object.getPrototypeOf,ua={}.hasOwnProperty,tc=Object.defineProperty,Wc=Object.getOwnPropertyDescriptor,Fb=[].slice,Uc=[].concat,ta="Boolean String Date RegExp Blob File FileList FileSystemFileHandle ArrayBuffer DataView Uint8ClampedArray ImageBitmap ImageData Map Set CryptoKey".split(" ").concat(Uc.apply([],[8,16,32,64].map(function(d){return["Int","Uint","Float"].map(function(e){return e+d+"Array"})}))).filter(function(d){return ea[d]}),
Xc=ta.map(function(d){return ea[d]});A(ta,function(d){return[d,!0]});var Ca=null,Yb={}.toString,oc="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Yc="symbol"==typeof oc?function(d){var e;return null!=d&&(e=d[oc])&&e.apply(d)}:function(){return null},Pa={},gc="undefined"!=typeof Symbol?function(d){return"AsyncFunction"===d[Symbol.toStringTag]}:function(){return!1},wa="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),uc=function(){return!0},Zc=!Error("").stack,
Ma="Unknown Constraint Data TransactionInactive ReadOnly Version NotFound InvalidState InvalidAccess Abort Timeout QuotaExceeded Syntax DataClone".split(" ");ta="Modify Bulk OpenFailed VersionChange Schema Upgrade InvalidTable MissingAPI NoSuchDatabase InvalidArgument SubTransaction Unsupported Internal DatabaseClosed PrematureCommit ForeignAwait".split(" ").concat(Ma);var Bd={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",
TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};h(aa).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+sa(this._e,2))}},toString:function(){return this.name+": "+this.message}});h(mb).from(aa);h(Ya).from(aa);var pc=ta.reduce(function(d,e){return d[e]=e+"Error",d},{}),S=ta.reduce(function(d,e){function f(l,m){this._e=na();this.name=k;l?"string"==typeof l?
(this.message=l+(m?"\n "+m:""),this.inner=m||null):"object"==typeof l&&(this.message=l.name+" "+l.message,this.inner=l):(this.message=Bd[e]||k,this.inner=null)}var k=e+"Error";return h(f).from(aa),d[e]=f,d},{});S.Syntax=SyntaxError;S.Type=TypeError;S.Range=RangeError;var Vc=Ma.reduce(function(d,e){return d[e+"Error"]=S[e],d},{});Ma=ta.reduce(function(d,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(d[e+"Error"]=S[e]),d},{});Ma.ModifyError=mb;Ma.DexieError=aa;Ma.BulkError=Ya;var $a={};ta="undefined"==
typeof Promise?[]:function(){var d=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[d,Xa(d),d];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Xa(e),d]}();var vb=ta[0],xb=ta[1],qc=ta[2],Vb=xb&&xb.then,tb=vb&&vb.constructor,Tb=!!qc,Ob=!1,Cd=qc?function(){qc.then(ob)}:ea.setImmediate?setImmediate.bind(null,ob):ea.MutationObserver?function(){var d=document.createElement("div");(new MutationObserver(function(){ob();d=null})).observe(d,{attributes:!0});d.setAttribute("i",
"1")}:function(){setTimeout(ob,0)},cb=function(d,e){db.push([d,e]);pb&&(Cd(),pb=!1)},Sb=!0,pb=!0,Ia=[],nb=[],Rb=null,Nb=Za,Qa={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Bc,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(d){try{Bc(d[0],d[1])}catch(e){}})}},O=Qa,db=[],Ja=0,qb=[],rc={get:function(){function d(k,l){var m=this,q=!e.global&&(e!==O||f!==wb),u=q&&!Aa(),w=new N(function(v,x){Pb(m,new xc(yb(k,e,q,u),yb(l,e,q,u),v,x,e))});return wa&&yc(w,this),w}var e=O,f=wb;return d.prototype=
$a,d},set:function(d){g(this,"then",d&&d.prototype===$a?rc:{get:function(){return d},set:rc.set})}};c(N.prototype,{then:rc,_then:function(d,e){Pb(this,new xc(null,null,d,e,O))},catch:function(d){if(1===arguments.length)return this.then(null,d);var e=arguments[1];return"function"==typeof d?this.then(null,function(f){return(f instanceof d?e:rb)(f)}):this.then(null,function(f){return(f&&f.name===d?e:rb)(f)})},finally:function(d){return this.then(function(e){return d(),e},function(e){return d(),rb(e)})},
stack:{get:function(){if(this._stack)return this._stack;try{Ob=!0;var d=function m(f,k,l){if(k.length===l)return k;var q="",u,w,v;!1===f._state&&(null!=(u=f._value)?(w=u.name||"Error",v=u.message||u,q=sa(u,0)):(w=u,v=""),k.push(w+(v?": "+v:"")+q));wa&&((q=sa(f._stackHolder,2))&&-1===k.indexOf(q)&&k.push(q),f._prev&&m(f._prev,k,l));return k}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=d),d}finally{Ob=!1}}},timeout:function(d,e){var f=this;return d<1/0?new N(function(k,
l){var m=setTimeout(function(){return l(new S.Timeout(e))},d);f.then(k,l).finally(clearTimeout.bind(null,m))}):this}});"undefined"!=typeof Symbol&&Symbol.toStringTag&&g(N.prototype,Symbol.toStringTag,"Dexie.Promise");Qa.env=Ac();c(N,{all:function(){var d=V.apply(null,arguments).map(sb);return new N(function(e,f){0===d.length&&e([]);var k=d.length;d.forEach(function(l,m){return N.resolve(l).then(function(q){d[m]=q;--k||e(d)},f)})})},resolve:function(d){if(d instanceof N)return d;if(d&&"function"==
typeof d.then)return new N(function(f,k){d.then(f,k)});var e=new N($a,!0,d);return yc(e,Rb),e},reject:rb,race:function(){var d=V.apply(null,arguments).map(sb);return new N(function(e,f){d.map(function(k){return N.resolve(k).then(e,f)})})},PSD:{get:function(){return O},set:function(d){return O=d}},totalEchoes:{get:function(){return wb}},newPSD:Ea,usePSD:Ra,scheduler:{get:function(){return cb},set:function(d){cb=d}},rejectionMapper:{get:function(){return Nb},set:function(d){Nb=d}},follow:function(d,
e){return new N(function(f,k){return Ea(function(l,m){var q=O;q.unhandleds=[];q.onunhandled=m;q.finalize=Ha(function(){var u=this;var w=function(){0===u.unhandleds.length?l():m(u.unhandleds[0])};qb.push(function x(){w();qb.splice(qb.indexOf(x),1)});++Ja;cb(function(){0==--Ja&&Qb()},[])},q.finalize);d()},e,f,k)})}});tb&&(tb.allSettled&&g(N,"allSettled",function(){var d=V.apply(null,arguments).map(sb);return new N(function(e){0===d.length&&e([]);var f=d.length,k=Array(f);d.forEach(function(l,m){return N.resolve(l).then(function(q){return k[m]=
{status:"fulfilled",value:q}},function(q){return k[m]={status:"rejected",reason:q}}).then(function(){return--f||e(k)})})})}),tb.any&&"undefined"!=typeof AggregateError&&g(N,"any",function(){var d=V.apply(null,arguments).map(sb);return new N(function(e,f){0===d.length&&f(new AggregateError([]));var k=d.length,l=Array(k);d.forEach(function(m,q){return N.resolve(m).then(function(u){return e(u)},function(u){l[q]=u;--k||f(new AggregateError(l))})})})}));var oa={awaits:0,echoes:0,id:0},gd=0,ub=[],Ub=0,
wb=0,fd=0;-1===(""+Vb).indexOf("[native code]")&&(Sa=Aa=ba);var Cc="unhandledrejection",la=N.reject,Na=String.fromCharCode(65535),jb=[],Eb="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),qd=Eb,Dd=Eb,Rc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1},td=(ha.prototype._trans=function(d,e,f){function k(u,w,v){if(!v.schema[m])throw new S.NotFound("Table "+m+" not part of transaction");return e(v.idbtrans,v)}var l=this._tx||O.trans,m=this.name,q=ab();try{return l&&
l.db===this.db?l===O.trans?l._promise(d,k,f):Ea(function(){return l._promise(d,k,f)},{trans:l,transless:O.transless||O}):function C(w,v,x,t){if(w.idbdb&&(w._state.openComplete||O.letThrough||w._vip)){var y=w._createTransaction(v,x,w._dbSchema);try{y.create(),w._state.PR1398_maxLoop=3}catch(B){return B.name===pc.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w._close(),w.open().then(function(){return C(w,v,x,t)})):la(B)}return y._promise(v,function(B,
G){return Ea(function(){return O.trans=y,t(B,G,y)})}).then(function(B){return y._completion.then(function(){return B})})}if(w._state.openComplete)return la(new S.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._options.autoOpen)return la(new S.DatabaseClosed);w.open().catch(ba)}return w._state.dbReadyPromise.then(function(){return C(w,v,x,t)})}(this.db,d,[this.name],k)}finally{q&&bb()}},ha.prototype.get=function(d,e){var f=this;return d&&d.constructor===Object?this.where(d).first(e):
this._trans("readonly",function(k){return f.core.get({trans:k,key:d}).then(function(l){return f.hook.reading.fire(l)})}).then(e)},ha.prototype.where=function(d){function e(w,v){try{return 0===m.cmp(w,v)}catch(x){return!1}}if("string"==typeof d)return new this.db.WhereClause(this,d);if(pa(d))return new this.db.WhereClause(this,"["+d.join("+")+"]");var f=ja(d);if(1===f.length)return this.where(f[0]).equals(d[f[0]]);var k=this.schema.indexes.concat(this.schema.primKey).filter(function(w){return w.compound&&
f.every(function(v){return 0<=w.keyPath.indexOf(v)})&&w.keyPath.every(function(v){return 0<=f.indexOf(v)})})[0];if(k&&this.db._maxKey!==Na)return this.where(k.name).equals(k.keyPath.map(function(w){return d[w]}));!k&&wa&&console.warn("The query "+JSON.stringify(d)+" on "+this.name+" would benefit of a compound index ["+f.join("+")+"]");var l=this.schema.idxByName,m=this.db._deps.indexedDB,q=f.reduce(function(w,v){var x=w[0],t=w[1];w=l[v];var C=d[v];return[x||w,x||!w?Ka(t,w&&w.multi?function(y){y=
D(y,v);return pa(y)&&y.some(function(B){return e(C,B)})}:function(y){return e(C,D(y,v))}):t]},[null,null]),u=q[0];q=q[1];return u?this.where(u.name).equals(d[u.keyPath]).filter(q):k?this.filter(q):this.where(f).equals("")},ha.prototype.filter=function(d){return this.toCollection().and(d)},ha.prototype.count=function(d){return this.toCollection().count(d)},ha.prototype.offset=function(d){return this.toCollection().offset(d)},ha.prototype.limit=function(d){return this.toCollection().limit(d)},ha.prototype.each=
function(d){return this.toCollection().each(d)},ha.prototype.toArray=function(d){return this.toCollection().toArray(d)},ha.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ha.prototype.orderBy=function(d){return new this.db.Collection(new this.db.WhereClause(this,pa(d)?"["+d.join("+")+"]":d))},ha.prototype.reverse=function(){return this.toCollection().reverse()},ha.prototype.mapToClass=function(d){function e(f){if(!f)return f;var k,l=Object.create(d.prototype);
for(k in f)if(ua.call(f,k))try{l[k]=f[k]}catch(m){}return l}this.schema.mappedClass=d;return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),d},ha.prototype.defineClass=function(){return this.mapToClass(function(d){b(this,d)})},ha.prototype.add=function(d,e){var f=this,k=this.schema.primKey,l=k.auto,m=k.keyPath,q=d;return m&&l&&(q=zb(m)(d)),this._trans("readwrite",function(u){return f.core.mutate({trans:u,type:"add",keys:null!=
e?[e]:null,values:[q]})}).then(function(u){return u.numFailures?N.reject(u.failures[0]):u.lastResult}).then(function(u){if(m)try{M(d,m,u)}catch(w){}return u})},ha.prototype.update=function(d,e){if("object"!=typeof d||pa(d))return this.where(":id").equals(d).modify(e);var f=D(d,this.schema.primKey.keyPath);if(void 0===f)return la(new S.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?ja(e).forEach(function(k){M(d,k,e[k])}):e(d,{value:d,primKey:f})}catch(k){}return this.where(":id").equals(f).modify(e)},
ha.prototype.put=function(d,e){var f=this,k=this.schema.primKey,l=k.auto,m=k.keyPath,q=d;return m&&l&&(q=zb(m)(d)),this._trans("readwrite",function(u){return f.core.mutate({trans:u,type:"put",values:[q],keys:null!=e?[e]:null})}).then(function(u){return u.numFailures?N.reject(u.failures[0]):u.lastResult}).then(function(u){if(m)try{M(d,m,u)}catch(w){}return u})},ha.prototype.delete=function(d){var e=this;return this._trans("readwrite",function(f){return e.core.mutate({trans:f,type:"delete",keys:[d]})}).then(function(f){return f.numFailures?
N.reject(f.failures[0]):void 0})},ha.prototype.clear=function(){var d=this;return this._trans("readwrite",function(e){return d.core.mutate({trans:e,type:"deleteRange",range:Rc})}).then(function(e){return e.numFailures?N.reject(e.failures[0]):void 0})},ha.prototype.bulkGet=function(d){var e=this;return this._trans("readonly",function(f){return e.core.getMany({keys:d,trans:f}).then(function(k){return k.map(function(l){return e.hook.reading.fire(l)})})})},ha.prototype.bulkAdd=function(d,e,f){var k=this,
l=Array.isArray(e)?e:void 0,m=(f=f||(l?void 0:e))?f.allKeys:void 0;return this._trans("readwrite",function(q){var u=k.schema.primKey,w=u.auto;if((u=u.keyPath)&&l)throw new S.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(l&&l.length!==d.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");var v=d.length;u=u&&w?d.map(zb(u)):d;return k.core.mutate({trans:q,type:"add",keys:l,values:u,wantResults:m}).then(function(x){var t=x.numFailures,
C=x.results,y=x.lastResult;x=x.failures;if(0===t)return m?C:y;throw new Ya(k.name+".bulkAdd(): "+t+" of "+v+" operations failed",x);})})},ha.prototype.bulkPut=function(d,e,f){var k=this,l=Array.isArray(e)?e:void 0,m=(f=f||(l?void 0:e))?f.allKeys:void 0;return this._trans("readwrite",function(q){var u=k.schema.primKey,w=u.auto;if((u=u.keyPath)&&l)throw new S.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(l&&l.length!==d.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");
var v=d.length;u=u&&w?d.map(zb(u)):d;return k.core.mutate({trans:q,type:"put",keys:l,values:u,wantResults:m}).then(function(x){var t=x.numFailures,C=x.results,y=x.lastResult;x=x.failures;if(0===t)return m?C:y;throw new Ya(k.name+".bulkPut(): "+t+" of "+v+" operations failed",x);})})},ha.prototype.bulkDelete=function(d){var e=this,f=d.length;return this._trans("readwrite",function(k){return e.core.mutate({trans:k,type:"delete",keys:d})}).then(function(k){var l=k.numFailures,m=k.lastResult;k=k.failures;
if(0===l)return m;throw new Ya(e.name+".bulkDelete(): "+l+" of "+f+" operations failed",k);})},ha),sd=(Z.prototype._read=function(d,e){var f=this._ctx;return f.error?f.table._trans(null,la.bind(null,f.error)):f.table._trans("readonly",d).then(e)},Z.prototype._write=function(d){var e=this._ctx;return e.error?e.table._trans(null,la.bind(null,e.error)):e.table._trans("readwrite",d,"locked")},Z.prototype._addAlgorithm=function(d){var e=this._ctx;e.algorithm=Ka(e.algorithm,d)},Z.prototype._iterate=function(d,
e){return Bb(this._ctx,d,e,this._ctx.table.core)},Z.prototype.clone=function(d){var e=Object.create(this.constructor.prototype),f=Object.create(this._ctx);return d&&b(f,d),e._ctx=f,e},Z.prototype.raw=function(){return this._ctx.valueMapper=null,this},Z.prototype.each=function(d){var e=this._ctx;return this._read(function(f){return Bb(e,d,f,e.table.core)})},Z.prototype.count=function(d){var e=this;return this._read(function(f){var k=e._ctx,l=k.table.core;if(Ta(k,!0))return l.count({trans:f,query:{index:Ab(k,
l.schema),range:k.range}}).then(function(q){return Math.min(q,k.limit)});var m=0;return Bb(k,function(){return++m,!1},f,l).then(function(){return m})}).then(d)},Z.prototype.sortBy=function(d,e){function f(w,v){return v?f(w[l[v]],v-1):w[m]}function k(w,v){w=f(w,q);v=f(v,q);return w<v?-u:v<w?u:0}var l=d.split(".").reverse(),m=l[0],q=l.length-1,u="next"===this._ctx.dir?1:-1;return this.toArray(function(w){return w.sort(k)}).then(e)},Z.prototype.toArray=function(d){var e=this;return this._read(function(f){var k=
e._ctx;if("next"===k.dir&&Ta(k,!0)&&0<k.limit){var l=k.valueMapper,m=Ab(k,k.table.core.schema);return k.table.core.query({trans:f,limit:k.limit,values:!0,query:{index:m,range:k.range}}).then(function(u){u=u.result;return l?u.map(l):u})}var q=[];return Bb(k,function(u){return q.push(u)},f,k.table.core).then(function(){return q})},d)},Z.prototype.offset=function(d){var e=this._ctx;return 0>=d||(e.offset+=d,Ta(e)?Xb(e,function(){var f=d;return function(k,l){return 0===f||(1===f?--f:l(function(){k.advance(f);
f=0}),!1)}}):Xb(e,function(){var f=d;return function(){return 0>--f}})),this},Z.prototype.limit=function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),Xb(this._ctx,function(){var e=d;return function(f,k,l){return 0>=--e&&k(l),0<=e}},!0),this},Z.prototype.until=function(d,e){return Wb(this._ctx,function(f,k,l){return!d(f.value)||(k(l),e)}),this},Z.prototype.first=function(d){return this.limit(1).toArray(function(e){return e[0]}).then(d)},Z.prototype.last=function(d){return this.reverse().first(d)},
Z.prototype.filter=function(d){var e;return Wb(this._ctx,function(f){return d(f.value)}),(e=this._ctx).isMatch=Ka(e.isMatch,d),this},Z.prototype.and=function(d){return this.filter(d)},Z.prototype.or=function(d){return new this.db.WhereClause(this._ctx.table,d,this)},Z.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Z.prototype.desc=function(){return this.reverse()},Z.prototype.eachKey=function(d){var e=
this._ctx;return e.keysOnly=!e.isMatch,this.each(function(f,k){d(k.key,k)})},Z.prototype.eachUniqueKey=function(d){return this._ctx.unique="unique",this.eachKey(d)},Z.prototype.eachPrimaryKey=function(d){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(f,k){d(k.primaryKey,k)})},Z.prototype.keys=function(d){var e=this._ctx;e.keysOnly=!e.isMatch;var f=[];return this.each(function(k,l){f.push(l.key)}).then(function(){return f}).then(d)},Z.prototype.primaryKeys=function(d){var e=this._ctx;
if("next"===e.dir&&Ta(e,!0)&&0<e.limit)return this._read(function(k){var l=Ab(e,e.table.core.schema);return e.table.core.query({trans:k,values:!1,limit:e.limit,query:{index:l,range:e.range}})}).then(function(k){return k.result}).then(d);e.keysOnly=!e.isMatch;var f=[];return this.each(function(k,l){f.push(l.primaryKey)}).then(function(){return f}).then(d)},Z.prototype.uniqueKeys=function(d){return this._ctx.unique="unique",this.keys(d)},Z.prototype.firstKey=function(d){return this.limit(1).keys(function(e){return e[0]}).then(d)},
Z.prototype.lastKey=function(d){return this.reverse().firstKey(d)},Z.prototype.distinct=function(){var d=this._ctx;d=d.index&&d.table.schema.idxByName[d.index];if(!d||!d.multi)return this;var e={};return Wb(this._ctx,function(f){var k=f.primaryKey.toString();f=ua.call(e,k);return e[k]=!0,!f}),this},Z.prototype.modify=function(d){var e=this,f=this._ctx;return this._write(function(k){function l(F,E){var H=E.failures;E=E.numFailures;B+=F-E;F=0;for(E=ja(H);F<E.length;F++)y.push(H[E[F]])}var m,q;var u=
"function"==typeof d?d:(m=ja(d),q=m.length,function(F){for(var E=!1,H=0;H<q;++H){var I=m[H],J=d[I];D(F,I)!==J&&(M(F,I,J),E=!0)}return E});var w=f.table.core,v=w.schema.primaryKey,x=v.outbound,t=v.extractKey,C=e.db._options.modifyChunkSize||200,y=[],B=0,G=[];return e.clone().primaryKeys().then(function(F){function E(H){var I=Math.min(C,F.length-H);return w.getMany({trans:k,keys:F.slice(H,H+I),cache:"immutable"}).then(function(J){for(var K=[],L=[],P=x?[]:null,R=[],W=0;W<I;++W){var qa=J[W],ka={value:ca(qa),
primKey:F[H+W]};!1!==u.call(ka,ka.value,ka)&&(null==ka.value?R.push(F[H+W]):x||0===ra(t(qa),t(ka.value))?(L.push(ka.value),x&&P.push(F[H+W])):(R.push(F[H+W]),K.push(ka.value)))}var T=Ta(f)&&f.limit===1/0&&("function"!=typeof d||d===sc)&&{index:f.index,range:f.range};return Promise.resolve(0<K.length&&w.mutate({trans:k,type:"add",values:K}).then(function(U){for(var X in U.failures)R.splice(parseInt(X),1);l(K.length,U)})).then(function(){return(0<L.length||T&&"object"==typeof d)&&w.mutate({trans:k,
type:"put",keys:P,values:L,criteria:T,changeSpec:"function"!=typeof d&&d}).then(function(U){return l(L.length,U)})}).then(function(){return(0<R.length||T&&d===sc)&&w.mutate({trans:k,type:"delete",keys:R,criteria:T}).then(function(U){return l(R.length,U)})}).then(function(){return F.length>H+I&&E(H+C)})})}return E(0).then(function(){if(0<y.length)throw new mb("Error modifying one or more objects",y,B,G);return F.length})})})},Z.prototype.delete=function(){var d=this._ctx,e=d.range;return Ta(d)&&(d.isPrimKey&&
!Dd||3===e.type)?this._write(function(f){return d.table.core.count({trans:f,query:{index:d.table.core.schema.primaryKey,range:e}}).then(function(k){return d.table.core.mutate({trans:f,type:"deleteRange",range:e}).then(function(l){var m=l.failures;l.lastResult;l.results;if(l=l.numFailures)throw new mb("Could not delete some values",Object.keys(m).map(function(q){return m[q]}),k-l);return k-l})})}):this.modify(sc)},Z),sc=function(d,e){return e.value=null},Ic=(Object.defineProperty(ma.prototype,"Collection",
{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ma.prototype.between=function(d,e,f,k){f=!1!==f;k=!0===k;try{return 0<this._cmp(d,e)||!(0!==this._cmp(d,e)||!f&&!k||f&&k)?Ua(this):new this.Collection(this,function(){return Fa(d,e,!f,!k)})}catch(l){return va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.")}},ma.prototype.equals=function(d){return null==d?va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>."):
new this.Collection(this,function(){return{type:1,lower:d,upper:d}})},ma.prototype.above=function(d){return null==d?va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>."):new this.Collection(this,function(){return Fa(d,void 0,!0)})},ma.prototype.aboveOrEqual=function(d){return null==d?va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>."):new this.Collection(this,function(){return Fa(d,void 0,
!1)})},ma.prototype.below=function(d){return null==d?va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>."):new this.Collection(this,function(){return Fa(void 0,d,!1,!0)})},ma.prototype.belowOrEqual=function(d){return null==d?va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>."):new this.Collection(this,function(){return Fa(void 0,d)})},ma.prototype.startsWith=function(d){return"string"!=typeof d?
va(this,"String expected."):this.between(d,d+Na,!0,!0)},ma.prototype.startsWithIgnoreCase=function(d){return""===d?this.startsWith(d):Cb(this,function(e,f){return 0===e.indexOf(f[0])},[d],Na)},ma.prototype.equalsIgnoreCase=function(d){return Cb(this,function(e,f){return e===f[0]},[d],"")},ma.prototype.anyOfIgnoreCase=function(){var d=V.apply(Pa,arguments);return 0===d.length?Ua(this):Cb(this,function(e,f){return-1!==f.indexOf(e)},d,"")},ma.prototype.startsWithAnyOfIgnoreCase=function(){var d=V.apply(Pa,
arguments);return 0===d.length?Ua(this):Cb(this,function(e,f){return f.some(function(k){return 0===e.indexOf(k)})},d,Na)},ma.prototype.anyOf=function(){var d=this,e=V.apply(Pa,arguments),f=this._cmp;try{e.sort(f)}catch(m){return va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.")}if(0===e.length)return Ua(this);var k=new this.Collection(this,function(){return Fa(e[0],e[e.length-1])});k._ondirectionchange=function(m){f="next"===m?d._ascending:
d._descending;e.sort(f)};var l=0;return k._addAlgorithm(function(m,q,u){for(var w=m.key;0<f(w,e[l]);)if(++l===e.length)return q(u),!1;return 0===f(w,e[l])||(q(function(){m.continue(e[l])}),!1)}),k},ma.prototype.notEqual=function(d){return this.inAnyRange([[-1/0,d],[d,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ma.prototype.noneOf=function(){var d=V.apply(Pa,arguments);if(0===d.length)return new this.Collection(this);try{d.sort(this._ascending)}catch(f){return va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.")}var e=
d.reduce(function(f,k){return f?f.concat([[f[f.length-1][1],k]]):[[-1/0,k]]},null);return e.push([d[d.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},ma.prototype.inAnyRange=function(d,e){function f(E,H){return C(E[0],H[0])}var k=this,l=this._cmp,m=this._ascending,q=this._descending,u=this._min,w=this._max;if(0===d.length)return Ua(this);if(!d.every(function(E){return void 0!==E[0]&&void 0!==E[1]&&0>=m(E[0],E[1])}))return va(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",
S.InvalidArgument);var v=!e||!1!==e.includeLowers,x=e&&!0===e.includeUppers,t,C=m;try{(t=d.reduce(function(E,H){for(var I=0,J=E.length;I<J;++I){var K=E[I];if(0>l(H[0],K[1])&&0<l(H[1],K[0])){K[0]=u(K[0],H[0]);K[1]=w(K[1],H[1]);break}}return I===J&&E.push(H),E},[])).sort(f)}catch(E){return va(this,"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.")}var y=0,B=x?function(E){return 0<m(E,t[y][1])}:function(E){return 0<=m(E,t[y][1])},G=v?function(E){return 0<
q(E,t[y][0])}:function(E){return 0<=q(E,t[y][0])},F=B;d=new this.Collection(this,function(){return Fa(t[0][0],t[t.length-1][1],!v,!x)});return d._ondirectionchange=function(E){C="next"===E?(F=B,m):(F=G,q);t.sort(f)},d._addAlgorithm(function(E,H,I){for(var J=E.key;F(J);)if(++y===t.length)return H(I),!1;return!B(J)&&!G(J)||(0===k._cmp(J,t[y][1])||0===k._cmp(J,t[y][0])||H(function(){C===m?E.continue(t[y][0]):E.continue(t[y][1])}),!1)}),d},ma.prototype.startsWithAnyOf=function(){var d=V.apply(Pa,arguments);
return d.every(function(e){return"string"==typeof e})?0===d.length?Ua(this):this.inAnyRange(d.map(function(e){return[e,e+Na]})):va(this,"startsWithAnyOf() only works with strings")},ma),Ga=eb(null,"storagemutated"),ud=(ya.prototype._lock=function(){return z(!O.global),++this._reculock,1!==this._reculock||O.global||(O.lockOwnerFor=this),this},ya.prototype._unlock=function(){if(z(!O.global),0==--this._reculock)for(O.global||(O.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var d=
this._blockedFuncs.shift();try{Ra(d[1],d[0])}catch(e){}}return this},ya.prototype._locked=function(){return this._reculock&&O.lockOwnerFor!==this},ya.prototype.create=function(d){var e=this;if(!this.mode)return this;var f=this.db.idbdb,k=this.db._state.dbOpenError;if(z(!this.idbtrans),!d&&!f)switch(k&&k.name){case "DatabaseClosedError":throw new S.DatabaseClosed(k);case "MissingAPIError":throw new S.MissingAPI(k.message,k);default:throw new S.OpenFailed(k);}if(!this.active)throw new S.TransactionInactive;
return z(null===this._completion._state),(d=this.idbtrans=d||(this.db.core||f).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=fa(function(l){gb(l);e._reject(d.error)}),d.onabort=fa(function(l){gb(l);e.active&&e._reject(new S.Abort(d.error));e.active=!1;e.on("abort").fire(l)}),d.oncomplete=fa(function(){e.active=!1;e._resolve();"mutatedParts"in d&&Ga.storagemutated.fire(d.mutatedParts)}),this},ya.prototype._promise=function(d,e,f){var k=this;if("readwrite"===
d&&"readwrite"!==this.mode)return la(new S.ReadOnly("Transaction is readonly"));if(!this.active)return la(new S.TransactionInactive);if(this._locked())return new N(function(m,q){k._blockedFuncs.push([function(){k._promise(d,e,f).then(m,q)},O])});if(f)return Ea(function(){var m=new N(function(q,u){k._lock();var w=e(q,u,k);w&&w.then&&w.then(q,u)});return m.finally(function(){return k._unlock()}),m._lib=!0,m});var l=new N(function(m,q){var u=e(m,q,k);u&&u.then&&u.then(m,q)});return l._lib=!0,l},ya.prototype._root=
function(){return this.parent?this.parent._root():this},ya.prototype.waitFor=function(d){var e,f=this._root(),k=N.resolve(d);f._waitingFor?f._waitingFor=f._waitingFor.then(function(){return k}):(f._waitingFor=k,f._waitingQueue=[],e=f.idbtrans.objectStore(f.storeNames[0]),function q(){for(++f._spinCount;f._waitingQueue.length;)f._waitingQueue.shift()();f._waitingFor&&(e.get(-1/0).onsuccess=q)}());var l=f._waitingFor;return new N(function(q,u){k.then(function(w){return f._waitingQueue.push(fa(q.bind(null,
w)))},function(w){return f._waitingQueue.push(fa(u.bind(null,w)))}).finally(function(){f._waitingFor===l&&(f._waitingFor=null)})})},ya.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))},ya.prototype.table=function(d){var e=this._memoizedTables||(this._memoizedTables={});if(ua.call(e,d))return e[d];var f=this.schema[d];if(!f)throw new S.NotFound("Table "+d+" not part of transaction");f=new this.db.Table(d,f,this);return f.core=this.db.core.table(d),
e[d]=f},ya),ib=function(d){try{return d.only([[]]),ib=function(){return[[]]},[[]]}catch(e){return ib=function(){return Na},Na}},ld=0,vd=(Gb.prototype._parseStoresSpec=function(d,e){ja(d).forEach(function(f){if(null!==d[f]){var k=d[f].split(",").map(function(m,q){var u=(m=m.trim()).replace(/([&*]|\+\+)/g,""),w=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Zb(u,w||null,/&/.test(m),/\*/.test(m),/\+\+/.test(m),pa(w),0===q)}),l=k.shift();if(l.multi)throw new S.Schema("Primary key cannot be multi-valued");
k.forEach(function(m){if(m.auto)throw new S.Schema("Only primary key can be marked as autoIncrement (++)");if(!m.keyPath)throw new S.Schema("Index must have a name and cannot be an empty string");});e[f]=Kc(f,l,k)}})},Gb.prototype.stores=function(d){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?b(this._cfg.storesSource,d):d;d=e._versions;var f={},k={};return d.forEach(function(l){b(f,l._cfg.storesSource);k=l._cfg.dbschema={};l._parseStoresSpec(f,k)}),e._dbSchema=k,bc(e,[e._allTables,
e,e.Transaction.prototype]),Db(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],ja(k),k),e._storeNames=ja(k),this},Gb.prototype.upgrade=function(d){return this._cfg.contentUpgrade=Lb(this._cfg.contentUpgrade||ba,d),this},Gb),wd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(d){return Y(Y({},d),{table:function(e){function f(t,C,y){var B=hb(t),G=q[B]=q[B]||[],F=null==t?0:"string"==typeof t?1:t.length;B=0<C;B=Y(Y({},y),{isVirtual:B,keyTail:C,keyLength:F,extractKey:$b(t),
unique:!B&&y.unique});return G.push(B),B.isPrimaryKey||u.push(B),1<F&&f(2===F?t[0]:t.slice(0,F-1),C+1,y),G.sort(function(E,H){return E.keyTail-H.keyTail}),B}function k(t){var C,y=t.query.index;return y.isVirtual?Y(Y({},t),{query:{index:y,range:(C=t.query.range,y=y.keyTail,{type:1===C.type?2:C.type,lower:Hb(C.lower,C.lowerOpen?d.MAX_KEY:d.MIN_KEY,y),lowerOpen:!0,upper:Hb(C.upper,C.upperOpen?d.MIN_KEY:d.MAX_KEY,y),upperOpen:!0})}}):t}var l=d.table(e),m=l.schema,q={},u=[];e=f(m.primaryKey.keyPath,0,
m.primaryKey);q[":id"]=[e];for(var w=0,v=m.indexes;w<v.length;w++){var x=v[w];f(x.keyPath,0,x)}return Y(Y({},l),{schema:Y(Y({},m),{primaryKey:e,indexes:u,getIndexByKeyPath:function(t){return(t=q[hb(t)])&&t[0]}}),count:function(t){return l.count(k(t))},query:function(t){return l.query(k(t))},openCursor:function(t){function C(F){return Object.create(F,{continue:{value:function(E){null!=E?F.continue(Hb(E,t.reverse?d.MAX_KEY:d.MIN_KEY,B)):t.unique?F.continue(F.key.slice(0,G).concat(t.reverse?d.MIN_KEY:
d.MAX_KEY,B)):F.continue()}},continuePrimaryKey:{value:function(E,H){F.continuePrimaryKey(Hb(E,d.MAX_KEY,B),H)}},primaryKey:{get:function(){return F.primaryKey}},key:{get:function(){var E=F.key;return 1===G?E[0]:E.slice(0,G)}},value:{get:function(){return F.value}}})}var y=t.query.index,B=y.keyTail,G=y.keyLength;return y.isVirtual?l.openCursor(k(t)).then(function(F){return F&&C(F)}):l.openCursor(t)}})}})}},xd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(d){return Y(Y({},d),{table:function(e){var f=
d.table(e),k=f.schema.primaryKey;return Y(Y({},f),{mutate:function(l){function m(t){var C,y,B=O.trans,G=t.keys||(C=k,"delete"===(y=t).type?y.keys:y.keys||y.values.map(C.extractKey));if(!G)throw Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?Y(Y({},t),{keys:G}):Y({},t)).type&&(t.values=a([],t.values,!0)),t.keys&&(t.keys=a([],t.keys,!0)),y=G,("add"===(C=t).type?Promise.resolve([]):f.getMany({trans:C.trans,keys:y,cache:"immutable"})).then(function(F){var E=G.map(function(H,
I){var J,K,L,P=F[I],R={onerror:null,onsuccess:null};return"delete"===t.type?w.fire.call(R,H,P,B):"add"===t.type||void 0===P?(J=v.fire.call(R,H,t.values[I],B),null==H&&null!=J&&(t.keys[I]=H=J,k.outbound||M(t.values[I],k.keyPath,H))):(J=lc(P,t.values[I]),(K=x.fire.call(R,J,H,P,B))&&(L=t.values[I],Object.keys(K).forEach(function(W){ua.call(L,W)?L[W]=K[W]:M(L,W,K[W])}))),R});return f.mutate(t).then(function(H){var I=H.failures,J=H.results,K=H.numFailures;H=H.lastResult;for(var L=0;L<G.length;++L){var P=
(J||G)[L],R=E[L];null==P?R.onerror&&R.onerror(I[L]):R.onsuccess&&R.onsuccess("put"===t.type&&F[L]?t.values[L]:P)}return{failures:I,results:J,numFailures:K,lastResult:H}}).catch(function(H){return E.forEach(function(I){return I.onerror&&I.onerror(H)}),Promise.reject(H)})})}var q=O.trans,u=q.table(e).hook,w=u.deleting,v=u.creating,x=u.updating;switch(l.type){case "add":if(v.fire===ba)break;return q._promise("readwrite",function(){return m(l)},!0);case "put":if(v.fire===ba&&x.fire===ba)break;return q._promise("readwrite",
function(){return m(l)},!0);case "delete":if(w.fire===ba)break;return q._promise("readwrite",function(){return m(l)},!0);case "deleteRange":if(w.fire!==ba)return q._promise("readwrite",function(){return function G(C,y,B){return f.query({trans:C,values:!1,query:{index:k,range:y},limit:B}).then(function(F){var E=F.result;return m({type:"delete",keys:E,trans:C}).then(function(H){return 0<H.numFailures?Promise.reject(H.failures[0]):E.length<B?{failures:[],numFailures:0,lastResult:void 0}:G(C,Y(Y({},y),
{lower:E[E.length-1],lowerOpen:!0}),B)})})}(l.trans,l.range,1E4)},!0)}return f.mutate(l)}})}})}},zd={stack:"dbcore",level:-1,create:function(d){return{table:function(e){var f=d.table(e);return Y(Y({},f),{getMany:function(k){if(!k.cache)return f.getMany(k);var l=Nc(k.keys,k.trans._cache,"clone"===k.cache);return l?N.resolve(l):f.getMany(k).then(function(m){return k.trans._cache={keys:k.keys,values:"clone"===k.cache?ca(m):m},m})},mutate:function(k){return"add"!==k.type&&(k.trans._cache=null),f.mutate(k)}})}}}},
za=function(d,e){if(!this){var f=new za;return d&&"d"in d&&b(f,d),f}b(this,arguments.length?{d:1,from:d,to:1<arguments.length?e:d}:{d:0})};c(za.prototype,((ta={add:function(d){return lb(this,d),this},addKey:function(d){return kb(this,d,d),this},addKeys:function(d){var e=this;return d.forEach(function(f){return kb(e,f,f)}),this}})[oc]=function(){return mc(this)},ta));var yd={stack:"dbcore",level:0,create:function(d){var e=d.schema.name,f=new za(d.MIN_KEY,d.MAX_KEY);return Y(Y({},d),{table:function(k){function l(C){C=
(y=C.query).index;var y=y.range;return[C,new za(null!==(C=y.lower)&&void 0!==C?C:d.MIN_KEY,null!==(y=y.upper)&&void 0!==y?y:d.MAX_KEY)]}var m=d.table(k),q=m.schema,u=q.primaryKey,w=u.extractKey,v=u.outbound,x=Y(Y({},m),{mutate:function(C){function y(L){return G[L="idb://"+e+"/"+k+"/"+L]||(G[L]=new za)}var B=C.trans,G=B.mutatedParts||(B.mutatedParts={}),F=y(""),E=y(":dels"),H=C.type;B="deleteRange"===C.type?[C.range]:"delete"===C.type?[C.keys]:50>C.values.length?[[],C.values]:[];var I=B[0],J=B[1],
K=C.trans._cache;return m.mutate(C).then(function(L){var P,R;return pa(I)?("delete"!==H&&(I=L.results),F.addKeys(I),(P=Nc(I,K))||"add"===H||E.addKeys(I),(P||J)&&(R=P,q.indexes.forEach(function(W){function qa(U){return null!=U?W.extractKey(U):null}function ka(U){return W.multiEntry&&pa(U)?U.forEach(function(X){return T.addKey(X)}):T.addKey(U)}var T=y(W.name||"");(R||J).forEach(function(U,X){U=R&&qa(R[X]);X=J&&qa(J[X]);0!==ra(U,X)&&(null!=U&&ka(U),null!=X&&ka(X))})}))):I?(P={from:I.lower,to:I.upper},
E.add(P),F.add(P)):(F.add(f),E.add(f),q.indexes.forEach(function(W){return y(W.name).add(f)})),L})}}),t={get:function(C){return[u,new za(C.key)]},getMany:function(C){return[u,(new za).addKeys(C.keys)]},count:l,query:l,openCursor:l};return ja(t).forEach(function(C){x[C]=function(y){var B=O.subscr;if(B){var G=function(K){K="idb://"+e+"/"+k+"/"+K;return B[K]||(B[K]=new za)},F=G(""),E=G(":dels"),H=t[C](y),I=H[0];H=H[1];if(G(I.name||"").add(H),!I.isPrimaryKey){if("count"!==C){var J="query"===C&&v&&y.values&&
m.query(Y(Y({},y),{values:!1}));return m[C].apply(this,arguments).then(function(K){if("query"===C){if(v&&y.values)return J.then(function(R){R=R.result;return F.addKeys(R),K});var L=y.values?K.result.map(w):K.result;(y.values?F:E).addKeys(L)}else if("openCursor"===C){var P=y.values;return K&&Object.create(K,{key:{get:function(){return E.addKey(K.primaryKey),K.key}},primaryKey:{get:function(){var R=K.primaryKey;return E.addKey(R),R}},value:{get:function(){return P&&F.addKey(K.primaryKey),K.value}}})}return K})}E.add(f)}}return m[C].apply(this,
arguments)}}),x}})}},La=(ia.prototype.version=function(d){if(isNaN(d)||.1>d)throw new S.Type("Given version is not a positive number");if(d=Math.round(10*d)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,d);var e=this._versions,f=e.filter(function(k){return k._cfg.version===d})[0];return f||(f=new this.Version(d),e.push(f),e.sort(od),f.stores({}),this._state.autoSchema=!1,f)},ia.prototype._whenReady=function(d){var e=
this;return this.idbdb&&(this._state.openComplete||O.letThrough||this._vip)?d():(new N(function(f,k){if(e._state.openComplete)return k(new S.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return void k(new S.DatabaseClosed);e.open().catch(ba)}e._state.dbReadyPromise.then(f,k)})).then(d)},ia.prototype.use=function(d){var e=d.stack,f=d.create,k=d.level,l=d.name;l&&this.unuse({stack:e,name:l});d=this._middlewares[e]||(this._middlewares[e]=[]);return d.push({stack:e,
create:f,level:null==k?10:k,name:l}),d.sort(function(m,q){return m.level-q.level}),this},ia.prototype.unuse=function(d){var e=d.stack,f=d.name,k=d.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(l){return k?l.create!==k:!!f&&l.name!==f})),this},ia.prototype.open=function(){return rd(this)},ia.prototype._close=function(){var d=this._state,e=jb.indexOf(this);if(0<=e&&jb.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(f){}this._novip.idbdb=null}d.dbReadyPromise=
new N(function(f){d.dbReadyResolve=f});d.openCanceller=new N(function(f,k){d.cancelOpen=k})},ia.prototype.close=function(){this._close();var d=this._state;this._options.autoOpen=!1;d.dbOpenError=new S.DatabaseClosed;d.isBeingOpened&&d.cancelOpen(d.dbOpenError)},ia.prototype.delete=function(){var d=this,e=0<arguments.length,f=this._state;return new N(function(k,l){function m(){d.close();var q=d._deps.indexedDB.deleteDatabase(d.name);q.onsuccess=fa(function(){var u=d._deps;var w=d.name;var v=u.indexedDB;
u=u.IDBKeyRange;ic(v)||"__dbnames"===w||hc(v,u).delete(w).catch(ba);k()});q.onerror=xa(l);q.onblocked=d._fireOnBlocked}if(e)throw new S.InvalidArgument("Arguments not allowed in db.delete()");f.isBeingOpened?f.dbReadyPromise.then(m):m()})},ia.prototype.backendDB=function(){return this.idbdb},ia.prototype.isOpen=function(){return null!==this.idbdb},ia.prototype.hasBeenClosed=function(){var d=this._state.dbOpenError;return d&&"DatabaseClosed"===d.name},ia.prototype.hasFailed=function(){return null!==
this._state.dbOpenError},ia.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ia.prototype,"tables",{get:function(){var d=this;return ja(this._allTables).map(function(e){return d._allTables[e]})},enumerable:!1,configurable:!0}),ia.prototype.transaction=function(){var d=function(e,f,k){var l=arguments.length;if(2>l)throw new S.InvalidArgument("Too few arguments");for(var m=Array(l-1);--l;)m[l-1]=arguments[l];return k=m.pop(),[e,Uc.apply([],m),k]}.apply(this,
arguments);return this._transaction.apply(this,d)},ia.prototype._transaction=function(d,e,f){var k=this,l=O.trans;l&&l.db===this&&-1===d.indexOf("!")||(l=null);var m,q=-1!==d.indexOf("?");d=d.replace("!","").replace("?","");try{if(m=e.map(function(v){v=v instanceof k.Table?v.name:v;if("string"!=typeof v)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return v}),"r"==d||"readonly"===d)var u="readonly";else{if("rw"!=d&&"readwrite"!=d)throw new S.InvalidArgument("Invalid transaction mode: "+
d);u="readwrite"}if(l){if("readonly"===l.mode&&"readwrite"===u){if(!q)throw new S.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");l=null}l&&m.forEach(function(v){if(l&&-1===l.storeNames.indexOf(v)){if(!q)throw new S.SubTransaction("Table "+v+" not included in parent transaction.");l=null}});q&&l&&!l.active&&(l=null)}}catch(v){return l?l._promise(null,function(x,t){t(v)}):la(v)}var w=function G(x,t,C,y,B){return N.resolve().then(function(){var F=
O.transless||O,E=x._createTransaction(t,C,x._dbSchema,y);F={trans:E,transless:F};if(y)E.idbtrans=y.idbtrans;else try{E.create(),x._state.PR1398_maxLoop=3}catch(J){return J.name===pc.InvalidState&&x.isOpen()&&0<--x._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),x._close(),x.open().then(function(){return G(x,t,C,null,B)})):la(J)}var H,I=gc(B);return I&&Sa(),F=N.follow(function(){var J;(H=B.call(E,E))&&(I?(J=Aa.bind(null,null),H.then(J,J)):"function"==typeof H.next&&"function"==typeof H.throw&&
(H=kc(H)))},F),(H&&"function"==typeof H.then?N.resolve(H).then(function(J){return E.active?J:la(new S.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):F.then(function(){return H})).then(function(J){return y&&E._resolve(),E._completion.then(function(){return J})}).catch(function(J){return E._reject(J),la(J)})})}.bind(null,this,u,m,l,f);return l?l._promise(u,w,"lock"):O.trans?Ra(O.transless,function(){return k._whenReady(w)}):this._whenReady(w)},ia.prototype.table=function(d){if(!ua.call(this._allTables,
d))throw new S.InvalidTable("Table "+d+" does not exist");return this._allTables[d]},ia);ta="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";var Ad=(nc.prototype.subscribe=function(d,e,f){return this._subscribe(d&&"function"!=typeof d?d:{next:d,error:e,complete:f})},nc.prototype[ta]=function(){return this},nc);try{var Jb={indexedDB:ea.indexedDB||ea.mozIndexedDB||ea.webkitIndexedDB||ea.msIndexedDB,IDBKeyRange:ea.IDBKeyRange||ea.webkitIDBKeyRange}}catch(d){Jb={indexedDB:null,
IDBKeyRange:null}}var Oa=La;c(Oa,Y(Y({},Ma),{delete:function(d){return(new Oa(d,{addons:[]})).delete()},exists:function(d){return(new Oa(d,{addons:[]})).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(d){try{return e=Oa.dependencies,f=e.indexedDB,e=e.IDBKeyRange,(ic(f)?Promise.resolve(f.databases()).then(function(k){return k.map(function(l){return l.name}).filter(function(l){return"__dbnames"!==l})}):hc(f,e).toCollection().primaryKeys()).then(d)}catch(k){return la(new S.MissingAPI)}var e,
f},defineClass:function(){return function(d){b(this,d)}},ignoreTransaction:function(d){return O.trans?Ra(O.transless,d):d()},vip:jc,async:function(d){return function(){try{var e=kc(d.apply(this,arguments));return e&&"function"==typeof e.then?e:N.resolve(e)}catch(f){return la(f)}}},spawn:function(d,e,f){try{var k=kc(d.apply(f,e||[]));return k&&"function"==typeof k.then?k:N.resolve(k)}catch(l){return la(l)}},currentTransaction:{get:function(){return O.trans||null}},waitFor:function(d,e){e=N.resolve("function"==
typeof d?Oa.ignoreTransaction(d):d).timeout(e||6E4);return O.trans?O.trans.waitFor(e):e},Promise:N,debug:{get:function(){return wa},set:function(d){da(d,"dexie"===d?function(){return!0}:Dc)}},derive:h,extend:b,props:c,override:p,Events:eb,on:Ga,liveQuery:Tc,extendObservabilitySet:Sc,getByKeyPath:D,setByKeyPath:M,delByKeyPath:function(d,e){"string"==typeof e?M(d,e,void 0):"length"in e&&[].map.call(e,function(f){M(d,f,void 0)})},shallowClone:Q,deepClone:ca,getObjectDiff:lc,cmp:ra,asap:r,minKey:-1/0,
addons:[],connections:jb,errnames:pc,dependencies:Jb,semVer:"3.2.4",version:["3","2","4"].map(function(d){return parseInt(d)}).reduce(function(d,e,f){return d+e/Math.pow(10,2*f)})}));Oa.maxKey=ib(Oa.dependencies.IDBKeyRange);"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Ga("storagemutated",function(d){var e;Ba||(Eb?(e=document.createEvent("CustomEvent")).initCustomEvent("x-storagemutated-1",!0,!0,d):e=new CustomEvent("x-storagemutated-1",{detail:d}),Ba=!0,dispatchEvent(e),
Ba=!1)}),addEventListener("x-storagemutated-1",function(d){d=d.detail;Ba||Ib(d)}));var Kb,Ba=!1;return"undefined"!=typeof BroadcastChannel?("function"==typeof(Kb=new BroadcastChannel("x-storagemutated-1")).unref&&Kb.unref(),Ga("storagemutated",function(d){Ba||Kb.postMessage(d)}),Kb.onmessage=function(d){d.data&&Ib(d.data)}):"undefined"!=typeof self&&"undefined"!=typeof navigator&&(Ga("storagemutated",function(d){try{Ba||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",
JSON.stringify({trig:Math.random(),changedParts:d})),"object"==typeof self.clients&&a([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:"x-storagemutated-1",changedParts:d})}))}catch(e){}}),"undefined"!=typeof addEventListener&&addEventListener("storage",function(d){"x-storagemutated-1"!==d.key||(d=JSON.parse(d.newValue))&&Ib(d.changedParts)}),(Jb=self.document&&navigator.serviceWorker)&&Jb.addEventListener("message",function(d){(d=d.data)&&"x-storagemutated-1"===
d.type&&Ib(d.changedParts)})),N.rejectionMapper=function(d,e){return!d||d instanceof aa||d instanceof TypeError||d instanceof SyntaxError||!d.name||!Vc[d.name]?d:(e=new Vc[d.name](e||d.message,d),"stack"in d&&g(e,"stack",{get:function(){return this.inner.stack}}),e)},da(wa,Dc),Y(La,Object.freeze({__proto__:null,Dexie:La,liveQuery:Tc,default:La,RangeSet:za,mergeRanges:lb,rangesOverlap:Pc}),{default:La}),La});
var Annotation=Class({create:function(a,b,c,g){this.stepCookie=[""];this.index=b;this.scale=1;this.pageWidth=c||BookInfo.getBook().pageWidth;this.pageHeight=g||BookInfo.getBook().pageHeight;this.containParent=this.noteParent=a;this.panelContainer=$("<div id='annotationPage"+b+"' class='panelContainer'></div>");this.panelContainer.css({top:0,left:"0px",height:"0px",bottom:0,right:0,margin:"auto"});this.canvasPanel=$("<canvas id='annotationCvsPanel"+b+"' class='annotationCvsPanel' width="+this.pageWidth+
" height="+this.pageHeight+" ></canvas>");this.drawCanvas=$("<canvas id='annotationDraw"+b+"' class='annotationDraw' width="+this.pageWidth+" height="+this.pageHeight+" ></canvas>");this.panelContainer.append(this.canvasPanel).append(this.drawCanvas);this.ctx=this.canvasPanel[0].getContext("2d");this.drawCtx=this.drawCanvas[0].getContext("2d");this.eraserCircle=$("<div class='eraserCircle' style='z-index:5;position:absolute;display:none'></div>");this.panelContainer.append(this.eraserCircle);this.containParent.append(this.panelContainer);
this.initCss();this.initEvent()},initCss:function(){this.panelContainer.css({"pointer-events":"none",position:"absolute","z-index":"5","-webkit-transform-origin":"0 0","-o-transform-origin":"0 0","-moz-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0",width:this.pageWidth+"px",height:this.pageHeight+"px"});this.canvasPanel.css({position:"absolute","z-index":"0",width:"100%",height:"100%"});this.drawCanvas.css({position:"absolute","z-index":"0",width:"100%",height:"100%"})},
onResize:function(a,b,c){this.scale=c;this.pageWidth=a;this.pageHeight=b;this.canvasPanel[0].width=a;this.canvasPanel[0].height=b;this.drawCanvas[0].width=a;this.drawCanvas[0].height=b;this.panelContainer.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});this.resizeNote(a,b)},resizeNote:function(a,b){var c=this,g,h,n,p,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return global.annotationCookie?r.yield(global.annotationCookie.getCookie("Note"),2):
r.return();g=r.yieldResult;if(!g)return r.return();h=g[c.index-1];if(!h)return r.return();for(n in h)p=a,z=b,c.noteParent.find("#"+n).css({left:h[n].position.x*p+"px",top:h[n].position.y*z+"px",width:h[n].size*a+"px",height:h[n].size*b+"px"}),c.noteParent.find("#"+n).find(".noteBox").css({top:h[n].size*z+10+"px"});r.jumpToEnd()})},initEvent:function(){this.eraserCircle.bind("pointerdown ",function(a){a.preventDefault()}.bind(this));this.panelContainer.bind("pointerdown mousedown mouseup mouseover mousemove",
function(a){a.stopPropagation()}.bind(this));this.panelContainer.bind("touchstart touchend touchmove",function(a){a.stopPropagation();a.preventDefault()}.bind(this));this.drawCanvas.bind("pointerdown ",function(a){a.stopPropagation()}.bind(this));this.canvasPanel.bind("pointerdown ",function(a){a.stopPropagation()}.bind(this));this.panelContainer.bind(_event._move,function(a){this.panelContainer.css({cursor:"auto"});switch(global.annotationPannel.selectCase){case AnnotationPannel.PEN:this.panelContainer.css({cursor:"url("+
uiBaseURL+"note_edit.png),auto"});break;case AnnotationPannel.RECT:this.panelContainer.css({cursor:"url("+uiBaseURL+"note_edit.png),auto"});break;case AnnotationPannel.ROUND:this.panelContainer.css({cursor:"url("+uiBaseURL+"note_edit.png),auto"})}}.bind(this));this.penPaint(this.drawCanvas);this.penPaint(this.canvasPanel)},penPaint:function(a){var b=0,c=0;a.bind("pointerdown mousedown touchstart",function(g){console.log("penPaint down");(isPhone()||isPad())&&global.annotationPannel.bottomBox.css({display:"none"});
global.colorPanel&&global.colorPanel.visible&&global.colorPanel.curElem[0]==global.annotationPannel.showColor[0]&&global.colorPanel.hide();global.annotationCookie.currentSteps=[];2==global.annotationPannel.selectCase||3==global.annotationPannel.selectCase||4==global.annotationPannel.selectCase?(b=2,c=16):c=b=-4;if(isPhone()||isPad())c=b=0;g=this.getPosition(g,b,c);this.X=g.x;this.Y=g.y;if(5==global.annotationPannel.selectCase){var h=this.getNumberFromSlider("eraser")/2;isPhone()||isPad()||(h=0);this.X=
g.x-h;this.Y=g.y-h;var n={x:(g.x-h)/this.pageWidth,y:(g.y-h)/this.pageHeight,lineWidth:this.getNumberFromSlider("eraser")/this.pageWidth};this.showEraser(g.x-h,g.y-h,"block");this.eraserClear(g.x-h,g.y-h);global.annotationCookie.currentSteps.push(n)}this.noLeaveCvs=this.isDown=!0}.bind(this));a.bind("mouseup touchend pointerup",function(g){this.eraserCircle.css({display:"none"});this.noLeaveCvs&&(this.drawCaseEvent(g),this.isDown=this.noLeaveCvs=!1)}.bind(this));a.bind("mouseleave",function(g){this.noLeaveCvs=
!1;if(this.isDown&&this.lastPos){this.isDown=!1;switch(global.annotationPannel.selectCase){case 2:global.annotationCookie.setAllAnnoSteps(2,this.index-1,global.annotationCookie.currentSteps);global.annotationCookie.stepIndex+=1;break;case 3:g={startX:this.X/this.pageWidth,startY:this.Y/this.pageHeight,x:this.lastPos.x/this.pageWidth,y:this.lastPos.y/this.pageHeight,lineWidth:this.getNumberFromSlider("width")/this.pageWidth,color:Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/
100)};global.annotationCookie.setAllAnnoSteps(3,this.index-1,[g]);global.annotationCookie.stepIndex+=1;this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight);this.drawRect(this.ctx,this.lastPos.x,this.lastPos.y);break;case 4:g={startX:this.X/this.pageWidth,startY:this.Y/this.pageHeight,x:this.lastPos.x/this.pageWidth,y:this.lastPos.y/this.pageHeight,lineWidth:this.getNumberFromSlider("width")/this.pageWidth,color:Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/
100)};global.annotationCookie.setAllAnnoSteps(4,this.index-1,[g]);global.annotationCookie.stepIndex+=1;this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight);this.drawEllipse(this.ctx,this.lastPos.x,this.lastPos.y);break;case 5:global.annotationCookie.setAllAnnoSteps(5,this.index-1,global.annotationCookie.currentSteps),global.annotationCookie.stepIndex+=1}this.lastPos=void 0}}.bind(this));a.bind("mousemove touchmove pointermove",function(g){console.log("penPaint move");if(this.isDown&&this.noLeaveCvs)switch(g=
this.getPosition(g,b,c),global.annotationPannel.selectCase){case AnnotationPannel.PEN:var h={startX:this.X/this.pageWidth,startY:this.Y/this.pageHeight,x:g.x/this.pageWidth,y:g.y/this.pageHeight,lineWidth:this.getNumberFromSlider("width")/this.pageWidth,opacity:this.getNumberFromSlider("alpha")/100,color:Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/100)};global.annotationCookie.currentSteps.push(h);this.drawLine(g.x,g.y);this.noLeaveCvs&&(this.lastPos=g);
break;case AnnotationPannel.ERASER:var n=this.getNumberFromSlider("eraser")/2;isPhone()||isPad()||(n=0);this.showEraser(g.x-n,g.y-n,"block");h={x:(g.x-n)/this.pageWidth,y:(g.y-n)/this.pageHeight,lineWidth:this.getNumberFromSlider("eraser")/this.pageWidth};global.annotationCookie.currentSteps.push(h);this.eraserClear(g.x-n,g.y-n);this.noLeaveCvs&&(this.lastPos=g);break;case AnnotationPannel.RECT:this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight);this.drawRect(this.drawCtx,g.x,g.y);this.noLeaveCvs&&
(this.lastPos=g);break;case AnnotationPannel.ROUND:this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight),this.drawEllipse(this.drawCtx,g.x,g.y),this.noLeaveCvs&&(this.lastPos=g)}}.bind(this))},getNumberFromSlider:function(a){switch(a){case "width":return isPhone()||isPad()?parseInt(global.annotationPannel.widthBox.find(".bubbleNum").text()):global.annotationPannel.inputWidth.val();case "eraser":return isPhone()||isPad()?parseInt(global.annotationPannel.eraserBox.find(".bubbleNum").text()):global.annotationPannel.inputEraserWidth.val();
case "alpha":return isPhone()||isPad()?parseInt(global.annotationPannel.alphaBox.find(".bubbleNum").text()):global.annotationPannel.inputAlpha.val()}},drawCaseEvent:function(a){switch(global.annotationPannel.selectCase){case 2:a=this.getPosition(a,2,16);global.annotationCookie.setAllAnnoSteps(2,this.index-1,global.annotationCookie.currentSteps);this.X=a.x;this.Y=a.y;global.annotationCookie.stepIndex+=1;break;case 3:a=this.getPosition(a,2,16);var b={startX:this.X/this.pageWidth,startY:this.Y/this.pageHeight,
x:a.x/this.pageWidth,y:a.y/this.pageHeight,lineWidth:this.getNumberFromSlider("width")/this.pageWidth,color:Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/100)};global.annotationCookie.setAllAnnoSteps(3,this.index-1,[b]);this.drawRect(this.ctx,a.x,a.y);this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight);this.X=a.x;this.Y=a.y;global.annotationCookie.stepIndex+=1;break;case 4:a=this.getPosition(a,2,16);b={startX:this.X/this.pageWidth,startY:this.Y/this.pageHeight,
x:a.x/this.pageWidth,y:a.y/this.pageHeight,lineWidth:this.getNumberFromSlider("width")/this.pageWidth,color:Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/100)};global.annotationCookie.setAllAnnoSteps(4,this.index-1,[b]);this.drawEllipse(this.ctx,a.x,a.y);this.drawCtx.clearRect(0,0,this.pageWidth,this.pageHeight);this.X=a.x;this.Y=a.y;global.annotationCookie.stepIndex+=1;break;case 5:global.annotationCookie.setAllAnnoSteps(5,this.index-1,global.annotationCookie.currentSteps),
global.annotationCookie.stepIndex+=1}},getPosition:function(a,b,c,g){if(isPad()||isPhone())c=b=0,"note"==g&&(b=-this.pageWidth/25,c=-this.pageHeight/28);var h;g=(null==(h=BookInfo.getBook().showPage.parameters)?void 0:h.toScale)||1;if(bookType===BookType.documentView_book||bookType===BookType.singleDocumentView_book)g=BookInfo.getBook().docViewBook.parameters.toScale||1;a=a.originalEvent&&a.originalEvent.changedTouches?a.originalEvent.changedTouches:a.changedTouches?a.changedTouches:[a];var n=document.documentElement.scrollLeft||
document.body.scrollLeft;h=document.documentElement.scrollTop||document.body.scrollTop;b=(a[0].pageX||a[0].clientX+n)-this.panelContainer.offset().left+b;a=(a[0].pageY||a[0].clientY+h)-this.panelContainer.offset().top+c;return{x:b/g,y:a/g}},showEraser:function(a,b){var c=this.getNumberFromSlider("eraser");this.eraserCircle.css({"pointer-events":"none",display:"block",background:"rgba(33,33,33,0.4)",width:c+"px",height:c+"px",left:a+"px",top:b+"px"})},drawLine:function(a,b){this.ctx.beginPath();.85<=
this.getNumberFromSlider("alpha")/100?this.ctx.lineCap="round":this.ctx.lineCap="butt";this.ctx.lineJoin="round";this.ctx.lineWidth=this.getNumberFromSlider("width");this.ctx.strokeStyle=Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/100);this.ctx.moveTo(this.X,this.Y);this.ctx.lineTo(a,b);this.ctx.stroke();this.X=a;this.Y=b},drawRect:function(a,b,c){a.beginPath();a.lineCap="round";a.lineJoin="round";a.lineWidth=this.getNumberFromSlider("width");a.strokeStyle=
Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/100);var g=this.X,h=this.Y;0>b-this.X&&(g=b);0>c-this.Y&&(h=c);a.moveTo(g,h);a.strokeRect(g,h,Math.abs(b-this.X),Math.abs(c-this.Y));a.stroke()},drawEllipse:function(a,b,c){b=b/2+this.X/2;c=c/2+this.Y/2;var g=Math.abs(b-this.X),h=Math.abs(c-this.Y);a.lineCap="round";a.lineJoin="round";a.lineWidth=this.getNumberFromSlider("width");a.strokeStyle=Color(global.annotationPannel.inputColor.val()).rgba(this.getNumberFromSlider("alpha")/
100);a.save();var n=g>h?g:h;g/=n;h/=n;a.scale(g,h);a.beginPath();a.arc(b/g,c/h,n,0,2*Math.PI,!1);a.closePath();a.restore();a.stroke()},eraserClear:function(a,b){this.ctx.beginPath();this.ctx.stroke();this.ctx.clearRect(this.X,this.Y,this.getNumberFromSlider("eraser"),this.getNumberFromSlider("eraser"));this.X=a;this.Y=b},clearCvs:function(){this.ctx.clearRect(0,0,this.pageWidth,this.pageHeight)}}),AnnotationCookie=Class({create:function(a,b,c){var g=this;this.parent=a;this.bookType=BookInfo.getBookType();
this.pageWidth=b;this.pageHeight=c;this.defaultWidth=b;this.scale=this.tranScale=1;this.stepIndex=0;this.currentSteps=[];this.allAnnoSteps=[];this.migrationStatusMap=new Map;global.annotationCookieDB=new AnnotationCookieDB;global.annotationCookieDB.init().then(function(){g.migrateData()});this.repaintCookie=debounceAsyncByKey(this.debounceRepaintCookie,100,function(h){return h[2]})},getCookieName:function(a){var b=bookConfig.ClientBookId?bookConfig.ClientBookId:"";return window.location.href.replace(window.location.hash,
"").replace(window.location.search,"")+b+a},getCookie:function(a){var b=this,c,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){return 1==h.nextAddress?(null==(c=b.migrationStatusMap.get(a))?0:c.isDone)?h.jumpTo(2):h.yield(b.migrateLocalStorageToIndexedDB(a),2):4!=h.nextAddress?h.yield(global.annotationCookieDB.getCookie(a),4):(g=h.yieldResult)?h.return(g):h.return(null)})},migrateData:function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){return 1==b.nextAddress?
b.yield(a.migrateLocalStorageToIndexedDB("Cookie"),2):b.yield(a.migrateLocalStorageToIndexedDB("Note"),0)})},migrateLocalStorageToIndexedDB:function(a){var b=this,c,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:c=b.migrationStatusMap.get(a)||{promise:null,isDone:!1};if(c.isDone)return h.return();if(!c.promise){h.jumpTo(2);break}return h.yield(c.promise,3);case 3:return h.return();case 2:return g=function(){var n,p,z,r,A;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){switch(D.nextAddress){case 1:return D.yield(global.annotationCookieDB.getCookie(a),
2);case 2:if(n=D.yieldResult)return D.return(n);p=b.getCookieName(a);z=window.localStorage.getItem(p);if(!z)return D.return();A=r=JSON.parse(z);D.setCatchFinallyBlocks(3);return D.yield(global.annotationCookieDB.saveCookie(a,A),5);case 5:D.leaveTryBlock(0);break;case 3:D.enterCatchBlock(),D.jumpToEnd()}})}.call(b),b.migrationStatusMap.set(a,{promise:g,isDone:!1}),h.yield(g,4);case 4:b.migrationStatusMap.set(a,{promise:null,isDone:!0}),h.jumpToEnd()}})},hasCvsCookie:function(a){var b=this,c,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:c=
["Cookie"],g=0;case 2:if(!(g<c.length)){n.jumpTo(4);break}return n.yield(b.getCookie(c[g]),5);case 5:if((h=n.yieldResult)&&h.length&&h[a]&&h[a].length)return n.return(!0);g++;n.jumpTo(2);break;case 4:return n.return(!1)}})},saveCookie:function(){var a=this,b,c,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(1==n.nextAddress)return n.yield(a.getCookie("Cookie",!1),2);(b=n.yieldResult)||(b=[]);for(c=0;c<a.stepIndex;c++)if(g=a.allAnnoSteps[c].index,a.isArray(g))for(h=0;h<g.length;h++)b[g[h]]=
[];else b[g]||(b[g]=[]),b[g].push(a.allAnnoSteps[c]);return n.yield(global.annotationCookieDB.saveCookie("Cookie",b),0)})},getPage:function(a){a=a?a+1:BookInfo.getBook().currentPageIndex;var b="";"slide"==bookConfig.FlipStyle.toLocaleLowerCase()&&BookInfo.isDoublePage(BookInfo.getBookType())?(BookInfo.getBook().pageArray[a].leftPage?b=BookInfo.getBook().pageArray[a].leftPage.pageAttachments.$annotation:BookInfo.getBook().pageArray[a].rightPage&&(b=BookInfo.getBook().pageArray[a].rightPage.pageAttachments.$annotation),
rightToLeft&&BookInfo.getBook().pageArray[a].rightPage&&(b=BookInfo.getBook().pageArray[a].rightPage.pageAttachments.$annotation)):b=BookInfo.getBook().pageArray[a].page.pageAttachments.$annotation;return b},debounceRepaintCookie:function(a,b,c,g){var h=this,n,p,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){h.pageWidth=a;h.pageHeight=b;g||(g=h.getPage(c));a&&b||(h.pageWidth=g.width(),h.pageHeight=g.height());if(!h.pageWidth||!h.pageHeight)return r.return();h.clearUnsaveCookie();
if(!BookInfo.getBook().showPage.find("#annotationCvsPanel"+(c+1))[0])return r.return();n=BookInfo.getBook().showPage.find("#annotationCvsPanel"+(c+1))[0].getContext("2d");n.clearRect(0,0,h.pageWidth,h.pageHeight);p=function(){h.getCookie("Cookie").then(function(A){A&&A[c]&&h.putCookie(c,A[c],a,b)})};z=function(){h.getCookie("Note").then(function(A){if(g&&A){A[c]&&Object.keys(A[c]).length&&g.css({display:"block"});for(var D in A[c]){var M=A[c][D],Q=M.position.x*a,ca=M.position.y*b,V=g.find("#"+D),
da=h.getNoteBoxSize();V[0]?(V.css({"font-size":14/h.scale+"px",left:Q/h.scale+"px",top:ca/h.scale+"px",width:.05*a/h.scale+"px",height:.05*a/h.scale+"px"}),isPad()||isPhone()?(V.css({width:.05*a/h.scale+"px",height:.05*a/h.scale+"px"}),V.find(".noteBox").css({top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-transform":"translate(-50%, -50%)"})):V.find(".noteBox").css({top:(.05*a+10)/h.scale+"px","-webkit-transform":"scale("+h.tranScale+")","-o-transform":"scale("+h.tranScale+")","-moz-transform":"scale("+
h.tranScale+")","-ms-transform":"scale("+h.tranScale+")",transform:"scale("+h.tranScale+")","-webkit-transform-origin":"0 0","-o-transform-origin":"0 0","-moz-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"}),V.find(".noteBox textarea").css({width:da.width-20+"px",height:da.height+"px"}).val(M.value),isPhone()||isPad()?V.find(".noteBox .noteTitle").css({width:da.width-82+"px"}):V.find(".noteBox .noteTitle").css({width:da.width-68+"px"}),h.refreshNoteColor(V,M.colorIndex,
da)):isPhone()||isPad()?new AnnotationAddMobileNote(g,A[c][D]):new AnnotationAddNote(g,A[c][D])}}})};p();z();r.jumpToEnd()})},getNoteBoxSize:function(){if(isPhone()){var a=148<parseInt(this.pageWidth/2)?148:parseInt(this.pageWidth/2);var b=80<parseInt(this.pageHeight/2)?80:parseInt(this.pageHeight/2)}else a=228<parseInt(this.pageWidth/2)?228:parseInt(this.pageWidth/2),b=100<parseInt(this.pageHeight/2)?100:parseInt(this.pageHeight/2);b>a-20&&(b=a-20);return{width:a,height:b}},refreshNoteColor:function(a,
b,c){if(void 0!=b){var g=a.find(".noteBox"),h="#FFF1dc #ffe2df #e6f6ff #e7ffea #f3e9ff #d0cdc7".split(" "),n=g.find(".colorBox");a.find(".noteSvgIcon").html(this.getNoteSvg(h[b]));g.css({background:h[b]});a=$(n.find("span")[b]);if(isPhone()||isPad())4>p&&(p=4),8<p&&(p=8),n.find("span").removeClass("active").css({margin:"10px "+p+"px;"});else{var p=(c.width-72)/7;4>p&&(p=4);n.find("span").removeClass("active").css({margin:"9px 0 9px "+p+"px","box-shadow":"0 0 0 1px rgba(11,11,11,0.3)","-webkit-box-shadow":"0 0 0 1px rgba(11,11,11,0.3)"})}a.addClass("active").css({"box-shadow":"0 0 0 2px #4BA0FF",
"-webkit-box-shadow":"0 0 0 2px #4BA0FF"})}},getNoteSvg:function(a){return'<svg style="position:absolute;top:0;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><defs><style>.cls-1, .cls-2 {fill-rule: evenodd;}.cls-1 {opacity: 0.85;}</style></defs><path id="\u8930\u3222\u59f8_2" data-name="\u8930\u3222\u59f8 2" class="cls-1" d="M2,0H15.917A1.98,1.98,0,0,1,18,2V13l-5,5s-8.875.063-11,0-2-2.667-2-2.667-0.062-10.562,0-13S2,0,2,0Z"/><path  fill="'+a+'" id="\u8930\u3222\u59f8_2_\u93b7\u75af\u7909" data-name="\u8930\u3222\u59f8 2 \u93b7\u75af\u7909" class="cls-2" d="M2,1H16a0.863,0.863,0,0,1,1,1c-0.031,1.156,0,10,0,10H12v5H2s-0.906.281-1-1S0.969,3,1,2A0.994,0.994,0,0,1,2,1ZM13,13h4l-4,4V13ZM4.5,5h5a0.5,0.5,0,0,1,0,1h-5A0.5,0.5,0,0,1,4.5,5Zm0,3h7a0.5,0.5,0,0,1,0,1h-7A0.5,0.5,0,0,1,4.5,8Zm0,3h5a0.5,0.5,0,0,1,0,1h-5A0.5,0.5,0,0,1,4.5,11Z"/></svg>'},
putCookie:function(a,b,c,g){if(BookInfo.getBook().showPage.find("#annotationCvsPanel"+(a+1))[0]&&(BookInfo.getBook().showPage.find("#annotationCvsPanel"+(a+1))[0].getContext("2d"),b))for(var h=0;h<b.length;h++){var n=b[h].cookie,p=b[h].type;var z=BookInfo.getBook().showPage.find("#annotationCvsPanel"+(a+1))[0].getContext("2d");if("Clear"==p)for(var r=BookInfo.getCurrentPages(),A=0;A<r.length;A++){z=BookInfo.getBook().showPage.find("#annotationCvsPanel"+r[A])[0];if(!z)return;z=z.getContext("2d");z.clearRect(0,
0,this.pageWidth,this.pageHeight)}for(r=0;r<n.length;r++)switch(p){case "Pen":this.drawLine(z,n[r],c,g);break;case "Rect":this.drawRect(z,n[r],c,g);break;case "Round":this.drawRound(z,n[r],c,g);break;case "Eraser":this.drawClear(z,n[r],c,g)}}},stepPaint:function(a,b,c){if("Clear"!=a)var g=BookInfo.getBook().showPage.find("#annotationCvsPanel"+(b+1))[0].getContext("2d");for(var h=0;h<c.length;h++)switch(a){case "Pen":this.drawLine(g,c[h]);break;case "Rect":this.drawRect(g,c[h]);break;case "Round":this.drawRound(g,
c[h]);break;case "Eraser":this.drawClear(g,c[h]);break;case "Clear":for(var n=0;n<b.length;n++)g=BookInfo.getBook().showPage.find("#annotationCvsPanel"+(b[n]+1))[0].getContext("2d"),g.clearRect(0,0,this.pageWidth,this.pageHeight)}},repaintSteps:function(){var a=this,b,c,g,h,n,p,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:if(!a.allAnnoSteps.length)return r.return();r.setCatchFinallyBlocks(2);b=BookInfo.getCurrentPages();c=0;case 4:if(!(c<b.length)){for(p=
0;p<a.stepIndex;p++)a.stepPaint(a.allAnnoSteps[p].type,a.allAnnoSteps[p].index,a.allAnnoSteps[p].cookie);r.leaveTryBlock(0);break}g=BookInfo.getBook().showPage.find("#annotationCvsPanel"+b[c])[0].getContext("2d");g.clearRect(0,0,a.pageWidth,a.pageHeight);return r.yield(a.hasCvsCookie(b[c]-1),7);case 7:h=r.yieldResult;if(!h){r.jumpTo(5);break}return r.yield(a.getCookie("Cookie"),9);case 9:n=r.yieldResult,a.putCookie(b[c]-1,n[b[c]-1]);case 5:c++;r.jumpTo(4);break;case 2:z=r.enterCatchBlock(),console.log(z),
r.jumpToEnd()}})},clearUnsaveCookie:function(){this.stepIndex=0;this.currentSteps=[];this.allAnnoSteps=[]},deleteNoteCookie:function(a,b,c){return global.annotationCookieDB.deleteNoteCookie(a,b,c)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},drawRound:function(a,b,c,g){var h=c||this.pageWidth,n=g||this.pageHeight;if(this.isFullConfig(b)){g=(b.x/2+b.startX/2)*h;c=(b.y/2+b.startY/2)*n;var p=Math.abs(g-b.startX*h);n=Math.abs(c-b.startY*n);a.lineCap="round";a.lineJoin=
"round";a.lineWidth=parseInt(b.lineWidth*h);a.strokeStyle=b.color;a.save();b=p>n?p:n;h=p/b;p=n/b;a.scale(h,p);a.beginPath();a.arc(g/h,c/p,b,0,2*Math.PI,!1);a.closePath();a.restore();a.stroke()}},drawRect:function(a,b,c,g){c=c||this.pageWidth;g=g||this.pageHeight;if(this.isFullConfig(b)){a.beginPath();a.lineCap="round";a.lineJoin="round";a.lineWidth=b.lineWidth*c;a.strokeStyle=b.color;var h=b.startX*c,n=b.startY*g;0>b.x-b.startX&&(h=b.x*c);0>b.y-b.startY&&(n=b.y*g);a.moveTo(h,n);a.strokeRect(h,n,Math.abs(b.x-
b.startX)*c,Math.abs(b.y-b.startY)*g);a.stroke()}},drawLine:function(a,b,c,g){c=c||this.pageWidth;g=g||this.pageHeight;this.isFullConfig(b)&&(a.lineCap=.85<=b.opacity?"round":"butt",a.lineJoin="round",a.lineWidth=b.lineWidth*c,a.strokeStyle=b.color,a.beginPath(),a.moveTo(b.startX*c,b.startY*g),a.lineTo(b.x*c,b.y*g),a.stroke(),a.closePath())},drawClear:function(a,b,c,g){c=c||this.pageWidth;g=g||this.pageHeight;a&&b.x&&b.y&&b.lineWidth&&(a.beginPath(),a.clearRect(b.x*c,b.y*g,b.lineWidth*c,b.lineWidth*
g),a.stroke(),a.closePath())},isFullConfig:function(a){return a&&a.startX&&a.startY&&a.x&&a.y&&a.lineWidth&&a.color},onResize:function(a,b,c){this.scale=c;this.tranScale=a/this.defaultWidth;this.pageWidth=a;this.pageHeight=b},setAllAnnoSteps:function(a,b,c){this.allAnnoSteps.length>this.stepIndex&&(this.allAnnoSteps.length=this.stepIndex);switch(a){case 2:this.allAnnoSteps.push({type:"Pen",index:b,cookie:c});break;case 3:this.allAnnoSteps.push({type:"Rect",index:b,cookie:c});break;case 4:this.allAnnoSteps.push({type:"Round",
index:b,cookie:c});break;case 5:this.allAnnoSteps.push({type:"Eraser",index:b,cookie:c});break;case 11:this.allAnnoSteps.push({type:"Clear",index:b,cookie:c})}},saveNoteCookie:function(a,b,c,g){return global.annotationCookieDB.saveNoteCookie(a,b,c,g)}}),AnnotationCookieDB=Class({create:function(){this.annotationDb=null;this.storeName="annotations";this.initPromise=null;this.isInitialized=!1},init:function(a){a=void 0===a?"AnnotationDB":a;var b=this,c,g,h,n,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(z){switch(z.nextAddress){case 1:if(b.isInitialized)return z.return();
c=0;g=5;case 2:if(!("undefined"===typeof Dexie&&c<g)){if("undefined"===typeof Dexie)return z.return();z.setCatchFinallyBlocks(5);b.annotationDb=new Dexie(a);h={};b.annotationDb.version(1).stores((h[b.storeName]="++id, key, type",h));b.initPromise=b.annotationDb.open();return z.yield(b.initPromise,7)}return z.yield(new Promise(function(r){return setTimeout(r,100)}),4);case 4:c++;z.jumpTo(2);break;case 7:b.isInitialized=!0;z.leaveTryBlock(0);break;case 5:return z.enterCatchBlock(),z.setCatchFinallyBlocks(8),
z.yield(null==(n=b.annotationDb)?void 0:n.delete(),10);case 10:return b.annotationDb=new Dexie(a),p={},b.annotationDb.version(1).stores((p[b.storeName]="++id, key, type",p)),b.initPromise=b.annotationDb.open(),z.yield(b.initPromise,11);case 11:b.isInitialized=!0;z.leaveTryBlock(0);break;case 8:z.enterCatchBlock(),z.jumpToEnd()}})},ensureInit:function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){switch(b.nextAddress){case 1:if(a.isInitialized){b.jumpTo(2);break}return b.yield(a.init(),
2);case 2:return b.setCatchFinallyBlocks(4),b.yield(a.initPromise,6);case 6:b.leaveTryBlock(0);break;case 4:b.enterCatchBlock(),b.jumpToEnd()}})},getCookieName:function(a){var b="undefined"!==typeof bookConfig&&bookConfig.ClientBookId?bookConfig.ClientBookId:"";return window.location.href.replace(window.location.hash,"").replace(window.location.search,"")+b+a},getCookie:function(a){var b=this,c,g,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:return n.yield(b.ensureInit(),
2);case 2:return c=b.getCookieName(a),n.setCatchFinallyBlocks(3),n.yield(b.annotationDb[b.storeName].where("key").equals(c).first(),5);case 5:return(g=n.yieldResult)&&g.content?n.return(JSON.parse(g.content)):n.return(null);case 3:return h=n.enterCatchBlock(),console.log("getCookie error:",h),n.return(null)}})},saveCookie:function(a,b,c){c=void 0===c?"":c;var g=this,h,n,p,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:return r.yield(g.ensureInit(),2);
case 2:return h=g.getCookieName(a),n={key:h,type:c,content:"string"===typeof b?b:JSON.stringify(b)},r.setCatchFinallyBlocks(3),r.yield(g.annotationDb[g.storeName].where("key").equals(h).first(),5);case 5:return(p=r.yieldResult)?(n.id=p.id,r.yield(g.annotationDb[g.storeName].put(n),9)):r.yield(g.annotationDb[g.storeName].add(n),8);case 8:return r.return(r.yieldResult);case 9:return r.return(r.yieldResult);case 7:r.leaveTryBlock(0);break;case 3:z=r.enterCatchBlock(),console.log("saveCookie error:",
z),r.jumpToEnd()}})},deleteCookie:function(a){var b=this,c,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:return h.yield(b.ensureInit(),2);case 2:return c=b.getCookieName(a),h.setCatchFinallyBlocks(3),h.yield(b.annotationDb[b.storeName].where("key").equals(c).delete(),5);case 5:return h.return(h.yieldResult);case 3:g=h.enterCatchBlock(),console.log("deleteCookie error:",g),h.jumpToEnd()}})},saveNoteCookie:function(a,b,c,g){var h=this,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){switch(p.nextAddress){case 1:return p.yield(h.ensureInit(),
2);case 2:return p.yield(h.getCookie(a),3);case 3:return n=(n=p.yieldResult)||[],n[b]||(n[b]={}),n[b][c]=g,p.yield(h.saveCookie(a,n),4);case 4:return p.return(p.yieldResult)}})},deleteNoteCookie:function(a,b,c){var g=this,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:return n.yield(g.ensureInit(),2);case 2:return n.yield(g.getCookie(a),3);case 3:h=n.yieldResult;if(!(h&&h[b]&&h[b][c])){console.log("Note item not found");n.jumpTo(0);break}delete h[b][c];
0===Object.keys(h[b]).length&&(h[b]=null);return n.yield(g.saveCookie(a,h),5);case 5:return n.return(n.yieldResult)}})}}),AnnotationAddNote=Class({create:function(a,b,c){this.parent=a;this.config=b;b.colorIndex||(b.colorIndex=0);this.size=.05;this.setColorIndex(b.colorIndex);this.initPageConfig();this.colorArr="#FFF1dc #ffe2df #e6f6ff #e7ffea #f3e9ff #d0cdc7".split(" ");this.position={x:b.position.x*this.notePanelWidth,y:b.position.y*this.notePanelHeight};if(isPhone()||isPad()){var g,h;this.position=
{x:b.position.x*this.notePanelWidth/((null==(g=global.annotationCookie)?void 0:g.scale)||1),y:b.position.y*this.notePanelHeight/((null==(h=global.annotationCookie)?void 0:h.scale)||1)}}this.noteShow=c;this.container=$("<div id="+b.id+" title='"+this.config.value+"' class='noteContainer button'></div>");this.icon=$("<div class='noteSvgIcon'>"+this.getNoteSvg("#FFF1dc")+"</div>");b.colorIndex&&this.icon.html(this.getNoteSvg(this.colorArr[b.colorIndex]));this.close=$("<p class='note-panel-close button' role='button' tabindex='0'><span class='note-btn-icon'></span></p>");
this.remove=$("<p class='note-panel-remove button' role='button' tabindex='0'><span class='note-btn-icon'></span></p>");this.noteTitle=$("<div class='noteTitle'>"+this.config.time+"</div>");this.noteTitleBg=$("<div class='notetitleBg' style='width:100%;height:28px;position:absolute;left:0;background:rgba(11,11,11,0.1);'></div>");this.noteBox=$("<div class='noteBox'></div>");this.textarea=$("<textarea placeholder='"+getLanguage("tltAddTexts","add texts")+"...'>"+this.config.value+"</textarea>");this.colorBox=
$("<div class='colorBox'></div>");this.initColorItems();this.noteBox.append(this.noteTitleBg).append(this.noteTitle).append(this.close).append(this.remove).append(this.textarea).append(this.colorBox);this.container.append(this.icon).append(this.noteBox);this.parent.append(this.container);this.initDeletePart();this.initCss();this.initEvent();this.setA11y();this.showOrHide();this.moveEvent()},initDeletePart:function(){this.deleteBox=$("<div class='deleteBox' ></div>");this.centerBox=$("<div class='centerBox' style='border-radius:4px;text-align:center;position:absolute;left:50%;top:35%;transform:translate(-50%,-50%);width:100%;'></div>");
this.deleteAlertText=$("<div class='infDeleteNote' style='padding: 0 10px;font-size:18px;'>"+getLanguage("infDeleteNote","Do you want to delete the note?")+"</div>");this.confirmBox=$("<div style='text-align:center;position:absolute;bottom:0;height:50px;line-height:50px;width:100%;border-top:1px solid rgba(11,11,11,0.1);'></div>");this.yes=$("<div class='yes deleteBtn button' style='cursor:pointer;display:inline-block;color:#FF5E5F;border-left: 1px solid rgba(11,11,11,0.1);width:50%;box-sizing:border-box;height:50px;line-height:50px;'>"+
getLanguage("lblConfirm","confirm")+"</div>");this.no=$("<div class='no deleteBtn button' style='cursor:pointer;display:inline-block;width:50%;box-sizing:border-box;height:50px;line-height:50px;'>"+getLanguage("lblCancel","cancel")+"</div>");this.centerBox.append(this.deleteAlertText);this.confirmBox.append(this.no).append(this.yes);this.deleteBox.append(this.centerBox).append(this.confirmBox);this.deleteBox.css({"z-index":"10000",background:"#fff","box-shadow":" 0 0 3px #bbb",display:"none",width:"228px",
height:"164px",position:"absolute",top:"0",left:"0",bottom:"0",right:"0"});this.noteBox.append(this.deleteBox);this.confirmBox.find(".deleteBtn").bind("mouseenter",function(a){$(a.target).css({background:"rgba(11,11,11,0.1)"})}.bind(this));this.confirmBox.find(".deleteBtn").bind("mouseleave",function(a){$(a.target).css({background:""})}.bind(this));this.yes.bind(_event._click,function(){var a=this;global.annotationCookie.deleteNoteCookie("Note",this.config.index,this.config.id).then(function(){a.container.remove();
a.container=void 0;a.deleteBox.fadeOut(200)})}.bind(this));this.no.bind(_event._click,function(){this.deleteBox.fadeOut(200)}.bind(this))},setColorIndex:function(a){this.colorIndex=a},initPageConfig:function(){this.pageIndex=this.config.index+1;BookInfo.getBook().pageArray.length&&BookInfo.getBook().pageArray[this.pageIndex]&&("slide"==bookConfig.FlipStyle.toLocaleLowerCase()&&BookInfo.isDoublePage(BookInfo.getBookType())?(BookInfo.getBook().pageArray[this.pageIndex].leftPage?this.page=BookInfo.getBook().pageArray[this.pageIndex].leftPage:
BookInfo.getBook().pageArray[this.pageIndex].rightPage&&(this.page=BookInfo.getBook().pageArray[this.pageIndex].rightPage),rightToLeft&&BookInfo.getBook().pageArray[this.pageIndex].rightPage&&(this.page=BookInfo.getBook().pageArray[this.pageIndex].rightPage)):this.page=BookInfo.getBook().pageArray[this.pageIndex].page,this.pageWidth=this.page.pageWidth,this.pageHeight=this.page.pageHeight,this.page.pageAttachments?(this.notePanelWidth=this.page.pageAttachments.pageWidth,this.notePanelHeight=this.page.pageAttachments.pageHeight):
(this.notePanelWidth=this.parent.width(),this.notePanelHeight=this.parent.height()),isPhone()||isPad()?(this.noteBoxWidth=148<parseInt(this.notePanelWidth/2)?148:parseInt(this.notePanelWidth/2),this.noteBoxHeight=80<parseInt(this.notePanelHeight/2)?80:parseInt(this.notePanelHeight/2)):(this.noteBoxWidth=228<parseInt(this.notePanelWidth/2)?228:parseInt(this.notePanelWidth/2),this.noteBoxHeight=100<parseInt(this.notePanelHeight/2)?100:parseInt(this.notePanelHeight/2)),this.noteBoxHeight>this.noteBoxWidth-
20&&(this.noteBoxHeight=this.noteBoxWidth-20))},initColorItems:function(){var a=(this.noteBoxWidth-72)/7;4>a&&(a=4);for(var b=0;b<this.colorArr.length;b++){var c=$("<span style='float:left;cursor:pointer;background:"+this.colorArr[b]+";margin: 9px 0 9px "+a+"px;width:12px;height:12px;display:inline-block;border-radius:50%;box-shadow:0 0 0 1px rgba(11,11,11,0.3);-webkit-box-shadow:0 0 0 1px rgba(11,11,11,0.3)'></span>");b==this.colorIndex&&(c.addClass("active").css({"box-shadow":"0 0 0 2px #4BA0FF",
"-webkit-box-shadow":"0 0 0 2px #4BA0FF"}),this.noteBox.css({background:this.colorArr[b]}));this.colorItemEvent(c,b);this.colorBox.append(c)}},colorItemEvent:function(a,b){a.bind(_event._click,function(){this.colorBox.find("span").removeClass("active").css({"box-shadow":"0 0 0 1px rgba(11,11,11,0.3)","-webkit-box-shadow":"0 0 0 1px rgba(11,11,11,0.3)"});a.css({"box-shadow":"0 0 0 2px #4BA0FF","-webkit-box-shadow":"0 0 0 2px #4BA0FF"}).addClass("active");this.noteBox.css({background:this.colorArr[b]});
this.setColorIndex(b);this.icon.html(this.getNoteSvg(this.colorArr[b]));this.saveNoteCookie()}.bind(this))},getNoteSvg:function(a){return'<svg style="position:absolute;top:0;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><defs><style>.cls-1, .cls-2 {fill-rule: evenodd;}.cls-1 {opacity: 0.85;}</style></defs><path id="\u8930\u3222\u59f8_2" data-name="\u8930\u3222\u59f8 2" class="cls-1" d="M2,0H15.917A1.98,1.98,0,0,1,18,2V13l-5,5s-8.875.063-11,0-2-2.667-2-2.667-0.062-10.562,0-13S2,0,2,0Z"/><path  fill="'+
a+'" id="\u8930\u3222\u59f8_2_\u93b7\u75af\u7909" data-name="\u8930\u3222\u59f8 2 \u93b7\u75af\u7909" class="cls-2" d="M2,1H16a0.863,0.863,0,0,1,1,1c-0.031,1.156,0,10,0,10H12v5H2s-0.906.281-1-1S0.969,3,1,2A0.994,0.994,0,0,1,2,1ZM13,13h4l-4,4V13ZM4.5,5h5a0.5,0.5,0,0,1,0,1h-5A0.5,0.5,0,0,1,4.5,5Zm0,3h7a0.5,0.5,0,0,1,0,1h-7A0.5,0.5,0,0,1,4.5,8Zm0,3h5a0.5,0.5,0,0,1,0,1h-5A0.5,0.5,0,0,1,4.5,11Z"/></svg>'},initCss:function(){var a=global.annotationCookie.scale;this.colorBox.css({"text-align":"center",position:"absolute",
overflow:"hidden",bottom:"0",left:"0",width:"100%",height:"28px",background:"rgba(11,11,11,0.1)"});this.close.find(".note-btn-icon").css({background:"url("+uiBaseURL+"annotationSprite.png) -72px -1px no-repeat",position:"absolute",height:"14px",width:"14px",top:"4px",right:"4px"});this.remove.find(".note-btn-icon").css({background:"url("+uiBaseURL+"annotationSprite.png) -120px -17px no-repeat",position:"absolute",height:"14px",width:"14px",top:"4px",right:"4px"});this.close.css({cursor:"pointer",
position:"absolute",height:"14px",width:"14px",padding:"4px",top:"3px",right:"3px"});this.remove.css({cursor:"pointer",position:"absolute",height:"14px",width:"14px",padding:"4px",top:"3px",right:"27px"});this.container.css({"font-size":14/a+"px","z-index":"1001",position:"absolute",width:this.size*this.notePanelWidth+"px",left:this.position.x+"px",top:this.position.y+"px",height:this.size*this.notePanelWidth+"px"});this.icon.css({cursor:"pointer",width:"100%",height:"100%"});this.icon.find("img").css({position:"relative",
cursor:"pointer",width:"100%",height:"100%","z-index":"51"});this.noteBox.css({overflow:"hidden","border-radius":"5px","padding-bottom":"24px","z-index":"1","-webkit-box-shadow":" 2px 2px 5px #111","-o-box-shadow":" 2px 2px 5px #111","-moz-box-shadow":" 2px 2px 5px #111","-ms-box-shadow":" 2px 2px 5px #111","box-shadow":" 2px 2px 5px #111",background:"#FFF1dc",position:"absolute","min-width":this.noteBoxWidth/a+"px","min-height":this.noteBoxHeight/a+"px",top:this.container.width()+10+"px",left:"0"});
this.noteTitle.css({overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","font-size":12/a+"px",position:"relative",width:this.noteBoxWidth-68+"px",padding:6/a+"px "+8/a+"px"});this.textarea.css({resize:"none",border:"none",overflow:"auto","padding-top":"5px",background:"transparent","font-size":12/a+"px",position:"relative",width:(this.noteBoxWidth-20)/a+"px",margin:"0 "+8/a+"px 0",height:this.noteBoxHeight/a+"px"});if(isPad()||isPhone())this.close.find(".note-btn-icon").css({opacity:"1"}),
this.remove.find(".note-btn-icon").css({opacity:"1"})},getPage:function(a){var b="";if("slide"==bookConfig.FlipStyle.toLocaleLowerCase()&&BookInfo.isDoublePage(BookInfo.getBookType())){var c=BookInfo.getBook().currentPage;c.leftPage&&c.leftPage.pageIndex==a?b=c.leftPage.pageAttachments.$annotation:c.rightPage&&c.rightPage.pageIndex==a&&(b=c.rightPage.pageAttachments.$annotation)}else b=BookInfo.getBook().pageArray[a].page.pageAttachments.$annotation;return b},elemDrag:function(a,b){b=new Hammer(a[0]);
b.on("panstart",function(c){c=this.getPanPosition(c);this.X=c.x;this.Y=c.y;this.isfocus=!0}.bind(this));b.on("panend",function(c){var g=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){g.isfocus=!1;return h.yield(g.saveNoteCookie(),0)})}.bind(this));b.on("panmove",function(c){var g=this,h,n,p,z,r,A,D,M,Q,ca,V,da,na,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(aa){switch(aa.nextAddress){case 1:if(!g.isfocus){aa.jumpTo(0);break}g.initPageConfig();h=global.annotationCookie.tranScale||
1;n=global.annotationCookie.scale||1;p=g.getPanPosition(c);z=p.x/n-g.X/n;r=p.y/n-g.Y/n;A=a.left()+z;D=a.top()+r;M=g.parent.offset();Q=parseInt((g.pageWidth-g.parent.width())/2);ca=(g.pageHeight-g.parent.height())/2;V=BookInfo.getCurrentPages();da=0;if(2>V.length){A<=-Q&&(A=-Q);A>=g.pageWidth-a.width()-Q&&(A=g.pageWidth-a.width()-Q);aa.jumpTo(3);break}if(Math.ceil(M.left-Q)>=parseInt(windowWidth/2)){aa.jumpTo(4);break}if(A<=-Q){A=-Q;aa.jumpTo(3);break}if(!(p.x>=M.left+g.pageWidth+a.width()/2-Q&&2==
V.length)){p.x>=M.left+g.pageWidth-a.width()/2-Q&&p.x<=M.left+g.pageWidth+a.width()/2+-Q&&(A=g.pageWidth-a.width()-Q);aa.jumpTo(3);break}na=0;case 8:if(!(na<V.length)){aa.jumpTo(3);break}sa=g.getPage(V[na]);if(sa[0]==g.parent[0]){aa.jumpTo(9);break}Q=(g.pageWidth-sa.width())/2;A=-Q;sa.css({display:"block"}).append(a);g.parent=sa;return aa.yield(global.annotationCookie.deleteNoteCookie("Note",g.config.index,g.config.id),12);case 12:return g.config.index=V[na]-1,aa.yield(g.saveNoteCookie(),13);case 13:aa.jumpTo(3);
break;case 9:na++;aa.jumpTo(8);break;case 4:if(!(2==V.length&&p.x-M.left<-a.width()/2-Q)){A<=-Q&&(A=-Q);A>=g.pageWidth-a.width()-Q&&(A=g.pageWidth-a.width()-Q);aa.jumpTo(3);break}na=0;case 15:if(!(na<V.length)){aa.jumpTo(3);break}sa=g.getPage(V[na]);if(sa[0]==g.parent[0]){aa.jumpTo(16);break}Q=(g.pageWidth-sa.width())/2;A=g.pageWidth-a.width()-Q;sa.css({display:"block"}).append(a);g.parent=sa;return aa.yield(global.annotationCookie.deleteNoteCookie("Note",g.config.index,g.config.id),19);case 19:return g.config.index=
V[na]-1,aa.yield(g.saveNoteCookie(),20);case 20:aa.jumpTo(3);break;case 16:na++;aa.jumpTo(15);break;case 3:D<=-ca?D=-ca:isPhone()||isPad()?D>g.pageHeight-a.height()-ca&&(D=g.pageHeight-a.height()-ca):D>g.pageHeight-a.height()-10-(g.noteBox.height()+24)*h-ca&&(D=g.pageHeight-a.height()-10-(g.noteBox.height()+24)*h-ca),A<=-Q&&(A=-Q),A>=g.pageWidth-a.width()-Q&&(A=g.pageWidth-a.width()-Q),a.css({left:parseFloat(A)+"px",top:parseFloat(D)+"px"}),isPhone()||isPad()||(g.pageWidth-g.container.left()-Q<=g.noteBox.width()*
h?(da=g.pageWidth-g.container.left()-Q-g.noteBox.width()*h,g.noteBox.css({left:da+"px",top:g.container.width()+10+"px"})):g.noteBox.css({left:"0px",top:g.container.width()+10+"px"})),g.X=p.x,g.Y=p.y,aa.jumpToEnd()}})}.bind(this))},resetNotePos:function(){this.parent.height();var a=(this.pageWidth-this.parent.width())/2;this.container.top();var b=this.container.left(),c=global.annotationCookie.tranScale||1;b<=-a&&(b=-a);b>=this.pageWidth-this.noteBox.width()-a&&this.noteBox.width();nLeft=this.pageWidth-
this.container.left()-a<=this.noteBox.width()*c?this.pageWidth-this.container.left()-a-this.noteBox.width()*c:0;this.noteBox.css({left:nLeft+"px"})},getPhoneStartPos:function(a,b){a=a||window.event;return{x:(a.originalEvent.targetTouches[0].pageX||a.originalEvent.targetTouches[0].clientX)+(document.documentElement.scrollLeft||document.body.scrollLeft),y:(a.originalEvent.targetTouches[0].pageY||a.originalEvent.targetTouches[0].clientY)+(document.documentElement.scrollTop||document.body.scrollTop)}},
getPhoneEndPos:function(a){a=a||window.event;return{x:(a.originalEvent.changedTouches[0].pageX||a.originalEvent.changedTouches[0].clientX)+(document.documentElement.scrollLeft||document.body.scrollLeft),y:(a.originalEvent.changedTouches[0].pageY||a.originalEvent.changedTouches[0].clientY)+(document.documentElement.scrollTop||document.body.scrollTop)}},getPanPosition:function(a){return a.center},moveEvent:function(){tmpContainer.bind(_event._up,function(){this.isfocus=!1}.bind(this));this.container.bind("pointerdown ",
function(a){a.stopPropagation()}.bind(this));this.elemDrag(this.container,tmpContainer,"");this.elemDrag(this.noteBox,tmpContainer,"")},iconEvent:function(){var a=this;this.container.bind("touchstart touchend",function(b){b.stopPropagation();b.preventDefault()}.bind(this));this.noteBox.bind("touchstart touchend",function(b){b.stopPropagation()}.bind(this));this.container.bind("mousedown mouseup",function(b){b.stopPropagation();b.preventDefault()}.bind(this));this.icon.bind(_event._down,function(b){b=
getPositionFromEvt(b);this.iconX=b.x;this.iconY=b.y}.bind(this));this.icon.bind(_event._down,function(b){isPhone()||isPad()||this.icon.css({opacity:"0.7"})}.bind(this));this.icon.bind(_event._up,function(b){isPhone()||isPad()||this.icon.css({opacity:""})}.bind(this));this.icon.bind(_event._enter,function(b){isPhone()||isPad()||this.icon.css({opacity:"0.85"})}.bind(this));this.icon.bind(_event._leave,function(b){isPhone()||isPad()||this.icon.css({opacity:""})}.bind(this));this.textarea.bind("keyup",
debounce(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){a.colorIndex=a.colorBox.find(".active").index();return b.yield(a.saveNoteCookie(!0),0)})},300));this.showNoteEvent()},showNoteEvent:function(){this.initNoteEvent();this.container.bind(_event._up,function(a){a=getPositionFromEvt(a);var b=a.y;3>Math.abs(a.x-this.iconX)&&3>Math.abs(b-this.iconY)&&this.showOrHide();this.saveNoteCookie()}.bind(this))},initEvent:function(){this.iconEvent();this.container.bind("pointerdown",
function(c){c.stopPropagation()}.bind(this));isPhone()||isPad()?this.textarea.bind("click mousedown mouseup pointerdown mouseover",function(c){c.stopPropagation()}):this.textarea.bind("click mousedown pointerdown mouseover",function(c){c.stopPropagation()});this.container.bind(_event._mousewheel,function(c){c.stopPropagation()}.bind(this));for(var a=[this.close,this.remove],b=0;b<a.length;b++)(function(c){c.bind(_event._down,function(g){isPhone()||isPad()||c.css({"background-color":"rgba(11,11,11,0.3)"})}.bind(this));
c.bind(_event._up,function(g){isPhone()||isPad()||c.css({"background-color":"transparent"})}.bind(this))}).call(this,a[b])},initNoteEvent:function(){this.close.bind(_event._click,function(){this.noteShow=!0;this.saveNoteCookie();this.noteBox.css({display:"none"})}.bind(this));this.remove.bind(_event._click,function(){var a=this;this.deleteBox.fadeIn(200);setTimeout(function(){a.no.focus()},200)}.bind(this))},showOrHide:function(){this.noteShow?this.show():this.hide();this.hasMove=!1},show:function(){this.noteBox.css({display:"block"});
this.noteBox.attr("tabindex",-1);this.noteBox.focus();this.noteShow=!1},hide:function(){this.noteBox.css({display:"none"});this.noteShow=!0;this.noteBox.removeAttr("tabindex");this.resetNotePos()},saveNoteCookie:function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){a.config.value=a.textarea.val();a.config.colorIndex=a.colorIndex;a.container.attr("title",a.config.value);a.config.position={x:a.container.left()/a.notePanelWidth*global.annotationCookie.scale,y:a.container.top()/
a.notePanelHeight*global.annotationCookie.scale};return b.yield(global.annotationCookie.saveNoteCookie("Note",a.config.index,a.config.id,a.config),0)})},setA11y:function(){this.noteBox.find(".button").each(function(){$(this).attr("tabindex",0);$(this).attr("role","button");$(this).off("keydown.a11y").on("keydown.a11y",function(a){"Enter"!==a.key&&" "!==a.key||$(this).trigger("click")})})}}),AnnotationAddMobileNote=Class({create:function(a,b,c){this.mobileNoteBox=$("<div class='mobile_note' id='"+
b.id+"' style='display:none;position:absolute;z-index:10001;width:100%;height:100%;left:0;top:0;bottom:0;right:0;background:rgba(0,0,0,0.85);'></div>");this._super(a,b,c);this.size=.05;this.container.css({"font-size":"14px","z-index":"1001",position:"absolute",width:this.size*this.notePanelWidth+"px",left:this.position.x+"px",top:this.position.y+"px",height:this.size*this.notePanelWidth+"px"})},initDeletePart:function(){this.deleteBox=$("<div class='deleteBox' ></div>");this.centerBox=$("<div class='centerBox' style='border-radius:4px;background: #fff; padding:50px 0 0; box-shadow: 0 0 3px #bbb;text-align:center;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:100%;'></div>");
this.deleteAlertText=$("<div style='padding: 0 10px 39px;font-size:18px;border-bottom: 1px solid rgba(11,11,11,0.1);'>"+getLanguage("infDeleteNote","Do you want to delete the note?")+"</div>");this.yes=$("<div class='yes' style='color:#FF5E5F;cursor:pointer;display:inline-block;border-left: 1px solid rgba(11,11,11,0.1);width:50%;height:60px;line-height:60px;'>"+getLanguage("lblConfirm","confirm")+"</div>");this.no=$("<div class='no' style='color:#111;cursor:pointer;display:inline-block;  width:49%;height:60px;line-height:60px;'>"+
getLanguage("lblCancel","cancel")+"</div>");this.centerBox.append(this.deleteAlertText).append(this.no).append(this.yes);this.deleteBox.append(this.centerBox);this.deleteBox.css({"z-index":"10000",background:"rgba(11,11,11,0.5)",display:"none",width:"100%",height:"100%",position:"absolute",top:"0",left:"0",bottom:"0",right:"0"});this.noteBox.append(this.deleteBox)},initDeleteEvent:function(){this.yes.onTap(function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(1==
b.nextAddress)return b.yield(global.annotationCookie.deleteNoteCookie("Note",a.config.index,a.config.id),2);a.container.remove();a.container=void 0;a.mobileNoteBox.remove();a.deleteBox.fadeOut(200);b.jumpToEnd()})}.bind(this));this.no.onTap(function(){this.deleteBox.fadeOut(200)}.bind(this))},moveEvent:function(){tmpContainer.bind(_event._up,function(){this.isfocus=!1}.bind(this));this.elemDrag(this.container,tmpContainer,"")},initPageConfig:function(){this._super();this.noteBoxWidth=windowWidth>
windowHeight?.8*windowHeight:.8*windowWidth;this.noteBoxHeight=9*this.noteBoxWidth/16},initColorItems:function(){this.colorBox.html("");var a=(this.noteBoxWidth-120)/14;4>a&&(a=4);8<a&&(a=8);for(var b=0;b<this.colorArr.length;b++){var c=$("<span style='cursor:pointer;background:"+this.colorArr[b]+";margin: 10px "+a+"px;width:20px;height:20px;display:inline-block;border-radius:50%;box-shadow:0 0 0 1px rgba(11,11,11,0.3);-webkit-box-shadow:0 0 0 1px rgba(11,11,11,0.3)'></span>");b==this.colorIndex&&
(c.addClass("active").css({"box-shadow":"0 0 0 2px #4BA0FF","-webkit-box-shadow":"0 0 0 2px #4BA0FF"}),this.noteBox.css({background:this.colorArr[b]}));this.colorItemEvent(c,b);this.colorBox.append(c)}},initNoteEvent:function(){this.close.onTap(function(){this.saveNoteCookie();this.showOrHide()}.bind(this));this.remove.onTap(function(){this.deleteBox.fadeIn(200)}.bind(this));this.initDeleteEvent()},showNoteEvent:function(){this.container.bind(_event._up,function(a){a=getPositionFromEvt(a);var b=a.y;
3>Math.abs(a.x-this.iconX)&&3>Math.abs(b-this.iconY)&&this.showOrHide()}.bind(this))},initCss:function(){var a=global.annotationCookie.scale;this.noteTitleBg.css({height:"40px"});this.colorBox.css({"text-align":"center",position:"absolute",overflow:"hidden",bottom:"0",left:"0",width:"100%",height:"40px",background:"rgba(11,11,11,0.1)"});this.close.find(".note-btn-icon").css({background:"url("+uiBaseURL+"annotationSprite.png) -72px -1px no-repeat",position:"absolute",height:"14px",width:"14px",top:"4px",
right:"5px"});this.remove.find(".note-btn-icon").css({background:"url("+uiBaseURL+"annotationSprite.png) -120px -17px no-repeat",position:"absolute",height:"14px",width:"14px",top:"4px",right:"5px"});this.close.css({cursor:"pointer",position:"absolute",height:"14px",width:"14px",padding:"5px",top:"8px",right:"9px"});this.remove.css({cursor:"pointer",position:"absolute",height:"14px",width:"14px",padding:"5px",top:"8px",right:"42px"});this.icon.css({cursor:"pointer",width:"100%",height:"100%"});this.icon.find("img").css({position:"relative",
cursor:"pointer",width:"100%",height:"100%","z-index":"51"});this.noteBox.css({overflow:"hidden","border-radius":"5px","padding-bottom":"40px","z-index":"1","-webkit-box-shadow":" 2px 2px 5px #111","-o-box-shadow":" 2px 2px 5px #111","-moz-box-shadow":" 2px 2px 5px #111","-ms-box-shadow":" 2px 2px 5px #111","box-shadow":" 2px 2px 5px #111",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","min-width":this.noteBoxWidth/a+"px","min-height":this.noteBoxHeight/a+"px"});this.noteTitle.css({overflow:"hidden",
"text-overflow":"ellipsis","white-space":"nowrap","font-size":12/a+"px",position:"relative",width:this.noteBoxWidth-82+"px",padding:12/a+"px "+8/a+"px"});this.textarea.css({resize:"none",border:"none",overflow:"auto","padding-top":"5px",background:"transparent","font-size":12/a+"px",position:"relative",width:(this.noteBoxWidth-20)/a+"px",margin:"0 "+8/a+"px 0",height:this.noteBoxHeight/a+"px"});if(isPad()||isPhone())this.close.find(".note-btn-icon").css({opacity:"1"}),this.remove.find(".note-btn-icon").css({opacity:"1"})},
showOrHide:function(){this.noteShow?(this.initPageConfig(),this.initColorItems(),this.initCss(),this.mobileNoteBox.html(this.noteBox),tmpContainer.append(this.mobileNoteBox),this.mobileNoteBox.css({display:"block"}),this.noteBox.css({display:"block"}),this.initNoteEvent(),this.noteShow=!1):(this.mobileNoteBox.css({display:"none"}),this.mobileNoteBox.html(""),this.mobileNoteBox.remove(),this.noteBox.css({display:"none"}),this.noteShow=!0);this.hasMove=!1}}).extend("AnnotationAddNote"),HardPage=Class({create:function(a,
b,c,g,h){this._super(a,b,c,g,h);this.isHardPage=!0;this.borderWidth=bookConfig.hardCoverBorderWidth;this.outerCoverBorder=bookConfig.outerCoverBorder||BookInfo.isInnerPage(a,g);this.$page=$("<div class='hardSide' style='background-color:"+bookConfig.borderColor+";'></div>");this.$page.append(this.page.side);this.page.side.addClass("pageSide");this.renderPage()},newPage:function(a,b,c,g){this.page=new HardSide(a,b,c,g)},setLeftOrRight:function(a){(this.isLeft=a)?this.setCSSByName("left-side"):this.setCSSByName("right-side");
var b=a&&this.outerCoverBorder?this.borderWidth:0,c=bookConfig.cornerRound;a?(this.$page.css({"border-radius":c+"px 0px 0px "+c+"px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"})):(this.$page.css({"border-radius":"0px "+c+"px "+c+"px 0px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-right":-this.borderWidth+"px"}));this.page.side.css({left:b+"px"})},setUpOrDown:function(a){(this.isUp=a)?this.setCSSByName("up-side"):this.setCSSByName("down-side");
var b=a&&this.outerCoverBorder?this.borderWidth:0,c=bookConfig.cornerRound;a?(this.$page.css({"border-radius":c+"px "+c+"px 0px 0px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"})):(this.$page.css({"border-radius":"0px 0px "+c+"px "+c+"px"}),this.$page.css({"margin-bottom":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"}));this.page.side.css({top:b+"px"})},onResize:function(a,b,c){this.pageWidth=a;this.pageHeight=b;bookConfig.FlipDirection?
(this.width=a+2*this.borderWidth,this.height=b+this.borderWidth,this.pageWidth=this.outerCoverBorder?a:a+2*this.borderWidth,this.pageHeight=this.outerCoverBorder?b:b+this.borderWidth):(this.width=a+this.borderWidth,this.height=b+2*this.borderWidth,this.pageWidth=this.outerCoverBorder?a:a+this.borderWidth,this.pageHeight=this.outerCoverBorder?b:b+2*this.borderWidth);if(this.page)this.page.onResize(this.pageWidth,this.pageHeight);this.$page.css({width:this.width,height:this.height});bookConfig.FlipDirection?
this.page.side.css({left:this.outerCoverBorder?this.borderWidth:0}):this.page.side.css({top:this.outerCoverBorder?this.borderWidth:0});if(this.rendering)this.rendering.onResize(a,b)},renderPage:function(){this.rendering&&(this.rendering.destroy(),this.rendering=null);this.rendering=new PageRendering(this.$page,this.pageIndex,this.bookType);this.rendering.onResize(this.width,this.height);this.rendering.render()},beginToFlip:function(){},setHardCover:function(a,b,c,g,h){this.outerCoverBorder=bookConfig.outerCoverBorder||
BookInfo.isInnerPage(this.pageIndex,this.bookType);this.$page.css("background-color",bookConfig.borderColor);this.borderWidth!=bookConfig.hardCoverBorderWidth&&(this.borderWidth=bookConfig.hardCoverBorderWidth,bookConfig.FlipDirection?this.setUpOrDown(this.isUp):this.setLeftOrRight(this.isLeft),this.onResize(this.pageWidth,this.pageHeight));this.renderPage()}}).extend(PageInterface),HardSide=Class({create:function(a,b,c,g){this._super(a,b,c,g);this.isHard=!0},addFlipShadow:function(){},renderPage:function(){}}).extend(BookPage),
HardCover=Class({create:function(a){this.parent=a;this.borderWidth=bookConfig.hardCoverBorderWidth;this.rightToLeft=bookConfig.RightToLeft;this.cover=$("<div class='hardCover'></div>");this.initPage();this.initBookSpine();this.parent.append(this.cover)},initPage:function(){var a=BookInfo.getHardCoverPages(!0);this.leftPage=new HardPage(a[0],"coverPage",!1,BookType.normal_book);this.rightPage=new HardPage(a[1],"coverPage",!1,BookType.normal_book);this.cover.append(this.leftPage.$page);this.cover.append(this.rightPage.$page);
this.leftPage.rendering.midCoil&&this.leftPage.rendering.midCoil.hide();this.rightPage.rendering.midCoil&&this.rightPage.rendering.midCoil.hide();this.leftPage.setLeftOrRight(!0);this.rightPage.setLeftOrRight(!1);this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,"margin-left":0});this.rightPage.setCSSByStyle({top:"0",right:"0","margin-top":0,"margin-right":0})},initBookSpine:function(){this.topSpine=new BookSpine(this.cover);this.bottomSpine=new BookSpine(this.cover);this.topSpine.setCSSByName("top_spine");
this.bottomSpine.setCSSByName("botoom_spine")},onResize:function(a,b,c){if(this.leftPage)this.leftPage.onResize(a,b);if(this.rightPage)this.rightPage.onResize(a,b);this.topSpine.onResize(c);this.bottomSpine.onResize(c);this.pageWidth=a;this.pageHeight=b;this.resizeCover(a,b,c)},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=2*a+(c[0]+c[1])+2*this.borderWidth;this.height=b+2*this.borderWidth;this.cover.css({width:this.width+"px",height:this.height+"px",left:-(this.borderWidth+c[0])+
"px",top:-this.borderWidth+"px"})},refresh:function(a,b,c){this.refreshBookSpine(b);this.refreshPage(a,c);this.resizeCover(this.pageWidth,this.pageHeight,b)},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!0)},refreshPage:function(a,b){var c=this.getSensitiveIndex().min,g=this.getSensitiveIndex().max;if(a<=c||a>=g){if(a<=c&&bookConfig.RightToLeft||!bookConfig.RightToLeft&&a>=g)this.rightPage&&this.rightPage.setVisible(!1),(b<g&&bookConfig.RightToLeft||b>c&&!bookConfig.RightToLeft)&&
this.leftPage&&this.leftPage.setVisible(!0);if(a<=c&&!bookConfig.RightToLeft||bookConfig.RightToLeft&&a>=g)this.leftPage&&this.leftPage.setVisible(!1),(b<g&&!bookConfig.RightToLeft||b>c&&bookConfig.RightToLeft)&&this.rightPage&&this.rightPage.setVisible(!0);this.hideBookSpine()}else this.showBookSpine(),this.leftPage&&this.leftPage.setVisible(!0),this.rightPage&&this.rightPage.setVisible(!0)},refreshBookSpine:function(a){this.topSpine.refresh(a);this.bottomSpine.refresh(a)},hideBookSpine:function(){this.topSpine.hide();
this.bottomSpine.hide()},showBookSpine:function(){this.topSpine.show();this.bottomSpine.show()},show:function(){this.cover.show()},hide:function(){this.cover.hide()}}),BookSpine=Class({create:function(a){this.parent=a;this.initSpine()},initSpine:function(){this.height=bookConfig.hardCoverBorderWidth;this.bookSpine=$("<div class='bookSpine'></div>");this.bookSpine.css({height:this.height,"background-color":bookConfig.borderColor});this.parent.append(this.bookSpine);this.addShadow()},addShadow:function(){this.leftShadow=
$("<div class='left_shadow shadow'></div>");this.rightShadow=$("<div class='right_shadow shadow'></div>");this.bookSpine.append(this.leftShadow);this.bookSpine.append(this.rightShadow)},refresh:function(a){this.onResize(a)},show:function(){this.bookSpine.show()},hide:function(){},setCSSByStyle:function(a){this.bookSpine.css(a)},setCSSByName:function(a){this.bookSpine.attr("class",a);this.bookSpine.addClass("bookSpine")},onResize:function(a){this.width=a[0]+a[1];this.bookSpine.css({width:this.width,
"margin-left":-this.width/2+"px"})}}),HardBook=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[1,totalPageCount].indexOf(b)&&0<=[1,totalPageCount].indexOf(a)||0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},toSoftPage:function(a){var b=
this.currentPageIndex;if(0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a))return!1;0>[1,totalPageCount].indexOf(b)&&[1,totalPageCount].indexOf(a);return!0},toHardPage:function(a){return!1},toCoverPage:function(a){var b=this.currentPageIndex;return 0>[1,2,totalPageCount-1,totalPageCount].indexOf(b)&&0>[1,2,totalPageCount-1,totalPageCount].indexOf(a)||0<=[2,3].indexOf(b)&&
0>[1,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},isHardPage:function(a,b){return!1},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();
this.hardCover=new HardCover(this.flipBook)},newPage:function(a){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new NormalPage(a,"page",!1,BookType.normal_book)},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!0),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!1),
this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-left-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-right-side")):(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!1),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-right-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-left-side"));return[this.pageArray[a],this.pageArray[b]]},setAttachmentBeforeFlipTo:function(a){this._super(a);
this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=
b.getThicknessWidth()});return a},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(NormalBook),
OpenHardBook=Class({crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||totalPageCount!=b&&totalPageCount!=a?!1:!0},toSoftPage:function(a){return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(this.currentPageIndex)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)?!1:!0},toCoverPage:function(a){return totalPageCount!=this.currentPageIndex&&
totalPageCount!=a?!1:!0},isCoverPage:function(a,b){return a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount&&gotoPageFun(totalPageCount-1,!1,"cross page")},newPage:function(a){return 1==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new NormalPage(a,"page",!1,BookType.normal_book)}}).extend(HardBook),SingleHardCover=Class({initPage:function(){var a=
BookInfo.getHardCoverPages(!1);bookConfig.RightToLeft&&(this.leftPage=new HardPage(a[0],"coverPage",!0,BookType.single_book));bookConfig.RightToLeft||(this.rightPage=new HardPage(a[0],"coverPage",!0,BookType.single_book));this.leftPage&&this.cover.append(this.leftPage.$page);this.rightPage&&this.cover.append(this.rightPage.$page);this.leftPage&&this.leftPage.setLeftOrRight(!0);this.rightPage&&this.rightPage.setLeftOrRight(!1);this.leftPage&&this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,
"margin-left":0});this.rightPage&&this.rightPage.setCSSByStyle({top:"0",right:"0","margin-top":0,"margin-right":0})},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!1)},initBookSpine:function(){this.topSpine=new SingleBookSpine(this.cover);this.bottomSpine=new SingleBookSpine(this.cover);this.topSpine.setCSSByName("top_spine");this.bottomSpine.setCSSByName("botoom_spine")},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=a+(c[0]+c[1])+this.borderWidth;this.height=
b+2*this.borderWidth;this.cover.css({width:this.width+"px",height:this.height+"px",left:(bookConfig.RightToLeft?-(this.borderWidth+c[0]):0)+"px",top:-this.borderWidth+"px"})}}).extend(HardCover),SingleBookSpine=Class({onResize:function(a){this.width=a[0]+a[1];this.bookSpine.css({width:this.width});bookConfig.RightToLeft?this.bookSpine.css({left:"auto",right:"0"}):this.bookSpine.css({right:"auto",left:"0"})}}).extend(BookSpine),SingleHardBook=Class({bookType:BookType.single_book,create:function(a){this._super(a)},
crossFlipMode:function(a){var b=this.currentPageIndex;return 1==b&&2!=a||2!=b&&1==a?!0:!1},toSoftPage:function(a){return 2==a||1==a?!1:!0},toHardPage:function(a){return!1},toCoverPage:function(a){return 1!=a?!1:!0},isCoverPage:function(a,b){var c=a;a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!0:!1},isHardPage:function(a,b){return!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=
new SingleHardCover(this.flipBook)},newPage:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"page",!0,BookType.single_book),a.setLeftOrRight(bookConfig.RightToLeft)):a=new NormalPage(a,"page",!0,BookType.single_book);return a},newPageBack:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"pageBack",!0,BookType.single_book,!0),a.setLeftOrRight(bookConfig.RightToLeft)):a=new NormalPage(a,"pageBack",!0,BookType.single_book,!0);return a},followToPoint:function(a,b,c){this._super(a,
b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=b.getThicknessWidth()});return a},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!0),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-left-side"),
this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-right-side")):(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!1),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!1),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-right-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-left-side"));return[this.pageArray[c],this.pageBackArray[c]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,
this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),
this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(SingleBook),AlbumSide=Class({create:function(a,b,c,g){this._super(a,b,c,g);this.isHard=!0},renderPage:function(){},onResize:function(a,b){this._super(a,b);bookConfig.FlipDirection?
this.side&&this.side.css({left:"50%","margin-left":-a/2+"px"}):this.side&&this.side.css({top:"50%","margin-top":-b/2+"px"})}}).extend(BookPage),AlbumPage=Class({isHardPage:!0,create:function(a,b,c,g,h){this._super(a,b,c,g,h);this.isHardPage=!0;this.$page=this.page.side},newPage:function(a,b,c,g){var h=this.isSingleBook?window.singleCachePages:window.cachePages;g&&(h=window.mirrorSideCachePages);this.page=h&&h[a]?h[a]:new BookPage(a,b,c,g);isPhone()||isPad()||!bookConfig.isCachePages||(this.isSingleBook&&
!g?(window.singleCachePages||(window.singleCachePages=[]),window.singleCachePages[a]=this.page):g?(window.mirrorSideCachePages||(window.mirrorSideCachePages=[]),window.mirrorSideCachePages[a]=this.page):(window.cachePages||(window.cachePages=[]),window.cachePages[a]=this.page))},setLeftOrRight:function(a){this.page&&this.page.setLeftOrRight(a)},setUpOrDown:function(a){this.page&&this.page.setUpOrDown(a)},onResize:function(a,b,c){this.opacity=c?c:1;this.pageWidth=a;this.pageHeight=b;this.width=a;this.height=
b;if(this.page)this.page.onResize(this.pageWidth,this.pageHeight)},addFlipShadow:function(){this.pageFlipShadow||(this.pageFlipShadow=new HardPageFlipShadow(this.side))},beginToFlip:function(){}}).extend(PageInterface),AlbumBook=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){return!1},toSoftPage:function(a){return!1},toHardPage:function(a){return!0},isHardPage:function(a,b){return!0},toCoverPage:function(){return!1},isCoverPage:function(){return!1},
gotoNearPage:function(a){},newPage:function(a){return new AlbumPage(a,"page",!1,BookType.normal_book)},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!0),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-left-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-right-side")):(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!1),this.pageArray[b]&&
this.pageArray[b].setLeftOrRight(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-right-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-left-side"));return[this.pageArray[a],this.pageArray[b]]}}).extend(NormalBook),AlbumHardBook=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[1,totalPageCount].indexOf(b)&&0<=[1,totalPageCount].indexOf(a)||0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||
0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},toSoftPage:function(a){return!1},toHardPage:function(a){var b=this.currentPageIndex;if(0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a))return!1;0>[1,totalPageCount].indexOf(b)&&
[1,totalPageCount].indexOf(a);return!0},toCoverPage:function(a){var b=this.currentPageIndex;return 0>[1,2,totalPageCount-1,totalPageCount].indexOf(b)&&0>[1,2,totalPageCount-1,totalPageCount].indexOf(a)||0<=[2,3].indexOf(b)&&0>[1,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},isHardPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!1:!0},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-
1?!0:!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new HardCover(this.flipBook)},newPage:function(a){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new AlbumPage(a,"page",
!1,BookType.normal_book)},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!0),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-left-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-right-side")):(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!1),
this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-right-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-left-side"));return[this.pageArray[a],this.pageArray[b]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),
this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=b.getThicknessWidth()});return a},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},
resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(NormalBook),OpenAlbumHardBook=Class({crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-
2,totalPageCount].indexOf(a)||totalPageCount!=b&&totalPageCount!=a?!1:!0},toHardPage:function(a){return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(this.currentPageIndex)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)?!1:!0},toCoverPage:function(a){return totalPageCount!=this.currentPageIndex&&totalPageCount!=a?!1:!0},isHardPage:function(a,b){return a==totalPageCount||a==totalPageCount-1?!1:!0},isCoverPage:function(a,b){return a==totalPageCount||a==totalPageCount-
1?!0:!1},gotoNearPage:function(a){this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount&&gotoPageFun(totalPageCount-1,!1,"cross page")},newPage:function(a){return 1==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new AlbumPage(a,"page",!1,BookType.normal_book)}}).extend(AlbumHardBook),SingleAlbumBook=Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){return!1},toSoftPage:function(a){return!1},
toHardPage:function(a){return!0},isHardPage:function(a,b){return!0},toCoverPage:function(){return!1},isCoverPage:function(){return!1},gotoNearPage:function(a){},newPage:function(a){return new AlbumPage(a,"page",!0,BookType.single_book)},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!0),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!0),this.pageArray[c]&&
this.pageArray[c].setCSSByName("flip-hard-left-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-right-side")):(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!1),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!1),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-right-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-left-side"));return[this.pageArray[c],this.pageBackArray[c]]}}).extend(SingleBook),SingleAlbumHardBook=
Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 1==b&&2!=a||2!=b&&1==a?!0:!1},toSoftPage:function(a){return!1},toHardPage:function(a){return 2==a||1==a?!1:!0},toCoverPage:function(a){return 1!=a?!1:!0},isCoverPage:function(a,b){var c=a;a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!0:!1},isHardPage:function(a,b){var c=a;a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!1:!0},gotoNearPage:function(a){1==
this.currentPageIndex?gotoPageFun(2,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new SingleHardCover(this.flipBook)},newPage:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"page",!0,BookType.single_book),a.setLeftOrRight(bookConfig.RightToLeft)):a=new AlbumPage(a,"page",!0,BookType.single_book);return a},newPageBack:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"pageBack",!0,BookType.single_book),a.setLeftOrRight(bookConfig.RightToLeft)):
a=new AlbumPage(a,"pageBack",!0,BookType.single_book,!0);return a},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!0),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-left-side"),
this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-right-side")):(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!1),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!1),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-right-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-left-side"));return[this.pageArray[c],this.pageBackArray[c]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,
this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=b.getThicknessWidth()});return a},
onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(SingleBook),
SingleCalendarPage=Class({flipToPoint:function(a,b,c){if(a&&b)if(1==this.hardPage)this.flipToHardPoint(a,b);else if(this.downMask&&this.upMask&&this.downMask.page&&this.upMask.page){this.coordinate=b;var g=this.pageWidth,h=computePoint(this.pageHeight,g,this.maskWidth,a,b);if(h){var n=transformCSS({rotate:h.rotate,tran:{x:-h.maskTranY,y:h.maskTranX}}),p=transformCSS({rotate:h.rotate,tran:{x:-h.maskTranY,y:h.maskTranX}}),z=transformCSS({rotate:-h.rotate,tran:{x:0,y:-h.pageTranX}}),r=transformCSS({rotate:h.rotate,
tran:{x:0,y:h.pageTranX}});this.downMask&&this.downMask.setCSSByStyle(n);this.upMask&&this.upMask.setCSSByStyle(p);this.downMask&&this.downMask.page&&this.downMask.page.setCSSByStyle(z);this.upMask&&this.upMask.page&&this.upMask.page.setCSSByStyle(r);this.setFlipAlpha(g,a,b);this.setFlipShadow(h,c);this.book.followToPoint(this,a,b)}}},flipToHardPoint:function(a,b){if(a&&b){this.coordinate=b;var c=this.pageWidth,g=computePoint(this.pageHeight,c,this.maskWidth,a,b);if(g){var h=-90+90*Math.abs(b.x/a.x);
0>b.x&&(h=90-90*Math.abs(b.x/a.x));var n=transformCSS({perspective:6E3,rotateX:-h});h=transformCSS({perspective:6E3,rotateX:-h});this.downMask&&this.downMask.setCSSByStyle(n);this.upMask&&this.upMask.setCSSByStyle(h);0>b.x/a.x?(this.upMask.setVisible(!1),this.downMask.setVisible(!1)):(this.upMask.setVisible(!1),this.downMask.setVisible(!0));this.setHardFlipShadow(g);this.setFlipAlpha(c,a,b);this.book.followToPoint(this,a,b)}}},setPageZIndex:function(){var a=this.downMask.pageIndex,b=this.upMask.pageIndex,
c=originTotalPageCount+5+b,g=originTotalPageCount+5-a;if(bookConfig.HardPageEnable){if(b==totalPageCount||1==b)c=2*(bookConfig.totalPageCount+5)+10;if(a==totalPageCount||1==a)g=2*(bookConfig.totalPageCount+5)+10}this.upMask.setZIndex(c);this.downMask.setZIndex(g)},setFlipAlpha:function(a,b,c){},setFlipOriginPoint:function(){this.dragMoveToFlip||rightToLeft||(this.fromPoint={x:this.pageHeight,y:0});!this.dragMoveToFlip&&rightToLeft&&(this.fromPoint={x:-this.pageHeight,y:0});this.toPoint="left"==this.book.flipToDirection?
{x:-this.pageHeight,y:this.fromPoint.y}:{x:this.pageHeight,y:this.fromPoint.y};this.startPoint||(this.startPoint={x:0,y:0});this.startPoint.x=-this.toPoint.x;this.startPoint.y=this.toPoint.y},endFlipByIndex:function(a){a=transformCSS({rotate:0,tran:{x:0,y:0}});this.upMask.setCSSByStyle(a);this.upMask.page&&this.upMask.page.setCSSByStyle(a);this.downMask.setCSSByStyle(a);this.downMask.page&&this.downMask.page.setCSSByStyle(a);this.upMask.setUpOrDown(rightToLeft);this.downMask.setUpOrDown(rightToLeft);
this.book.setZIndexByPageIndex(this.upMask);this.book.setZIndexByPageIndex(this.downMask);this.upMask.clearFlipShadow();this.downMask.clearFlipShadow()}}).extend(SingleFlipPage),DoubleCalendarPage=Class({flipToPoint:function(a,b,c){if(a&&b)if(1==this.hardPage)this.flipToHardPoint(a,b);else if(this.downMask&&this.upMask&&this.downMask.page&&this.upMask.page){this.coordinate=b;var g=this.pageWidth,h=computePoint(this.pageHeight,g,this.maskWidth,a,b);if(h){var n=transformCSS({rotate:h.rotate,tran:{x:-h.maskTranY,
y:h.maskTranX}}),p=transformCSS({rotate:h.rotate,tran:{x:-h.maskTranY,y:h.maskTranX}}),z=transformCSS({rotate:-h.rotate,tran:{x:0,y:-h.pageTranX}}),r=transformCSS({rotate:h.rotate,tran:{x:0,y:h.pageTranX}});this.downMask&&this.downMask.setCSSByStyle(n);this.upMask&&this.upMask.setCSSByStyle(p);this.downMask&&this.downMask.page&&this.downMask.page.setCSSByStyle(z);this.upMask&&this.upMask.page&&this.upMask.page.setCSSByStyle(r);this.setFlipAlpha(g,a,b);this.setFlipShadow(h,c);this.book.followToPoint(this,
a,b)}}},flipToHardPoint:function(a,b){if(a&&b){var c=this.pageWidth,g=this.pageHeight,h=this.maskWidth;b.x>g&&(b.x=g);b.x<-g&&(b.x=-g);this.coordinate=b;if(g=computePoint(g,c,h,a,b)){var n=-90+90*Math.abs(b.x/a.x);0>b.x&&(n=90-90*Math.abs(b.x/a.x));h=transformCSS({perspective:6E3,rotateX:-n});n=transformCSS({perspective:6E3,rotateX:-n});this.downMask&&this.downMask.setCSSByStyle(h);this.upMask&&this.upMask.setCSSByStyle(n);0>b.x/a.x?this.setPagesVisible(!1):this.setPagesVisible(!0);this.setHardFlipShadow(g);
this.setFlipAlpha(c,a,b);this.book.followToPoint(this,a,b)}}},setFlipOriginPoint:function(a){this.dragMoveToFlip||"left"!=a||(this.fromPoint={x:this.pageHeight,y:0});this.dragMoveToFlip||"right"!=a||(this.fromPoint={x:-this.pageHeight,y:0});this.toPoint={x:-this.fromPoint.x,y:this.fromPoint.y};this.startPoint||(this.startPoint={x:0,y:0});this.startPoint.x=this.fromPoint.x;this.startPoint.y=this.fromPoint.y},endFlipByIndex:function(a){var b=transformCSS({rotate:0,tran:{x:0,y:0}});this.upMask.setCSSByStyle(b);
this.upMask.page&&this.upMask.page.setCSSByStyle(b);this.downMask.setCSSByStyle(b);this.downMask.page&&this.downMask.page.setCSSByStyle(b);a?(this.downMask.setUpOrDown(!0),this.upMask.setUpOrDown(!0)):(this.downMask.setUpOrDown(!1),this.upMask.setUpOrDown(!1));this.book.setZIndexByPageIndex(this.upMask);this.book.setZIndexByPageIndex(this.downMask);this.upMask.clearFlipShadow();this.downMask.clearFlipShadow()}}).extend(DoubleFlipPage),DoubleCalendar=Class({bookType:BookType.normal_book,doublePage:!0,
create:function(a){this._super(a);this.resetZoomArea()},initBook:function(){this._super();this.showPage=this.flipBook},newFlipPage:function(){return new DoubleCalendarPage(this)},newPage:function(a){return new NormalPage(a,"page",!1,this.bookType)},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});this.currentPage&&(this.setZIndexByPageIndex(this.currentPage),this.currentPage.setCSSByStyle(a));this.previousPage&&(this.setZIndexByPageIndex(this.previousPage),this.previousPage.setCSSByStyle(a));
this.previousPage2&&(this.setZIndexByPageIndex(this.previousPage2),this.previousPage2.setCSSByStyle(a));this.currentPage2&&(this.setZIndexByPageIndex(this.currentPage2),this.currentPage2.setCSSByStyle(a));this.nextPage&&(this.setZIndexByPageIndex(this.nextPage),this.nextPage.setCSSByStyle(a));this.nextPage2&&(this.setZIndexByPageIndex(this.nextPage2),this.nextPage2.setCSSByStyle(a));rightToLeft?(this.currentPage&&this.currentPage.setUpOrDown(!1),this.previousPage&&this.previousPage.setUpOrDown(!1),
this.previousPage2&&this.previousPage2.setUpOrDown(!1),this.currentPage2&&this.currentPage2.setUpOrDown(!0),this.nextPage&&this.nextPage.setUpOrDown(!0),this.nextPage2&&this.nextPage2.setUpOrDown(!0)):(this.currentPage&&this.currentPage.setUpOrDown(!0),this.previousPage&&this.previousPage.setUpOrDown(!0),this.previousPage2&&this.previousPage2.setUpOrDown(!0),this.currentPage2&&this.currentPage2.setUpOrDown(!1),this.nextPage&&this.nextPage.setUpOrDown(!1),this.nextPage2&&this.nextPage2.setUpOrDown(!1))},
getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-up-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-down-side")):(this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-down-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-up-side"));return[this.pageArray[a],this.pageArray[b]]},flipToMax:function(a,b,c,g){g=this.flipPageManager.initFlipPageByIndex(a,b,g);this.addPagesBeforeFlipToMax(b,
c);this.pageArray[b+1]&&(this.pageArray[b+1].setUpOrDown(rightToLeft),g.nextPage=this.pageArray[b+1]);this.setPagesStyleBeforeFlipToMax(b,c);this.deleteUnnecessaryPagesBeforeFlipToMax(a,b);return g},setPagesStyleBeforeFlipToMax:function(a,b){b&&this.supportSerialsFlip()&&(this.pageArray[a+1]&&this.setZIndexByPageIndex(this.pageArray[a+1],a),this.pageArray[a+2]&&(this.setZIndexByPageIndex(this.pageArray[a+2],a),this.pageArray[a+2].setUpOrDown(rightToLeft)),this.pageArray[a+3]&&(this.setZIndexByPageIndex(this.pageArray[a+
3],a),this.pageArray[a+3].setUpOrDown(rightToLeft)))},setPagesStyleAfterFlipToMax:function(a){this.pageArray[a]&&(this.setZIndexByPageIndex(this.pageArray[a],a),this.pageArray[a].setUpOrDown(!rightToLeft));this.pageArray[a-1]&&(this.setZIndexByPageIndex(this.pageArray[a-1],a),this.pageArray[a-1].setUpOrDown(!rightToLeft));this.pageArray[a-2]&&(this.setZIndexByPageIndex(this.pageArray[a-2],a),this.pageArray[a-2].setUpOrDown(!rightToLeft));this.supportSerialsFlip()&&this.flipping||(this.pageArray[a+
1]&&this.setZIndexByPageIndex(this.pageArray[a+1]),this.pageArray[a+2]&&(this.setZIndexByPageIndex(this.pageArray[a+2]),this.pageArray[a+2].setUpOrDown(rightToLeft)),this.pageArray[a+3]&&(this.setZIndexByPageIndex(this.pageArray[a+3]),this.pageArray[a+3].setUpOrDown(rightToLeft)))},flipToMin:function(a,b,c,g){g=this.flipPageManager.initFlipPageByIndex(a,b,g);this.addPagesBeforeFlipToMin(b,c);this.pageArray[b-1]&&(this.pageArray[b-1].setUpOrDown(!rightToLeft),g.nextPage=this.pageArray[b-1]);this.setPagesStyleBeforeFlipToMin(b,
c);this.deleteUnnecessaryPagesBeforeFlipToMin(a,b);return g},setPagesStyleBeforeFlipToMin:function(a,b){b&&this.supportSerialsFlip()&&(this.pageArray[a-1]&&this.setZIndexByPageIndex(this.pageArray[a-1],a),this.pageArray[a-2]&&(this.setZIndexByPageIndex(this.pageArray[a-2],a),this.pageArray[a-2].setUpOrDown(!rightToLeft)),this.pageArray[a-3]&&(this.setZIndexByPageIndex(this.pageArray[a-3],a),this.pageArray[a-3].setUpOrDown(!rightToLeft)))},setPagesStyleAfterFlipToMin:function(a){this.pageArray[a]&&
(this.setZIndexByPageIndex(this.pageArray[a],a),this.pageArray[a].setUpOrDown(rightToLeft));this.pageArray[a+1]&&(this.setZIndexByPageIndex(this.pageArray[a+1],a),this.pageArray[a+1].setUpOrDown(rightToLeft));this.pageArray[a+2]&&(this.setZIndexByPageIndex(this.pageArray[a+2],a),this.pageArray[a+2].setUpOrDown(rightToLeft));this.supportSerialsFlip()&&this.flipping||(this.pageArray[a-1]&&this.setZIndexByPageIndex(this.pageArray[a-1]),this.pageArray[a-2]&&(this.setZIndexByPageIndex(this.pageArray[a-
2]),this.pageArray[a-2].setUpOrDown(!rightToLeft)),this.pageArray[a-3]&&(this.setZIndexByPageIndex(this.pageArray[a-3]),this.pageArray[a-3].setUpOrDown(!rightToLeft)))},movetoCenter:function(a,b,c){if(!this.status_zoom&&bookConfig.retainBookCenter&&!(1<BookInfo.getPagesByIndex(a).length&&1<BookInfo.getPagesByIndex(b).length)){var g=this.pageHeight,h=-g/2;g/=2;var n=0,p=0;BookInfo.isLeftPage(a,!0)||1!=BookInfo.getPagesByIndex(a).length||(n=h);BookInfo.isLeftPage(a,!0)&&1==BookInfo.getPagesByIndex(a).length&&
(n=g);BookInfo.isLeftPage(b,!0)||1!=BookInfo.getPagesByIndex(b).length||(p=h);BookInfo.isLeftPage(b,!0)&&1==BookInfo.getPagesByIndex(b).length&&(p=g);this.fromTrans=0>this.movedY*p&&this.toTrans!=p?this.movedY:n;this.toTrans=p;a=2*this.pageHeight;void 0==c&&(c=a);isNaN(c)||(this.movedLength=c,this.movedY=$.easing.easeInOutSine(null,c,this.fromTrans,this.toTrans-this.fromTrans,a),this.setCSS({tran:{x:0,y:this.movedY}}))}},edgeX:function(){this.MiddleX=0},getFromStartPointByIndex:function(a,b){var c=
this.getMinPageIndex(this.currentPageIndex),g=c+1;if(a!=g&&a!=c){var h={x:0,y:0},n={x:0,y:0},p=b.getPageWidthHeight().height;b.getPageWidthHeight();b=!1;if(a>g&&!rightToLeft||a<c&&rightToLeft)h={x:p,y:0},n.x=h.x-2,n.y=h.y+2,b=!0;if(a<c&&!rightToLeft||a>g&&rightToLeft)h={x:-p,y:0},n.x=h.x+2,n.y=h.y+2,b=!1;this.flipToDirection=b?"left":"right";return[h,n]}},afterZoomIn:function(a){if(!isPhone()&&!isPad()||bookConfig.usePdfJs){if(isPhone()||isPad()||this.showPages(),a&&this.flipBook.parameters&&!this.flipBook.parameters.resize){this.flipBook.parameters.resize=
!0;a=this.flipBook.offset().left;var b=this.flipBook.offset().top,c=this.flipBook.parameters.left,g=this.flipBook.parameters.top;h=this.flipBook.parameters.scale;c={tran:{x:a-c,y:b-g},scale:1,origin:{x:0,y:0}};1!=h&&this.resizeBook(Math.round(this.width*h),Math.round(this.height*h/2));this.status_zoom||(h=0,1==this.currentPageIndex&&bookConfig.retainBookCenter&&!bookConfig.isTheBookOpen&&(h=rightToLeft?this.height/4:-this.height/4),this.currentPageIndex==totalPageCount&&bookConfig.retainBookCenter&&
(h=rightToLeft?-this.height/4:this.height/4),c.tran={x:0,y:h},c.left=a-0,c.top=b-h);this.setCSS(c);this.flipBook.parameters.tran=c.tran;this.flipBook.parameters.scale=1;this.flipBook.parameters.toScale=1;this.flipBook.parameters.width=$(this.flipBook).width();this.flipBook.parameters.height=$(this.flipBook).height();this.flipBook.parameters.origin={x:0,y:0};this.flipBook.parameters.resize=!1;isPhone()||isPad()||this.switchLargeImage()}}else if(b=BookInfo.getCurrentPages(),void 0!=b&&null!=b)for(c=
0;c<b.length;c++)if(g=b[c],this.pageArray[g]){var h=this.flipBook.parameters.scale;this.pageArray[g].resizeSvg(Math.round(this.pageWidth*h),Math.round(this.pageHeight*h));bookConfig.highDefinitionConversion?this.pageArray[g].zoomInSideImage():(1<a.scale&&this.pageArray[g].zoomInSideImage(),1==a.scale&&this.pageArray[g].zoomOutSideImage())}},getFitWH:function(){this.getSpace(!1);var a=this.getSpace(!0),b=windowWidth-a.left-a.right;a=windowHeight-a.top-a.bottom;var c=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+
parseFloat(bookConfig.visibleAreaRight))/100,g=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;return fitPageWidthHeight(b,a,c,2*g)},getSpace:function(a){var b=bookConfig.leftMargin+templateArea.getLeftWidth(),c=bookConfig.rightMargin+templateArea.getRightWidth(),g=bookConfig.topMargin+templateArea.getTopHeight(),h=bookConfig.bottomMargin+templateArea.getBottomHeight();a&&(b+=bookConfig.hardCoverBorderWidth+totalThicknessWidth(!0),c+=
bookConfig.hardCoverBorderWidth+totalThicknessWidth(!0),g+=bookConfig.hardCoverBorderWidth,h+=bookConfig.hardCoverBorderWidth);return{left:b,right:c,top:g,bottom:h}},resizeBook:function(a,b){this.endFlip();this.width=a;this.height=2*b;this.pageWidth=a;this.pageHeight=b;this.maskWidth=parseInt(Math.sqrt(a*a+b*b));0!=(this.maskWidth-this.height)%2&&(this.maskWidth+=1);this.setCSS({width:this.width,height:this.height});this.resizePage(this.pageWidth,this.pageHeight);this.resetBookShadow(this.currentPageIndex)},
resetBookShadow:function(){},setAttachmentBeforeFlipTo:function(){},setAttachmentAfterFlipTo:function(){},flippingTo:function(a){this.currentPageIndex=a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex);this.resetZoomArea()},resetZoomArea:function(){this.flipBook&&this.flipBook.parameters&&this.flipBook.parameters.zoomArea&&(1!=this.getCurrentPages().length||BookInfo.isLeftPage(this.currentPageIndex,!0)?1==this.getCurrentPages().length&&
BookInfo.isLeftPage(this.currentPageIndex,!0)?this.flipBook.parameters.zoomArea={left:0,top:0,right:0,bottom:50}:this.flipBook.parameters.zoomArea={left:0,top:0,right:0,bottom:0}:this.flipBook.parameters.zoomArea={left:0,top:50,right:0,bottom:0})},getDownUpPage:function(a,b){this.addPageArray([a,b]);this.pageArray[a]&&this.pageArray[a].beginToFlip();this.pageArray[b]&&this.pageArray[b].beginToFlip();this.pageArray[a]&&(this.pageArray[a].page.setCSSByName("down-flip-side"),this.setZIndexByPageIndex(this.pageArray[a]));
this.pageArray[b]&&(this.pageArray[b].page.setCSSByName("flip-vertical-side"),this.pageArray[b].page.side.addClass("boxShadow"),this.setZIndexByPageIndex(this.pageArray[b]));return[this.pageArray[a],this.pageArray[b]]},adjustBookPosition:function(){if(!this.status_zoom&&!this.flipping&&this.width&&this.height){this.pageWidthHeight=this.getFitWH();var a=this.getTranX(),b=this.pageWidthHeight.y/this.height,c=this.getTranY(b);this.flipBook.animateToTransform.bind(this.flipBook)(b,{x:a,y:c},{x:0,y:50})}},
getTranX:function(){var a=this.getCssLeft(),b=this.getSpace(!0);return b.left+(windowWidth-b.left-b.right-this.pageWidthHeight.x)/2-a},getTranY:function(a){if(!bookConfig.retainBookCenter)return 0;var b=0;a=this.height*a/4;1!=this.currentPageIndex||bookConfig.isTheBookOpen||(b=rightToLeft?a:-a);this.currentPageIndex==totalPageCount&&(b=rightToLeft?-a:a);a=this.getCssTop();var c=this.getSpace(!0);return c.top+(windowHeight-c.top-c.bottom-this.height)/2-a+b}}).extend(DoubleFlipBook),SingleFlipCalendar=
Class({bookType:BookType.single_book,doublePage:!1,pageBackArray:null,create:function(a){this.pageBackArray=[];this._super(a)},newPage:function(a){return new NormalPage(a,"page",!0,this.bookType)},newPageBack:function(a){return new NormalPage(a,"pageBack",!0,BookType.single_book,!0)},newFlipPage:function(){return new SingleCalendarPage(this)},resetPages:function(a){isNaN(a)||0>=a||(this.unWrapPageBackExcludeArray([a,a+1]),this.unWrapPageExcludeArray([a,a+1]),this.addPageArray([a,a+1]),this.addPageBackArray([a]),
this.currentPage=this.pageArray[a],this.currentPage2=this.pageBackArray[a],this.nextPage=this.pageArray[a+1],this.previousPage=this.pageArray[a-1],this.previousPage2=this.pageBackArray[a-1],this.setPageCss(),this.loading())},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});this.currentPage&&(this.setZIndexByPageIndex(this.currentPage),this.currentPage.setCSSByStyle(a));this.previousPage&&(this.setZIndexByPageIndex(this.previousPage),this.previousPage.setCSSByStyle(a));this.previousPage2&&
(this.setZIndexByPageIndex(this.previousPage2),this.previousPage2.setCSSByStyle(a));this.currentPage2&&(this.setZIndexByPageIndex(this.currentPage2),this.currentPage2.setCSSByStyle(a));this.nextPage&&(this.setZIndexByPageIndex(this.nextPage),this.nextPage.setCSSByStyle(a));rightToLeft?(this.currentPage&&this.currentPage.setUpOrDown(!0),this.previousPage&&this.previousPage.setUpOrDown(!0),this.previousPage2&&this.previousPage2.setUpOrDown(!0),this.currentPage2&&this.currentPage2.setUpOrDown(!0),this.nextPage&&
this.nextPage.setUpOrDown(!0)):(this.currentPage&&this.currentPage.setUpOrDown(!1),this.previousPage&&this.previousPage.setUpOrDown(!1),this.previousPage2&&this.previousPage2.setUpOrDown(!1),this.currentPage2&&this.currentPage2.setUpOrDown(!1),this.nextPage&&this.nextPage.setUpOrDown(!1))},addPageBackArray:function(a){if(a&&this.pageBackArray)for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>originTotalPageCount||(!this.pageBackArray[a[b]]||this.flipping&&!imageLoaded[a[b]]||this.fillContent(a[b]),this.pageBackArray[a[b]]))){var c=
this.newPageBack(a[b]),g=this.pageInfoArray[a[b]];c.onResize(this.pageWidth*g.pageWidth,this.pageHeight*g.pageHeight,g.opacity);c.mirrorSide();this.pageBackArray[a[b]]=c;this.flipping&&!imageLoaded[a[b]]||this.fillContent(a[b]);this.flipBook.append(c.$page)}},getDownUpPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);this.pageArray[c]&&this.pageArray[c].beginToFlip();this.pageBackArray[c]&&this.pageBackArray[c].beginToFlip();this.pageArray[c]&&this.pageArray[c].page.setCSSByName("down-flip-side");
this.pageBackArray[c]&&(this.pageBackArray[c].page.setCSSByName("flip-vertical-side"),this.pageBackArray[c].page.side.addClass("boxShadow"));return[this.pageArray[c],this.pageBackArray[c]]},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);rightToLeft?(this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-up-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-down-side")):(this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-down-side"),
this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-up-side"));return[this.pageArray[c],this.pageBackArray[c]]},flipToMax:function(a,b,c){var g=this.flipPageManager.initFlipPageByIndex(a,b);this.addPagesBeforeFlipToMax(b,c);this.pageArray[b]&&(this.pageArray[b].setUpOrDown(rightToLeft),g.nextPage=this.pageArray[b]);this.setPagesStyleBeforeFlipToMax(b,c);this.deleteUnnecessaryPagesBeforeFlipToMax(a,b);return g},addPagesBeforeFlipToMax:function(a,b){this.addPageArray([a]);b&&this.supportSerialsFlip()&&
(this.addPageBackArray([a]),this.addPageArray([a+1]))},setPagesStyleBeforeFlipToMax:function(a,b){b&&(this.pageArray[a]&&(this.setZIndexByPageIndex(this.pageArray[a],a),this.pageArray[a].setUpOrDown(rightToLeft)),this.pageBackArray[a]&&(this.setZIndexByPageIndex(this.pageBackArray[a],a),this.pageBackArray[a].setUpOrDown(rightToLeft)),this.pageArray[a+1]&&(this.setZIndexByPageIndex(this.pageArray[a+1],a),this.pageArray[a+1].setUpOrDown(rightToLeft)))},deleteUnnecessaryPagesBeforeFlipToMax:function(a,
b){for(var c=b+1;c<=originTotalPageCount;c++)this.pageBackArray[c]&&(this.pageBackArray[c]&&this.pageBackArray[c].remove(),this.pageBackArray[c]=void 0);for(c=b+2;c<=originTotalPageCount;c++)this.pageArray[c]&&(this.pageArray[c]&&this.pageArray[c].remove(),this.pageArray[c]=void 0);for(c=a+1;c<b;c++)if(this.pageArray[c]||this.pageBackArray[c])this.pageArray[c]&&this.pageArray[c].remove(),this.pageBackArray[c]&&this.pageBackArray[c].remove(),this.pageArray[c]=void 0,this.pageBackArray[c]=void 0},afterFlipToMax:function(a){this.addPagesAfterFlipToMax(a);
this.setPagesStyleAfterFlipToMax(a);this.deleteUnnecessaryPagesAfterFlipToMax(a)},addPagesAfterFlipToMax:function(a){this.supportSerialsFlip()||(this.addPageArray([a]),this.addPageBackArray([a]),this.addPageArray([a+1]));this.pageArray[a]&&this.fillContent(a);this.pageArray[a+1]&&this.fillContent(a+1)},setPagesStyleAfterFlipToMax:function(a){this.pageArray[a-1]&&this.setZIndexByPageIndex(this.pageArray[a-1],a);this.pageBackArray[a-1]&&this.setZIndexByPageIndex(this.pageBackArray[a-1],a);this.supportSerialsFlip()||
(this.pageArray[a]&&(this.setZIndexByPageIndex(this.pageArray[a]),this.pageArray[a].setUpOrDown(rightToLeft)),this.pageBackArray[a]&&(this.setZIndexByPageIndex(this.pageBackArray[a]),this.pageBackArray[a].setUpOrDown(rightToLeft)),this.pageArray[a+1]&&(this.setZIndexByPageIndex(this.pageArray[a+1]),this.pageArray[a+1].setUpOrDown(rightToLeft)))},deleteUnnecessaryPagesAfterFlipToMax:function(a){for(a-=2;0<=a;a--)if(this.pageArray[a]||this.pageBackArray[a])this.pageArray[a]&&this.pageArray[a].remove(),
this.pageBackArray[a]&&this.pageBackArray[a].remove(),this.pageArray[a]=void 0,this.pageBackArray[a]=void 0},flipToMin:function(a,b,c){var g=this.flipPageManager.initFlipPageByIndex(a,b);this.addPagesBeforeFlipToMin(b,c);this.pageArray[a]&&(g.nextPage=this.pageArray[a]);this.setPagesStyleBeforeFlipToMin(b);this.deleteUnnecessaryPagesBeforeFlipToMin(a,b);return g},addPagesBeforeFlipToMin:function(a,b){},setPagesStyleBeforeFlipToMin:function(a){},deleteUnnecessaryPagesBeforeFlipToMin:function(a,b){for(--a;a>
b;a--)if(this.pageArray[a]||this.pageBackArray[a])this.pageArray[a]&&this.pageArray[a].remove(),this.pageBackArray[a]&&this.pageBackArray[a].remove(),this.pageArray[a]=void 0,this.pageBackArray[a]=void 0},afterFlipToMin:function(a){this.addPagesAfterFlipToMin(a);this.setPagesStyleAfterFlipToMin(a);this.deleteUnnecessaryPagesAfterFlipToMin(a)},addPagesAfterFlipToMin:function(a){this.supportSerialsFlip()||(this.addPageArray([a]),this.addPageBackArray([a]),this.addPageArray([a-1]));this.pageArray[a]&&
this.fillContent(a);this.pageArray[a-1]&&this.fillContent(a-1)},setPagesStyleAfterFlipToMin:function(a){this.pageArray[a+1]&&(this.setZIndexByPageIndex(this.pageArray[a+1]),this.pageArray[a+1].setUpOrDown(rightToLeft))},deleteUnnecessaryPagesAfterFlipToMin:function(a){for(var b=a+2;b<=originTotalPageCount;b++)if(this.pageArray[b]||this.pageBackArray[b])this.pageArray[b]&&this.pageArray[b].remove(),this.pageBackArray[b]&&this.pageBackArray[b].remove(),this.pageArray[b]=void 0,this.pageBackArray[b]=
void 0;this.pageBackArray[a+1]&&(this.pageBackArray[a+1]&&this.pageBackArray[a+1].remove(),this.pageBackArray[a+1]=void 0)},getCurrentPages:function(){return[this.currentPageIndex]},getPagesByIndex:function(a){return[a]},movetoCenter:function(){},getFromStartPointByIndex:function(a,b){var c=this.currentPageIndex;if(a!=c&&a!=c){var g={x:0,y:0},h=b.getPageWidthHeight().height;b.getPageWidthHeight();var n=!1;b={x:h,y:0};rightToLeft&&(b={x:-h,y:0});if(a>c&&!rightToLeft||a<c&&rightToLeft)n=!0;if(a<c&&
!rightToLeft||a>c&&rightToLeft)n=!1;a>c&&(g={x:b.x*(h-2)/h,y:2});a<c&&(g={x:-b.x*(h-2)/h,y:2});this.flipToDirection=n?"left":"right";return[b,g]}},realBookPosition:function(){var a=this.flipBook.offset().left,b=this.flipBook.offset().top-(rightToLeft?0:this.pageHeight);return[a,b]},edgeX:function(){this.MiddleX=this.pageHeight/2;rightToLeft&&(this.MiddleX=-this.pageHeight/2)},realIndex:function(a){var b=this.currentPageIndex;if(a&&!rightToLeft||!a&&rightToLeft)return[b,b+1];if(!a&&!rightToLeft||a&&
rightToLeft)return[b,b-1]},getFromStartPointByCoordinate:function(a,b,c){if(a){var g={x:0,y:0},h={x:0,y:0},n=c.getPageWidthHeight().height;c=c.getPageWidthHeight().width;var p=a.y>c/2?a.y-5:a.y+5;a.x<this.MiddleX&&(g.y=p,h.x=-n);a.x>this.MiddleX&&(g.y=p,h.x=n);b&&0<=b.indexOf("r")&&(h.x=n);b&&0<=b.indexOf("l")&&(h.x=-n);"tl"==b&&(g.y=0);"bl"==b&&(g.y=c);"tr"==b&&(g.y=0);"br"==b&&(g.y=c);g.x=rightToLeft?-n:n;h.y=g.y;return[g,h]}},getFlipTo:function(a){var b=this.currentPageIndex,c="";a>b&&(c="max");
a<b&&(c="min");return{flipTo:c,minIndex:b,maxIndex:b,toIndex:a}},afterZoomIn:function(a){if(!isPhone()&&!isPad()||bookConfig.usePdfJs){if(isPhone()||isPad()||this.showPages(),a&&this.flipBook.parameters&&!this.flipBook.parameters.resize){this.flipBook.parameters.resize=!0;a=this.flipBook.offset().left;var b=this.flipBook.offset().top;a-=this.flipBook.parameters.left;var c=b-this.flipBook.parameters.top;b=this.flipBook.parameters.scale;1!=b&&this.resizeBook(Math.round(this.width*b),Math.round(this.height*
b));transformCSS({tran:{x:a,y:c},scale:1,origin:{x:0,y:0},obj:this.flipBook});this.flipBook.parameters.tran={x:a,y:c};this.flipBook.parameters.scale=1;this.flipBook.parameters.toScale=1;this.flipBook.parameters.width=$(this.flipBook).width();this.flipBook.parameters.height=$(this.flipBook).height();this.flipBook.parameters.origin={x:0,y:0};this.flipBook.parameters.resize=!1;isPhone()||isPad()||this.switchLargeImage()}}else if(c=BookInfo.getCurrentPages(),void 0!=c&&null!=c)for(var g=0;g<c.length;g++){var h=
c[g];this.pageArray[h]&&this.pageArray[h]&&(b=this.flipBook.parameters.scale,this.pageArray[h].resizeSvg(Math.round(this.width*b),Math.round(this.height*b)),bookConfig.highDefinitionConversion?this.pageArray[h].zoomInSideImage():(1<a.scale&&this.pageArray[h].zoomInSideImage(),1==a.scale&&this.pageArray[h].zoomOutSideImage()))}},setZIndexByPageIndex:function(a,b){a&&(b=b?b:this.currentPageIndex,a==this.pageArray[b]?a.setZIndex(2):a==this.pageBackArray[b]?a.setZIndex(1):a==this.pageArray[b+1]?a.setZIndex(0):
a.setZIndex(-1))},getFitWH:function(){this.getSpace(!1);var a=this.getSpace(!0),b=windowWidth-a.left-a.right;a=windowHeight-a.top-a.bottom;var c=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,g=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;return fitPageWidthHeight(b,a,c,g)},getSpace:function(a){var b=bookConfig.leftMargin+templateArea.getLeftWidth(),c=bookConfig.rightMargin+
templateArea.getRightWidth(),g=bookConfig.topMargin+templateArea.getTopHeight(),h=bookConfig.bottomMargin+templateArea.getBottomHeight();a&&(b+=bookConfig.hardCoverBorderWidth,c+=bookConfig.hardCoverBorderWidth,g+=rightToLeft?bookConfig.hardCoverBorderWidth+totalThicknessWidth(!1):0,h+=rightToLeft?0:bookConfig.hardCoverBorderWidth+totalThicknessWidth(!1));return{left:b,right:c,top:g,bottom:h}},resizeBook:function(a,b){this.endFlip();this.width=a;this.height=b;this.pageWidth=a;this.pageHeight=b;this.maskWidth=
parseInt(Math.sqrt(a*a+b*b));0!=(this.maskWidth-this.height)%2&&(this.maskWidth+=1);this.flipBook.css({width:this.width+"px",height:this.height+"px"});this.resizePage(this.pageWidth,this.pageHeight);this.resetBookShadow()},resetBookShadow:function(){},setAttachmentBeforeFlipTo:function(){},setAttachmentAfterFlipTo:function(){},flippingTo:function(a){this.currentPageIndex=a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex)}}).extend(SingleFlipBook),
NormalCalendar=Class({bookType:BookType.normal_book,doublePage:!0,create:function(a){this._super(a);this.resetZoomArea()},resetBookShadow:function(a){a=this.flipPageManager.array.length;if(0==a){var b=2==BookInfo.getCurrentPages().length,c=!BookInfo.isLeftPage(this.currentPageIndex,!0);this.bookAttachments.Items.find("BookShadow").each(function(r){r.doubleHeight(b);r.down(c);r.show()})}else{for(var g=!0,h=!0,n=0;n<a;n++){var p=this.flipPageManager.array[n],z=this.flipPageManager[p].nextIndex;p=this.flipPageManager[p].currentIndex;
1==BookInfo.getPagesByIndex(z).length&&BookInfo.isLeftPage(z,!0)&&(h=!1);1==BookInfo.getPagesByIndex(p).length&&BookInfo.isLeftPage(p,!0)&&(h=!1);1!=BookInfo.getPagesByIndex(z).length||BookInfo.isLeftPage(z,!0)||(g=!1);1!=BookInfo.getPagesByIndex(p).length||BookInfo.isLeftPage(p,!0)||(g=!1)}g||h||this.bookAttachments.Items.find("BookShadow").each(function(r){r.hide()});(g&&!h||!g&&h)&&this.bookAttachments.Items.find("BookShadow").each(function(r){r.show();r.doubleHeight(!1);r.down(h)})}},hasTwoSingleFlipPage:function(a){for(var b=
this.flipPageManager.array.length,c,g=0;g<b;g++){var h=this.flipPageManager.array[g],n=this.flipPageManager[h].nextIndex;h=this.flipPageManager[h].currentIndex;1==BookInfo.getPagesByIndex(n).length&&(c=n);1==BookInfo.getPagesByIndex(h).length&&(c=h)}return c&&(c!=a&&1==BookInfo.getPagesByIndex(a).length||c!=this.currentPageIndex&&1==BookInfo.getPagesByIndex(this.currentPageIndex).length)?(this.bookAttachments.Items.find("BookShadow").each(function(p){p.hide()}),!0):!1},flippingTo:function(a){this.currentPageIndex=
a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex);this.resetZoomArea()},afterCurling:function(){this._super();this.resetBookShadow(this.currentPageIndex);this.bookAttachments.afterCurling()},setAttachmentBeforeFlipTo:function(a){this.pauseAnimation();this.bookAttachments.setAttachmentBeforeFlipTo(a);this.resetBookShadow(a)},setAttachmentAfterFlipTo:function(a){this.stopMedia();this.resetSlider();this.bookAttachments.setAttachmentAfterFlipTo(a);
this.resetBookShadow(a);this.flipping||this.enterPage();bookConfig.ThumbnailsButtonVisible&&global.thumbnail&&(thumbnail.clearHighLight(),thumbnail.setHighLight(this.currentPageIndex));window.resizeBookAfterFlip&&!this.flipping&&window.setTimeout(function(){onStageResize()},30)},resizeAttachments:function(a,b){this.bookAttachments.onResize(a,b)},afterZoomIn:function(a){a&&this.flipBook.parameters&&!this.flipBook.parameters.resize&&(this._super(a),this.bookAttachments.afterZoomIn(this.width,this.height))}}).extend(DoubleCalendar),
SingleCalendar=Class({bookType:BookType.single_book,doublePage:!1,create:function(a){this._super(a)},newPage:function(a){return new NormalPage(a,"page",!0,BookType.single_book)},newPageBack:function(a){return new NormalPage(a,"pageBack",!0,BookType.single_book,!0)},afterCurling:function(){this._super();this.bookAttachments.afterCurling()},setAttachmentBeforeFlipTo:function(a){this.pauseAnimation();this.bookAttachments.setAttachmentBeforeFlipTo(a)},setAttachmentAfterFlipTo:function(a){this.stopMedia();
this.resetSlider();this.flipping||this.enterPage();this.bookAttachments.setAttachmentAfterFlipTo(a);bookConfig.ThumbnailsButtonVisible&&global.thumbnail&&(thumbnail.clearHighLight(),thumbnail.setHighLight(this.currentPageIndex));window.resizeBookAfterFlip&&!this.flipping&&window.setTimeout(function(){onStageResize()},30)},resizeAttachments:function(a,b){this.bookAttachments.onResize(a,b)},resetBookShadow:function(){this.bookAttachments.Items.find("BookShadow").each(function(a){a.doubleWidth(!0);a.down(!1)})},
flippingTo:function(a){this.currentPageIndex=a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex)}}).extend(SingleFlipCalendar),HardCalendarCover=Class({create:function(a){this.parent=a;this.borderWidth=bookConfig.hardCoverBorderWidth;this.rightToLeft=bookConfig.RightToLeft;this.cover=$("<div class='hardCover'></div>");this.initPage();this.initBookSpine();this.parent.append(this.cover)},initPage:function(){var a=BookInfo.getHardCoverPages(!0);
this.leftPage=new HardPage(a[0],"coverPage",!1,BookType.normal_book);this.rightPage=new HardPage(a[1],"coverPage",!1,BookType.normal_book);this.cover.append(this.leftPage.$page);this.cover.append(this.rightPage.$page);this.leftPage.setUpOrDown(!0);this.rightPage.setUpOrDown(!1);this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,"margin-left":0});this.rightPage.setCSSByStyle({bottom:"0",left:"0","margin-bottom":0,"margin-left":0})},initBookSpine:function(){this.topSpine=new BookSpine(this.cover);
this.bottomSpine=new BookSpine(this.cover);this.topSpine.setCSSByName("top_spine");this.bottomSpine.setCSSByName("botoom_spine")},onResize:function(a,b,c){if(this.leftPage)this.leftPage.onResize(a,b);if(this.rightPage)this.rightPage.onResize(a,b);this.topSpine.onResize(c);this.bottomSpine.onResize(c);this.pageWidth=a;this.pageHeight=b;this.resizeCover(a,b,c)},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=a+2*this.borderWidth;this.height=2*b+(c[0]+c[1])+2*this.borderWidth;this.cover.css({width:this.width+
"px",height:this.height+"px",left:-this.borderWidth+"px",top:-(this.borderWidth+c[0])+"px"})},refresh:function(a,b,c){this.refreshBookSpine(b);this.refreshPage(a,c);this.resizeCover(this.pageWidth,this.pageHeight,b)},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!0)},refreshPage:function(a,b){var c=this.getSensitiveIndex().min,g=this.getSensitiveIndex().max;if(a<=c||a>=g){if(a<=c&&bookConfig.RightToLeft||!bookConfig.RightToLeft&&a>=g)this.rightPage&&this.rightPage.setVisible(!1),
(b<g&&bookConfig.RightToLeft||b>c&&!bookConfig.RightToLeft)&&this.leftPage&&this.leftPage.setVisible(!0);if(a<=c&&!bookConfig.RightToLeft||bookConfig.RightToLeft&&a>=g)this.leftPage&&this.leftPage.setVisible(!1),(b<g&&!bookConfig.RightToLeft||b>c&&bookConfig.RightToLeft)&&this.rightPage&&this.rightPage.setVisible(!0);this.hideBookSpine()}else this.showBookSpine(),this.leftPage&&this.leftPage.setVisible(!0),this.rightPage&&this.rightPage.setVisible(!0)},refreshBookSpine:function(a){this.topSpine.refresh(a);
this.bottomSpine.refresh(a)},hideBookSpine:function(){this.topSpine.hide();this.bottomSpine.hide()},showBookSpine:function(){this.topSpine.show();this.bottomSpine.show()},show:function(){this.cover.show()},hide:function(){this.cover.hide()}}),HardCalendar=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[1,totalPageCount].indexOf(b)&&0<=[1,totalPageCount].indexOf(a)||0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||
0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},toSoftPage:function(a){var b=this.currentPageIndex;if(0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a))return!1;0>[1,totalPageCount].indexOf(b)&&[1,totalPageCount].indexOf(a);
return!0},toHardPage:function(a){return!1},toCoverPage:function(a){var b=this.currentPageIndex;return 0>[1,2,totalPageCount-1,totalPageCount].indexOf(b)&&0>[1,2,totalPageCount-1,totalPageCount].indexOf(a)||0<=[2,3].indexOf(b)&&0>[1,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},isHardPage:function(a,b){return!1},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){1==this.currentPageIndex?
gotoPageFun(2,!1,"cross page"):this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new HardCalendarCover(this.flipBook)},newPage:function(a){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new NormalPage(a,"page",!1,BookType.normal_book)},followToPoint:function(a,
b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setUpOrDown(!0),this.pageArray[b]&&this.pageArray[b].setUpOrDown(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-up-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-down-side")):(this.pageArray[a]&&this.pageArray[a].setUpOrDown(!1),this.pageArray[b]&&this.pageArray[b].setUpOrDown(!0),
this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-down-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-up-side"));return[this.pageArray[a],this.pageArray[b]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);
this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){return[0,0]},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),
this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(NormalCalendar),OpenHardCalendar=Class({crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||totalPageCount!=b&&totalPageCount!=a?!1:!0},toSoftPage:function(a){return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(this.currentPageIndex)&&
0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)?!1:!0},toCoverPage:function(a){return totalPageCount!=this.currentPageIndex&&totalPageCount!=a?!1:!0},isCoverPage:function(a,b){return a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount&&gotoPageFun(totalPageCount-1,!1,"cross page")},newPage:function(a){return 1==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,
"page",!1,BookType.normal_book):new NormalPage(a,"page",!1,BookType.normal_book)}}).extend(HardCalendar),SingleHardCalendarCover=Class({initPage:function(){var a=BookInfo.getHardCoverPages(!1);bookConfig.RightToLeft&&(this.leftPage=new HardPage(a[0],"coverPage",!0,BookType.single_book));bookConfig.RightToLeft||(this.rightPage=new HardPage(a[0],"coverPage",!0,BookType.single_book));this.leftPage&&this.cover.append(this.leftPage.$page);this.rightPage&&this.cover.append(this.rightPage.$page);this.leftPage&&
this.leftPage.setUpOrDown(!0);this.rightPage&&this.rightPage.setUpOrDown(!1);this.leftPage&&this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,"margin-left":0});this.rightPage&&this.rightPage.setCSSByStyle({bottom:"0",left:"0","margin-bottom":0,"margin-left":0})},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!1)},initBookSpine:function(){this.topSpine=new SingleBookSpine(this.cover);this.bottomSpine=new SingleBookSpine(this.cover);this.topSpine.setCSSByName("top_spine");
this.bottomSpine.setCSSByName("botoom_spine")},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=a+2*this.borderWidth;this.height=b+(c[0]+c[1])+this.borderWidth;this.cover.css({width:this.width+"px",height:this.height+"px",top:(bookConfig.RightToLeft?-(this.borderWidth+c[0]):0)+"px",left:-this.borderWidth+"px"})}}).extend(HardCover),SingleHardCalendar=Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 1==
b&&2!=a||2!=b&&1==a?!0:!1},toSoftPage:function(a){return 2==a||1==a?!1:!0},toHardPage:function(a){return!1},toCoverPage:function(a){return 1!=a?!1:!0},isCoverPage:function(a,b){var c=a;a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!0:!1},isHardPage:function(a,b){return!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new SingleHardCalendarCover(this.flipBook)},newPage:function(a){1==
a||a==bookConfig.totalPageCount?(a=new HardPage(a,"page",!0,BookType.single_book),a.setUpOrDown(bookConfig.RightToLeft)):a=new NormalPage(a,"page",!0,BookType.single_book);return a},newPageBack:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"pageBack",!0,BookType.single_book,!0),a.setUpOrDown(bookConfig.RightToLeft)):a=new NormalPage(a,"pageBack",!0,BookType.single_book,!0);return a},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},
getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!0),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-up-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-down-side")):(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!1),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!1),
this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-down-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-up-side"));return[this.pageArray[c],this.pageBackArray[c]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);
this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){return[0,0]},onResize:function(a,b){this._super(a,b)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(SingleCalendar),
AlbumCanlendar=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){return!1},toSoftPage:function(a){return!1},toHardPage:function(a){return!0},isHardPage:function(a,b){return!0},toCoverPage:function(){return!1},isCoverPage:function(){return!1},gotoNearPage:function(a){},newPage:function(a){return new AlbumPage(a,"page",!1,BookType.normal_book)},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setUpOrDown(!0),
this.pageArray[b]&&this.pageArray[b].setUpOrDown(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-up-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-down-side")):(this.pageArray[a]&&this.pageArray[a].setUpOrDown(!1),this.pageArray[b]&&this.pageArray[b].setUpOrDown(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-down-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-up-side"));return[this.pageArray[a],this.pageArray[b]]}}).extend(NormalCalendar),
AlbumHardCalendar=Class({bookType:BookType.normal_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[1,totalPageCount].indexOf(b)&&0<=[1,totalPageCount].indexOf(a)||0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},toSoftPage:function(a){return!1},
toHardPage:function(a){var b=this.currentPageIndex;if(0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a))return!1;0>[1,totalPageCount].indexOf(b)&&[1,totalPageCount].indexOf(a);return!0},toCoverPage:function(a){var b=this.currentPageIndex;return 0>[1,2,totalPageCount-1,totalPageCount].indexOf(b)&&0>[1,2,totalPageCount-1,totalPageCount].indexOf(a)||0<=[2,3].indexOf(b)&&0>[1,
totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},isHardPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!1:!0},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):
1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new HardCalendarCover(this.flipBook)},newPage:function(a){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new AlbumPage(a,"page",!1,BookType.normal_book)},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&
this.pageArray[a].setUpOrDown(!0),this.pageArray[b]&&this.pageArray[b].setUpOrDown(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-up-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-down-side")):(this.pageArray[a]&&this.pageArray[a].setUpOrDown(!1),this.pageArray[b]&&this.pageArray[b].setUpOrDown(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-down-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-up-side"));return[this.pageArray[a],
this.pageArray[b]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){return[0,
0]},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(NormalCalendar),
OpenAlbumHardCalendar=Class({crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||totalPageCount!=b&&totalPageCount!=a?!1:!0},toHardPage:function(a){return 0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(this.currentPageIndex)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)?!1:!0},toCoverPage:function(a){return totalPageCount!=
this.currentPageIndex&&totalPageCount!=a?!1:!0},isHardPage:function(a,b){return a==totalPageCount||a==totalPageCount-1?!1:!0},isCoverPage:function(a,b){return a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount&&gotoPageFun(totalPageCount-1,!1,"cross page")},newPage:function(a){return 1==a||a==totalPageCount||a==totalPageCount-1?new HardPage(a,"page",!1,BookType.normal_book):new AlbumPage(a,
"page",!1,BookType.normal_book)}}).extend(AlbumHardCalendar),SingleAlbumCalendar=Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){return!1},toSoftPage:function(a){return!1},toHardPage:function(a){return!0},isHardPage:function(a,b){return!0},toCoverPage:function(){return!1},isCoverPage:function(){return!1},gotoNearPage:function(a){},newPage:function(a){return new AlbumPage(a,"page",!0,BookType.single_book)},getDownUpHardPage:function(a,b){var c=a;a>
b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!0),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-up-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-down-side")):(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!1),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!1),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-down-side"),
this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-up-side"));return[this.pageArray[c],this.pageBackArray[c]]}}).extend(SingleCalendar),SingleAlbumHardCalendar=Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 1==b&&2!=a||2!=b&&1==a?!0:!1},toSoftPage:function(a){return!1},toHardPage:function(a){return 2==a||1==a?!1:!0},toCoverPage:function(a){return 1!=a?!1:!0},isCoverPage:function(a,b){var c=a;a>
b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!0:!1},isHardPage:function(a,b){var c=a;a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!1:!0},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new SingleHardCalendarCover(this.flipBook)},newPage:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"page",!0,BookType.single_book),a.setUpOrDown(bookConfig.RightToLeft)):
a=new AlbumPage(a,"page",!0,BookType.single_book);return a},newPageBack:function(a){1==a||a==bookConfig.totalPageCount?(a=new HardPage(a,"pageBack",!0,BookType.single_book),a.setUpOrDown(bookConfig.RightToLeft)):a=new AlbumPage(a,"pageBack",!0,BookType.single_book,!0);return a},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);
bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!0),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-up-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-down-side")):(this.pageArray[c]&&this.pageArray[c].setUpOrDown(!1),this.pageBackArray[c]&&this.pageBackArray[c].setUpOrDown(!1),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-down-side"),this.pageBackArray[c]&&
this.pageBackArray[c].setCSSByName("flip-hard-up-side"));return[this.pageArray[c],this.pageBackArray[c]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,
this.getThicknessWidth(),this.currentPageIndex)},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=b.getThicknessWidth()});return a},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b){this._super(a,b);this.hardCover.onResize(a,b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,
this.getThicknessWidth(),this.currentPageIndex)},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(SingleCalendar),SlideCalendarPage=Class({onPageLoaded:null,create:function(a,b,c,g){this.pageHeight=this.pageWidth=this.height=this.width=this.zIndex=0;this.pageIndex=a;this.pageArray=[];this.bookType=c;this.onPageLoaded=g;this.side=$("<div class='slide_side'></div>");this.side.attr("id",b+a);this.init(a)},init:function(a){isNaN(a)||(this.pages=
$("<div class='slide_pages'></div>"),this.initPages(a),this.setPageCss(),this.side.append(this.pages),this.initEvent())},initEvent:function(){this.adContainer&&this.adContainer.css({"z-index":3});isBelowIE9()?this.pages.IEZoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)}):this.pages.zoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)})},zoomIn:function(a){a=BookInfo.getBook();
a.status_zoom=!0;a.adContainer&&a.adContainer.css({"z-index":1});StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(c){c.setAsZoomout();c.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!1);if(!isPhone()&&!isPad()){this.switchLargeImage();bookConfig.ZoomToolbarVisible&&!this.controlBar&&(this.controlBar=new ZoomControlBar(tmpContainer),this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5));if(this.controlBar){var b=
"lite"==bookConfig.ToolbarViewMode&&bookType==BookType.catalog_book?50:0;this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5);this.controlBar.setVisible(bookConfig.isZoomControlBarVisible)}global.canMagnifierZoom&&BookInfo.getBook().unMagnifierZoom()}},zoomOut:function(){var a=BookInfo.getBook();a.status_zoom=!1;a.flipping||!a.adContainer||1!=a.currentPageIndex||bookConfig.isTheBookOpen||a.adContainer.css({"z-index":3});gotoPageFun(a.toPageIndex,!1,"change book type");
StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(b){b.setAsZoomin();b.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!0);this.switchNormalImage();this.controlBar&&this.controlBar.setVisible(!1)},onZoomed:function(a){if(isPhone()||isPad()){var b=BookInfo.getBook(),c=BookInfo.getCurrentPages();if(void 0!=c&&null!=c)for(var g=0;g<c.length;g++){var h=b.pageArray[c[g]];h&&(h.resizeSvg(Math.round(this.pageWidth*a.scale),Math.round(this.pageHeight*
a.scale)),bookConfig.highDefinitionConversion?h.zoomInSideImage():(1<a.scale&&h.zoomInSideImage(),1==a.scale&&h.zoomOutSideImage()))}}else a&&!this.pages.parameters.resize&&(this.pages.parameters.resize=!0,a=this.pages.offset().left,b=this.pages.offset().top,a-=this.pages.parameters.left,b-=this.pages.parameters.top,c=this.pages.parameters.scale,1!=c&&(this.resizePages(parseInt(this.pageWidth*c),parseInt(this.pageHeight*c)),c=1),c=transformCSS({tran:{x:a,y:b},scale:c,origin:{x:0,y:0}}),this.pages.css(c),
this.pages.parameters&&(this.pages.parameters.tran={x:a,y:b},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1))},mouseWheelFlip:function(){var a;this.side.parent().bind(_event._mousewheel,function(b){if(void 0!=a&&150>new Date-a)var c=!1;else a=new Date,c=!0;if(!c)return!1;c=b.originalEvent;c=Math.max(-1,Math.min(1,
c.wheelDelta||-c.detail));b=b.originalEvent?b.originalEvent:b;this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>c?this.controlBar&&this.controlBar.zoomDown(b):this.controlBar&&this.controlBar.zoomUp(b));!this.status_zoom&&bookConfig.mouseWheelFlip&&(0>c?nextPageFun("mouse wheel flip"):previousPageFun("mouse wheel flip"));if(bookConfig.mouseWheelFlip)return stopEvent(b),!1}.bind(this))},initPages:function(a){a=bookConfig.isTheBookOpen?2*a:2*a-1;var b=a-
1;var c=rightToLeft?a:b;a=rightToLeft?b:a;this.addPageArray([c,a]);this.leftPage=this.pageArray[c];this.rightPage=this.pageArray[a]},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});!this.rightPage&&this.leftPage&&bookConfig.retainBookCenter?(this.leftPage.centerPage(),this.leftPage.setCSSByStyle(a)):!this.leftPage&&this.rightPage&&bookConfig.retainBookCenter?(this.rightPage.centerPage(),this.rightPage.setCSSByStyle(a)):(this.leftPage&&(this.leftPage.setUpOrDown(!0),this.leftPage.setCSSByStyle(a)),
this.rightPage&&(this.rightPage.setUpOrDown(!1),this.rightPage.setCSSByStyle(a)))},addPageArray:function(a){if(a&&this.pageArray)for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>originTotalPageCount||this.pageArray[a[b]])){var c=new Page(a[b],"page",this.bookType,this.onPageLoaded);c.hideMiddleShadow();c.onResize(this.pageWidth,this.pageHeight);this.pageArray[a[b]]=c;this.pages.append(c.side)}},fillContent:function(a){this.pageArray[a]&&this.pageArray[a].fillContent()},fillImage:function(){for(var a=
0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].fillContent()},remove:function(){this.controlBar&&this.controlBar.destroy();this.side.remove();this.side=void 0},setCSSByStyle:function(a){this.side.css(a)},setCSSByName:function(a){this.side.addClass(a)},onResize:function(a,b){this.width=a;this.height=b;this.resetPages()},resetPages:function(){if(this.pages){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,b=bookConfig.largePageHeight*
(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;b=fitPageWidthHeight(this.width,this.height,a,2*b);a=parseInt(b.x);b=2*parseInt(b.y/2);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=
$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1);this.controlBar&&this.controlBar.setVisible(!1)}},resizePages:function(a,b){this.pageWidth=a;this.pageHeight=b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+
"px"});a=this.pageWidth;b=this.pageHeight/2;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)},loading:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].loading()},setLeftOrRight:function(a){this.isLeft=a},reset:function(){},getSide:function(){return this.side},setZIndex:function(a){this.zIndex=a;this.side.css({"z-index":a})},getZIndex:function(){return this.zIndex},enterSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&
this.pageArray[a].enterSide()},leaveSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].leaveSide()},initSelectTextEvent:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initSelectTextEvent()},destroySelect:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroySelect()},initMagnifierEvent:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},
destroyMagnifier:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroyMagnifier()},pauseAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].pauseAnimation()},startAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].startAnimation()},addHistoryTexts:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&this.pageArray[b].addHistoryTexts(a)},highlightSearch:function(){for(var a=
0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearHighlight:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].clearHighlight()},resetSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].resetSlider()},initReaderOrSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initReaderOrSlider&&this.pageArray[a].initReaderOrSlider()},fillPage:function(a,
b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].fillPage(a,b)},zoomInSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomInSideImage()},zoomOutSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomOutSideImage()},switchLargeImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].switchLargeImage()},switchNormalImage:function(a){for(var b=
0;b<this.pageArray.length;b++)this.pageArray[b]&&this.pageArray[b].switchNormalImage(a)},resizeSvg:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].resizeSvg(a,b)}}),DocViewCalendarPage=Class({onPageLoaded:null,create:function(a,b,c,g){this.pageHeight=this.pageWidth=this.height=this.width=this.zIndex=0;this.pageIndex=a;this.pageArray=[];this.bookType=c;this.onPageLoaded=g;this.side=$("<div class='slide_side'></div>");this.side.attr("id",b+a);this.init(a)},
init:function(a){isNaN(a)||(this.pages=$("<div class='slide_pages'></div>"),this.initPages(a),this.setPageCss(),this.side.append(this.pages),this.initEvent())},initEvent:function(){this.adContainer&&this.adContainer.css({"z-index":3});isBelowIE9()?this.pages.IEZoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)}):this.pages.zoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)})},
zoomIn:function(a){a=BookInfo.getBook();a.status_zoom=!0;a.adContainer&&a.adContainer.css({"z-index":1});StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(c){c.setAsZoomout();c.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!1);if(!isPhone()&&!isPad()){this.switchLargeImage();bookConfig.ZoomToolbarVisible&&!this.controlBar&&(this.controlBar=new ZoomControlBar(tmpContainer),this.controlBar.setPosition((windowWidth-this.controlBar.width)/
2,templateArea.getTopHeight()+b+5));if(this.controlBar){var b="lite"==bookConfig.ToolbarViewMode&&bookType==BookType.catalog_book?50:0;this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5);this.controlBar.setVisible(bookConfig.isZoomControlBarVisible)}global.canMagnifierZoom&&BookInfo.getBook().unMagnifierZoom()}},zoomOut:function(){var a=BookInfo.getBook();a.status_zoom=!1;a.flipping||!a.adContainer||1!=a.currentPageIndex||bookConfig.isTheBookOpen||a.adContainer.css({"z-index":3});
gotoPageFun(a.toPageIndex,!1,"change book type");StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(b){b.setAsZoomin();b.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!0);this.switchNormalImage();this.controlBar&&this.controlBar.setVisible(!1)},onZoomed:function(a){if(isPhone()||isPad()){var b=BookInfo.getBook(),c=BookInfo.getCurrentPages();if(void 0!=c&&null!=c)for(var g=0;g<c.length;g++){var h=b.pageArray[c[g]];h&&(h.resizeSvg(Math.round(this.pageWidth*
a.scale),Math.round(this.pageHeight*a.scale)),bookConfig.highDefinitionConversion?h.zoomInSideImage():(1<a.scale&&h.zoomInSideImage(),1==a.scale&&h.zoomOutSideImage()))}}else a&&!this.pages.parameters.resize&&(this.pages.parameters.resize=!0,a=this.pages.offset().left,b=this.pages.offset().top,a-=this.pages.parameters.left,b-=this.pages.parameters.top,c=this.pages.parameters.scale,1!=c&&(this.resizePages(parseInt(this.pageWidth*c),parseInt(this.pageHeight*c)),c=1),c=transformCSS({tran:{x:a,y:b},scale:c,
origin:{x:0,y:0}}),this.pages.css(c),this.pages.parameters&&(this.pages.parameters.tran={x:a,y:b},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1))},mouseWheelFlip:function(){var a;this.side.parent().bind(_event._mousewheel,function(b){if(void 0!=a&&150>new Date-a)var c=!1;else a=new Date,c=!0;if(!c)return!1;c=b.originalEvent;
c=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));b=b.originalEvent?b.originalEvent:b;this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>c?this.controlBar&&this.controlBar.zoomDown(b):this.controlBar&&this.controlBar.zoomUp(b));!this.status_zoom&&bookConfig.mouseWheelFlip&&(0>c?nextPageFun("mouse wheel flip"):previousPageFun("mouse wheel flip"));if(bookConfig.mouseWheelFlip)return stopEvent(b),!1}.bind(this))},initPages:function(a){a=bookConfig.isTheBookOpen?
2*a:2*a-1;var b=a-1;var c=rightToLeft?a:b;a=rightToLeft?b:a;this.addPageArray([c,a]);this.leftPage=this.pageArray[c];this.rightPage=this.pageArray[a]},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});!this.rightPage&&this.leftPage&&bookConfig.retainBookCenter?(this.leftPage.centerPage(),this.leftPage.setCSSByStyle(a)):!this.leftPage&&this.rightPage&&bookConfig.retainBookCenter?(this.rightPage.centerPage(),this.rightPage.setCSSByStyle(a)):(this.leftPage&&(this.leftPage.setUpOrDown(!0),
this.leftPage.setCSSByStyle(a)),this.rightPage&&(this.rightPage.setUpOrDown(!1),this.rightPage.setCSSByStyle(a)))},addPageArray:function(a){if(a&&this.pageArray)for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>originTotalPageCount||this.pageArray[a[b]])){var c=new Page(a[b],"page",this.bookType,this.onPageLoaded);c.hideMiddleShadow();c.onResize(this.pageWidth,this.pageHeight);this.pageArray[a[b]]=c;this.pages.append(c.side)}},fillContent:function(a){this.pageArray[a]&&this.pageArray[a].fillContent()},
fillImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].fillContent()},remove:function(){this.controlBar&&this.controlBar.destroy();this.side.remove();this.side=void 0},setCSSByStyle:function(a){this.side.css(a)},setCSSByName:function(a){this.side.addClass(a)},onResize:function(a,b){this.width=a;this.height=b;this.resetPages()},resetPages:function(){if(this.pages){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/
100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;b=fitPageWidthHeight(this.width,this.height,a,2*b);a=parseInt(b.x);b=2*parseInt(b.y/2);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=
$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1);this.controlBar&&this.controlBar.setVisible(!1)}},resizePages:function(a,b){this.pageWidth=a;this.pageHeight=
b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});a=this.pageWidth;b=this.pageHeight/2;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)},loading:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].loading()},setLeftOrRight:function(a){this.isLeft=a},reset:function(){},getSide:function(){return this.side},setZIndex:function(a){this.zIndex=a;this.side.css({"z-index":a})},getZIndex:function(){return this.zIndex},
enterSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].enterSide()},leaveSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].leaveSide()},initSelectTextEvent:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initSelectTextEvent()},destroySelect:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroySelect()},initMagnifierEvent:function(){for(var a=
0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},destroyMagnifier:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroyMagnifier()},pauseAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].pauseAnimation()},startAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].startAnimation()},addHistoryTexts:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&
this.pageArray[b].addHistoryTexts(a)},highlightSearch:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearHighlight:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].clearHighlight()},resetSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].resetSlider()},initReaderOrSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initReaderOrSlider&&
this.pageArray[a].initReaderOrSlider()},fillPage:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].fillPage(a,b)},zoomInSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomInSideImage()},zoomOutSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomOutSideImage()},switchLargeImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].switchLargeImage()},
switchNormalImage:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&this.pageArray[b].switchNormalImage(a)},resizeSvg:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].resizeSvg(a,b)}}),IssuuHardSide=Class({create:function(a,b,c,g){this._super(a,b,c,g);this.isHard=!0},addFlipShadow:function(){},renderPage:function(){}}).extend(IssuuPage),IssuuHardPage=Class({create:function(a,b,c,g,h){this._super(a,b,c,g,h);this.isHardPage=!0;this.borderWidth=
bookConfig.hardCoverBorderWidth;this.outerCoverBorder=bookConfig.outerCoverBorder||BookInfo.isInnerPage(a,g);this.$page=$("<div class='hardSide' style='background-color:"+bookConfig.borderColor+";'></div>");this.$page.append(this.page.side);this.page.side.addClass("pageSide");this.renderPage()},newPage:function(a,b,c,g){this.page=new IssuuHardSide(a,b,c,g)},setLeftOrRight:function(a){(this.isLeft=a)?this.setCSSByName("left-side"):this.setCSSByName("right-side");var b=a&&this.outerCoverBorder?this.borderWidth:
0,c=bookConfig.cornerRound;a?(this.$page.css({"border-radius":c+"px 0px 0px "+c+"px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"})):(this.$page.css({"border-radius":"0px "+c+"px "+c+"px 0px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-right":-this.borderWidth+"px"}));this.page.side.css({left:b+"px"})},setUpOrDown:function(a){(this.isUp=a)?this.setCSSByName("up-side"):this.setCSSByName("down-side");var b=a&&this.outerCoverBorder?this.borderWidth:
0,c=bookConfig.cornerRound;a?(this.$page.css({"border-radius":c+"px "+c+"px 0px 0px"}),this.$page.css({"margin-top":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"})):(this.$page.css({"border-radius":"0px 0px "+c+"px "+c+"px"}),this.$page.css({"margin-bottom":-this.borderWidth+"px","margin-left":-this.borderWidth+"px"}));this.page.side.css({top:b+"px"})},onResize:function(a,b,c){this.pageWidth=a;this.pageHeight=b;bookConfig.FlipDirection?(this.width=a+2*this.borderWidth,this.height=b+
this.borderWidth,this.pageWidth=this.outerCoverBorder?a:a+2*this.borderWidth,this.pageHeight=this.outerCoverBorder?b:b+this.borderWidth):(this.width=a+this.borderWidth,this.height=b+2*this.borderWidth,this.pageWidth=this.outerCoverBorder?a:a+this.borderWidth,this.pageHeight=this.outerCoverBorder?b:b+2*this.borderWidth);if(this.page)this.page.onResize(this.pageWidth,this.pageHeight);this.$page.css({width:this.width,height:this.height});bookConfig.FlipDirection?this.page.side.css({left:this.outerCoverBorder?
this.borderWidth:0}):this.page.side.css({top:this.outerCoverBorder?this.borderWidth:0});if(this.rendering)this.rendering.onResize(a,b)},renderPage:function(){this.rendering&&(this.rendering.destroy(),this.rendering=null);this.rendering=new PageRendering(this.$page,this.pageIndex,this.bookType);this.rendering.onResize(this.width,this.height);this.rendering.render()},beginToFlip:function(){},setHardCover:function(a,b,c,g,h){this.outerCoverBorder=bookConfig.outerCoverBorder||BookInfo.isInnerPage(this.pageIndex,
this.bookType);this.$page.css("background-color",bookConfig.borderColor);this.borderWidth!=bookConfig.hardCoverBorderWidth&&(this.borderWidth=bookConfig.hardCoverBorderWidth,bookConfig.FlipDirection?this.setUpOrDown(this.isUp):this.setLeftOrRight(this.isLeft),this.onResize(this.pageWidth,this.pageHeight));this.renderPage()}}).extend(PageInterface),IssuuHardCover=Class({create:function(a){this.parent=a;this.borderWidth=bookConfig.hardCoverBorderWidth;this.rightToLeft=bookConfig.RightToLeft;this.cover=
$("<div class='hardCover'></div>");this.initPage();this.initBookSpine();this.parent.append(this.cover)},initPage:function(){var a=BookInfo.getHardCoverPages(!0);this.leftPage=new IssuuHardPage(a[0],"coverPage",!1,BookType.normal_book);this.rightPage=new IssuuHardPage(a[1],"coverPage",!1,BookType.normal_book);this.cover.append(this.leftPage.$page);this.cover.append(this.rightPage.$page);this.leftPage.rendering.midCoil&&this.leftPage.rendering.midCoil.hide();this.rightPage.rendering.midCoil&&this.rightPage.rendering.midCoil.hide();
this.leftPage.setLeftOrRight(!0);this.rightPage.setLeftOrRight(!1);this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,"margin-left":0});this.rightPage.setCSSByStyle({top:"0",right:"0","margin-top":0,"margin-right":0})},initBookSpine:function(){this.topSpine=new IssuuBookSpine(this.cover);this.bottomSpine=new IssuuBookSpine(this.cover);this.topSpine.setCSSByName("top_spine");this.bottomSpine.setCSSByName("botoom_spine")},onResize:function(a,b,c){c||(c=1);if(this.leftPage)this.leftPage.onResize(a[0].x*
c,a[0].y*c);if(this.rightPage)this.rightPage.onResize(a[1].x*c,a[1].y*c);this.topSpine.onResize(b);this.bottomSpine.onResize(b);this.topSpine.setCSSByStyle({left:a[0].x*c+this.borderWidth+"px"});this.bottomSpine.setCSSByStyle({left:a[0].x*c+this.borderWidth+"px"});this.pagesWhArray=[{x:a[0].x*c,y:a[0].y*c},{x:a[1].x*c,y:a[1].y*c}];this.resizeCover((a[0].x+a[1].x)*c,a[0].y*c,b);a=transformCSS({scale:{x:1,y:1}});this.leftPage&&this.leftPage.$page.css(a);this.rightPage&&this.rightPage.$page.css(a);this.topSpine.setCSSByStyle(a);
this.bottomSpine.setCSSByStyle(a)},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=a+(c[0]+c[1])+2*this.borderWidth;this.height=b+2*this.borderWidth;this.cover.css({width:this.width+"px",height:this.height+"px",left:-(this.borderWidth+c[0])+"px",top:-this.borderWidth+"px"})},refresh:function(a,b,c){this.refreshBookSpine(b);this.refreshPage(a,c);this.resizeCover(this.pagesWhArray[0].x+this.pagesWhArray[1].x,this.pagesWhArray[0].y,b)},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!0)},
refreshPage:function(a,b){var c=this.getSensitiveIndex().min,g=this.getSensitiveIndex().max;if(a<=c||a>=g){if(a<=c&&bookConfig.RightToLeft||!bookConfig.RightToLeft&&a>=g)this.rightPage&&this.rightPage.setVisible(!1),(b<g&&bookConfig.RightToLeft||b>c&&!bookConfig.RightToLeft)&&this.leftPage&&this.leftPage.setVisible(!0);if(a<=c&&!bookConfig.RightToLeft||bookConfig.RightToLeft&&a>=g)this.leftPage&&this.leftPage.setVisible(!1),(b<g&&!bookConfig.RightToLeft||b>c&&bookConfig.RightToLeft)&&this.rightPage&&
this.rightPage.setVisible(!0);this.hideBookSpine()}else this.showBookSpine(),this.leftPage&&this.leftPage.setVisible(!0),this.rightPage&&this.rightPage.setVisible(!0)},doSetMovingScale:function(a,b){var c=transformCSS({scale:{x:a.x,y:a.y}});b=transformCSS({scale:{x:b.x,y:b.y}});this.leftPage&&this.leftPage.$page.css(c);this.rightPage&&this.rightPage.$page.css(b);a=transformCSS({scale:{x:1,y:a.y}});this.topSpine.setCSSByStyle(a);this.bottomSpine.setCSSByStyle(a)},refreshBookSpine:function(a){this.topSpine.refresh(a);
this.bottomSpine.refresh(a)},hideBookSpine:function(){this.topSpine.hide();this.bottomSpine.hide()},showBookSpine:function(){this.topSpine.show();this.bottomSpine.show()},show:function(){this.cover.show()},hide:function(){this.cover.hide()}}),IssuuBookSpine=Class({create:function(a){this.parent=a;this.initSpine()},initSpine:function(){this.height=bookConfig.hardCoverBorderWidth;this.bookSpine=$("<div class='bookSpine'></div>");this.bookSpine.css({height:"100%","background-color":bookConfig.borderColor});
this.parent.append(this.bookSpine);this.addShadow()},addShadow:function(){this.leftShadow=$("<div class='left_shadow shadow'></div>");this.rightShadow=$("<div class='right_shadow shadow'></div>");this.bookSpine.append(this.leftShadow);this.bookSpine.append(this.rightShadow)},refresh:function(a){this.onResize(a)},show:function(){this.bookSpine.show()},hide:function(){},setCSSByStyle:function(a){this.bookSpine.css(a)},setCSSByName:function(a){this.bookSpine.attr("class",a);this.bookSpine.addClass("bookSpine")},
onResize:function(a){this.width=a[0]+a[1];this.bookSpine.css({width:this.width})}}),IssuuSingleHardCover=Class({onResize:function(a,b){if(this.leftPage)this.leftPage.onResize(a[0].x,a[0].y);if(this.rightPage)this.rightPage.onResize(a[0].x,a[0].y);this.topSpine.onResize(b);this.bottomSpine.onResize(b);this.topSpine.setCSSByStyle({left:a[0].x+this.borderWidth+"px"});this.bottomSpine.setCSSByStyle({left:a[0].x+this.borderWidth+"px"});this.pagesWhArray=a;this.resizeCover(a[0].x,a[0].y,b);a=transformCSS({scale:{x:1,
y:1}});this.leftPage&&this.leftPage.$page.css(a);this.rightPage&&this.rightPage.$page.css(a);this.topSpine.setCSSByStyle(a);this.bottomSpine.setCSSByStyle(a)},doSetMovingScale:function(a){a&&(a=transformCSS({scale:{x:a.x,y:a.y}}),this.leftPage&&this.leftPage.$page.css(a),this.rightPage&&this.rightPage.$page.css(a),a=transformCSS({scale:{x:1,y:a.y}}),this.topSpine.setCSSByStyle(a),this.bottomSpine.setCSSByStyle(a))},initPage:function(){var a=BookInfo.getHardCoverPages(!1);bookConfig.RightToLeft&&(this.leftPage=
new IssuuHardPage(a[0],"coverPage",!0,BookType.single_book));bookConfig.RightToLeft||(this.rightPage=new IssuuHardPage(a[0],"coverPage",!0,BookType.single_book));this.leftPage&&this.cover.append(this.leftPage.$page);this.rightPage&&this.cover.append(this.rightPage.$page);this.leftPage&&this.leftPage.setLeftOrRight(!0);this.rightPage&&this.rightPage.setLeftOrRight(!1);this.leftPage&&this.leftPage.setCSSByStyle({top:"0",left:"0","margin-top":0,"margin-left":0});this.rightPage&&this.rightPage.setCSSByStyle({top:"0",
right:"0","margin-top":0,"margin-right":0})},getSensitiveIndex:function(){return BookInfo.getSensitiveIndex(!1)},initBookSpine:function(){this.topSpine=new IssuuSingleBookSpine(this.cover);this.bottomSpine=new IssuuSingleBookSpine(this.cover);this.topSpine.setCSSByName("top_spine");this.bottomSpine.setCSSByName("botoom_spine")},resizeCover:function(a,b,c){this.thicknessWidthArray=c;this.width=a+(c[0]+c[1])+this.borderWidth;this.height=b+2*this.borderWidth;this.cover.css({width:this.width+"px",height:this.height+
"px",left:(bookConfig.RightToLeft?-(this.borderWidth+c[0]):0)+"px",top:-this.borderWidth+"px"})}}).extend(IssuuHardCover),IssuuSingleBookSpine=Class({onResize:function(a){this.width=a[0]+a[1];this.bookSpine.css({width:this.width});bookConfig.RightToLeft?this.bookSpine.css({left:"auto",right:"0"}):this.bookSpine.css({right:"auto",left:"0"})}}).extend(IssuuBookSpine),HardIssuuBook=Class({bookType:BookType.normal_book,doublePage:!0,create:function(a){bookConfig.bookPageStretch=!0;this._super(a);this.resetZoomArea();
bookConfig.supportSerialsFlip=!1},crossFlipMode:function(a){var b=this.currentPageIndex;return 0<=[1,totalPageCount].indexOf(b)&&0<=[1,totalPageCount].indexOf(a)||0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,totalPageCount].indexOf(a)?!1:!0},toSoftPage:function(a){var b=this.currentPageIndex;if(0<=[1,2,3].indexOf(b)&&0<=[1,2,3].indexOf(a)||
0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(b)&&0<=[totalPageCount-1,totalPageCount-2,totalPageCount].indexOf(a))return!1;0>[1,totalPageCount].indexOf(b)&&[1,totalPageCount].indexOf(a);return!0},toHardPage:function(a){return!1},toCoverPage:function(a){var b=this.currentPageIndex;return 0>[1,2,totalPageCount-1,totalPageCount].indexOf(b)&&0>[1,2,totalPageCount-1,totalPageCount].indexOf(a)||0<=[2,3].indexOf(b)&&0>[1,totalPageCount].indexOf(a)||0>[1,totalPageCount].indexOf(b)&&0>[1,
totalPageCount].indexOf(a)?!1:!0},isHardPage:function(a,b){return!1},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!0:!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):this.currentPageIndex==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):a==totalPageCount?gotoPageFun(totalPageCount-1,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new IssuuHardCover(this.flipBook)},
newPage:function(a){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?new IssuuHardPage(a,"page",!1,BookType.normal_book):new IssuuNormalPage(a,"page",!1,BookType.normal_book)},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getDownUpHardPage:function(a,b,c){this.addPageArray([a,b]);c?(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!0),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!1),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-left-side"),
this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-right-side"),bookConfig.RightToLeft||a!=totalPageCount||this.pageArray[b].setCSSByName("flip-hard-right-last-side"),bookConfig.RightToLeft&&1==a&&this.pageArray[b].setCSSByName("flip-hard-right-last-side")):(this.pageArray[a]&&this.pageArray[a].setLeftOrRight(!1),this.pageArray[b]&&this.pageArray[b].setLeftOrRight(!0),this.pageArray[a]&&this.pageArray[a].setCSSByName("flip-hard-right-side"),this.pageArray[b]&&this.pageArray[b].setCSSByName("flip-hard-left-side"),
bookConfig.RightToLeft||1!=a||this.pageArray[b].setCSSByName("flip-hard-left-first-side"),bookConfig.RightToLeft&&a==totalPageCount&&this.pageArray[b].setCSSByName("flip-hard-left-first-side"));return[this.pageArray[a],this.pageArray[b]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),
this.currentPageIndex)},movetoCenter:function(a,b,c){if(bookConfig.retainBookCenter){var g=this.getMovedXByIndex(b).x-this.getMovedXByIndex(a).x,h=this.width;if(void 0==c||c>h)c=h;if(!isNaN(c)){this.movedLength=c;var n=this.getFitWHByIndex(a),p=this.getFitWHByIndex(b);this.status_zoom&&(n=this.getFitWHByIndex(a,this.width,this.height),p=this.getFitWHByIndex(b,this.width,this.height));this.getFlipTo(b);var z=BookInfo.getMinPageIndex(a),r=BookInfo.getMaxPageIndex(a);if(bookConfig.RightToLeft)if(a<b){var A=
this.scalePages([z,z-1,z-2],c,h,n[1],p[1],{x:0,y:50});z=this.scalePages([r,b],c,h,n[0],p[1],{x:100,y:50},!1,0,{x:-n[1].x,y:0});var D=this.scalePages([b+1],c,h,n[0],p[0],{x:100,y:50},!0,z);this.scalePages([b+2],c,h,n[0],p[0],{x:100,y:50})}else z=this.scalePages([z,b],c,h,n[1],p[0],{x:100,y:50},!1,0,{x:-n[1].x,y:0}),A=this.scalePages([b-1],c,h,n[1],p[1],{x:0,y:50},!0,z),this.scalePages([b-2],c,h,n[1],p[1],{x:0,y:50}),D=this.scalePages([r,r+1,r+2],c,h,n[0],p[0],{x:100,y:50});else a<b?(D=this.scalePages([z,
z-1,z-2],c,h,n[0],p[0],{x:100,y:50}),z=this.scalePages([r,b],c,h,n[1],p[0],{x:100,y:50},!1,0,{x:-n[1].x,y:0}),A=this.scalePages([b+1],c,h,n[1],p[1],{x:0,y:50},!0,z),this.scalePages([b+2],c,h,n[1],p[1],{x:0,y:50})):(z=this.scalePages([z,b],c,h,n[0],p[1],{x:100,y:50},!1,0,{x:-n[1].x,y:0}),D=this.scalePages([b-1],c,h,n[0],p[0],{x:100,y:50},!0,z),this.scalePages([b-2],c,h,n[0],p[0],{x:100,y:50}),A=this.scalePages([r,r+1,r+2],c,h,n[1],p[1],{x:0,y:50}));this.movedX=$.easing.easeInOutSine(null,c,0,g+(p[0].x-
n[0].x)-0,h);g={tran:{x:parseInt(this.movedX),y:0}};this.status_zoom||this.setCSS(g);this.bookAttachments.Items.find("ThicknessManager").each(function(M){M.leftThickness&&M.leftThickness.doSetMovingScale(a,b,c,h,!1,D.y,(-D.x+1)*n[0].x);M.rightThickness&&M.rightThickness.doSetMovingScale(a,b,c,h,!1,A.y,(A.x-1)*n[1].x)}.bind(this));this.hardCover.doSetMovingScale(D,A)}}},setAttachmentAfterFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),
this.currentPageIndex)},onResize:function(a,b){this._super(a,b);this.hardCover.onResize(this.getFitWHByIndex(this.currentPageIndex),this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b,c){this._super(a,b,c);var g=this.getFitWHByIndex(this.currentPageIndex);a=BookInfo.getLeftPages();b=BookInfo.getRightPages();c&&(g=[{x:a[0]&&this.pageArray[a[0]]?this.pageArray[a[0]].pageWidth:0,y:a[0]&&this.pageArray[a[0]]?this.pageArray[a[0]].pageHeight:
0},{x:b[0]&&this.pageArray[b[0]]?this.pageArray[b[0]].pageWidth:0,y:b[0]&&this.pageArray[b[0]]?this.pageArray[b[0]].pageHeight:0}]);this.hardCover.onResize(g,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},isHardPage:function(a,b){return!1},isCoverPage:function(a,b){return 1==a||2==a||a==totalPageCount||a==totalPageCount-1?!0:!1},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=
b.getThicknessWidth()});return a},show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(IssuuBook),SingleHardIssuuBook=Class({bookType:BookType.single_book,create:function(a){this._super(a)},crossFlipMode:function(a){var b=this.currentPageIndex;return 1==b&&2!=a||2!=b&&1==a?!0:!1},toSoftPage:function(a){return 2==a||1==a?!1:!0},toHardPage:function(a){return!1},toCoverPage:function(a){return 1!=a?!1:!0},isCoverPage:function(a,b){var c=a;
a>b&&(c=b);return 1==c||c==bookConfig.totalPageCount?!0:!1},isHardPage:function(a,b){return!1},gotoNearPage:function(a){1==this.currentPageIndex?gotoPageFun(2,!1,"cross page"):1==a&&gotoPageFun(2,!1,"cross page")},initBook:function(){this._super();this.hardCover=new IssuuSingleHardCover(this.flipBook)},newPage:function(a){1==a||a==bookConfig.totalPageCount?(a=new IssuuHardPage(a,"page",!0,BookType.single_book),a.setLeftOrRight(bookConfig.RightToLeft)):a=new IssuuNormalPage(a,"page",!0,BookType.single_book);
return a},newPageBack:function(a){1==a||a==bookConfig.totalPageCount?(a=new IssuuHardPage(a,"pageBack",!0,BookType.single_book,!0),a.setLeftOrRight(bookConfig.RightToLeft)):a=new IssuuNormalPage(a,"pageBack",!0,BookType.single_book,!0);return a},followToPoint:function(a,b,c){this._super(a,b,c);this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth())},getThicknessWidth:function(){var a=[0,0];this.bookAttachments.Items.find("ThicknessManager").each(function(b){a=b.getThicknessWidth()});
return a},getDownUpHardPage:function(a,b){var c=a;a>b&&(c=b);this.addPageArray([c]);this.addPageBackArray([c]);bookConfig.RightToLeft?(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!0),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!0),this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-left-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-right-side")):(this.pageArray[c]&&this.pageArray[c].setLeftOrRight(!1),this.pageBackArray[c]&&this.pageBackArray[c].setLeftOrRight(!1),
this.pageArray[c]&&this.pageArray[c].setCSSByName("flip-hard-right-side"),this.pageBackArray[c]&&this.pageBackArray[c].setCSSByName("flip-hard-left-side"));return[this.pageArray[c],this.pageBackArray[c]]},setAttachmentBeforeFlipTo:function(a){this._super(a);this.hardCover&&this.hardCover.refresh(a,this.getThicknessWidth(),this.currentPageIndex)},afterCurling:function(){this._super();this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},setAttachmentAfterFlipTo:function(a){this._super(a);
this.hardCover&&this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},resizeBook:function(a,b,c){this._super(a,b,c);b=this.getFitWHByIndex(this.currentPageIndex);a=BookInfo.getCurrentPages();c&&(b=[{x:a[0]&&this.pageArray[a[0]]?this.pageArray[a[0]].pageWidth:0,y:a[0]&&this.pageArray[a[0]]?this.pageArray[a[0]].pageHeight:0},{x:0,y:0}]);this.hardCover.onResize(b,this.getThicknessWidth());this.hardCover.refresh(this.currentPageIndex,this.getThicknessWidth(),this.currentPageIndex)},
show:function(){this._super();this.hardCover.show()},hide:function(){this._super();this.hardCover.hide()}}).extend(SingleIssuuBook),DocViewBookPage=Class({onPageLoaded:null,create:function(a,b,c,g){this.pageHeight=this.pageWidth=this.top=this.left=this.height=this.width=this.zIndex=0;this.pageIndex=a;this.pageArray=[];this.bookType=c;this.side=$("<div class='slide_side'></div>");this.side.css({position:"absolute",width:"100%",height:"100%","will-change":"transform","backface-visibility":"hidden",
perspective:"1000px"});this.side.attr("id",b+a);this.init(a)},init:function(a){isNaN(a)||(this.pages=$("<div class='slide_pages'></div>"),this.pages.css("position","absolute"),this.initPages(a),this.setPageCss(),this.side.append(this.pages))},initEvent:function(){this.adContainer&&this.adContainer.css({"z-index":3});isBelowIE9()?this.pages.IEZoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)}):this.pages.zoom({side:this,zoomIn:this.zoomIn.bind(this),
zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)})},zoomIn:function(a){a=BookInfo.getBook();a.status_zoom=!0;a.adContainer&&a.adContainer.css({"z-index":1});StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(c){c.setAsZoomout();c.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!1);if(!isPhone()&&!isPad()){this.switchLargeImage();bookConfig.ZoomToolbarVisible&&!this.controlBar&&(this.controlBar=new ZoomControlBar(tmpContainer),
this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5));if(this.controlBar){var b="lite"==bookConfig.ToolbarViewMode&&bookType==BookType.catalog_book?50:0;this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5);this.controlBar.setVisible(bookConfig.isZoomControlBarVisible)}global.canMagnifierZoom&&BookInfo.getBook().unMagnifierZoom()}},zoomOut:function(){var a=BookInfo.getBook();a.status_zoom=!1;a.flipping||!a.adContainer||
1!=a.currentPageIndex||bookConfig.isTheBookOpen||a.adContainer.css({"z-index":3});gotoPageFun(a.toPageIndex,!1,"change book type");StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(b){b.setAsZoomin();b.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!0);this.switchNormalImage();this.controlBar&&this.controlBar.setVisible(!1)},onZoomed:function(a){if(isPhone()||isPad()){var b=BookInfo.getBook(),c=BookInfo.getCurrentPages();if(void 0!=c&&
null!=c)for(var g=0;g<c.length;g++){var h=b.pageArray[c[g]];h&&(h.resizeSvg(Math.round(this.pageWidth*a.scale),Math.round(this.pageHeight*a.scale)),bookConfig.highDefinitionConversion?h.zoomInSideImage():(1<a.scale&&h.zoomInSideImage(),1==a.scale&&h.zoomOutSideImage()))}}else a&&!this.pages.parameters.resize&&(this.pages.parameters.resize=!0,a=this.pages.offset().left,b=this.pages.offset().top,a-=this.pages.parameters.left,b-=this.pages.parameters.top,c=this.pages.parameters.scale,1!=c&&(this.resizePages(parseInt(this.pageWidth*
c),parseInt(this.pageHeight*c)),c=1),c=transformCSS({tran:{x:a,y:b},scale:c,origin:{x:0,y:0}}),this.pages.css(c),this.pages.parameters&&(this.pages.parameters.tran={x:a,y:b},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1))},mouseWheelFlip:function(){var a;this.side.parent().bind(_event._mousewheel,function(b){if(void 0!=
a&&150>new Date-a)var c=!1;else a=new Date,c=!0;if(!c)return!1;c=b.originalEvent;c=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));b=b.originalEvent?b.originalEvent:b;this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>c?this.controlBar&&this.controlBar.zoomDown(b):this.controlBar&&this.controlBar.zoomUp(b));!this.status_zoom&&bookConfig.mouseWheelFlip&&(0>c?nextPageFun("mouse wheel flip"):previousPageFun("mouse wheel flip"));if(bookConfig.mouseWheelFlip)return stopEvent(b),
!1}.bind(this))},initPages:function(a){a=bookConfig.isTheBookOpen?2*a:2*a-1;var b=a-1;var c=rightToLeft?a:b;a=rightToLeft?b:a;this.addPageArray([c,a]);this.leftPage=this.pageArray[c];this.rightPage=this.pageArray[a]},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});!this.rightPage&&this.leftPage&&bookConfig.retainBookCenter?(this.leftPage.centerPage(),this.leftPage.setCSSByStyle(a)):!this.leftPage&&this.rightPage&&bookConfig.retainBookCenter?(this.rightPage.centerPage(),this.rightPage.setCSSByStyle(a)):
(this.leftPage&&(this.leftPage.setLeftOrRight(!0),this.leftPage.setCSSByStyle(a)),this.rightPage&&(this.rightPage.setLeftOrRight(!1),this.rightPage.setCSSByStyle(a)))},addPageArray:function(a){if(a&&this.pageArray)for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>originTotalPageCount||this.pageArray[a[b]])){var c=new Page(a[b],"page",this.bookType,this.onPageLoaded);c.hideMiddleShadow();c.onResize(this.pageWidth,this.pageHeight);this.pageArray[a[b]]=c;this.pages.append(c.side)}},fillContent:function(a){this.pageArray[a]&&
this.pageArray[a].fillContent()},fillImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].fillContent()},remove:function(){this.controlBar&&this.controlBar.destroy();this.side.remove();this.side=void 0},setCSSByStyle:function(a){this.side.css(a)},setCSSByName:function(a){this.side.addClass(a)},onResize:function(a,b){this.width=a;this.height=b;this.resetPages()},resetPages:function(){if(this.pages){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+
parseFloat(bookConfig.visibleAreaRight))/100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;b=fitPageWidthHeight(this.width,this.height,2*a,b);a=2*parseInt(b.x/2);b=parseInt(b.y);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=1,this.pages.parameters.toScale=
1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1);this.controlBar&&this.controlBar.setVisible(!1)}},resizePages:function(a,b){this.pageWidth=
a;this.pageHeight=b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});a=this.pageWidth/2;b=this.pageHeight;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)},loading:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].loading()},setLeftOrRight:function(a){this.isLeft=a},reset:function(){},getSide:function(){return this.side},setZIndex:function(a){this.zIndex=a;this.side.css({"z-index":a})},getZIndex:function(){return this.zIndex},
enterSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].enterSide()},leaveSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].leaveSide()},initSelectTextEvent:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initSelectTextEvent()},destroySelect:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroySelect()},initMagnifierEvent:function(){for(var a=
0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},destroyMagnifier:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroyMagnifier()},pauseAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].pauseAnimation()},startAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].startAnimation()},addHistoryTexts:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&
this.pageArray[b].addHistoryTexts(a)},highlightSearch:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearHighlight:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].clearHighlight()},resetSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].resetSlider()},initReaderOrSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initReaderOrSlider&&
this.pageArray[a].initReaderOrSlider()},fillPage:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].fillPage(a,b)},zoomInSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomInSideImage()},zoomOutSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomOutSideImage()},switchLargeImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].switchLargeImage()},
switchNormalImage:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&this.pageArray[b].switchNormalImage(a)},resizeSvg:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].resizeSvg(a,b)}}),SingleDocViewBookPage=Class({initPages:function(a){this.addPageArray([a]);this.page=this.pageArray[a]},resetPages:function(){if(this.pages){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/
100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;b=fitPageWidthHeight(this.width,this.height,a,b);a=2*parseInt(b.x/2);b=parseInt(b.y);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=
$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1);this.controlBar&&this.controlBar.setVisible(!1)}},resizePages:function(a,b){this.pageWidth=a;this.pageHeight=
b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});a=this.pageWidth;b=this.pageHeight;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)}}).extend(DocViewBookPage),DocViewBook=Class({currentTran:0,marginTop:10,toNewPageIndex:-1,create:function(a){this._super(a);this.currentPageIndex=this.getRealBookIndex(a.currentPageIndex);this.mainPageIndex=this.getRealBookIndex(a.currentPageIndex);this.marginTop=bookConfig.pageSpacing;this.flippingTime=
1E3;this.initBook();this.initEvent()},initBook:function(){this.docViewBook=$("<div class='DocViewBook' id='DocViewBook' ></div>");this.docViewBook.css("position","absolute");this.parent.append(this.docViewBook);this.initAttachments()},initAttachments:function(){this.showPage=this.docViewBook;this.bookAttachments=new BookAttachmentsBuilder(this.flipBook,this.currentPageIndex,this,this.options.isDoublePage)},getBook:function(){return this.docViewBook},fillPage:function(a,b){if(a&&!this.animationId)for(var c=
this.pageArray.length,g=0;g<c;g++)this.pageArray[g]&&this.pageArray[g].fillPage(a,b),this.pageBackArray&&this.pageBackArray[g]&&this.pageBackArray[g].fillPage(a,b)},resetPages:function(a){if(!(isNaN(a)||0>=a)){var b=[a,a+1,a-1,a+2,a-2];this.unWrapPageExcludeArray(b);this.addPageArray(b);this.loading();this.currentPage=this.pageArray[a];this.nextPage=this.pageArray[a+1];this.previousPage=this.pageArray[a-1]}},addPageArray:function(a){if(a&&this.pageArray){for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>
this.pageLength()||(this.pageArray[a[b]]&&this.fillContent(a[b]),this.pageArray[a[b]]))){var c=this.newPage(a[b]);c.onResize(this.width,this.height);this.pageArray[a[b]]=c;this.fillContent(a[b]);this.docViewBook.append(c.getSide())}this.orderPages()}},setPagePosition:function(a,b){if(bookConfig.FlipDirection){var c=b*(this.height+this.marginTop);if(!this.jumping){var g;c=parseFloat(null==(g=this.pageArray[a])?void 0:g.top);if(a!==this.currentPageIndex&&this.pageArray[a]){var h,n;c=null!=(n=parseFloat(null==
(h=this.pageArray[this.currentPageIndex])?void 0:h.top))?n:0;c=b*(this.height+this.marginTop)+c}}b=transformCSS({tran:{x:0,y:c}});this.pageArray[a]&&(this.pageArray[a].setCSSByStyle(b),this.pageArray[a].top=c)}else{h=b*(this.width+this.marginTop);if(!this.jumping){var p;h=parseFloat(null==(p=this.pageArray[a])?void 0:p.left);if(a!==this.currentPageIndex&&this.pageArray[a]){var z;h=null!=(z=parseFloat(null==(c=this.pageArray[this.currentPageIndex])?void 0:c.left))?z:0;h=b*(this.width+this.marginTop)+
h}}b=transformCSS({tran:{x:h,y:0}});this.pageArray[a]&&(this.pageArray[a].setCSSByStyle(b),this.pageArray[a].left=h)}},orderPages:function(){this.sequenceList={};for(var a=this.pageArray.length,b=0,c=this.mainPageIndex+1;c<a;c++)this.pageArray[c]&&(rightToLeft?b--:b++,this.pageArray[c].sequence=b,this.sequenceList[b]=c,this.setPagePosition(c,b));b=0;for(a=this.mainPageIndex;0<a;a--)this.pageArray[a]&&(this.pageArray[a].sequence=b,this.sequenceList[b]=a,this.setPagePosition(a,b),rightToLeft?b++:b--)},
setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});this.currentPage&&this.currentPage.setCSSByStyle(a);this.previousPage&&this.previousPage.setCSSByStyle(a);this.nextPage&&this.nextPage.setCSSByStyle(a)},fillContent:function(a){this.animationId||this.pageArray[a]&&this.pageArray[a].fillImage()},newPage:function(a){return new DocViewBookPage(a,"slidePage",this.bookType)},pageLength:function(){return bookConfig.totalPageCount},unWrapPageExcludeArray:function(a){if(a&&this.pageArray){for(var b=
this.pageArray.length,c=0;c<b;c++)!this.pageArray[c]||0<=a.indexOf(c)||(this.pageArray[c].remove(),this.pageArray[c]=void 0);this.orderPages()}},normalizeWheelDelta:function(a){var b=0;void 0!==a.deltaY?b=-a.deltaY:void 0!==a.detail?b=40*-a.detail:void 0!==a.wheelDelta&&(b=a.wheelDelta);0<b?b=Math.min(Math.max(Math.abs(b),20),120):0>b&&(b=-Math.min(Math.max(Math.abs(b),20),120));return b},mouseWheelFlip:function(){if(bookConfig.mouseWheelFlip){var a;this.docViewBook.bind(_event._mousewheel,function(b){if(void 0!=
a&&150>(new Date).getTime()-a)var c=!1;else a=(new Date).getTime(),c=!0;if(!c)return!1;c=b.originalEvent;var g=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>g?this.controlBar&&this.controlBar.zoomDown(b):this.controlBar&&this.controlBar.zoomUp(b));console.log("wheelDelta ",c.wheelDelta,40*-c.detail);this.status_zoom||!bookConfig.mouseWheelFlip||this.flipping||(c=this.normalizeWheelDelta(c),this.startSmoothWheelScroll(c));
if(bookConfig.mouseWheelFlip)return stopEvent(b),!1}.bind(this))}},flippingTo:function(a){this.currentPageIndex=a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex)},getRealPageIndex:function(){return this.currentPageIndex},getRealBookIndex:function(a){return a},gotoPage:function(a,b){if(!isNaN(a)){this.toPageIndex=a;if(this.status_zoom)return a={pointers:[{pageX:windowWidth/2,pageY:windowHeight/2}]},this.docViewBook.onDoubleTap.bind(this.docViewBook)(a),
!0;a=this.getRealBookIndex(a);0>=a||a>this.pageLength()||!this.flipEffect(a)||(!b&&flipHistory&&flipHistory.addFromCurrentIndex(this.toPageIndex),bookConfig.restorePageVisible&&window.localStorage.setItem(realLocation+"?historyPageIndex",this.toPageIndex),this.flipping=!1,-1!==this.toNewPageIndex?(this.flippingTo(a),playFlipSound(),this.mainPageIndex=a,this.resetPages(a),this.setAttachmentAfterFlipTo()):(b=1<Math.abs(a-this.currentPageIndex),this.flipInterval&&this.flipInterval.stop(),b?(this.jumping=
!0,this.flippingTo(a),playFlipSound(),this.refreshPages(a),this.afterFlipTo(),this.jumping=!1):this.flipIntervalTmp(a)))}},flipEffect:function(a){return this.status_zoom||a==this.currentPageIndex?!1:!0},flipIntervalTmp:function(a){var b=this.currentTran,c=this.getFlipTo(a);this.flipping=!0;var g=0;console.log("flipIntervalTmp",this.flipping);var h=function(n,p,z){n<p?(n=(0,$.easing["easeInOut"+z])(null,n,b,c-b,p),p=n-g,g=n,this.panBookForMove(p)):(this.flipping=!1,this.flipInterval.stop(),BookEvent.trigger("afterFlipPage",
[a]))}.bind(this);this.flipInterval=function(n,p){h(n,p,"Sine")}.animation(this,this.flippingTime)},refreshPages:function(a){if(!this.pageArray[a]){var b=this.getCurrentViewPageIndex(),c=bookConfig.FlipDirection?this.currentTran-this.height:this.currentTran-this.width;(a>b||a<this.mainPageIndex)&&!rightToLeft&&(c=this.currentTran);(a<b||a>this.mainPageIndex)&&rightToLeft&&(c=this.currentTran);this.addPageArray([a-1,a,a+1]);this.setBookTran(c)}this.showPage=this.pageArray[a].pages},getCurrentViewPageIndex:function(){var a=
Math.abs(this.currentTran);return this.sequenceList[(0>=this.currentTran?1:-1)*(bookConfig.FlipDirection?Math.floor(a/this.height)+1+(a%this.height>this.height/2)?0:1:Math.floor(a/this.width)+1+(a%this.width>this.width/2)?0:1)]},getFlipTo:function(a){if(!this.pageArray[a]||!this.pageArray[a].sequence)return 0;var b=bookConfig.FlipDirection?this.height+this.marginTop:this.width+this.marginTop;a=this.pageArray[a];var c=0;if(this.pageArray[this.currentPageIndex]){var g,h;c=bookConfig.FlipDirection?null==
(g=this.pageArray[this.currentPageIndex])?void 0:g.top:null==(h=this.pageArray[this.currentPageIndex])?void 0:h.left}return-a.sequence*b-parseFloat(c)},getCurrentTran:function(){return this.currentTran},setBookTran:function(a){if(bookConfig.FlipDirection){var b=transformCSS({rotate:0,tran:{x:0,y:a}});isBelowIE9()&&(b={top:a+this.bookTop+"px"})}else b=transformCSS({rotate:0,tran:{x:a,y:0}}),isBelowIE9()&&(b={left:a+this.bookLeft+"px"});this.setCSSByStyle(b);this.currentTran=a},onResize:function(){this.resize();
this.status_zoom=!1;this.showPage=this.pageArray[this.currentPageIndex].pages},resize:function(){this.endFlip();this.resizeBook();this.resizePage(this.width,this.height);this.resetPages(this.currentPageIndex);this.resizeAdvertisement()},getTop:function(){return this.bookTop},resizeBook:function(){var a=bookConfig.topMargin+templateArea.getTopHeight(),b=bookConfig.bottomMargin+templateArea.getBottomHeight(),c=bookConfig.leftMargin+templateArea.getLeftWidth(),g=bookConfig.rightMargin+templateArea.getRightWidth();
g=windowWidth-c-g;b=windowHeight-a-b;var h=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,n=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;h=fitPageWidthHeight(g,b,h,n);this.width=parseInt(h.x);this.height=parseInt(h.y);this.bookTop=a+(b-this.height)/2;this.bookLeft=c+(g-this.width)/2;useTheAliCloudChart(parseInt(h.x),this.height);this.docViewBook.css({width:this.width+
"px",height:this.height+"px",left:this.bookLeft+"px",top:this.bookTop+"px"})},resizeAdvertisement:function(){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;a=fitPageWidthHeight(this.width,this.height,a,2*b);this.pageWidth=parseInt(a.x);this.pageHeight=2*parseInt(a.y/2)},resizePage:function(a,b,c){c=this.pageArray.length;
for(var g=this.docViewBook.parameters.scale,h=a*g,n=b*g,p=0;p<c;p++)if(this.pageArray[p]){this.pageArray[p].onResize(a,b);this.pageArray[p].controlBar&&this.pageArray[p].controlBar.setVisible(!1);for(var z=this.pageArray[p].pageArray,r=0;r<z.length;r++)z[r]&&z[r].pageBackground&&((isPhone()||isPad())&&![4,5].includes(z[r].pageBackground.urlType)||1===g||z[r].sideImage.css({width:h+"px",height:n+"px",transform:"scale("+1/g+")","transform-origin":"0 0","will-change":"transform"}))}},getHeight:function(){return this.height},
getWidth:function(){return this.width},getScale:function(){return this.currentPage.pages.parameters.toScale},getCssLeft:function(){return parseInt(this.docViewBook.css("left"))},getCssTop:function(){return parseInt(this.docViewBook.css("top"))},checkFlipping:function(){this.flipping=!1;this.loading();this.fillContent(this.currentPageIndex)},afterFlipTo:function(){this.mainPageIndex=this.currentPageIndex;this.resetPages(this.currentPageIndex);this.setBookTran(0);this.startTran=this.currentTran;this.checkFlipping();
this.setAttachmentAfterFlipTo()},setAttachmentBeforeFlipTo:function(){this.bookAttachments.setAttachmentBeforeFlipTo()},setAttachmentAfterFlipTo:function(){this.stopMedia();this.resetSlider();this.flipping||this.enterPage();global.thumbnail&&(thumbnail.clearHighLight(),thumbnail.setHighLight(this.getRealPageIndex()));window.resizeBookAfterFlip&&!this.flipping&&window.setTimeout(function(){onStageResize()},30)},endFlip:function(){this.flipping=!1},loading:function(){this.flipping||this.pageArray[this.currentPageIndex]&&
this.pageArray[this.currentPageIndex].loading()},getCurrentPageIndex:function(){return this.getRealPageIndex()},getCurrentPages:function(){return[this.currentPageIndex]},setCSSByStyle:function(a){this.docViewBook.css(a)},setShow:function(a){},hide:function(){Log.debug("slide book hide.");this.visible=!1;this.setCSSByStyle({display:"none"});this.stopMedia();this.resetSlider();this.bookAttachments&&this.bookAttachments.hide()},show:function(){Log.debug("slide book show.");this.visible=!0;this.setCSSByStyle({display:"block"});
this.enterPage();this.bookAttachments&&this.bookAttachments.show()},enterPage:function(){this.afterChangeBookType();this.openShownMedia();this.addSearchHighlight()},addSearchHighlight:function(){var a=this.currentPageIndex;this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearSearchHighlight:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].clearHighlight()},openShownMedia:function(){var a=this.currentPageIndex;this.pageArray[a]&&this.pageArray[a].enterSide();
this.pageArray[a]&&this.pageArray[a].addHistoryTexts()},stopMedia:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].leaveSide()},resetSlider:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].resetSlider()},afterChangeBookType:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].initReaderOrSlider()},select:function(){this.selected=!0;var a=this.currentPageIndex;if(this.pageArray[a]){if(this.pageArray[a]){this.pageArray[a].initSelectTextEvent();
var b=this.pageArray[a].page;b&&b.pageAttachments.$select&&b.pageAttachments.$select.css({width:this.width+"px",height:this.height+"px"})}this.pageArray[a].pages.parameters&&(this.pageArray[a].pages.parameters.eventCancel=!0);this.docViewBook.parameters&&(this.docViewBook.parameters.eventCancel=!0)}},unSelect:function(){this.selected=!1;var a=this.getCurrentPages();if(void 0!=a&&null!=a){for(var b=0;b<a.length;b++){var c=a[b];this.pageArray[c]&&(this.pageArray[c]&&this.pageArray[c].destroySelect(),
this.pageArray[c].pages.parameters&&(this.pageArray[c].pages.parameters.eventCancel=!1))}this.docViewBook.parameters&&(this.docViewBook.parameters.eventCancel=!1);StateSynchronous.instance().findButtons("SelectTextButton",!0).each(function(g){g.setAsUnSelect();g.executeCallback()})}},magnifierZoom:function(){this.selected=!0;var a=this.currentPageIndex;this.pageArray[a]&&this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},unMagnifierZoom:function(){this.selected=!1;var a=BookInfo.getCurrentPages();
if(void 0!=a&&null!=a){for(var b=0;b<a.length;b++){var c=a[b];this.pageArray[c]&&this.pageArray[c]&&this.pageArray[c].destroyMagnifier()}bookConfig.MagnifierButtonVisible&&window.magnifierZoomBox&&window.magnifierZoomBox.hide();StateSynchronous.instance().findButtons("magnifier",!0).each(function(g){g.setAsZoomin()})}},switchLargeImage:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].switchLargeImage()},switchNormalImage:function(a){for(var b=this.pageArray.length,
c=0;c<b;c++)this.pageArray[c]&&this.pageArray[c].switchNormalImage(a)},destroy:function(){this.docViewBook.remove()},zoomIn:function(){this.status_zoom=!0;StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(b){b.setAsZoomout();b.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!1);this.switchLargeImage();bookConfig.ZoomToolbarVisible&&!this.controlBar&&(this.controlBar=new ZoomControlBar(tmpContainer),this.controlBar.setPosition((windowWidth-
this.controlBar.width)/2,templateArea.getTopHeight()+a+5));if(this.controlBar){var a="lite"==bookConfig.ToolbarViewMode&&bookType==BookType.catalog_book?50:0;this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+a+5);this.controlBar.setVisible(bookConfig.isZoomControlBarVisible)}global.canMagnifierZoom&&this.unMagnifierZoom()},zoomOut:function(){this.status_zoom=!1;gotoPageFun(this.toPageIndex,!1,"change book type");StateSynchronous.instance().findButtons("ZoomButton",
!0).each(function(a){a.setAsZoomin();a.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!0);this.controlBar&&this.controlBar.setVisible(!1)},onZoomed:function(a){console.log(a);if(a&&!this.docViewBook.parameters.resize){this.docViewBook.parameters.resize=!0;a=this.docViewBook.offset().left;var b=this.docViewBook.offset().top;a-=this.docViewBook.parameters.left;b-=this.docViewBook.parameters.top;var c=this.docViewBook.parameters.scale,g=transformCSS({tran:{x:a,
y:b},scale:c,origin:{x:0,y:0}}),h=this.pageArray.length,n=parseInt(this.width*c),p=parseInt(this.height*c);console.log(this.width,this.height,this.width*c);for(var z=0;z<h;z++)if(this.pageArray[z])for(var r=this.pageArray[z].pageArray,A=0;A<r.length;A++)if(r[A]){var D=r[A];if(D.pageAttachments){var M=fitPageWidthHeight(n,p,D.imageWidth,D.imageHeight);D.pageAttachments.onResize(M.x,M.y,n,p);D.pageAttachments.$animation&&D.pageAttachments.$animation.css({transform:"scale("+1/c+")","transform-origin":"0 0",
"will-change":"transform"});D.pageAttachments.$highlight&&D.pageAttachments.$highlight.css({transform:"scale("+1/c+")","transform-origin":"0","will-change":"transform"});D.pageAttachments.$select&&D.pageAttachments.$select.css({width:this.width+"px",height:this.height+"px"});if(D.pageAttachments.pageAnnotation)D.pageAttachments.pageAnnotation.onResize(this.width,this.height)}D.sideContent&&(1!==c?D.sideContent.css({width:n/c+"px",height:p/c+"px"}):D.sideContent.css({width:"100%",height:"100%"}));
D.pageBackground&&(D.pageBackground.onResize(n,p),!isPhone()&&!isPad()||[4,5].includes(D.pageBackground.urlType))&&(1!==c?D.sideImage.css({width:n+"px",height:p+"px",transform:"scale("+1/c+")","transform-origin":"0 0","will-change":"transform"}):D.sideImage.css({width:"100%",height:"100%",transform:"scale(1)","transform-origin":"0 0","will-change":"transform"}))}this.docViewBook.css(g);this.docViewBook.parameters&&(this.docViewBook.parameters.tran={x:a,y:b},this.docViewBook.parameters.width=$(this.docViewBook).width(),
this.docViewBook.parameters.height=$(this.docViewBook).height(),this.docViewBook.parameters.origin={x:0,y:0},this.docViewBook.parameters.resize=!1)}}}).extend(Book);
DocViewBook.expand({initEvent:function(){this.moveDirectionType={MOVE_LEFT:-1,MOVE_RIGHT:1,MOVE_NONE:0};this.mouseMoveDirection=this.moveDirectionType.MOVE_NONE;this.wheelAnimationId=this.animationId=null;this.hammerEventModular();this.mouseWheelFlip()},hammerEventModular:function(){var a=new Hammer.Manager(this.docViewBook[0]);a.add(new Hammer.Pan);a.add((new Hammer.Swipe).recognizeWith(a.get("pan")));a.add(new Hammer.Press({time:"1000"}));a.add(new Hammer.Pinch);a.add(new Hammer.Tap({event:"doubletap",
taps:2}));a.on("panstart panmove panend pancancel",this.onPan.bind(this));a.on("press",this.onPress.bind(this));this.docViewBook.bind("click",this.onTap.bind(this));a.on("swipe swipeup",this.onSwipe.bind(this));this.docViewBook.bind("mouseover ",this.onOver.bind(this));this.docViewBook.bind("mouseout ",this.onOut.bind(this));this.docViewBook.bind(_event._down,this.onDown.bind(this));$("body").bind(_event._end+" "+_event._leave,this.onUp.bind(this));this.initZoomEvent()},onPan:function(a){if(!this.selected){this.animateInterval&&
this.animateInterval.stop();this.swipeInterval&&this.swipeInterval.stop();this.stopAnimation();this.wheelAnimationId&&(cancelAnimationFrame(this.wheelAnimationId),this.wheelAnimationId=null);var b=this.getDelta(a);"panstart"===a.type&&(this.startMove=0,document.documentElement.style.cursor="grabbing",document.body.style.cursor="grabbing");if("panmove"===a.type){b=bookConfig.FlipDirection||bookConfig.upsideOnMobile()?b.deltaY:b.deltaX;var c=b-this.startMove;this.startMove=b;this.panBookForMove(c)}if("panend"==
a.type||"pancancel"==a.type)document.documentElement.style.cursor="grab",document.body.style.cursor="grab",console.log("restrictInBoundary"),this.restrictInBoundary()}},onSwipe:function(a){if(!this.selected){this.animateInterval&&this.animateInterval.stop();this.swipeInterval&&this.swipeInterval.stop();this.stopAnimation();this.wheelAnimationId&&(cancelAnimationFrame(this.wheelAnimationId),this.wheelAnimationId=null);var b=bookConfig.FlipDirection||bookConfig.upsideOnMobile(),c=parseFloat(this.pageArray[this.currentPageIndex][b?
"top":"left"]),g=bookConfig.RightToLeft?1:bookConfig.totalPageCount;this.currentPageIndex===(bookConfig.RightToLeft?bookConfig.totalPageCount:1)&&0<c||this.currentPageIndex===g&&0>c?this.restrictInBoundary():(c=this.getVelocity(a),a=c.velocityX,c=c.velocityY,b=b?c:a,50<Math.abs(b)&&(b=50*(0<b?1:-1)),this.startInertialScroll(b))}},onPress:function(a){},onTap:function(a){onWindowTap(a.srcEvent)},onOut:function(){document.documentElement.style.cursor="default";document.body.style.cursor="default"},onOver:function(a){this.selected||
(document.documentElement.style.cursor="grab",document.body.style.cursor="grab")},onDown:function(a){this.fingleDown=!0},onUp:function(a){this.swipeInterval||this.animationId||this.flipping||!this.fingleDown||(30<=Math.abs(this.currentTran-this.startTran)&&(this.currentTran>this.startTran&&!rightToLeft||this.currentTran<this.startTran&&rightToLeft?previousPageFun("window click"):this.currentTran!=this.startTran&&nextPageFun("window click")),this.startTran=this.currentTran,this.panstart=this.fingleDown=
!1,this.onBack())},onBack:function(){if(0!=this.currentTran&&!this.flipping){this.flipping=!0;var a=this.currentTran,b=function(c,g,h){c<g?(c=(0,$.easing["easeInOut"+h])(null,c,a,0-a,g),this.setBookTran(c)):(this.flipping=!1,this.flipInterval.stop(),this.setBookTran(0),this.startTran=this.currentTran)}.bind(this);this.flipInterval=function(c,g){b(c,g,"Sine")}.animation(this,this.flippingTime)}},initZoomEvent:function(){isBelowIE9()?this.docViewBook.IEZoom({side:this,zoomIn:this.zoomIn.bind(this),
zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)}):this.docViewBook.zoom({isSeries:!0,side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)})},dragChangePage:function(a){gotoPageFun(a,!1)},getVelocity:function(a){var b=0,c=0,g=bookConfig.upsideOnMobile();0==a.velocityX||g||(b=a.velocityX);0==a.velocityY||g||(c=a.velocityY);0!=a.velocityX&&g&&(b=a.velocityY);0!=a.velocityY&&g&&(c=-a.velocityX);return{velocityX:b,velocityY:c}},getDelta:function(a){var b=
0,c=0,g=bookConfig.upsideOnMobile();0==a.deltaX||g||(b=a.deltaX);0==a.deltaY||g||(c=a.deltaY);0!=a.deltaX&&g&&(b=a.deltaY);0!=a.deltaY&&g&&(c=-a.deltaX);return{deltaX:b,deltaY:c}},panBookForMove:function(a){var b=bookConfig.FlipDirection||bookConfig.upsideOnMobile(),c=b?this.height+this.marginTop:this.width+this.marginTop,g=b?"top":"left";b=b?"height":"width";this.status_zoom&&(a/=this.docViewBook.parameters.scale);for(var h=0;h<this.pageArray.length;h++){var n=this.pageArray[h];if(n){var p=parseFloat(n[g])+
a,z=c*n.sequence;if((1===this.currentPageIndex&&p>z||this.currentPageIndex===bookConfig.totalPageCount&&p<z)&&this.status_zoom){this.disableDriection=!1;return}this.disableDriection=!0;n.pageIndex===this.currentPageIndex&&-1===this.toNewPageIndex&&(p<-this[b]/2&&0>a&&(this.toNewPageIndex=bookConfig.RightToLeft?this.currentPageIndex-1:this.currentPageIndex+1),p>this[b]/2&&0<a&&(this.toNewPageIndex=bookConfig.RightToLeft?this.currentPageIndex+1:this.currentPageIndex-1));n[g]=p;p=transformCSS({tran:{x:n.left,
y:n.top}});n.setCSSByStyle(p)}}this.toNewPageIndex<=bookConfig.totalPageCount&&0<this.toNewPageIndex&&this.dragChangePage(this.toNewPageIndex);this.toNewPageIndex=-1},restrictInBoundary:function(){if(1===this.currentPageIndex||this.currentPageIndex===bookConfig.totalPageCount){this.animateInterval&&this.animateInterval.stop();this.stopAnimation();var a=bookConfig.FlipDirection||bookConfig.upsideOnMobile()?"top":"left",b=parseFloat(this.pageArray[this.currentPageIndex][a]),c=bookConfig.RightToLeft?
1:bookConfig.totalPageCount;if(this.currentPageIndex===(bookConfig.RightToLeft?bookConfig.totalPageCount:1)&&0<b||this.currentPageIndex===c&&0>b){var g=0,h=0;g=b;this.animateInterval=function(n,p){n=$.easing.easeOutBack(null,h,0,g,20);0<h&&(n-=$.easing.easeOutBack(null,h-1,0,b,20));console.log("movedTrans",n,b);for(p=0;p<this.pageArray.length;p++){var z=this.pageArray[p];if(z){var r=parseFloat(z[a]);z[a]=r-n;r=transformCSS({tran:{x:z.left,y:z.top}});z.setCSSByStyle(r)}}h++}.animation(this,320)}}},
startInertialScroll:function(a){var b=this;this.animationId&&this.stopAnimation();var c=performance.now(),g=c,h=a,n=0,p=0,z=a,r=bookConfig.FlipDirection||bookConfig.upsideOnMobile(),A=r?"top":"left",D=r?"height":"width",M=bookConfig.RightToLeft?bookConfig.totalPageCount:1,Q=bookConfig.RightToLeft?1:bookConfig.totalPageCount,ca=function(V){var da=Math.min(V-g,32);h=a=h+.25*(1.3*z*(1-(1-Math.pow(1-Math.min((V-c)/1500,1),3)))-h);n+=a*da;.35<=Math.abs(n)&&(da=Math.round(p+.3*(Math.round(n)-p)),0!==da&&
b.panBookForMove(da,!0),n-=da,p=da);da=parseFloat(b.pageArray[b.currentPageIndex][A]);.1>Math.abs(a)||b.currentPageIndex===M&&da>b[D]/2||b.currentPageIndex===Q&&da<-b[D]/2?(console.log("stopAnimation"),b.stopAnimation(),b.restrictInBoundary(),b.startTran=b.currentTran,b.fingleDown=!1,b.panstart=!1):(g=V,b.animationId=requestAnimationFrame(ca))};this.animationId=requestAnimationFrame(ca)},stopAnimation:function(){if(this.animationId){console.log("stopAnimation");cancelAnimationFrame(this.animationId);
this.animationId=null;for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].fillContent(b)}this.wheelAnimationId&&(cancelAnimationFrame(this.wheelAnimationId),this.wheelAnimationId=null)},startSmoothWheelScroll:function(a){var b=this;this.wheelAnimationId&&(cancelAnimationFrame(this.wheelAnimationId),this.wheelAnimationId=null);var c=5*a,g=null,h=0,n=function(p){null===g&&(g=p);p=Math.max(0,p-g);var z=Math.min(p/300,1),r=c*Math.sin(z*Math.PI/2),A=r-h;console.log("deltaMove",
A,r,p);h=r;.1<Math.abs(A)&&b.panBookForMove(A);1>z?b.wheelAnimationId=requestAnimationFrame(n):(b.wheelAnimationId=null,b.restrictInBoundary())};this.wheelAnimationId=requestAnimationFrame(n)}});
var DoubleDocViewBook=Class({getRealPageIndex:function(){var a=2*this.currentPageIndex-1;return a=Number.between(a,1,bookConfig.totalPageCount)},getRealBookIndex:function(a){a=bookConfig.isTheBookOpen?Math.ceil(a/2):parseInt(a/2)+1;return a=Number.between(a,1,this.pageLength())},pageLength:function(){return bookConfig.isTheBookOpen?Math.ceil(bookConfig.totalPageCount/2):parseInt(bookConfig.totalPageCount/2)+1}}).extend(DocViewBook),SingleDocViewBook=Class({getRealPageIndex:function(){var a=this.currentPageIndex;
return a=Number.between(a,1,bookConfig.totalPageCount)},getRealBookIndex:function(a){return a=Number.between(a,1,bookConfig.totalPageCount)},pageLength:function(){return bookConfig.totalPageCount},newPage:function(a){return new SingleDocViewBookPage(a,"slidePage",this.bookType)}}).extend(DocViewBook),PcDoubleDocViewBook=Class({bookType:BookType.slide_book,create:function(a){this._super(a)},onResize:function(){this._super()},initBook:function(){this._super();this.docViewBook.css("display","none")}}).extend(DoubleDocViewBook),
PcSingleDocViewBook=Class({bookType:BookType.singleDocumentView_book,create:function(a){this._super(a)},onResize:function(){this._super();this.bookAttachments&&this.bookAttachments.onResize(this.width,this.height)}}).extend(SingleDocViewBook),SlideBookPage=Class({onPageLoaded:null,create:function(a,b,c,g){this.pageHeight=this.pageWidth=this.height=this.width=this.zIndex=0;this.pageIndex=a;this.pageArray=[];this.bookType=c;this.onPageLoaded=g;this.side=$("<div class='slide_side'></div>");this.side.attr("id",
b+a);this.init(a)},init:function(a){isNaN(a)||(this.pages=$("<div class='slide_pages'></div>"),this.initPages(a),this.setPageCss(),this.side.append(this.pages),this.initEvent())},initEvent:function(){this.adContainer&&this.adContainer.css({"z-index":3});isBelowIE9()?this.pages.IEZoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)}):this.pages.zoom({side:this,zoomIn:this.zoomIn.bind(this),zoomOut:this.zoomOut.bind(this),onZoomed:this.onZoomed.bind(this)})},
zoomIn:function(a){a=BookInfo.getBook();a.status_zoom=!0;a.adContainer&&a.adContainer.css({"z-index":1});StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(c){c.setAsZoomout();c.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!1);if(!isPhone()&&!isPad()){this.switchLargeImage();bookConfig.ZoomToolbarVisible&&!this.controlBar&&(this.controlBar=new ZoomControlBar(tmpContainer),this.controlBar.setPosition((windowWidth-this.controlBar.width)/
2,templateArea.getTopHeight()+b+5));if(this.controlBar){var b="lite"==bookConfig.ToolbarViewMode&&bookType==BookType.catalog_book?50:0;this.controlBar.setPosition((windowWidth-this.controlBar.width)/2,templateArea.getTopHeight()+b+5);this.controlBar.setVisible(bookConfig.isZoomControlBarVisible)}global.canMagnifierZoom&&BookInfo.getBook().unMagnifierZoom()}},zoomOut:function(){var a=BookInfo.getBook();a.status_zoom=!1;a.flipping||!a.adContainer||1!=a.currentPageIndex||bookConfig.isTheBookOpen||a.adContainer.css({"z-index":3});
gotoPageFun(a.toPageIndex,!1,"change book type");StateSynchronous.instance().findButtons("ZoomButton",!0).each(function(b){b.setAsZoomin();b.executeCallback()});window.toolBar&&window.toolBar.btnZoom&&window.toolBar.changeZoomIcon(!0);this.switchNormalImage();this.controlBar&&this.controlBar.setVisible(!1)},onZoomed:function(a){if(isPhone()||isPad()){var b=BookInfo.getBook(),c=BookInfo.getCurrentPages();if(void 0!=c&&null!=c)for(var g=0;g<c.length;g++){var h=b.pageArray[c[g]];h&&(h.resizeSvg(Math.round(this.pageWidth*
a.scale),Math.round(this.pageHeight*a.scale)),bookConfig.highDefinitionConversion?h.zoomInSideImage():(1<a.scale&&h.zoomInSideImage(),1==a.scale&&h.zoomOutSideImage()))}}else a&&!this.pages.parameters.resize&&(this.pages.parameters.resize=!0,a=this.pages.offset().left,b=this.pages.offset().top,a-=this.pages.parameters.left,b-=this.pages.parameters.top,c=this.pages.parameters.scale,1!=c&&(this.resizePages(parseInt(this.pageWidth*c),parseInt(this.pageHeight*c)),c=1),c=transformCSS({tran:{x:a,y:b},scale:c,
origin:{x:0,y:0}}),this.pages.css(c),this.pages.parameters&&(this.pages.parameters.tran={x:a,y:b},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1))},mouseWheelFlip:function(){var a;this.side.parent().bind(_event._mousewheel,function(b){if(void 0!=a&&150>new Date-a)var c=!1;else a=new Date,c=!0;if(!c)return!1;c=b.originalEvent;
c=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));b=b.originalEvent?b.originalEvent:b;this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>c?this.controlBar&&this.controlBar.zoomDown(b):this.controlBar&&this.controlBar.zoomUp(b));!this.status_zoom&&bookConfig.mouseWheelFlip&&(0>c?nextPageFun("mouse wheel flip"):previousPageFun("mouse wheel flip"));if(bookConfig.mouseWheelFlip)return stopEvent(b),!1}.bind(this))},initPages:function(a){a=bookConfig.isTheBookOpen?
2*a:2*a-1;var b=a-1;var c=rightToLeft?a:b;a=rightToLeft?b:a;this.addPageArray([c,a]);this.leftPage=this.pageArray[c];this.rightPage=this.pageArray[a]},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});!this.rightPage&&this.leftPage&&bookConfig.retainBookCenter?(this.leftPage.centerPage(),this.leftPage.setCSSByStyle(a)):!this.leftPage&&this.rightPage&&bookConfig.retainBookCenter?(this.rightPage.centerPage(),this.rightPage.setCSSByStyle(a)):(this.leftPage&&(this.leftPage.setLeftOrRight(!0),
this.leftPage.setCSSByStyle(a)),this.rightPage&&(this.rightPage.setLeftOrRight(!1),this.rightPage.setCSSByStyle(a)))},addPageArray:function(a){if(a&&this.pageArray)for(var b=0;b<a.length;b++)if(!(0>=a[b]||a[b]>originTotalPageCount||this.pageArray[a[b]])){var c=new Page(a[b],"page",this.bookType,this.onPageLoaded);c.hideMiddleShadow();c.onResize(this.pageWidth,this.pageHeight);this.pageArray[a[b]]=c;this.pages.append(c.side)}},fillContent:function(a){this.pageArray[a]&&this.pageArray[a].fillContent()},
fillImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].fillContent()},remove:function(){this.controlBar&&this.controlBar.destroy();this.side.remove();this.side=void 0},setCSSByStyle:function(a){this.side.css(a)},setCSSByName:function(a){this.side.addClass(a)},onResize:function(a,b){this.width=a;this.height=b;this.resetPages()},resetPages:function(){if(this.pages){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/
100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;b=fitPageWidthHeight(this.width,this.height,2*a,b);a=2*parseInt(b.x/2);b=parseInt(b.y);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=1,this.pages.parameters.toScale=1,this.pages.parameters.width=
$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1);this.controlBar&&this.controlBar.setVisible(!1)}},resizePages:function(a,b){this.pageWidth=a;this.pageHeight=
b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});a=this.pageWidth/2;b=this.pageHeight;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)},loading:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].loading()},setLeftOrRight:function(a){this.isLeft=a},reset:function(){},getSide:function(){return this.side},setZIndex:function(a){this.zIndex=a;this.side.css({"z-index":a})},getZIndex:function(){return this.zIndex},
enterSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].enterSide()},leaveSide:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].leaveSide()},initSelectTextEvent:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initSelectTextEvent()},destroySelect:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroySelect()},initMagnifierEvent:function(){for(var a=
0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},destroyMagnifier:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].destroyMagnifier()},pauseAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].pauseAnimation()},startAnimation:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].startAnimation()},addHistoryTexts:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&
this.pageArray[b].addHistoryTexts(a)},highlightSearch:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearHighlight:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].clearHighlight()},resetSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].resetSlider()},initReaderOrSlider:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].initReaderOrSlider&&
this.pageArray[a].initReaderOrSlider()},fillPage:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].fillPage(a,b)},zoomInSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomInSideImage()},zoomOutSideImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].zoomOutSideImage()},switchLargeImage:function(){for(var a=0;a<this.pageArray.length;a++)this.pageArray[a]&&this.pageArray[a].switchLargeImage()},
switchNormalImage:function(a){for(var b=0;b<this.pageArray.length;b++)this.pageArray[b]&&this.pageArray[b].switchNormalImage(a)},resizeSvg:function(a,b){for(var c=0;c<this.pageArray.length;c++)this.pageArray[c]&&this.pageArray[c].resizeSvg(a,b)}}),SingleSlideBookPage=Class({initPages:function(a){this.addPageArray([a]);this.page=this.pageArray[a]},resetPages:function(){if(this.pages){if(bookConfig.isSingleBookFullWindowOnMobile&&(isPhone()||isPad()))var a=windowWidth,b=windowHeight;else a=bookConfig.largePageWidth*
(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100,b=fitPageWidthHeight(this.width,this.height,a,b),a=parseInt(b.x),b=parseInt(b.y);this.resizePages(a,b);this.pages.css({left:(this.width-a)/2+"px",top:(this.height-b)/2+"px"});a=transformCSS({rotate:0,tran:{x:0,y:0}});this.pages.css(a);this.pages.parameters&&(this.pages.parameters.tran={x:0,y:0},this.pages.parameters.scale=
1,this.pages.parameters.toScale=1,this.pages.parameters.width=$(this.pages).width(),this.pages.parameters.height=$(this.pages).height(),this.pages.parameters.origin={x:0,y:0},this.pages.parameters.resize=!1,this.pages.swipeInterval&&this.pages.swipeInterval.stop(),this.pages.animateInterval&&this.pages.animateInterval.stop(),this.pages.parameters.zoomFlag=!1,this.pages.parameters.zoomOut=!0,this.pages.parameters.toScale=1,this.pages.parameters.scale=1)}},resizePages:function(a,b){if(this.pages){this.pageWidth=
a;this.pageHeight=b;this.pages.css({width:this.pageWidth+"px",height:this.pageHeight+"px"});a=this.pageWidth;b=this.pageHeight;for(var c=0;c<this.pageArray.length;c++)if(this.pageArray[c])this.pageArray[c].onResize(a,b)}},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});this.page&&(this.page.centerPage(),this.page.setCSSByStyle(a))},fillPage:function(a,b){this.page&&this.page.fillPage(a,b)}}).extend(SlideBookPage),SlideBook=Class({currentTran:0,create:function(a){this._super(a);
this.currentPageIndex=this.getRealBookIndex(a.currentPageIndex);this.mainPageIndex=this.getRealBookIndex(a.currentPageIndex);this.initBook();this.initEvent()},initBook:function(){this.flipBook=$("<div class='SlideBook' id='SlideBook' ></div>");this.parent.append(this.flipBook);this.initAttachments()},initAttachments:function(){this.showPage=this.flipBook;this.bookAttachments=new BookAttachmentsBuilder(this.flipBook,this.currentPageIndex,this,this.options.isDoublePage);this.options.thickness&&this.bookAttachments.thickness(!0);
this.options.bookshadow&&this.bookAttachments.bookshadow();this.options.grayshadow&&this.bookAttachments.grayshadow();this.options.miniFullscreen&&this.bookAttachments.miniFullscreen();this.options.bookpagenumber&&this.bookAttachments.bookpagenumber();this.options.staticad&&this.bookAttachments.staticad();this.options.zoommap&&this.bookAttachments.zoommap();this.options.bookmarktab&&this.bookAttachments.bookmarktab();this.options.noteadd&&this.bookAttachments.noteadd()},getBook:function(){return this.flipBook},
fillPage:function(a,b){if(a)for(var c=this.pageArray.length,g=0;g<c;g++)this.pageArray[g]&&this.pageArray[g].fillPage(a,b),this.pageBackArray&&this.pageBackArray[g]&&this.pageBackArray[g].fillPage(a,b)},resetPages:function(a){isNaN(a)||0>=a||(this.unWrapPageExcludeArray([a,a+1,a-1]),this.addPageArray([a,a+1,a-1]),this.loading(),this.currentPage=this.pageArray[a],this.nextPage=this.pageArray[a+1],this.previousPage=this.pageArray[a-1],this.setPageCss())},addPageArray:function(a){if(a&&this.pageArray){for(var b=
0;b<a.length;b++)if(!(0>=a[b]||a[b]>this.pageLength()||(this.pageArray[a[b]]&&this.fillContent(a[b]),this.pageArray[a[b]]))){var c=this.newPage(a[b]);c.onResize(this.width,this.height);this.pageArray[a[b]]=c;this.fillContent(a[b]);this.flipBook.append(c.getSide())}this.orderPages()}},setPagePosition:function(a,b){bookConfig.FlipDirection?(b*=windowHeight,b={top:b+"px"}):(b*=windowWidth,b={left:b+"px"});this.pageArray[a]&&this.pageArray[a].setCSSByStyle(b)},orderPages:function(){this.sequenceList=
{};for(var a=this.pageArray.length,b=0,c=this.mainPageIndex+1;c<a;c++)this.pageArray[c]&&(rightToLeft?b--:b++,this.pageArray[c].sequence=b,this.sequenceList[b]=c,this.setPagePosition(c,b));b=0;for(a=this.mainPageIndex;0<a;a--)this.pageArray[a]&&(this.pageArray[a].sequence=b,this.sequenceList[b]=a,this.setPagePosition(a,b),rightToLeft?b++:b--)},setPageCss:function(){var a=transformCSS({rotate:0,tran:{x:0,y:0}});this.currentPage&&this.currentPage.setCSSByStyle(a);this.previousPage&&this.previousPage.setCSSByStyle(a);
this.nextPage&&this.nextPage.setCSSByStyle(a)},fillContent:function(a){(!this.flipping||imageLoaded[a])&&this.pageArray[a]&&this.pageArray[a].fillImage()},newPage:function(a){return new SlideBookPage(a,"slidePage",this.bookType)},pageLength:function(){return bookConfig.totalPageCount},unWrapPageExcludeArray:function(a){if(a&&this.pageArray){for(var b=this.pageArray.length,c=0;c<b;c++)!this.pageArray[c]||0<=a.indexOf(c)||(this.pageArray[c].remove(),this.pageArray[c]=void 0);this.orderPages()}},mouseWheelFlip:function(){if(bookConfig.mouseWheelFlip){var a;
this.flipBook.bind(_event._mousewheel,function(b){if(void 0!=a&&150>(new Date).getTime()-a)var c=!1;else a=(new Date).getTime(),c=!0;if(!c)return!1;c=b.originalEvent;c=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));this.status_zoom&&(b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]},0>c?this.currentPage.controlBar&&this.currentPage.controlBar.zoomDown(b):this.currentPage.controlBar&&this.currentPage.controlBar.zoomUp(b));this.status_zoom||!bookConfig.mouseWheelFlip||this.flipping||
(0>c?nextPageFun("mouse wheel flip"):previousPageFun("mouse wheel flip"));if(bookConfig.mouseWheelFlip)return stopEvent(b),!1}.bind(this))}},flippingTo:function(a){this.currentPageIndex=a;this.currentPageIndex=Math.max(1,this.currentPageIndex);this.currentPageIndex=Math.min(originTotalPageCount,this.currentPageIndex)},getRealPageIndex:function(){return this.currentPageIndex},getRealBookIndex:function(a){return a},gotoPage:function(a,b){if(!isNaN(a)){this.toPageIndex=a;if(this.status_zoom)return a=
{pointers:[{pageX:windowWidth/2,pageY:windowHeight/2}]},b=this.pageArray[this.currentPageIndex].pages,b.onDoubleTap.bind(b)(a),!0;a=this.getRealBookIndex(a);0>=a||a>this.pageLength()||!this.flipEffect(a)||(!b&&flipHistory&&flipHistory.addFromCurrentIndex(this.toPageIndex),this.flippingTo(a),playFlipSound(),bookConfig.restorePageVisible&&window.localStorage.setItem(realLocation+"?historyPageIndex",this.toPageIndex),this.flipInterval&&this.flipInterval.stop(),this.refreshPages(a),this.flipIntervalTmp(a))}},
flipEffect:function(a){return this.status_zoom||a==this.currentPageIndex||this.flipping?!1:!0},flipIntervalTmp:function(a){var b=this.currentTran,c=this.getFlipTo(a);this.flipping=!0;var g=function(h,n,p){h<n?(h=(0,$.easing["easeInOut"+p])(null,h,b,c-b,n),this.setBookTran(h)):(this.afterFlipTo(),this.flipInterval.stop(),BookEvent.trigger("afterFlipPage",[a]))}.bind(this);this.flipInterval=function(h,n){g(h,n,"Sine")}.animation(this,this.flippingTime)},refreshPages:function(a){this.setAttachmentBeforeFlipTo(a);
if(!this.pageArray[a]){var b=this.getCurrentViewPageIndex(),c=bookConfig.FlipDirection?this.currentTran-this.height:this.currentTran-this.width;(a>b||a<this.mainPageIndex)&&!rightToLeft&&(c=this.currentTran);(a<b||a>this.mainPageIndex)&&rightToLeft&&(c=this.currentTran);this.addPageArray([a]);this.setBookTran(c)}this.showPage=this.pageArray[a].pages},getCurrentViewPageIndex:function(){var a=Math.abs(this.currentTran);return this.sequenceList[(0>=this.currentTran?1:-1)*(bookConfig.FlipDirection?Math.floor(a/
this.height)+1+(a%this.height>this.height/2)?0:1:Math.floor(a/this.width)+1+(a%this.width>this.width/2)?0:1)]},getFlipTo:function(a){return this.pageArray[a]&&this.pageArray[a].sequence?-this.pageArray[a].sequence*(bookConfig.FlipDirection?windowHeight:windowWidth):0},getCurrentTran:function(){return this.currentTran},setBookTran:function(a){if(bookConfig.FlipDirection){var b=transformCSS({rotate:0,tran:{x:0,y:a}});isBelowIE9()&&(b={top:a+this.bookTop+"px"})}else b=transformCSS({rotate:0,tran:{x:a,
y:0}}),isBelowIE9()&&(b={left:a+this.bookLeft+"px"});this.setCSSByStyle(b);this.currentTran=a},onResize:function(){this.resize();this.status_zoom=!1;this.showPage=this.pageArray[this.currentPageIndex].pages},resize:function(){this.endFlip();this.resizeBook();this.resizePage(this.width,this.height);this.resetPages(this.currentPageIndex);this.resizeAdvertisement()},getTop:function(){return this.bookTop},resizeBook:function(){var a=bookConfig.topMargin+templateArea.getTopHeight(),b=bookConfig.bottomMargin+
templateArea.getBottomHeight(),c=bookConfig.leftMargin+templateArea.getLeftWidth(),g=bookConfig.rightMargin+templateArea.getRightWidth();g=windowWidth-c-g;b=windowHeight-a-b;var h=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,n=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;bookConfig.FlipDirection?(h=fitPageWidthHeight(g,b,h,2*n),this.width=parseInt(h.x),this.height=
2*parseInt(h.y/2),this.bookTop=a+(b-this.height)/2,this.bookLeft=c+(g-this.width)/2,bookType==BookType.slide_book&&useTheAliCloudChart(this.width,parseInt(h.y/2))):(h=fitPageWidthHeight(g,b,2*h,n),this.width=2*parseInt(h.x/2),this.height=parseInt(h.y),this.bookTop=a+(b-this.height)/2,this.bookLeft=c+(g-this.width)/2,bookType==BookType.slide_book&&useTheAliCloudChart(parseInt(h.x/2),this.height));this.flipBook.css({width:this.width+"px",height:this.height+"px",left:this.bookLeft+"px",top:this.bookTop+
"px"})},resizeAdvertisement:function(){var a=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,b=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;bookConfig.FlipDirection?(a=fitPageWidthHeight(this.width,this.height,a,2*b),this.pageWidth=parseInt(a.x),this.pageHeight=2*parseInt(a.y/2)):(a=fitPageWidthHeight(this.width,this.height,2*a,b),this.pageWidth=2*parseInt(a.x/2),this.pageHeight=
parseInt(a.y))},resizePage:function(a,b){for(var c=this.pageArray.length,g=0;g<c;g++)this.pageArray[g]&&(this.pageArray[g].onResize(a,b),this.pageArray[g].controlBar&&this.pageArray[g].controlBar.setVisible(!1))},getHeight:function(){return this.height},getWidth:function(){return this.width},getScale:function(){return this.currentPage.pages.parameters.toScale},getCssLeft:function(){return parseInt(this.flipBook.css("left"))},getCssTop:function(){return parseInt(this.flipBook.css("top"))},checkFlipping:function(){this.flipping=
!1;this.loading();this.fillContent(this.currentPageIndex)},afterFlipTo:function(){this.mainPageIndex=this.currentPageIndex;this.resetPages(this.currentPageIndex);this.setBookTran(0);this.startTran=this.currentTran;this.checkFlipping();this.setAttachmentAfterFlipTo()},setAttachmentBeforeFlipTo:function(){this.bookAttachments.setAttachmentBeforeFlipTo()},setAttachmentAfterFlipTo:function(){this.stopMedia();this.resetSlider();this.flipping||this.enterPage();global.thumbnail&&(thumbnail.clearHighLight(),
thumbnail.setHighLight(this.getRealPageIndex()));window.resizeBookAfterFlip&&!this.flipping&&window.setTimeout(function(){onStageResize()},30);this.bookAttachments.setAttachmentAfterFlipTo()},endFlip:function(){this.flipping=!1},loading:function(){this.flipping||this.pageArray[this.currentPageIndex]&&this.pageArray[this.currentPageIndex].loading()},getCurrentPageIndex:function(){return this.getRealPageIndex()},getCurrentPages:function(){return[this.currentPageIndex]},setCSSByStyle:function(a){this.flipBook.css(a)},
setShow:function(a){},hide:function(){Log.debug("slide book hide.");this.visible=!1;this.setCSSByStyle({display:"none"});this.stopMedia();this.resetSlider();this.bookAttachments&&this.bookAttachments.hide()},show:function(){Log.debug("slide book show.");this.visible=!0;this.setCSSByStyle({display:"block"});this.enterPage();this.bookAttachments&&this.bookAttachments.show()},enterPage:function(){this.afterChangeBookType();this.openShownMedia();this.addSearchHighlight()},addSearchHighlight:function(){var a=
this.currentPageIndex;this.pageArray[a]&&this.pageArray[a].highlightSearch()},clearSearchHighlight:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].clearHighlight()},openShownMedia:function(){var a=this.currentPageIndex;this.pageArray[a]&&this.pageArray[a].enterSide();this.pageArray[a]&&this.pageArray[a].addHistoryTexts()},stopMedia:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].leaveSide()},resetSlider:function(){for(var a=
this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].resetSlider()},afterChangeBookType:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].initReaderOrSlider()},select:function(){this.selected=!0;var a=this.currentPageIndex;this.pageArray[a]&&(this.pageArray[a]&&this.pageArray[a].initSelectTextEvent(),this.pageArray[a].pages.parameters&&(this.pageArray[a].pages.parameters.eventCancel=!0))},unSelect:function(){this.selected=!1;var a=this.getCurrentPages();
if(void 0!=a&&null!=a){for(var b=0;b<a.length;b++){var c=a[b];this.pageArray[c]&&(this.pageArray[c]&&this.pageArray[c].destroySelect(),this.pageArray[c].pages.parameters&&(this.pageArray[c].pages.parameters.eventCancel=!1))}StateSynchronous.instance().findButtons("SelectTextButton",!0).each(function(g){g.setAsUnSelect();g.executeCallback()})}},magnifierZoom:function(){this.selected=!0;var a=this.currentPageIndex;this.pageArray[a]&&this.pageArray[a]&&this.pageArray[a].initMagnifierEvent()},unMagnifierZoom:function(){this.selected=
!1;var a=BookInfo.getCurrentPages();if(void 0!=a&&null!=a){for(var b=0;b<a.length;b++){var c=a[b];this.pageArray[c]&&this.pageArray[c]&&this.pageArray[c].destroyMagnifier()}bookConfig.MagnifierButtonVisible&&window.magnifierZoomBox&&window.magnifierZoomBox.hide();StateSynchronous.instance().findButtons("magnifier",!0).each(function(g){g.setAsZoomin()})}},switchLargeImage:function(){for(var a=this.pageArray.length,b=0;b<a;b++)this.pageArray[b]&&this.pageArray[b].switchLargeImage()},switchNormalImage:function(a){for(var b=
this.pageArray.length,c=0;c<b;c++)this.pageArray[c]&&this.pageArray[c].switchNormalImage(a)},destroy:function(){}}).extend(Book);
SlideBook.expand({initEvent:function(){this.moveDirectionType={MOVE_LEFT:-1,MOVE_RIGHT:1,MOVE_NONE:0};this.mouseMoveDirection=this.moveDirectionType.MOVE_NONE;this.hammerEventModular();this.mouseWheelFlip()},hammerEventModular:function(){var a=new Hammer.Manager(this.flipBook[0]);a.add(new Hammer.Pan);a.add((new Hammer.Swipe).recognizeWith(a.get("pan")));a.add(new Hammer.Press({time:"1000"}));a.add(new Hammer.Pinch);a.add(new Hammer.Tap({event:"doubletap",taps:2}));a.on("panstart panmove",this.onPan.bind(this));
a.on("press",this.onPress.bind(this));this.flipBook.bind("click",this.onTap.bind(this));this.flipBook.bind("mouseover mousemove",this.onOver.bind(this));this.flipBook.bind(_event._down,this.onDown.bind(this));$("body").bind(_event._end+" "+_event._leave,this.onUp.bind(this));this.flipBook.speed(this.onSwipe.bind(this))},onPan:function(a){this.selected||this.status_zoom||this.isZoomming||bookType!=this.bookType||this.status_zoom||this.status_resize||this.flipping||!bookConfig.mouseDragFlip||("panstart"==
a.type&&(this.startTran=this.currentTran,this.panstart=!0),this.panstart&&(bookConfig.FlipDirection||bookConfig.upsideOnMobile()?this.setBookTran(this.startTran+a.deltaY):this.setBookTran(this.startTran+a.deltaX),"panend"==a.type&&(this.panstart=!1)))},onPress:function(a){},onTap:function(a){onWindowTap(a.srcEvent)},onOver:function(a){},onDown:function(a){this.fingleDown=!0},onUp:function(a){!this.flipping&&this.fingleDown&&(30<=Math.abs(this.currentTran-this.startTran)&&(this.currentTran>this.startTran&&
!rightToLeft||this.currentTran<this.startTran&&rightToLeft?previousPageFun("window click"):this.currentTran!=this.startTran&&nextPageFun("window click")),this.startTran=this.currentTran,this.panstart=this.fingleDown=!1,this.onBack())},onBack:function(){if(0!=this.currentTran&&!this.flipping){this.flipping=!0;var a=this.currentTran,b=function(c,g,h){c<g?(c=(0,$.easing["easeInOut"+h])(null,c,a,0-a,g),this.setBookTran(c)):(this.flipping=!1,this.flipInterval.stop(),this.setBookTran(0),this.startTran=
this.currentTran)}.bind(this);this.flipInterval=function(c,g){b(c,g,"Sine")}.animation(this,this.flippingTime)}},getNextPage:function(a){this.currentTran>this.startTran&&!rightToLeft||this.currentTran<this.startTran&&rightToLeft?previousPageFun(a):nextPageFun(a)},onSwipe:function(a,b){if(!(this.selected||this.status_zoom||this.isZomming||this.dragToFlip)){var c=30;bookConfig.FlipDirection?(c=c*this.height/1600,a=b):c=c*this.width/1600;Math.abs(a)<=c||(a<-c?rightToLeft?previousPageFun("swipe to flip"):
nextPageFun("swipe to flip"):a>c&&(rightToLeft?nextPageFun("swipe to flip"):previousPageFun("swipe to flip")))}}});
var DoubleSlideBook=Class({getRealPageIndex:function(){var a=2*this.currentPageIndex-1;return a=Number.between(a,1,bookConfig.totalPageCount)},getRealBookIndex:function(a){a=bookConfig.isTheBookOpen?Math.ceil(a/2):parseInt(a/2)+1;return a=Number.between(a,1,this.pageLength())},pageLength:function(){return bookConfig.isTheBookOpen?Math.ceil(bookConfig.totalPageCount/2):parseInt(bookConfig.totalPageCount/2)+1},newPage:function(a){return bookConfig.FlipDirection?new SlideCalendarPage(a,"slidePage",this.bookType):
new SlideBookPage(a,"slidePage",this.bookType)}}).extend(SlideBook),SingleSlideBook=Class({getRealPageIndex:function(){var a=this.currentPageIndex;return a=Number.between(a,1,bookConfig.totalPageCount)},getRealBookIndex:function(a){return a=Number.between(a,1,bookConfig.totalPageCount)},pageLength:function(){return bookConfig.totalPageCount},newPage:function(a){return new SingleSlideBookPage(a,"slidePage",this.bookType)},resizeBook:function(){var a=bookConfig.topMargin+templateArea.getTopHeight(),
b=bookConfig.bottomMargin+templateArea.getBottomHeight(),c=bookConfig.leftMargin+templateArea.getLeftWidth(),g=bookConfig.rightMargin+templateArea.getRightWidth();g=windowWidth-c-g;b=windowHeight-a-b;var h=bookConfig.largePageWidth*(-parseFloat(bookConfig.visibleAreaLeft)+parseFloat(bookConfig.visibleAreaRight))/100,n=bookConfig.largePageHeight*(parseFloat(bookConfig.visibleAreaBottom)-parseFloat(bookConfig.visibleAreaTop))/100;h=fitPageWidthHeight(g,b,h,n);this.width=parseInt(h.x);this.height=parseInt(h.y);
this.bookTop=a+(b-this.height)/2;this.bookLeft=c+(g-this.width)/2;bookType==BookType.singleSlide_book&&useTheAliCloudChart(this.width,this.height);this.flipBook.css({width:this.width+"px",height:this.height+"px",left:this.bookLeft+"px",top:this.bookTop+"px"})}}).extend(SlideBook),PcDoubleSlideBook=Class({bookType:BookType.slide_book,create:function(a){this._super(a)},onResize:function(){this._super();if(bookConfig.FlipDirection)this.bookAttachments.onResize(this.width,this.height/2);else this.bookAttachments.onResize(this.width/
2,this.height)}}).extend(DoubleSlideBook),PcSingleSlideBook=Class({bookType:BookType.singleSlide_book,create:function(a){this._super(a)},onResize:function(){this._super();this.bookAttachments.onResize(this.width,this.height)}}).extend(SingleSlideBook);
