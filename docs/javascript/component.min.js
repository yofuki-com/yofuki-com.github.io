var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(f){f.done?d(f.value):Promise.resolve(f.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(g,f){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(g){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(g||"")+"_"+d++,g)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(f){return f instanceof e?f:new e(function(h,k){h(f)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(f)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(f){d(f,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var h=0;h<f.length;++h){var k=f[h];f[h]=null;try{k()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var e=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var h=this.createResolveAndReject_();
try{f(h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.createResolveAndReject_=function(){function f(l){return function(m){k||(k=!0,l.call(h,m))}}var h=this,k=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var h=null!=f;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(f):
this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(f){var h=void 0;try{h=f.then}catch(k){this.reject_(k);return}"function"==typeof h?this.settleSameAsThenable_(h,f):this.fulfill_(f)};e.prototype.reject_=function(f){this.settle_(2,f)};e.prototype.fulfill_=function(f){this.settle_(1,f)};e.prototype.settle_=function(f,h){if(0!=this.state_)throw Error("Cannot settle("+f+", "+h+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=h;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;d(function(){if(f.notifyUnhandledRejection_()){var h=$jscomp.global.console;"undefined"!==typeof h&&h.error(f.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=$jscomp.global.CustomEvent,h=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):
"function"===typeof h?f=new h("unhandledrejection",{cancelable:!0}):(f=$jscomp.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return k(f)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)g.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(f){var h=this.createResolveAndReject_();
f.callWhenSettled_(h.resolve,h.reject)};e.prototype.settleSameAsThenable_=function(f,h){var k=this.createResolveAndReject_();try{f.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};e.prototype.then=function(f,h){function k(p,q){return"function"==typeof p?function(r){try{l(p(r))}catch(t){m(t)}}:q}var l,m,n=new e(function(p,q){l=p;m=q});this.callWhenSettled_(k(f,l),k(h,m));return n};e.prototype.catch=function(f){return this.then(void 0,f)};e.prototype.callWhenSettled_=function(f,h){function k(){switch(l.state_){case 1:f(l.result_);
break;case 2:h(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?g.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(f){return new e(function(h,k){k(f)})};e.race=function(f){return new e(function(h,k){for(var l=$jscomp.makeIterator(f),m=l.next();!m.done;m=l.next())c(m.value).callWhenSettled_(h,k)})};e.all=function(f){var h=$jscomp.makeIterator(f),k=h.next();return k.done?c([]):new e(function(l,
m){function n(r){return function(t){p[r]=t;q--;0==q&&l(p)}}var p=[],q=0;do p.push(void 0),q++,c(k.value).callWhenSettled_(n(p.length-1),m),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var f=0;f<g&&c<e;)if(d[c++]!=b[f++])return!1;return f>=g}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
var AnnotationPannel=Class({statics:{NONE:0,NOTE:1,PEN:2,RECT:3,ROUND:4,ERASER:5},create:function(a){a&&(this.annoStepCookie=[],this.annoCurrentStep=-1,this.parent=a,this.visible=!1,this.book=BookInfo.getBook().showPage,this.selectCase=AnnotationPannel.NONE,this.initPageConfig(),this.initHtml(),this.initCss(),this.selectCaseEvent(),this.initEvent(),this.setA11y())},initHtml:function(){this.panel=$("<div class='annotationPanel'></div>");this.topBox=$("<div class='topBox'></div>");this.annoBtnBox=$("<div class='annoBtnBox'></div>");
this.bottomBox=$("<div class='bottomBox'></div>");this.moveBar=$("<div class='noteMoveBar'><p></p></div>");this.noteSplit=$("<p class='anno-split-line'></p>");this.note=$("<div title='"+getLanguage("DrawToolWindow_TextNote","Note")+"' class='noteAdd button' role='button'><p></p></div>");this.pen=$("<div title='"+getLanguage("DrawToolWindow_Brush","Brush")+"' class='notePen button' role='button'><p></p></div>");this.rect=$("<div title='"+getLanguage("DrawToolWindow_Rectangular","Rectangular")+"' class='noteRect button' role='button'><p></p></div>");
this.round=$("<div title='"+getLanguage("DrawToolWindow_Ellipse","Ellipse")+"' class='noteRound button' role='button'><p></p></div>");this.eraserSplit=$("<p class='anno-split-line'></p>");this.eraser=$("<div title='"+getLanguage("DrawToolWindow_Eraser","Eraser")+"' class='noteEraser button' role='button'><p></p></div>");this.point=$("<div class='noteCursor' ><p></p></div>");this.clear=$("<div title='"+getLanguage("DrawToolWindow_Clear","Clear")+"' class='noteClear button' role='button'><p></p></div>");
this.undoSplit=$("<p class='anno-split-line'></p>");this.undo=$("<div title='"+getLanguage("DrawToolWindow_Undo","Undo")+"' class='noteUndo button' role='button'><p></p></div>");this.redo=$("<div title='"+getLanguage("DrawToolWindow_Redo","Redo")+"' class='noteRedo button' role='button'><p></p></div>");this.exitSplit=$("<p class='anno-split-line'></p>");this.exit=$("<div title='"+getLanguage("FlipPageEditor_Exit","Exit")+"' class='noteExit button' role='button'><p></p></div>");this.save=$("<div title='"+
getLanguage("FlipPageEditor_SaveAndExit","SaveAndExit")+"' class='noteSave button' role='button'><p></p></div>");this.annoBtnBox.append(this.point).append(this.noteSplit).append(this.note).append(this.pen).append(this.rect).append(this.round).append(this.eraserSplit).append(this.eraser).append(this.clear).append(this.undoSplit).append(this.undo).append(this.redo).append(this.exitSplit).append(this.save).append(this.exit);this.initBottomHtml();this.topBox.append(this.moveBar).append(this.annoBtnBox);
this.panel.append(this.topBox).append(this.bottomBox);this.parent.append(this.panel);this.setBtnSrc()},setBtnSrc:function(){for(var a=[this.moveBar,this.note,this.pen,this.rect,this.round,this.eraser,this.point,this.clear,this.undo,this.redo,this.exit,this.save],b=[{x:1,y:21,w:18,h:5,rotate:90,margin:"9"},{x:40,y:1,w:14,h:14},{x:72,y:17,w:14,h:14},{x:88,y:1,w:14,h:14},{x:104,y:1,w:14,h:14},{x:56,y:17,w:14,h:14},{x:56,y:1,w:14,h:14},{x:40,y:17,w:14,h:14},{x:120,y:1,w:14,h:14},{x:88,y:17,w:14,h:14},
{x:72,y:1,w:14,h:14},{x:104,y:17,w:14,h:14}],c=0;c<a.length;c++)this.setSrc(a[c].find("p"),b[c])},setSrc:function(a,b){b.rotate&&a.css({transform:"rotateZ("+b.rotate+"deg)","-webkit-transform":"rotateZ("+b.rotate+"deg)","transform-origin":"0 0","-webkit-transform-origin":"0 0"});b.margin||(b.margin=5);a.css({"pointer-events":"none",width:b.w+"px",height:b.h+"px",margin:b.margin+"px",display:"inline-block",background:"url("+uiBaseURL+"annotationSprite.png) "+-b.x+"px "+-b.y+"px no-repeat"})},initBottomHtml:function(){this.selColor=
"#FDC606";this.eraserBox=$("<div class='eraserBox' style='display:none;margin:6px 0'></div>");this.eraserWidth=$("<span class='eraserWidth' style='font-size:13px;margin-left:10px;margin-right:5px;'>"+getLanguage("DrawToolWindow_Width","Width")+"</span>");this.inputEraserWidth=$("<input class='eraserInput'  style='width:40px;display:inline-block;padding-left:3px;height: 20px;line-height: 20px;border:1px solid #bebec3;border-radius:2px;' type='number' step='1' min='1' value='30' />");this.widthBox=
$("<div class='widthBox' style='display:none;margin:6px 0'></div>");this.setWidth=$("<span class='setWidth' style='font-size:13px;margin-left:10px;margin-right:5px;'>Width</span>");this.inputWidth=$("<input  style='width:38px;display:inline-block;padding-left:3px;height: 20px;line-height: 20px;border:1px solid #bebec3;border-radius:2px;' type='number' step='1' min='1' value='3' />");this.alphaBox=$("<div class='alphaBox' style='display:none;margin:6px 0'></div>");this.setAplha=$("<span class='setAplha' style='font-size:13px;margin-left:10px;margin-right:5px;'>Alpha</span>");
this.inputAlpha=$("<input style='width:48px;display:inline-block;padding-left:3px;height: 20px;line-height: 20px;border:1px solid #bebec3;border-radius:2px;' type='number' step='1' value='100' min='0' max='100' />");this.colorBox=$("<div class='colorBox' style='position:relative;display:none;margin:6px 0'></div>");this.setColor=$("<span class='setColor'  style='font-size:13px;margin-left:10px;margin-right:5px;'>color</span>");this.inputColor=$("<input style='width:68px;display:inline-block;height: 20px;line-height: 20px;padding-left:3px;border:1px solid #bebec3;border-radius:2px;' value='"+
this.selColor+"'/>");this.showColor=$("<div class='showColor' color='"+this.selColor+"' style='cursor:pointer;background:"+this.selColor+";vertical-align:middle;display:inline-block;width:20px;height:20px;margin-left:1px;'></div>");this.showColorBox=$("<div style='display: inline-block;width: 22px;height: 22px;border: 1px solid #BEBEC3;background: #fff;line-height: 18px;margin-left: 1px;border-radius:2px;margin-right: 2px;'></div>");this.showColor.bind(_event._up,function(a){a.stopPropagation();global.colorPanel&&
global.colorPanel.showOrHide({e:a,elem:this.showColor,input:this.inputColor,closeAlpha:!0})}.bind(this));this.panel.bind(_event._up,function(){global.colorPanel&&global.colorPanel.visible&&global.colorPanel.curElem[0]==this.showColor[0]&&global.colorPanel.hide()}.bind(this));this.showColorBox.append(this.showColor);this.eraserBox.append(this.eraserWidth).append(this.inputEraserWidth);this.widthBox.append(this.setWidth).append(this.inputWidth);this.alphaBox.append(this.setAplha).append(this.inputAlpha);
this.colorBox.append(this.setColor).append(this.inputColor).append(this.showColorBox);this.bottomBox.append(this.eraserBox).append(this.widthBox).append(this.alphaBox).append(this.colorBox)},initPageConfig:function(){this.pageIndex=BookInfo.getBook().currentPageIndex;BookInfo.getBook().pageArray.length&&("slide"==bookConfig.FlipStyle.toLocaleLowerCase()&&BookInfo.isDoublePage(BookInfo.getBookType())?(BookInfo.getBook().pageArray[this.pageIndex].leftPage?this.page=BookInfo.getBook().pageArray[this.pageIndex].leftPage:
BookInfo.getBook().pageArray[this.pageIndex].rightPage&&(this.page=BookInfo.getBook().pageArray[this.pageIndex].rightPage),rightToLeft&&BookInfo.getBook().pageArray[this.pageIndex].rightPage&&(this.page=BookInfo.getBook().pageArray[this.pageIndex].rightPage)):this.page=BookInfo.getBook().pageArray[this.pageIndex].page,this.getPageSize())},getPageSize:function(){this.page.pageAttachments?(this.pageWidth=this.page.pageAttachments.pageWidth,this.pageHeight=this.page.pageAttachments.pageHeight,this.noteParent=
this.page.pageAttachments.$annotation):(this.noteParent=$("#animation0-"+this.pageIndex),this.noteParent[0]?(this.pageWidth=this.noteParent.width(),this.pageHeight=this.noteParent.height()):(this.pageWidth=this.page.pageWidth,this.pageHeight=this.page.pageHeight))},setPanelIndex:function(a,b,c){a||(a=0);b||(b=0);this.book=BookInfo.getBook().showPage;for(var d=BookInfo.getCurrentPages(),e=0;e<d.length;e++)this.book.find("#annotationPage"+d[e]).css({"pointer-events":c}),this.book.find("#annotationCvsPanel"+
d[e]).css({"z-index":a}),this.book.find("#annotationDraw"+d[e]).css({"z-index":b})},clearBtnDownCase:function(){isPhone()||isPad()?this.annoBtnBox.find("div").css({background:"transparent"}):this.annoBtnBox.find("div").css({background:""});BookInfo.getBook().noteAdd&&BookInfo.getBook().noteAdd.css({opacity:""});this.bottomBox.css({display:"none"})},noteEvent:function(){this.addNote();this.defaultBottomCase()},addNote:function(){var a=this,b,c,d,e,g,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==
h.nextAddress)return b=BookInfo.getBook().currentPageIndex,a.initPageConfig(),c=a.getNodePos(),d=new Date,e=d.toLocaleDateString()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds(),g="id"+d.getTime(),f={index:b-1,type:"note",id:g,time:e,size:.05,position:{x:c.x/a.pageWidth,y:c.y/a.pageHeight},value:""},isPhone()||isPad()?new AnnotationAddMobileNote(a.noteParent,f,!0):new AnnotationAddNote(a.noteParent,f,!0),a.noteParent.css({display:"block"}),h.yield(global.annotationCookie.saveNoteCookie("Note",
b-1,g,f),2);global.annotationPannel.selectCase=AnnotationPannel.NONE;global.annotationPannel.setPanelIndex(0,0,"none");h.jumpToEnd()})},getNumToFixed:function(a){return Math.floor(100*a)/100},getNodePos:function(){var a=this.noteParent.find(".noteContainer"),b=[],c=0,d=0;this.pos={x:this.getNumToFixed(.25*this.pageWidth),y:this.getNumToFixed(.1*this.pageHeight)};for(var e=0;e<a.length;e++){var g={x:this.getNumToFixed($(a[e]).left()),y:this.getNumToFixed($(a[e]).top())};b.push(g)}for(;b.filter(this.filterFun.bind(this)).length;)c+=
1,4<=c&&(d+=1,c=0),this.pos={x:this.getNumToFixed((.25+.075*c)*this.pageWidth),y:this.getNumToFixed(.1*this.pageHeight+.075*d*this.pageWidth)};return this.pos},filterFun:function(a){return this.posIsContain(this.pos,a)},posIsContain:function(a,b){var c=this.getNumToFixed(.05*this.pageWidth);return a.x>=b.x&&a.x<=b.x+c&&a.y>=b.y&&a.y<=b.y+c||a.x+c<=b.x+c&&a.x+c>=b.x+c&&a.y>=b.y&&a.y<=b.y+c||a.x>=b.x&&a.x<=b.x+c&&a.y+c>=b.y&&a.y+c<=b.y+c||a.x+c>=b.x&&a.x+c<=b.x+c&&a.y+c>=b.y&&a.y+c<=b.y+c?!0:!1},selectCaseEvent:function(){this.defaultCaseEvent();
this.note.bind(_event._click,function(a){a.stopPropagation();this.noteEvent()}.bind(this));this.pen.bind(_event._click,function(a){a.stopPropagation();this.selectCase!=AnnotationPannel.PEN?(this.selectCase=AnnotationPannel.PEN,this.setPanelIndex(2,0,"auto"),isPhone()||isPad()?this.pen.css({background:"rgba(255,255,255,0.2)"}):this.pen.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.pen.css({background:""}),this.defaultBottomCase());this.eraserBox.css({display:"none"});
this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("DrawToolWindow_Width","Width"));this.setAplha.text(getLanguage("DrawToolWindow_Alpha","Alpha"));this.setColor.text(getLanguage("DrawToolWindow_Color","Color"))}.bind(this));this.rect.bind(_event._click,function(a){a.stopPropagation();this.selectCase!=AnnotationPannel.RECT?(this.selectCase=AnnotationPannel.RECT,this.setPanelIndex(2,3,"auto"),
isPhone()||isPad()?this.rect.css({background:"rgba(255,255,255,0.2)"}):this.rect.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.rect.css({background:""}),this.defaultBottomCase());this.eraserBox.css({display:"none"});this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("TStuff_BorderWidth","Width"));this.setAplha.text(getLanguage("TStuff_BorderAlph","Alpha"));
this.setColor.text(getLanguage("TStuff_BorderColor","Color"))}.bind(this));this.round.bind(_event._click,function(a){a.stopPropagation();this.selectCase!=AnnotationPannel.ROUND?(this.selectCase=AnnotationPannel.ROUND,this.setPanelIndex(2,3,"auto"),isPhone()||isPad()?this.round.css({background:"rgba(255,255,255,0.2)"}):this.round.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.round.css({background:""}),this.defaultBottomCase());this.eraserBox.css({display:"none"});
this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("TStuff_BorderWidth","Width"));this.setAplha.text(getLanguage("TStuff_BorderAlph","Alpha"));this.setColor.text(getLanguage("TStuff_BorderColor","Color"))}.bind(this));this.eraser.bind(_event._click,function(a){a.stopPropagation();this.selectCase!=AnnotationPannel.ERASER?(this.selectCase=AnnotationPannel.ERASER,this.setPanelIndex(2,0,"auto"),
isPhone()||isPad()?this.eraser.css({background:"rgba(255,255,255,0.2)"}):this.eraser.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.eraser.css({background:""}),this.defaultBottomCase());this.eraserBox.css({display:"inline-block"});this.widthBox.css({display:"none"});this.alphaBox.css({display:"none"});this.colorBox.css({display:"none"})}.bind(this));this.point.bind(_event._click,function(a){a.stopPropagation();this.defaultBottomCase()}.bind(this));this.clear.bind(_event._click,
function(a){a.stopPropagation();a=BookInfo.getCurrentPages();this.selectCase=AnnotationPannel.NONE;this.setPanelIndex(0,0,"none");this.initPageConfig();for(var b=0;b<a.length;b++){var c=this.book.find("#annotationCvsPanel"+a[b])[0].getContext("2d");c.beginPath();c.stroke();c.clearRect(0,0,this.pageWidth,this.pageHeight);c.closePath()}global.annotationCookie.setAllAnnoSteps(11,a.map(function(d){return d-1}),[{type:"Clear"}]);global.annotationCookie.stepIndex+=1}.bind(this));this.exit.bind(_event._click,
function(a){a.stopPropagation();this.hide();this.initPageConfig();a=BookInfo.getCurrentPages();for(var b=0;b<a.length;b++)global.annotationCookie.repaintCookie(this.pageWidth,this.pageHeight,a[b]-1)}.bind(this));this.save.bind(_event._click,function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return a.stopPropagation(),c.yield(global.annotationCookie.saveCookie(),2);b.hide();c.jumpToEnd()})}.bind(this));this.undo.bind(_event._click,function(a){a.stopPropagation();
this.setPanelIndex(0,0,"none");this.selectCase=AnnotationPannel.NONE;--global.annotationCookie.stepIndex;0>=global.annotationCookie.stepIndex&&(global.annotationCookie.stepIndex=0);global.annotationCookie.repaintSteps()}.bind(this));this.redo.bind(_event._click,function(a){a.stopPropagation();this.setPanelIndex(0,0,"none");this.selectCase=AnnotationPannel.NONE;global.annotationCookie.stepIndex+=1;global.annotationCookie.stepIndex>=global.annotationCookie.allAnnoSteps.length&&(global.annotationCookie.stepIndex=
global.annotationCookie.allAnnoSteps.length);global.annotationCookie.repaintSteps()}.bind(this))},defaultBottomCase:function(){this.selectCase=AnnotationPannel.NONE;this.setPanelIndex(0,0,"none");this.bottomBox.css({display:"none"})},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},defaultCaseEvent:function(){this.annoBtnBox.find("div").bind(_event._click,function(a){a.stopPropagation();a=a.target;if("p"==a.tagName.toLowerCase()||"img"==a.tagName.toLowerCase())a=$(a).parent();
isPhone()||isPad()?$(a).siblings("div").css({background:"transparent"}):$(a).siblings("div").css({background:""})}.bind(this));this.annoBtnBox.find("div").bind(_event._down,function(a){a.stopPropagation();a=a.target;if("p"==a.tagName.toLowerCase()||"img"==a.tagName.toLowerCase())a=$(a).parent();isPhone()||isPad()?$(a).css({background:"rgba(255,255,255,0.2)"}):$(a).css({background:"rgba(0,0,0,0.2)"})}.bind(this));this.annoBtnBox.find("div").bind(_event._up,function(a){a.stopPropagation();a=a.target;
if("p"==a.tagName.toLowerCase()||"img"==a.tagName.toLowerCase())a=$(a).parent();isPhone()||isPad()?$(a).css({background:"transparent"}):$(a).css({background:""})}.bind(this))},initCss:function(){var a=404<=windowWidth?1:windowWidth/404;this.panel.css({display:"none",position:"absolute",width:"404px",height:"auto","border-radius":"1px",top:"60px",left:(0>windowWidth-404?0:(windowWidth-404)/2)+"px","-webkit-transform":"scale("+a+")","-moz-transform":"scale("+a+")","-o-transform":"scale("+a+")","-ms-transform":"scale("+
a+")",transform:"scale("+a+")","-webkit-transform-origin":"0 0","-moz-transform-origin":"0 0","-o-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0","z-index":"10000"});this.topBox.css({"border-radius":"3px",position:"relative",border:"1px solid rgba(0,0,0,0.1)",background:"#eaeaf0"});this.annoBtnBox.css({"border-radius":"3px",position:"relative",height:"36px",top:"0",left:"15px"});this.bottomBox.css({display:"none","border-radius":"3px","vertical-align":"middle",width:"402px",
left:"0",background:"#eaeaf0",border:"1px solid rgba(0, 0, 0, 0.1)","font-family":"Tahoma , sans-serif , Arial",position:"relative",top:"2px"});this.moveBar.css({cursor:"move",width:"16px",height:"36px",position:"absolute",top:"0"});this.note.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.pen.css({cursor:"pointer",width:"24px",height:"24px",position:"relative",float:"left",top:"6px",border:"1px solid transparent"});
this.rect.css({cursor:"pointer",width:"24px",height:"24px",position:"relative",float:"left",top:"6px",border:"1px solid transparent"});this.round.css({cursor:"pointer",width:"24px",height:"24px",position:"relative",float:"left",top:"6px",border:"1px solid transparent"});this.eraser.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.point.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",
top:"6px",border:"1px solid transparent"});this.clear.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.undo.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.redo.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.exit.css({cursor:"pointer",position:"relative",
float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"});this.save.css({cursor:"pointer",position:"relative",float:"left",width:"24px",height:"24px",top:"6px",border:"1px solid transparent"})},initEvent:function(){this.panel.bind("pointerdown mouseup mousedown click mouseenter mouseleave mouseover mouseout",function(a){a.stopPropagation()}.bind(this));this.moveBar.bind(_event._enter,function(a){this.moveBar.find("img").css({background:"#5A9BB7"})}.bind(this));this.moveBar.bind(_event._leave,
function(a){this.moveBar.find("img").css({background:"transparent"})}.bind(this));this.moveBar.bind(_event._down,function(a){a.preventDefault();a.stopPropagation();this.moveBar.find("img").css({background:"#5A9BB7"});a=getPositionFromEvt(a);this.catchX=a.x;this.catchY=a.y;this.catchFocus=!0}.bind(this));this.moveBar.bind(_event._up,function(a){a.preventDefault();a.stopPropagation();this.moveBar.find("img").css({background:"transparent"});this.catchFocus=!1}.bind(this));this.parent.bind(_event._move,
function(a){if(this.catchFocus){a=getPositionFromEvt(a);var b=a.x-this.catchX,c=a.y-this.catchY;this.panel.css({left:parseFloat(this.panel.left())+b+"px",top:parseFloat(this.panel.top())+c+"px"});this.catchX=a.x;this.catchY=a.y}}.bind(this));this.parent.bind(_event._up,function(a){this.catchFocus=!1}.bind(this));this.parent.bind(_event._leave,function(a){this.catchFocus&&(this.catchFocus=!1)}.bind(this))},changeLanguage:function(){for(var a=BookInfo.getBook().pageArray,b=0;b<a.length;b++)if(a[b]){var c=
a[b].page.pageAttachments.$annotation;c.find(".no.deleteBtn").html(getLanguage("lblCancel","cancel"));c.find(".yes.deleteBtn").html(getLanguage("lblConfirm","confirm"));c.find(".infDeleteNote").html(getLanguage("infDeleteNote","Do you want to delete the note?"));c.find(".noteBox textarea").attr("placeholder",getLanguage("tltAddTexts","add texts"))}this.note.attr("title",getLanguage("DrawToolWindow_TextNote","Note"));this.pen.attr("title",getLanguage("DrawToolWindow_Brush","Brush"));this.rect.attr("title",
getLanguage("DrawToolWindow_Rectangular","Rectangular"));this.round.attr("title",getLanguage("DrawToolWindow_Ellipse","Ellipse"));this.eraser.attr("title",getLanguage("DrawToolWindow_Eraser","Eraser"));this.clear.attr("title",getLanguage("DrawToolWindow_Clear","Clear"));this.undo.attr("title",getLanguage("DrawToolWindow_Undo","Undo"));this.redo.attr("title",getLanguage("DrawToolWindow_Redo","Redo"));this.exit.attr("title",getLanguage("FlipPageEditor_Exit","Exit"));this.save.attr("title",getLanguage("FlipPageEditor_SaveAndExit",
"SaveAndExit"))},onResize:function(){this.initPageConfig();var a=404<=windowWidth?1:windowWidth/404;this.panel.css({left:(0>windowWidth-404?0:(windowWidth-404)/2)+"px","-webkit-transform":"scale("+a+")","-moz-transform":"scale("+a+")","-o-transform":"scale("+a+")","-ms-transform":"scale("+a+")",transform:"scale("+a+")","z-index":"10000"});this.book=BookInfo.getBook().showPage},showOrHide:function(){this.visible?this.hide():this.show()},resetAnnoConfig:function(){this.annoBtnBox.find("div").css({border:"1px solid transparent"});
this.selectCase=AnnotationPannel.NONE;this.setPanelIndex(0,0,"none");global.annotationCookie&&global.annotationCookie.clearUnsaveCookie();this.clearBtnDownCase()},show:function(){var a=this;this.panel.fadeIn(200);setTimeout(function(){a.panel.attr("tabindex",-1);a.panel.focus()},220);this.visible=!0},hide:function(){this.resetAnnoConfig();this.panel.fadeOut(200,function(){}.bind(this));this.panel.removeAttr("tabindex");this.visible=!1},setA11y:function(){this.panel.find(".button, .noteBtn").each(function(){$(this).attr("tabindex",
0);$(this).attr("role","button");$(this).off("keydown.a11y").on("keydown.a11y",function(a){"Enter"!==a.key&&" "!==a.key||$(this).trigger("click")})})}}),PhoneAnnotationPannel=Class({create:function(a){this._super(a);this.resizeButtonSize()},resizeButtonSize:function(){this.annoBtnBox.find(".noteBtn").css({width:"40px"})},initHtml:function(){this.panel=$("<div class='annotationPanel mobile'></div>");this.topBox=$("<div class='topBox stage'></div>");this.annoBtnBox=$("<div class='annoBtnBox swiper'></div>");
this.bottomBox=$("<div class='bottomBox'></div>");this.moveBar=$("<div class='noteMoveBar'><img /></div>");this.note=$("<div title='"+getLanguage("DrawToolWindow_TextNote","Note")+"' class='noteAdd noteBtn' ><p class='note-svg'></p></div>");this.pen=$("<div title='"+getLanguage("DrawToolWindow_Brush","Brush")+"' class='notePen noteBtn'><p class='note-svg'></p></div>");this.rect=$("<div title='"+getLanguage("DrawToolWindow_Rectangular","Rectangular")+"' class='noteRect noteBtn'><p class='note-svg'></p></div>");
this.round=$("<div title='"+getLanguage("DrawToolWindow_Ellipse","Ellipse")+"' class='noteRound noteBtn'><p class='note-svg'></p></div>");this.eraser=$("<div title='"+getLanguage("DrawToolWindow_Eraser","Eraser")+"' class='noteEraser noteBtn'><p class='note-svg'></p></div>");this.clear=$("<div title='"+getLanguage("DrawToolWindow_Clear","Clear")+"' class='noteClear noteBtn'><p class='note-svg'></p></div>");this.undoSplit=$("<p class='anno-split-line' style='position:relative; margin: 0 0 0 10px;top: 15px;'></p>");
this.undo=$("<div title='"+getLanguage("DrawToolWindow_Undo","Undo")+"' class='noteUndo noteBtn'><p class='note-svg'></p></div>");this.redo=$("<div title='"+getLanguage("DrawToolWindow_Redo","Redo")+"' class='noteRedo noteBtn'><p class='note-svg'></p></div>");this.exit=$("<div title='"+getLanguage("lblCancel","Cancel")+"' class='noteExit noteBtn'>"+getLanguage("lblCancel","Cancel")+"</div>");this.save=$("<div title='"+getLanguage("FlipPageEditor_SaveAndExit","SaveAndExit")+"' class='noteSave noteBtn'><p class='note-svg'></p></div>");
this.annoBtnBox.append(this.undo).append(this.redo).append(this.save).append(this.undoSplit).append(this.note).append(this.pen).append(this.rect).append(this.round).append(this.eraser).append(this.clear).append(this.exit);this.initBottomHtml();this.topBox.append(this.annoBtnBox);this.panel.append(this.bottomBox).append(this.topBox).append(this.exit);$("body").append(this.panel);this.setBtnSrc()},initBottomHtml:function(){this.selColor="#FDC606";this.eraserBox=$("<div class='eraserBox' style='display:none;margin:6px 0;width:100%;position:relative;'></div>");
this.eraserWidth=$("<span class='eraserWidth' style='font-size:13px;margin-left:15px;margin-right:5px;'>"+getLanguage("DrawToolWindow_Width","Width")+"</span>");this.eraserSlider=new PhoneAnnotationSlider(this.bottomBox,this.eraserBox,"eraserWidth",80,10,30);this.widthBox=$("<div class='widthBox' style='display:none;margin:6px 0;width:100%;position:relative;'></div>");this.setWidth=$("<span class='setWidth' style='font-size:13px;margin-left:15px;margin-right:5px;'>Width</span>");this.widthSlider=
new PhoneAnnotationSlider(this.bottomBox,this.widthBox,"width",30,1,3);this.alphaBox=$("<div class='alphaBox' style='display:none;margin:6px 0;width:100%;position:relative;'></div>");this.setAplha=$("<span class='setAplha' style='font-size:13px;margin-left:15px;margin-right:5px;'>Alpha</span>");this.alphaSlider=new PhoneAnnotationSlider(this.bottomBox,this.alphaBox,"alpha",100,0,100);this.colorBox=$("<div class='colorBox' style='position:relative;display:none;margin:6px 0;line-height:24px;height:24px;'></div>");
this.setColor=$("<span class='setColor'  style='font-size:13px;margin-left:15px;margin-right:5px;'>color</span>");this.inputColor=$("<input style='position:absolute;top:2px;outline: none;-webkit-appearance: none; -webkit-appearance: none;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);width:68px;display:none;height: 24px;line-height: 24px;padding:0 3px 0;margin-left:30px;border:none;border-radius:0;' value='"+this.selColor+"'/>");this.showColor=$("<div class='showColor' color='"+this.selColor+"' style='cursor:pointer;background:"+
this.selColor+";vertical-align:middle;display:inline-block;width:22px;height:22px;border:1px solid #ffffff;'></div>");this.showColorBox=$("<div style='position:absolute;top:2px;left:98px;display: inline-block;width: 24px;height: 24px;background: #fff;line-height: 18px;margin-left: 5px;border-radius:0px;'></div>");this.showColor.onTap(function(a){global.colorPanel&&global.colorPanel.showOrHide({e:a,elem:this.showColor,input:this.inputColor,closeAlpha:!0})}.bind(this));this.panel.onTap(function(){global.colorPanel&&
global.colorPanel.visible&&global.colorPanel.curElem[0]==this.showColor[0]&&global.colorPanel.hide()}.bind(this));this.showColorBox.append(this.showColor);this.eraserBox.append(this.eraserWidth).append(this.inputEraserWidth);this.widthBox.append(this.setWidth).append(this.inputWidth);this.alphaBox.append(this.setAplha).append(this.inputAlpha);this.colorBox.append(this.setColor).append(this.inputColor).append(this.showColorBox);this.bottomBox.append(this.eraserBox).append(this.widthBox).append(this.alphaBox).append(this.colorBox)},
setBtnSrc:function(){for(var a=[this.note,this.pen,this.rect,this.round,this.eraser,this.clear,this.undo,this.redo,this.save],b="note pen rect round eraser clear undo redo save".split(" "),c=0;c<a.length;c++)this.setSrc(a[c],phoneSvgIcons[b[c]])},setSrc:function(a,b){a.find(".note-svg").css({"pointer-events":"none",padding:"8px",width:"20px",height:"20px"}).html(b)},resizeSlider:function(){this.eraserSlider.onResize();this.widthSlider.onResize();this.alphaSlider.onResize()},selectCaseEvent:function(){this.defaultCaseEvent();
this.note.onTap(function(a){this.noteEvent()}.bind(this));this.pen.onTap(function(a){this.selectCase!=AnnotationPannel.PEN?(this.selectCase=AnnotationPannel.PEN,this.setPanelIndex(2,0,"auto"),isPhone()||isPad()?this.pen.css({background:"rgba(255,255,255,0.2)"}):this.pen.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.pen.css({background:"transparent"}),this.defaultBottomCase());this.eraserBox.css({display:"none"});this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});
this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("DrawToolWindow_Width","Width"));this.setAplha.text(getLanguage("DrawToolWindow_Alpha","Alpha"));this.setColor.text(getLanguage("DrawToolWindow_Color","Color"))}.bind(this));this.rect.onTap(function(a){this.selectCase!=AnnotationPannel.RECT?(this.selectCase=AnnotationPannel.RECT,this.setPanelIndex(2,3,"auto"),isPhone()||isPad()?this.rect.css({background:"rgba(255,255,255,0.2)"}):this.rect.css({background:"rgba(0,0,0,0.2)"}),
this.bottomBox.css({display:"block"})):(this.rect.css({background:"transparent"}),this.defaultBottomCase());this.eraserBox.css({display:"none"});this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("TStuff_BorderWidth","Width"));this.setAplha.text(getLanguage("TStuff_BorderAlph","Alpha"));this.setColor.text(getLanguage("TStuff_BorderColor","Color"))}.bind(this));this.round.onTap(function(a){this.selectCase!=
AnnotationPannel.ROUND?(this.selectCase=AnnotationPannel.ROUND,this.setPanelIndex(2,3,"auto"),isPhone()||isPad()?this.round.css({background:"rgba(255,255,255,0.2)"}):this.round.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.round.css({background:"transparent"}),this.defaultBottomCase());this.eraserBox.css({display:"none"});this.widthBox.css({display:"inline-block"});this.alphaBox.css({display:"inline-block"});this.colorBox.css({display:"inline-block"});this.setWidth.text(getLanguage("TStuff_BorderWidth",
"Width"));this.setAplha.text(getLanguage("TStuff_BorderAlph","Alpha"));this.setColor.text(getLanguage("TStuff_BorderColor","Color"))}.bind(this));this.eraser.onTap(function(a){this.selectCase!=AnnotationPannel.ERASER?(this.selectCase=AnnotationPannel.ERASER,this.setPanelIndex(2,0,"auto"),isPhone()||isPad()?this.eraser.css({background:"rgba(255,255,255,0.2)"}):this.eraser.css({background:"rgba(0,0,0,0.2)"}),this.bottomBox.css({display:"block"})):(this.eraser.css({background:"transparent"}),this.defaultBottomCase());
this.eraserBox.css({display:"inline-block"});this.widthBox.css({display:"none"});this.alphaBox.css({display:"none"});this.colorBox.css({display:"none"})}.bind(this));this.clear.onTap(function(a){a=BookInfo.getCurrentPages();this.selectCase=AnnotationPannel.NONE;this.setPanelIndex(0,0,"none");for(var b=0;b<a.length;b++){var c=this.book.find("#annotationCvsPanel"+a[b])[0].getContext("2d");c.beginPath();c.stroke();c.clearRect(0,0,this.pageWidth,this.pageHeight);c.closePath()}global.annotationCookie.setAllAnnoSteps(11,
a.map(function(d){return d-1}),[{type:"Clear"}]);global.annotationCookie.stepIndex+=1}.bind(this));this.exit.onTap(function(a){this.hide();a=BookInfo.getCurrentPages();for(var b=0;b<a.length;b++)global.annotationCookie.repaintCookie(this.pageWidth,this.pageHeight,a[b]-1);bookConfig.toolbarAlwaysShow&&toolBar&&!toolBar.visible&&toolBar.show()}.bind(this));this.save.onTap(function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(global.annotationCookie.saveCookie(),
2);b.hide();bookConfig.toolbarAlwaysShow&&toolBar&&!toolBar.visible&&toolBar.show();c.jumpToEnd()})}.bind(this));this.undo.onTap(function(a){this.setPanelIndex(0,0,"none");this.selectCase=AnnotationPannel.NONE;--global.annotationCookie.stepIndex;0>=global.annotationCookie.stepIndex&&(global.annotationCookie.stepIndex=0);global.annotationCookie.repaintSteps()}.bind(this));this.redo.onTap(function(a){this.setPanelIndex(0,0,"none");this.selectCase=AnnotationPannel.NONE;global.annotationCookie.stepIndex+=
1;global.annotationCookie.stepIndex>=global.annotationCookie.allAnnoSteps.length&&(global.annotationCookie.stepIndex=global.annotationCookie.allAnnoSteps.length);global.annotationCookie.repaintSteps()}.bind(this))},defaultCaseEvent:function(){this.annoBtnBox.find("div").onTap(function(a){a=a.target;if("p"==a.tagName.toLowerCase()||"img"==a.tagName.toLowerCase())a=$(a).parent();$(a).siblings("div").css({background:"transparent"})}.bind(this))},initCss:function(){this.mainColor=Color(bookConfig.formBackgroundColor?
bookConfig.formBackgroundColor:bookConfig.toolbarColor).toString();this.fontColor=Color(bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor).toString();this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor);this.panel.css({background:this.mainColorObj.toString(),display:"none",position:"absolute",width:"100%",height:"auto","border-radius":"1px",bottom:"0",left:"0px","z-index":"99"});this.topBox.css({"-webkit-overflow-scrolling":"touch",width:"100%","text-align":"center",
"overflow-x":"scroll",position:"relative",border:"1px solid rgba(255,255,255,0.25)","border-left":"none","border-right":"none",background:this.mainColorObj.toString()});this.annoBtnBox.css({display:"inline-block",width:"516px",padding:"5px 0","text-align":"center",position:"relative",height:"52px",top:"0",left:"0"});this.bottomBox.css({display:"none","vertical-align":"middle",left:"0",background:this.mainColorObj.toString(),color:"#fff",border:"1px solid rgba(0, 0, 0, 0.1)","font-family":"Tahoma , sans-serif , Arial",
position:"relative",padding:"5px"});this.note.css({cursor:"pointer",position:"relative",float:"left",width:"36px",height:"36px",top:"10px"});this.pen.css({cursor:"pointer",width:"36px",height:"36px",position:"relative",float:"left",top:"10px"});this.rect.css({cursor:"pointer",width:"36px",height:"36px",position:"relative",float:"left",top:"10px"});this.round.css({cursor:"pointer",width:"36px",height:"36px",position:"relative",float:"left",top:"10px"});this.eraser.css({cursor:"pointer",position:"relative",
float:"left",width:"36px",height:"36px",top:"10px"});this.clear.css({cursor:"pointer",position:"relative",float:"left",width:"36px",height:"36px",top:"10px"});this.undo.css({cursor:"pointer",position:"relative",float:"left",width:"36px",height:"36px",top:"10px"});this.redo.css({cursor:"pointer",position:"relative",float:"left",width:"36px",height:"36px",top:"10px"});this.save.css({cursor:"pointer",position:"relative",float:"left",width:"36px",height:"36px",top:"10px"});this.exit.css({cursor:"pointer",
position:"relative",float:"left","text-align":"center",width:"100%",height:"40px","line-height":"40px",color:"#fff"})},onResize:function(){this.initPageConfig();this.book=BookInfo.getBook().showPage;this.alphaSlider.onResize();this.widthSlider.onResize();this.eraserSlider.onResize()},showOrHide:function(){this.visible?this.hide():this.show()},resetAnnoConfig:function(){this.clearBtnDownCase();this.defaultBottomCase();global.annotationCookie&&global.annotationCookie.clearUnsaveCookie()},show:function(){var a=
transformCSS({origin:{x:0,y:0},tran:{x:0,y:240},scale:1}),b=transformCSS({origin:{x:0,y:0},tran:{x:0,y:0},scale:1});this.panel.css({display:"block"}).css(a);setTimeout(function(){animateOnce(this.panel,b,300,function(){global.toolBar&&(global.toolBar.hide(),global.toolBar.showExtendedBar=!1);this.visible=!0;this.setA11y()}.bind(this),"%stransform")}.bind(this),10)},hide:function(){var a=transformCSS({origin:{x:0,y:0},tran:{x:0,y:240},scale:1});global.toolBar&&!bookConfig.toolbarAlwaysShow&&global.toolBar.hide();
animateOnce(this.panel,a,300,function(){this.resetAnnoConfig();this.visible=!1;this.panel.css({display:"none"})}.bind(this),"%stransform")}}).extend("AnnotationPannel"),PhoneAnnotationSlider=Class({create:function(a,b,c,d,e,g){this.maxNum=d;this.maxWidth=windowWidth-140;this.minLeft=102;this.maxLeft=windowWidth-38;this.slider=$("<div class='"+c+"Slider' style='-webkit-tap-highlight-color: transparent;outline: none;position:absolute;z-index:0;cursor:pointer;left:"+this.minLeft+"px;top:8px;width:"+
this.maxWidth+"px;height:2px;border-radius: 2px;border:2px solid transparent;'></div>");this.sliderBg=$("<div class='"+c+"SliderBg' style='z-index:0;pointer-events:none; position:absolute;cursor:pointer;width:100%;height:2px;background:#777777;border-radius: 2px;'></div>");this.sliderEnter=$("<div class='"+c+"SliderEnter' style='pointer-events:none;z-index:1;pointer-events:none;position:absolute;left:0;width:"+g/this.maxNum*this.maxWidth+"px;height:2px;background:#fff;border-radius: 2px;'></div>");
this.pointer=$("<div class='"+c+"SliderPointer' style='z-index:2;cursor:pointer;position:absolute;left:"+(g/this.maxNum*this.maxWidth-8)+"px;top:-9px;width:16px;height:16px;border:2px solid transparent;'><span style='border-radius: 50%;background: #ffffff;pointer-events:none;position:absolute;width:16px;height:16px;'></span></div>");this.number=g;this.numberBubble=$("<div style='pointer-events:none;display:none;position:absolute;background:#ffffff;color:#111;border-radius:3px;box-shadow:0 0 2px #000;top:-36px;width:28px;height:24px;'><div style='position: absolute;border: 8px solid #fff;border-right: 6px solid transparent;border-bottom: 8px solid transparent;border-left: 6px solid transparent;bottom: -16px;left: 8px;'></div><p class='bubbleNum' style='width:100%;line-height:24px;line-height: 24px;text-align: center;'>"+
this.number+"</p></div>");this.slider.append(this.sliderEnter).append(this.pointer).append(this.sliderBg);b.append(this.slider).append(this.numberBubble);var f=!1,h=0,k={x:0,y:0},l={x:0,y:0};this.pointer.bind(_event._down,function(m){f=!0}.bind(this));this.slider.bind(_event._down,function(m){$(m.target)==this.pointer[0]&&(f=!0);k=getPositionFromEvt(m);k.x<=this.minLeft&&(k.x=this.minLeft);k.x>=this.maxLeft&&(k.x=this.maxLeft);f?this.numberBubble.css({display:"block"}).css({left:this.pointer.left()+
this.minLeft-3+"px"}):(number=Math.ceil((k.x-this.minLeft-16)/this.maxWidth*this.maxNum),this.numberBubble.css({display:"block"}).css({left:k.x-17+"px"}).find(".bubbleNum").html(this.getNumber(k.x-this.minLeft-17,this.maxWidth,e,this.maxNum)),this.pointer.animate({left:k.x-this.minLeft-17+"px"},"normal",function(){this.numberBubble.css({display:"none"})}.bind(this)),this.sliderEnter.animate({width:k.x-this.minLeft-7+"px"}));l=k}.bind(this));a.bind(_event._move,function(m){if(f){l=getPositionFromEvt(m);
l.x<=this.minLeft&&(l.x=this.minLeft);l.x>=this.maxLeft&&(l.x=this.maxLeft);var n=l.x-k.x;h=this.pointer.left()+n;h=-8>h?-8:h>this.maxWidth-8?this.maxWidth-8:h;m.preventDefault();this.numberBubble.css({left:h+this.minLeft-3+"px"}).find(".bubbleNum").html(this.getNumber(l.x-this.minLeft,this.maxWidth,e,this.maxNum));this.pointer.css({left:h+"px"});this.sliderEnter.css({width:h+4+"px"});k=l}k=l}.bind(this));a.bind(_event._up,function(m){k=l;this.numberBubble.css({display:"none"});f&&(f=!1,h&&l&&(this.numberBubble.css({left:h+
this.minLeft-4+"px"}).find(".bubbleNum").html(this.getNumber(l.x-this.minLeft,this.maxWidth,e,this.maxNum)),this.pointer.css({left:h+"px"}),this.sliderEnter.css({width:h+4+"px"}),h=0))}.bind(this))},onResize:function(){this.maxWidth=windowWidth-140;this.minLeft=102;this.maxLeft=windowWidth-38;this.slider.css({width:this.maxWidth+"px"});var a=1*this.numberBubble.find(".bubbleNum").text()/this.maxNum*this.maxWidth;this.numberBubble.css({left:a+"px"});this.pointer.css({left:a-8+"px"});this.sliderEnter.css({width:a-
4+"px"})},getNumber:function(a,b,c,d){a=Math.ceil(a/b*d);a<=c&&(a=c);a>=d&&(a=d);return a}}),PictureListFrame=Class({create:function(a){this.currentPageIndex=BookInfo.getCurrentPageIndex()||1;this.imageWidth=100;this.callback=a;this.leftButtonUrl=form_icons.print_left?"data:image/png;base64,"+form_icons.print_left:uiBaseURL+"print_left.png";this.rightButtonUrl=form_icons.print_right?"data:image/png;base64,"+form_icons.print_right:uiBaseURL+"print_right.png";this.initDefaultDom();this.initHtml();this.initEvent();
this.fillContent(this.currentPageIndex)},initDefaultDom:function(){this.thumbnail=$("<div class='thumbnail'></div>");this.page=$("<div class='page'></div>");this.image=$("<img/>");this.noThumbBg=$("<div style='display:none;margin: 0 auto;background:"+bookConfig.pageBackgroundColor+";width:100px;height:130px;'></div>");this.leftBtn=$("<img class='leftBtn btn button_hover' src='"+this.leftButtonUrl+"'/>");this.rightBtn=$("<img class='rightBtn btn button_hover' src='"+this.rightButtonUrl+"'/>");this.thumbnail.append(this.noThumbBg).append(this.image);
this.thumbnail.append(this.page)},resetBtnSrc:function(){this.leftBtn.attr("src",this.leftButtonUrl);this.rightBtn.attr("src",this.rightButtonUrl)},initEvent:function(){this.leftBtn.bind(_event._click,function(){this.fillContent(this.currentPageIndex-1)}.bind(this));this.rightBtn.bind(_event._click,function(){this.fillContent(this.currentPageIndex+1)}.bind(this))},fillContent:function(a){if(!(1>a||a>bookConfig.totalPageCount)){1==a?this.leftBtn.css({opacity:"0.4",cursor:"auto"}):this.leftBtn.css({opacity:"1",
cursor:"pointer"});a==bookConfig.totalPageCount?this.rightBtn.css({opacity:"0.4",cursor:"auto"}):this.rightBtn.css({opacity:"1",cursor:"pointer"});this.currentPageIndex=a;var b=function(c,d){c.match(/^none/)?(this.noThumbBg.css({display:"block"}),this.image.css({display:"none"})):(this.image.attr("src",c),this.noThumbBg.css({display:"none"}),this.image.css({display:"inline-block",width:this.imageWidth+"px",height:"130px",objectFit:"contain"}))}.bind(this);pageResourceLoad(a,"thumb",b);this.fillPage(a);
this.callback&&this.callback(a)}},fillPage:function(a){this.page.html(a+"/"+bookConfig.totalPageCount)},getPageIndex:function(){return this.currentPageIndex}}),PictureListForm=Class({initHtml:function(){this.stage=$("<div class='pictureList_win10'></div>");this.stage.append(this.thumbnail);1<bookConfig.totalPageCount&&(this.stage.append(this.leftBtn),this.stage.append(this.rightBtn))},getDom:function(){return this.stage}}).extend(PictureListFrame),AnalysisPrint=Class({create:function(a){this.printArea=
$("<div class='print-area' style='width:100%;height:100%;position:absolute;left:0;top:0;'></div>");this.button=a;this.initPrintEvent()},getImageSizeForMM:function(a,b){return a/210>=b/297?{width:210,height:Math.floor(210*b/a)}:{width:Math.floor(297*a/b),height:297}},getImageSizeForInches:function(a,b){return a/7.18>=b/10.61?{width:7.18,height:Number.fixed(7.18*b/a,2)}:{width:Number.fixed(10.61*a/b,2),height:10.61}},getImageSizeForIE:function(a,b){return a/8>=b/11.3?{width:8,height:Number.fixed(8*
b/a,2)}:{width:Number.fixed(11.3*a/b,2),height:11.3}},loadWatermark:function(){var a=this;return new Promise(function(b,c){var d=$("<img src = '"+bookConfig.printWatermarkFile+"'/>");d.on("load",function(){b()});d.on("error",function(){c()});a.$watermark=d})},printPages:function(a){var b=this,c,d,e,g,f,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:if(!a||!a.length||!parseBool(bookConfig.PrintButtonVisible))return k.return();b.initLoadPrint();c=0;b.printArea.empty();
b.printArray=[];d=function(l,m,n,p){var q=$("<div style='position:relative;width:100%;height:100%;'></div>"),r=$(n);l&&-1<l.indexOf("none")&&!l.startsWith("data:image")&&m&&0>m.indexOf("none")&&(r=$(m));void 0===p&&(p=n);q.append(r);parseBool(bookConfig.PrintButtonVisible)&&""!=bookConfig.printWatermarkFile&&($watermark=this.$watermark,$watermark.css({"z-index":"201",position:"absolute",maxWidth:"80px",maxHeight:"80px",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}),q.append($watermark),this.getImageSizeForInches($watermark[0].naturalWidth,
$watermark[0].naturalHeight));$(r).parent().css({"text-align":"center",width:"100%",height:"100%"});r.css({"text-align":"center","max-width":"100%","max-height":"100%"});"stretch"===bookConfig.printBackgroundPosition?r.css({width:"100%",height:"100%"}):"fill"===bookConfig.printBackgroundPosition?r.css({width:"100%",height:"100%","object-fit":"cover"}):$(r).parent().css({display:"flex","justify-content":"center","align-items":"center"});this.printArray[p]=q;c++;if(c==a.length){for(l=1;l<this.printArray.length;l++)this.printArray[l]&&
this.printArea.append(this.printArray[l]);this.printArea.printArea({onReady:this.hidePrintLoading.bind(this)})}};if(!bookConfig.printWatermarkFile){k.jumpTo(2);break}k.setCatchFinallyBlocks(3);return k.yield(b.loadWatermark(),5);case 5:k.leaveTryBlock(2);break;case 3:k.enterCatchBlock();case 2:e=BookInfo.getBook().pageWidth;g=BookInfo.getBook().pageHeight;f={};for(h=0;h<a.length;f={$jscomp$loop$prop$page$2:f.$jscomp$loop$prop$page$2},h++)f.$jscomp$loop$prop$page$2=a[h],getPageDir(f.$jscomp$loop$prop$page$2,
"normal").then(function(l){return function(m){var n=e,p=g;if(bookConfig.normalSuffix&&"zip"===bookConfig.normalSuffix||-1<m.indexOf("zip"))window.printLoadStack||b.initPrintStack(a),n=2*e,p=2*g;"object"!=typeof m&&m.match(/none/)?b.getPrintImgType(l.$jscomp$loop$prop$page$2).then(function(q){pageResourceLoad(l.$jscomp$loop$prop$page$2,q,d.bind(b),n,p)}):pageResourceLoad(l.$jscomp$loop$prop$page$2,"normal",d.bind(b),n,p)}}(f));k.jumpToEnd()}})},getPrintImgType:function(a){var b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==
e.nextAddress)return b="normal",e.yield(getPageDir(a,"thumb"),2);if(3!=e.nextAddress)return c=e.yieldResult,e.yield(getPageDir(a,"previewPage"),3);d=e.yieldResult;c.match(/none/)?d.match(/none/)||(b="previewPage"):b="thumb";return e.return(b)})},getPages:function(a){if("all"==a){a=[];for(var b=1;b<=bookConfig.totalPageCount;b++)a.push(b);return a}return"current"==a?BookInfo.getCurrentPages():getPagesByRange(a)},initPrintEvent:function(){this.button.bind(_event._click,function(a){this.printType=this.button.printType;
switch(this.printType){case "printAll":var b=this.getPages("all");this.printPages(b);break;case "printCurrent":b=this.getPages("current");this.printPages(b);break;case "printRange":a=$("#print_range_num").val();if(0>=parseInt(a))return;b=this.getPages(a);this.printPages(b)}BookEvent.trigger("print",[BookInfo.getCurrentPageIndex(),"printAll"==this.printType?"all":b.join(","),this.printType])}.bind(this))},initPrintStack:function(a){window.printLoadStack&&(window.printLoadStack.destroy(),window.printLoadStack=
null);window.printLoadStack||(window.printLoadStack=new PdfLoadArray(a.length))},initLoadPrint:function(){this.printLoad||(this.printLoad=$("<div class='posterContainer'></div>"),this.printLoad.css({display:"none","z-index":"1001",position:"absolute",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(11,11,11,0.7)"}),this.printLoad.bind("click",function(a){a.stopPropagation();window.printLoadStack&&window.printLoadStack.destroy();this.hidePrintLoading()}.bind(this)),this.loadingIcon=$("<img style='position:absolute;transform : translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);left : 50%;top : 50%;z-index:1112' src='"+
uiBaseURL+"loading.gif' />"),this.printLoad.append(this.loadingIcon),tmpContainer.append(this.printLoad));this.showPrintLoading()},showPrintLoading:function(){this.printLoad&&this.printLoad.fadeIn(200)},hidePrintLoading:function(){this.printLoad&&this.printLoad.fadeOut(200)}}),PrintElements=Class({create:function(a){this._super(a);this.printOnUrl=form_icons.print_on?"data:image/png;base64,"+form_icons.print_on:uiBaseURL+"print_on.png";this.printOffUrl=form_icons.print_off?"data:image/png;base64,"+
form_icons.print_off:uiBaseURL+"print_off.png";this.initElements();this.initEvent(a);this.pickElements(a)},initElements:function(){this.rightToLeft?(this.printAll=$("<div class='printAll item button' print='printAll'><span class='title'>"+getLanguage("frmPrintall","Print All Pages")+"</span><img src='"+this.printOffUrl+"'/></div>"),this.printCurrent=$("<div class='printCurrent item on button' print='printCurrent'><span class='title'>"+getLanguage("frmPrintcurrent","Print Current Pages")+"</span><img src='"+
this.printOnUrl+"'/></div>"),this.printRange=$("<div class='printRange item button' print='printRange'><input id='print_range_num' dir='rtl' placeholder='"+getLanguage("frmPrintexample","Exzample:1,3-7,12")+"'></input><span class='title'>"+getLanguage("frmPrintRange","Print Range")+"</span><img src='"+this.printOffUrl+"'/></div>")):(this.printAll=$("<div class='printAll item button' print='printAll'><img src='"+this.printOffUrl+"'/><span class='title'>"+getLanguage("frmPrintall","Print All Pages")+
"</span></div>"),this.printCurrent=$("<div class='printCurrent item on button' print='printCurrent'><img src='"+this.printOnUrl+"'/><span class='title'>"+getLanguage("frmPrintcurrent","Print Current Pages")+"</span></div>"),this.printRange=$("<div class='printRange item button' print='printRange'><img src='"+this.printOffUrl+"'/><span class='title'>"+getLanguage("frmPrintRange","Print Range")+"</span><input id='print_range_num' placeholder='"+getLanguage("frmPrintexample","Example:1,3-7,12")+"'></input></div>"));
this.printButton=$("<div class='printButton title button'>"+getLanguage("frmPrintbtn","Print")+"</div>");this.printButton.printType="printCurrent";this.analysis=new AnalysisPrint(this.printButton);this.pictureListForm=new PictureListForm},pickElements:function(a){a.printOnUrl=this.printOnUrl;a.printOffUrl=this.printOffUrl;a.printAll=this.printAll;a.printCurrent=this.printCurrent;a.printRange=this.printRange;a.printButton=this.printButton;a.pictureListForm=this.pictureListForm},initEvent:function(a){this.printAll.click(function(b){this.buttonEvent(a,
b.delegateTarget)}.bind(this));this.printCurrent.click(function(b){this.buttonEvent(a,b.delegateTarget)}.bind(this));this.printRange.click(function(b){this.buttonEvent(a,b.delegateTarget)}.bind(this));this.printRange.find("input").on("input propertychange change",function(){this.refreshPrintButton()}.bind(this));this.printRange.find("input").bind("mousedown touchstart pointerdown mouseover mousemove touchmove touchstend",function(b){b.stopPropagation()})},buttonEvent:function(a,b){var c=a.stage.find(".on");
c.find("img").attr("src",this.printOffUrl);c.find("img")[0].colorChanged=!1;c.removeClass("on");$(b).find("img").attr("src",this.printOnUrl);$(b).find("img")[0].colorChanged=!1;$(b).addClass("on");b=$(b).attr("print");a.printButton.printType=b;this.refreshPrintButton();a.changeItemColor()},refreshPrintButton:function(){"printRange"!=this.printButton.printType||$("#print_range_num").val()?this.lightPrintButton():this.darkPrintButton()},lightPrintButton:function(){$(this.printButton).addClass("usable");
$(this.printButton).removeClass("disable");$(this.printButton).addClass("button_hover")},darkPrintButton:function(){"printRange"==this.printButton.printType&&($(this.printButton).removeClass("usable"),$(this.printButton).removeClass("button_hover"),$(this.printButton).addClass("disable"))},changeLanguage:function(){this.printAll.find(".title").html(getLanguage("frmPrintall","Print All Pages"));this.printCurrent.find(".title").html(getLanguage("frmPrintcurrent","Print Current Pages"));this.printRange.find(".title").html(getLanguage("frmPrintRange",
"Print Range"));this.printRange.find("#print_range_num").attr("placeholder",getLanguage("frmPrintexample","Exzample:1,3-7,12"));this.printButton.html(getLanguage("frmPrintbtn","Print"))}}).extend(FormElements),PhonePrintElements=Class({create:function(a){this._super(a);this.printOnUrl=phoneBaseURL+"print_on_phone.png";this.printOffUrl=phoneBaseURL+"print_off_phone.png";this.fontColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.initElements();this.initEvent(a);
this.pickElements(a)},initElements:function(){this.rightToLeft?(this.printAll=$("<div class='printAll item button' print='printAll'><span class='title'>"+getLanguage("frmPrintall","Print All Pages")+"</span><div class='print_icon'>"+this.getOffIcon()+"</div></div>"),this.printCurrent=$("<div class='printCurrent item on button' print='printCurrent'><span class='title'>"+getLanguage("frmPrintcurrent","Print Current Pages")+"</span><div class='print_icon'>"+this.getOnIcon()+"</div></div>"),this.printRange=
$("<div class='printRange item button' print='printRange'><div class='print_icon'>"+this.getOffIcon()+"</div><input id='print_range_num' dir='rtl' placeholder='"+getLanguage("frmPrintexample","Exzample:1,3-7,12")+"'></input><span class='title'>"+getLanguage("frmPrintRange","Print Range")+"</span></div>")):(this.printAll=$("<div class='printAll item button' print='printAll'><div class='print_icon'>"+this.getOffIcon()+"</div><span class='title'>"+getLanguage("frmPrintall","Print All Pages")+"</span></div>"),
this.printCurrent=$("<div class='printCurrent item on button' print='printCurrent'><div class='print_icon'>"+this.getOnIcon()+"</div><span class='title'>"+getLanguage("frmPrintcurrent","Print Current Pages")+"</span></div>"),this.printRange=$("<div class='printRange item button' print='printRange'><div class='print_icon'>"+this.getOffIcon()+"</div><span class='title'>"+getLanguage("frmPrintRange","Print Range")+"</span><input id='print_range_num' placeholder='"+getLanguage("frmPrintexample","Example:1,3-7,12")+
"'></input></div>"));this.printButton=$("<div class='printButton title button' role='button'>"+getLanguage("frmPrintbtn","Print")+"</div>");this.printButton.printType="printCurrent";this.analysis=new AnalysisPrint(this.printButton);this.pictureListForm=new PictureListForm},getOffIcon:function(){return'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="\u9365\u60e7\u7730_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 48 48" style="enable-background:new 0 0 48 48;" xml:space="preserve"><path fill='+
this.fontColor+' d="M23.6,8.3c-8.8,0-16,7.2-16,16c0,8.8,7.2,16,16,16c8.8,0,16-7.2,16-16S32.4,8.3,23.6,8.3L23.6,8.3z M23.6,38.3c-7.7,0-14-6.3-14-14c0-7.7,6.3-14,14-14c7.7,0,14,6.3,14,14C37.6,32.1,31.3,38.3,23.6,38.3L23.6,38.3z"/></svg>'},getOnIcon:function(){return'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="\u9365\u60e7\u7730_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 48 48" style="enable-background:new 0 0 48 48;" xml:space="preserve"><path fill='+
this.fontColor+' class="st0" d="M32.3,20.2L21.4,31.1c-0.2,0.2-0.6,0.2-0.8-0.1l-0.7-0.7c0,0,0,0,0,0L15,25.4c-0.2-0.2-0.2-0.6,0-0.9l1.3-1.3c0.2-0.2,0.6-0.2,0.9,0L21,27l9-9c0.2-0.2,0.6-0.2,0.8,0.1l1.3,1.3C32.4,19.7,32.5,20,32.3,20.2z"/><path class="st0" d="M23.6,8.3c-8.8,0-16,7.2-16,16c0,8.8,7.2,16,16,16c8.8,0,16-7.2,16-16S32.4,8.3,23.6,8.3L23.6,8.3z M23.6,38.3c-7.7,0-14-6.3-14-14c0-7.7,6.3-14,14-14c7.7,0,14,6.3,14,14C37.6,32.1,31.3,38.3,23.6,38.3L23.6,38.3z"/></svg>'},buttonEvent:function(a,b){var c=
a.stage.find(".on");c.find(".print_icon").html(this.getOffIcon());c.removeClass("on");$(b).find(".print_icon").html(this.getOnIcon());$(b).addClass("on");b=$(b).attr("print");a.printButton.printType=b;this.refreshPrintButton()}}).extend(PrintElements),PcPrintFrame=Class({create:function(a){this.elements=new PrintElements(this);this._super(a)},onCreate:function(){this.initColorCss();this._super()},initColorCss:function(){this.stage.css({"background-color":this.mainColorObj.rgba(this.formOpacity),color:this.fontColor})},
initHtml:function(){this._super()},appendPrintOptions:function(a){this.emptyTips=$('<div><span class="empty-printoptions-tips" >'+getLanguage("emptyPrintOptionsTips","No printing options.")+"</span></div>");this.emptyTips.css({height:"150px",width:"100%",display:"flex","align-items":"center","justify-content":"center","font-size":"20px"});a=a||this.stage;bookConfig.printOptions&&0<bookConfig.printOptions.length?(0<=bookConfig.printOptions.indexOf("all")&&a.append(this.printAll),0<=bookConfig.printOptions.indexOf("current")&&
a.append(this.printCurrent),0<=bookConfig.printOptions.indexOf("range")&&a.append(this.printRange),a.append(this.printButton)):a.append(this.emptyTips)},changeIconColor:function(){this._super();this.pictureListForm.leftBtn.changeButtonColor(this.fontColor);this.pictureListForm.rightBtn.changeButtonColor(this.fontColor);this.changeItemColor()},resetColorChanged:function(){this._super();this.printAll.find("img")[0].colorChanged=!1;this.printCurrent.find("img")[0].colorChanged=!1;this.printRange.find("img")[0].colorChanged=
!1;this.pictureListForm&&(this.pictureListForm.leftBtn[0].colorChanged=!1,this.pictureListForm.rightBtn[0].colorChanged=!1)},resetIconSrc:function(){this._super();this.stage.find(".item").find("img").attr("src",this.elements.printOffUrl);this.stage.find(".on").find("img").attr("src",this.elements.printOnUrl);this.pictureListForm&&this.pictureListForm.resetBtnSrc()},changeItemColor:function(){this.printCurrent.changeButtonColor(this.fontColor);this.printRange.changeButtonColor(this.fontColor);this.printAll.changeButtonColor(this.fontColor)},
onShow:function(){this.changeIconColor()}}).extend(FadeOutFadeForm),PhonePrintForm=Class({create:function(a){this.elements=new PhonePrintElements(this);this._super(a)},onCreate:function(){this.printAll.css({"background-color":this.fontColor,color:this.mainColor});this.printCurrent.css({"background-color":this.fontColor,color:this.mainColor});this.printRange.css({"background-color":this.fontColor,color:this.mainColor});this.printButton.css({"background-color":this.fontColor,color:this.mainColor});
this.favicon&&this.favicon.changeButtonColor(this.fontColor);this._super()},initHtml:function(){this.title.append(this.close);this.stage.append(this.title);this.appendPrintOptions()},changeItemColor:function(){},onShow:function(){this.favicon&&this.favicon.changeButtonColor(this.fontColor)},initEvent:function(){},appendPrintOptions:function(){this.emptyTips=$('<div><span class="no-files-prompt" >'+getLanguage("emptyPrintOptionsTips","No printing options.")+"</span></div>");this.emptyTips.css({height:"150px",
width:"100%",display:"flex","align-items":"center","justify-content":"center","font-size":"20px"});var a=this.stage;bookConfig.printOptions&&0<bookConfig.printOptions.length?(0<=bookConfig.printOptions.indexOf("all")&&a.append(this.printAll),0<=bookConfig.printOptions.indexOf("current")&&a.append(this.printCurrent),0<=bookConfig.printOptions.indexOf("range")&&a.append(this.printRange),a.append(this.printButton)):a.append(this.emptyTips)}}).extend(PhoneFormFrame),DownloadElements=Class({create:function(a){this._super(a);
this.downloadOnUrl=form_icons.print_on?"data:image/png;base64,"+form_icons.print_on:uiBaseURL+"print_on.png";this.downloadOffUrl=form_icons.print_off?"data:image/png;base64,"+form_icons.print_off:uiBaseURL+"print_off.png";this.initConfig();this.initElements();this.initEvent(a);this.pickElements(a);bookConfig.isEncryptionBook&&!BookRestrict.open&&this.setRestrictMode()},initConfig:function(){this.downloadconfig=window.downloadconfig},initElements:function(){this.rightToLeft?(this.downloadAll=$("<div class='buttondownloadAll item' download='downloadAll'><span class='title'>"+
getLanguage("DownloadFullPublication","Full Publication")+"</span><img src='"+this.downloadOffUrl+"'/></div>"),this.downloadCurrent=$("<div class='button downloadCurrent item' download='downloadCurrent'><span class='title'>"+getLanguage("DownloadCurrentPage","Current Page")+" </span><span class='page'>"+this.pageIndex+"</span><img src='"+this.downloadOffUrl+"'/></div>"),this.downloadAttachments=$("<div class='button downloadAttachments item' download='downloadAttachments'><span class='title'>"+getLanguage("DownloadAttachedFiles",
"Attached Files")+"</span><img src='"+this.downloadOffUrl+"'/></div>")):(this.downloadAll=$("<div class='button downloadAll item' download='downloadAll'><img src='"+this.downloadOffUrl+"'/><span class='title'>"+getLanguage("DownloadFullPublication","Full Publication")+"</span></div>"),this.downloadCurrent=$("<div class='button downloadCurrent item' download='downloadCurrent'><img src='"+this.downloadOffUrl+"'/><span class='title'>"+getLanguage("DownloadCurrentPage","Current Page")+"</span><span class='page'>"+
this.pageIndex+"</span></div>"),this.downloadAttachments=$("<div class='button downloadAttachments item' download='downloadAttachments'><img src='"+this.downloadOffUrl+"'/><span class='title'>"+getLanguage("DownloadAttachedFiles","Attached Files")+"</span></div>"));this.downloadButton=$("<div class='button downloadButton title button_hover'>"+getLanguage("btnDownload","Download")+"</div>");this.restrictedTips=$("<div class='download-restricted-tips'>*"+getLanguage("downloadRestrictionTips","English"==
UserGroups?"Download access for this book is restricted by the publisher.":"\u89e3\u9664\u9605\u8bfb\u9650\u5236\u540e\u624d\u80fd\u4e0b\u8f7d\u3002")+"</div>");this.restrictedTips.css({color:"#ff6d6d","line-height":"14px","margin-top":"8px","text-align":"left"});this.noFilesAvailablePrompt=$('<div><span class="no-files-prompt" >'+getLanguage("noFilesAvailablePrompt","No Files Available!")+"</span></div>");this.noFilesAvailablePrompt.css({height:"100%",width:"100%",display:"flex","align-items":"center",
"justify-content":"center","font-size":"20px"});this.downloadingTips=$("<div class='download-loading-tips'>"+getLanguage("downloadingTips","English"===UserGroups?"Downloading...":"\u6b63\u5728\u4e0b\u8f7d\uff0c\u8bf7\u7a0d\u7b49...")+"</div>");this.downloadingTips.css({color:Color(bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor).toString(),padding:"0 20px"});this.downloadButton.downloadType=downloadconfig.hideDownloadSinglePage?downloadconfig.pdf?"downloadAll":"downloadAttachments":
"downloadCurrent";this[this.downloadButton.downloadType].find("img").attr("src",this.downloadOnUrl);this[this.downloadButton.downloadType].addClass("on");this.selectAttachments=$("<select></select>");this.selectAttachments.css({display:"downloadAttachments"===this.downloadButton.downloadType?"inline-block":"none"});var a=this.downloadconfig.attachments;if(a&&0<a.length){for(var b=0;b<a.length;b++){var c=a[b];this.selectAttachments.append($("<option value='"+c.file+"'>"+c.name+"</option>"))}var d=
this;this.currentAttachmentName=this.selectAttachments.find("option")[0].innerText;this.selectAttachments.on("change",function(){d.currentAttachmentName=this.options[this.selectedIndex].innerText})}this.pictureListForm=new PictureListForm(this.gotoPage.bind(this));this.pageIndex=this.pictureListForm.getPageIndex()},setRestrictMode:function(){var a=this;this.downloadButton.removeClass("button_hover");this.downloadButton.addClass("disable");BookEvent.bindEvent("fillBookRestrict",function(b,c){c&&a.removeRestrictMode()})},
removeRestrictMode:function(){this.downloadButton.removeClass("disable");this.downloadButton.addClass("button_hover");this.restrictedTips&&this.restrictedTips.remove()},gotoPage:function(a){this.pageIndex=a;this.downloadCurrent.find(".page").html(a)},pickElements:function(a){a&&(a.downloadAll=this.downloadAll,a.downloadCurrent=this.downloadCurrent,a.downloadAttachments=this.downloadAttachments,a.selectAttachments=this.selectAttachments,a.downloadButton=this.downloadButton,a.pictureListForm=this.pictureListForm,
a.noFilesAvailablePrompt=this.noFilesAvailablePrompt,a.restricted=this.restricted,a.restrictedTips=this.restrictedTips)},get restricted(){return bookConfig.isEncryptionBook&&!BookRestrict.open},initEvent:function(a){var b=this;this.downloadAll.click(function(c){this.buttonEvent(a,c.delegateTarget)}.bind(this));this.downloadCurrent.click(function(c){this.buttonEvent(a,c.delegateTarget)}.bind(this));this.downloadAttachments.click(function(c){this.buttonEvent(a,c.delegateTarget)}.bind(this));this.verify=
!1;this.downloadButton.click(function(){var c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(b.restricted)return d.return();c=function(){var e,g,f,h,k,l,m,n,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){if(1==q.nextAddress)return b.verify=!0,e="","downloadAll"==b.downloadButton.downloadType&&(e=b.downloadconfig.pdf.url),"downloadCurrent"!=b.downloadButton.downloadType?q.jumpTo(2):q.yield(getPageDir(b.pageIndex,"normal"),3);2!=q.nextAddress&&(e=q.yieldResult);
"downloadAttachments"==b.downloadButton.downloadType&&(e=b.selectAttachments[0].value);if("object"==typeof e)if("downloadCurrent"==b.downloadButton.downloadType)b.loadImage(e,function(r,t){r=$("<a href='"+t.toDataURL("image/png")+"' download=\"page"+b.pageIndex+'.png">\n                </a>');r[0].click();r.remove()});else for(g=0;g<e.length;g++)f=e[g],bookConfig.isEncryptionBook||(f=f.removeStartFrom("?")),window.open(f,"_blank");else if("string"==typeof e&&-1<e.indexOf(".zip")&&"downloadAttachments"!==
b.downloadButton.downloadType)b.downloadPdfLoadingTask&&(b.downloadPdfLoadingTask.pause(),b.downloadPdfLoadingTask.destroy()),b.downloadPdfLoadingTask=new PdfLoadingTask(b.pageIndex,"normal",windowWidth,windowHeight,function(r){r=$("<a href="+r.toDataURL("image/png")+' download="page'+this.pageIndex+'.png"></a>');r[0].click();r.remove()}.bind(b)),b.downloadPdfLoadingTask.start();else if(-1<e.indexOf(".js"))pageResourceLoad(b.pageIndex,"normal",function(r,t,u,v){r=$("<a href="+r+' download="page'+
this.pageIndex+'.png"></a>');r[0].click();r.remove()}.bind(b));else if("downloadCurrent"==b.downloadButton.downloadType&&isSupportWebp&&!bookConfig.isEncryptionBook&&(e=e.removeStartFrom("?"),-1<e.indexOf("webp")&&(e+="?x-oss-process=image/format,jpg")),e.match(/^none/))h=document.createElement("canvas"),k=h.getContext("2d"),h.width=bookConfig.largePageWidth,h.height=bookConfig.largePageWidth,k.fillStyle=bookConfig.pageBackgroundColor,k.fillRect(0,0,bookConfig.largePageWidth,bookConfig.largePageHeight),
l=$("<a href="+h.toDataURL("image/png")+' download="page'+b.pageIndex+'.png"></a>'),l[0].click();else{m="";"downloadCurrent"==b.downloadButton.downloadType&&(m=b.pageIndex+".jpg");"downloadAttachments"==b.downloadButton.downloadType&&(m=b.currentAttachmentName||"");if(location.protocol.match("file:"))return/^\/\//i.test(e)&&(e="https://"+e),window.open(e),q.return();if("downloadAll"==b.downloadButton.downloadType)return"English"==UserGroups&&(n=_get(htmlConfig,"meta.url","")||window.location.href,
e=e.replace(/bookId=\d+/,"bookUrl="+encodeURIComponent(n))),bookConfig.isEncryptionBook&&(p=BookRestrict.getRestrictToken(),e=appendParamToUrl(e,"code="+p)),window.open(e,"_blank"),q.return();if(isAndroid()&&isWeChat()||isPad())return window.open(e,"_blank"),q.return();if((!isPhone()&&!isPad()||_agent_.browser.safari)&&/fliphtml5|yunzhan365|anyflip|pubhtml5/.test(location.host))return l=$('<a download="'+m+'" target="_blank" href="'+e+'"></a>'),l[0].click(),q.return();new DownloadFile({url:e,downloadName:m,
downloadButton:b.downloadButton,downloadingTips:b.downloadingTips})}q.jumpToEnd()})};b.downloadconfig.code&&!b.verify?(b.downloadPasswordPanel||(b.downloadPasswordPanel=new DownloadPasswordPanel({parent:$("body"),code:b.downloadconfig.code,callback:c})),b.downloadPasswordPanel.showOrHide()):c();d.jumpToEnd()})})},loadImage:function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d");c.style.position="relative";c.width=bookConfig.largePageWidth;c.height=bookConfig.largePageHeight;c.style.width=
bookConfig.largePageWidth+"px";c.style.height=bookConfig.largePageHeight+"px";Promise.all(a.map(function(e){return new Promise(function(g,f){var h=new Image;h.crossOrigin="Anonymous";h.src=e.replace(/^http:/,"https:");h.onload=function(){return g(h)};h.onerror=function(){return f(Error("Failed to load image: "+e))}})})).then(function(e){e.forEach(function(g){var f=g.naturalWidth,h=g.naturalHeight;if(bookConfig.largePageWidth/bookConfig.largePageHeight>f/h){var k=bookConfig.largePageHeight;var l=f/
h*k}else l=bookConfig.largePageWidth,k=h/f*l;d.drawImage(g,(bookConfig.largePageWidth-l)/2,(bookConfig.largePageHeight-k)/2,l,k)});b&&b(a,c)}).catch(function(e){console.log("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",e);b&&b(a,c)})},loadImages:function(a){var b=0,c=$("<canvas style='position:relative;'></canvas>");c.css({width:bookConfig.largePageWidth+"px",height:bookConfig.largePageHeight+"px"});c.attr("width",bookConfig.largePageWidth+"px");c.attr("height",bookConfig.largePageHeight+"px");for(var d=
0;d<imageURL.length;d++){a=imageURL[d];a=a.removeStartFrom("?");var e=$("<img style='position:absolute;left:0;top:0;bottom:0;right:0;margin:auto;'></img>");e.attr("src",a);e[0].onload=function(g){g=$(this);bookConfig.largePageWidth/bookConfig.largePageHeight>g[0].naturalWidth/g[0].naturalHeight?g.css({width:"auto",height:"100%"}):g.css({width:"100%",height:"auto"});c.drawImage(g);b++;b==imageURL.length&&callback&&callback(imageURL,imageURL,c,index)};e[0].onerror=function(g){b++;b==imageURL.length&&
callback&&callback(imageURL,imageURL,c,index)}}},buttonEvent:function(a,b){var c=a.stage.find(".on");c.find("img").attr("src",this.downloadOffUrl);c.find("img")[0].colorChanged=!1;c.removeClass("on");$(b).find("img").attr("src",this.downloadOnUrl);$(b).find("img")[0].colorChanged=!1;$(b).addClass("on");b=$(b).attr("download");a.downloadButton.downloadType=b;a.changeItemColor();"downloadAttachments"==b?a.selectAttachments.show():a.selectAttachments.hide()},changeLanguage:function(){this.downloadAll.find(".title").html(getLanguage("DownloadFullPublication",
"Full Publication"));this.downloadCurrent.find(".title").html(getLanguage("DownloadCurrentPage","Current Page"));this.downloadAttachments.find(".title").html(getLanguage("DownloadAttachedFiles","Attached Files"));this.downloadButton.html(getLanguage("btnDownload","Download"))}}).extend(FormElements),PcDownloadFrame=Class({get hasFiles(){return window.downloadconfig?!downloadconfig.hideDownloadSinglePage||downloadconfig.pdf||downloadconfig.attachments&&0<downloadconfig.attachments.length:!1},create:function(a){this.elements=
new DownloadElements(this);this._super(a)},onCreate:function(){this.initColorCss();this._super()},initColorCss:function(){this.stage.css({"background-color":this.mainColorObj.rgba(this.formOpacity),color:this.fontColor});this.borderColor=this.mainColorObj.reduce(26);this.itemBgColor=this.mainColorObj.add(24)},initHtml:function(){var a=this;this.restricted&&(this.loadingBox=$("<img src='"+uiBaseURL+"loading.svg'/>"),this.loadingBox.css({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),
this.content1.append(this.restrictedTips),BookRestrict.isLoaded||(this.content1.hide(),this.content2.hide(),this.content.append(this.loadingBox),BookEvent.bindEvent("onLoadBookRestrict",function(b,c){c&&a.removeRestrictMode()})));this._super()},removeRestrictMode:function(){this.content1.show();this.content2.show();this.loadingBox&&this.loadingBox.remove()},initEvent:function(){this._super()},onShow:function(){this.changeIconColor()},gotoPage:function(a){}}).extend(FadeOutFadeForm),PhoneDownloadForm=
Class({get hasFiles(){return window.downloadconfig?!downloadconfig.hideDownloadSinglePage||downloadconfig.pdf||downloadconfig.attachments&&0<downloadconfig.attachments.length:!1},create:function(a){this.elements=new DownloadElements(this);this._super(a)},onCreate:function(){this.content.find(".item").css({"background-color":this.fontColorObj.rgba(this.formOpacity),color:this.mainColor});this.selectContent.css({"background-color":this.fontColorObj.rgba(this.formOpacity),color:this.mainColor});this.downloadButton.css({"background-color":this.fontColorObj.rgba(this.formOpacity),
color:this.mainColor});this._super()},initHtml:function(){var a=this;this.title.append(this.close);this.stage.append(this.title);this.downloadContent=$("<div class='download_content'></div>");this.content=$("<div class='content'></div>");this.content1=$("<div class='content1'></div>");downloadconfig.pdf&&this.content1.append(this.downloadAll);downloadconfig.hideDownloadSinglePage||this.content1.append(this.downloadCurrent);this.selectContent=$("<div class='select_content'></div>");this.selectContent.append(this.selectAttachments);
downloadconfig.attachments&&0<downloadconfig.attachments.length&&(this.content1.append(this.downloadAttachments),this.content1.append(this.selectContent));this.hasFiles?this.content1.append(this.downloadButton):this.content1.append(this.noFilesAvailablePrompt);this.content2=$("<div class='content2'></div>");this.content2.append(this.pictureListForm.getDom());this.content.append(this.content2);this.content.append(this.content1);this.downloadContent.append(this.content);this.stage.append(this.downloadContent);
this.restricted&&(this.loadingBox=$("<img src='"+uiBaseURL+"loading.svg'/>"),this.loadingBox.css({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),this.content.css({height:"100%"}),this.downloadContent.css({height:"100%"}),this.content1.append(this.restrictedTips),this.restrictedTips.css({padding:"0 10px 0 20px "}),BookRestrict.isLoaded||(this.content1.hide(),this.content2.hide(),this.content.append(this.loadingBox),BookEvent.bindEvent("onLoadBookRestrict",function(b,c){c&&
a.removeRestrictMode()})))},removeRestrictMode:function(){this.content1.show();this.content2.show();this.loadingBox&&this.loadingBox.remove()},changeIconColor:function(){this._super();this.changeItemColor()},changeItemColor:function(){this.downloadCurrent.changeButtonColor(this.mainColor);this.downloadAttachments.changeButtonColor(this.mainColor);this.downloadAll.changeButtonColor(this.mainColor);this.pictureListForm.leftBtn.changeButtonColor(this.fontColor);this.pictureListForm.rightBtn.changeButtonColor(this.fontColor)},
onShow:function(){this.favicon&&this.favicon.changeButtonColor(this.fontColor);this.changeItemColor()},gotoPage:function(a){this.pictureListForm.fillContent(a)},initEvent:function(){}}).extend(PhoneFormFrame);
Class("DownloadPasswordPanel",{create:function(a){this.parent=a.parent;this.password=a.code;this.callback=a.callback;this.visible=!1;this.createPanel()},createPanel:function(){this.panel=$('<div class="download-password-panel"></div>');this.mask=$('<div class="download-password-mask"></div>');this.container=$('<div class="download-password-container"></div>');this.panel.append(this.mask).append(this.container);var a=$('<div class="download-password-head" ></div>'),b=$('<div class="download-password-title" >'+
getLanguage("downloadPasswordTitle","\u4e66\u7c4d\u8bbe\u7f6e\u4e86\u4e0b\u8f7d\u5bc6\u7801")+"</div>"),c=$('<div class="download-password-subTitle" >'+getLanguage("downloadPasswordSubTitle","\u8bf7\u8f93\u5165\u5bc6\u7801\u4e0b\u8f7d")+"</div>");a.append(b).append(c);this.container.append(a);this.container.append('<input type="password" class="download-password-input" autocomplete="off" placeholder="'+getLanguage("downloadPasswordPlaceholder","\u8bf7\u8f93\u5165\u4e0b\u8f7d\u5bc6\u7801")+'" />');
this.container.append('<div class="download-password-btnBox"></div>');this.panel.find(".download-password-btnBox").append('<div class="download-password-confirm">'+getLanguage("downloadPasswordConfirm","\u786e\u5b9a")+"</div>");this.parent.append(this.panel);this.bindEvent()},bindEvent:function(){var a=this;this.mask.on("click",function(){a.hide()});this.panel.on("click",".download-password-confirm",function(){var b=a.panel.find(".download-password-input").val();b&&a.regexPassword(b)});this.panel.find(".download-password-input").on("input propertychange",
function(b){var c=a.panel.find(".download-password-confirm");b?c.addClass("download-password-confirm-right"):c.removeClass("download-password-confirm-right")});BookEvent.bindEvent("changeLanguage",function(){return a.changeLanguage()})},regexPassword:function(a){a=a.split("").reverse().join("");btoa(a)===this.password?(this.callback&&this.callback(),this.destory()):(a=getLanguage("downloadPasswordErrorPrompt","\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5"),this.tipsBox||(this.tipsBox=new TipsBox({opacity:1},
$("body")),$(this.tipsBox.background[0]).css({position:"fixed","z-index":10001})),this.tipsBox.setCaption(a),this.tipsBox.showTipsBox())},showOrHide:function(){this.visible?this.hide():this.show()},show:function(){this.visible||(this.visible=!0,this.panel.show())},hide:function(){this.visible&&(this.visible=!1,this.panel.hide())},destory:function(){this.panel.remove()},changeLanguage:function(){this.panel.find(".download-password-title").text(getLanguage("downloadPasswordTitle","\u4e66\u7c4d\u8bbe\u7f6e\u4e86\u4e0b\u8f7d\u5bc6\u7801"));
this.panel.find(".download-password-subTitle").text(getLanguage("downloadPasswordSubTitle","\u8bf7\u8f93\u5165\u5bc6\u7801\u4e0b\u8f7d"));this.panel.find(".download-password-confirm").text(getLanguage("downloadPasswordConfirm","\u786e\u5b9a"));this.panel.find(".download-password-input").attr("placeholder",getLanguage("downloadPasswordPlaceholder","\u8bf7\u8f93\u5165\u4e0b\u8f7d\u5bc6\u7801"))}});
var DownloadFile=function(a){var b=void 0===a.downloadName?"":a.downloadName,c=a.downloadButton,d=a.downloadingTips;this.url=a.url;this.downloadName=b;this.downloadButton=c;this.downloadingTips=d;this.handleDownload()};
DownloadFile.prototype.getBlob=function(a){a=void 0===a?"GET":a;var b=this,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(fetch(b.url,{method:a}),4);case 4:return c=g.yieldResult,c.ok?g.yield(c.blob(),5):g.return("");case 5:return d=g.yieldResult,g.return(d);case 2:return e=g.enterCatchBlock(),console.log("Failed to fetch the file:",e),g.return("")}})};
DownloadFile.prototype.saveAs=function(a){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,this.downloadName);else{var b=document.createElement("a"),c=document.querySelector("body");b.href=window.URL.createObjectURL(a);b.download=this.downloadName;b.style.display="none";c.appendChild(b);b.click();c.removeChild(b);window.URL.revokeObjectURL(b.href)}};
DownloadFile.prototype.setDownloadingText=function(a){var b=this.downloadingTips,c=function(e){switch(e){case "start":return getLanguage("downloadingTips","English"===UserGroups?"Downloading...":"\u6b63\u5728\u4e0b\u8f7d\uff0c\u8bf7\u7a0d\u7b49...");case "success":return getLanguage("downloadSuccessfully","English"===UserGroups?"Download successful!":"\u4e0b\u8f7d\u5b8c\u6210\uff01");case "error":return null;default:return""}},d=function(e){var g=Color(bookConfig.formFontColor?bookConfig.formFontColor:
bookConfig.iconColor).toString();e.css({color:g,margin:"10px 20px"})};if(b.length)this.downloadButton.parent().find(".download-loading-tips").length||this.downloadButton.after(b),(a=c(a))?b.text(a):b.remove();else if(a=c(a))b=$("<div class='download-loading-tips'>"+a+"</div>"),d(b),this.downloadButton.after(b)};
DownloadFile.prototype.handleDownload=function(){var a=this,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.setCatchFinallyBlocks(2),a.setDownloadingText("start"),c.yield(a.getBlob(),4);if(2!=c.nextAddress){b=c.yieldResult;if(!b)return a.setDownloadingText("error"),window.open(a.url,"_blank"),c.return();a.saveAs(b);a.setDownloadingText("success");setTimeout(function(){a.downloadingTips.text("")},5E3);return c.leaveTryBlock(0)}c.enterCatchBlock();a.setDownloadingText("error");
window.open(a.url,"_blank");c.jumpToEnd()})};
var LanguageElements=Class({create:function(a){this._super(a);this.initElements();this.initEvent(a);this.pickElements(a)},initElements:function(){this.choosedUrl=uiBaseURL+"choosed.png";this.itemArray=[];this.scrollBox=$("<div class='scrollBox'></div>");this.wrapper=$("<div class='scrollListWrapper' ></div>");this.scrollList=$("<div class='scrollList'></div>");this.scrollBox.append(this.wrapper);this.wrapper.append(this.scrollList);for(var a=0;a<language.length;a++)language[a]&&language[a].language&&
this.addItem(language[a].language)},addItem:function(a){if(a){var b=a;if(isPhone()||isPad())b="&nbsp;&nbsp;&nbsp;"+a;var c=$("<div class='item'><div class='title'>"+b+"<div/><img src='"+this.choosedUrl+"'/></div>");a.toLowerCase()===bookConfig.language.toLowerCase()&&(c.addClass("focus"),this.currentItem=c);c.bind(_event._end,function(){this.refreshLanguage(a);this.currentItem=c;this.scrollBox.find(".focus").removeClass("focus");c.addClass("focus")}.bind(this));this.scrollList.append(c);this.itemArray.push(c)}},
refreshLanguage:function(a){changeLanguage(a)},initEvent:function(a){},pickElements:function(a){a.choosedUrl=this.choosedUrl;a.itemArray=this.itemArray;a.scrollBox=this.scrollBox},changeLanguage:function(){}}).extend(FormElements);
Class("PcLanguageForm",{create:function(a){this.elements=new LanguageElements(this);this._super(a)},onCreate:function(){this.close.changeButtonColor(this.color);this._super()},initEvent:function(){this._super();this.stage.bind(_event._end,function(){this.hide()}.bind(this));for(var a=0;a<this.itemArray.length;a++)this.itemArray[a].bind(_event._end,function(){this.hide()}.bind(this))},initHtml:function(){this.title.append(this.close);this.stage.append(this.title);this.stage.append(this.scrollBox)},
onResize:function(){},onShow:function(){}}).extend(FadeOutFadeForm);
var PhoneLanguageForm=Class({create:function(a){this.elements=new LanguageElements(this);this._super(a)},onCreate:function(){this._super();this.favicon&&this.favicon.changeButtonColor(this.fontColor)},initEvent:function(){},initHtml:function(){this.title.append(this.close);this.stage.append(this.title);this.stage.append(this.scrollBox)},onResize:function(){this._super();this.scrollBox.css({height:this.height-61+"px",overflow:"auto"})},onShow:function(){}}).extend(PhoneFormFrame),HelpElements=Class({create:function(a){this._super(a);
this.initElements();this.initEvent(a);this.pickElements(a)},initElements:function(){bookConfig.helpContentFileURL?this.image=$("<div></div>"):(this.helpUrl=form_icons.help_form?"data:image/png;base64,"+form_icons.help_form:uiBaseURL+"help_form.png",this.image=$("<img class='logo' src='"+this.helpUrl+"'/>"),this.title1=$("<p class='description'>"+getLanguage("lblHelp1","Drag the page corner to view")+"</p>"),this.title2=$("<p class='description'>"+getLanguage("lblHelp2","Double click to zoom in, out")+
"</p>"))},resetHelpIcon:function(a){bookConfig.helpContentFileURL||this.image.attr("src",this.helpUrl)},initEvent:function(a){},pickElements:function(a){a.helpUrl=this.helpUrl;a.image=this.image;a.title1=this.title1;a.title2=this.title2},changeLanguage:function(){this.title1&&this.title1.html(getLanguage("lblHelp1","Drag the page corner to view"));this.title2&&this.title2.html(getLanguage("lblHelp2","Double click to zoom in, out"))}}).extend(FormElements),PcHelpFrame=Class({create:function(a){this.elements=
new HelpElements(this);this._super(a)},onCreate:function(){this.initColorCss();bookConfig.helpContentFileURL&&(this.stage.css({width:bookConfig.helpWidth+"px",height:bookConfig.helpHeight+"px"}),this.image.css({background:"url("+bookConfig.helpContentFileURL+") center no-repeat","background-size":"contain",width:"100%",height:"100%"}),this.content&&this.content.css({width:bookConfig.helpWidth-34+"px",height:bookConfig.helpHeight-59+"px"}));this._super();bookConfig.showHelpContentAtFirst?this.show():
this.hide()},initColorCss:function(){this.stage.css({"background-color":this.mainColor,color:this.fontColor})},resetColorChanged:function(){this._super();!bookConfig.helpContentFileURL&&this.image&&(this.image[0].colorChanged=!1)},resetIconSrc:function(a){this._super();!bookConfig.helpContentFileURL&&this.image&&this.elements.resetHelpIcon(this.fontColor)},changeIconColor:function(){this._super();!bookConfig.helpContentFileURL&&this.image&&this.image.changeButtonColor(this.fontColor)},initHtml:function(){this._super()},
onShow:function(){this.changeIconColor()}}).extend(FadeOutFadeForm);
Class("SharePoster",{create:function(a){this.parent=a;this.initConfig();this.initHtml();this.initCss();this.initEvent()},initHtml:function(){this.pContainer=$("<div class='posterContainer'></div>");this.initReadyHtmlPanel();this.initPosterImgPanel();this.parent.append(this.pContainer)},initConfig:function(){this.height=windowHeight-20;this.width=.66*this.height;var a=windowWidth-20;this.width>a&&(this.width=a,this.height=this.width/.66);this.scale=this.width/684},initReadyHtmlPanel:function(){this.canvas=
$("<canvas style='z-index:1;left: 50%;top: 50%;position: absolute;-webkit-transform: translate(-50%,-50%) scale("+this.scale+");transform: translate(-50%,-50%) scale("+this.scale+");'></canvas>");this.ctx=this.canvas[0].getContext("2d");this.thumb=$("<img crossOrigin='Anonymous' style='border: 1px solid #e5e5e5;width: 100%;height: 100%;position: absolute;left:0;bottom: 0;'/>");this.cvsBg=$("<img crossOrigin='Anonymous' src='"+uiBaseURL+"posterBg.jpg' />");this.qrcodeBox=$("<div style='border: 1px solid #e5e5e5;'></div>");
this.qrcodeBox.qrcode({width:100,height:100,render:"image",text:bookConfig.socialShareLink?bookConfig.socialShareLink:window.location.href.removeStartFrom("#p=")});this.pContainer.append(this.canvas).append(this.svg)},initPosterImg:function(){this.beforeCreatePoster();this.canvas[0].width=684;this.canvas[0].height=1036;this.imgs=[this.cvsBg,this.thumb];this.getSrcAndImg(0)},setImgs:function(a,b){var c=a.imgs;a.loadImgFun(c[b]).then(function(){b+=1;b<c.length?a.setImgs(a,b):a.drawPoster()})},isBgSvg:function(a){return"object"==
typeof a&&(a[0]&&-1<a[0].indexOf("svg")||a[1]&&-1<a[1].indexOf("svg"))},getSrcAndImg:function(a){var b=this;getPageDir(1,"normal").then(function(c){b.isBgSvg(c)?(c.forEach(function(d,e){bookConfig.isEncryptionBook||(d=d.removeStartFrom("?"));d.match(/.jpg|.png|.webp/)?(this.thumb.attr("src",d),this.thumb.attr("crossOrigin","Anonymous")):(e=$("<img />"),e.attr("src",d),e.attr("crossOrigin","Anonymous"),this.imgs.push(e))}.bind(b)),b.setImgs(b,a)):("object"==typeof c&&c[0]&&(c=(fliphtml5_pages.normalPath&&
void 0!=fliphtml5_pages.normalPath[0]?fliphtml5_pages.normalPath[0]:"")+c[0]),-1<c.indexOf("none")?getPageDir(1,"thumb").then(function(d){d.match(/none/)?(b.thumb.attr("src","").css({display:"none"}),b.setImgs(b,a)):(bookConfig.isEncryptionBook||(d=d.removeStartFrom("?")),b.thumb.attr("src",d),b.thumb.attr("crossOrigin","Anonymous"),b.setImgs(b,a),b.isUseThumb=!0)}):"string"==typeof c&&c.match(/.jpg|.png|.webp/)?(bookConfig.isEncryptionBook||(c=c.removeStartFrom("?")),b.thumb.attr("src",c),b.thumb.attr("crossOrigin",
"Anonymous"),b.setImgs(b,a)):"string"==typeof c&&-1<c.indexOf(".zip")&&(b.pdfLoadingTask=new PdfLoadingTask(1,"normal",684,1036,b.afterLoadPdf.bind(b,a)),b.pdfLoadingTask.start()))})},afterLoadPdf:function(a,b){this.thumb.attr("src",b.toDataURL("image/png"));this.setImgs(this,a)},loadImgFun:function(a){var b=$(a);return new Promise(function(c,d){b[0].complete?(console.log("load img complete"),b.attr("crossOrigin","Anonymous"),c()):(b[0].onload=function(){b.attr("crossOrigin","Anonymous");console.log("load img ok");
c()},b[0].onerror=function(e){console.log("load img error",b);d(e)})}.bind(this))},drawImages:function(a,b){this.imgs.shift();this.imgs.forEach(function(c){var d=getImageConfig(c[0],556,781,this.isUseThumb);""===c.attr("src")?(d={width:556,height:781,left:0,top:0},this.ctx.fillStyle="#ffffff",this.ctx.fillRect(a+d.left,b+d.top,d.width,d.height)):this.ctx.drawImage(c[0],d.left+a,d.top+b,d.width,d.height)}.bind(this))},drawPoster:function(){var a=window.document.title,b=getImageConfig(this.thumb[0],
556,781,this.isUseThumb);if(!this.thumb[0].src.match(/base64/)&&-1<this.thumb[0].src.indexOf("none")||!this.thumb[0].src.match(/jpg|png|webp/))b={width:556,height:781,left:0,top:0};this.ctx.drawImage(this.cvsBg[0],0,0,684,1036);this.drawBottomShadow(b,64,55);this.drawImages(64,55);this.drawCvsBorder(b,64,55);this.drawLeftShadow(b,64,55);this.drawTitleText(a,"20 Arial");this.ctx.fillStyle="#ffffff";this.ctx.fillRect(308,936,1,60);this.drawAlertText();this.drawQrcode();try{this.afterCreatedPoster();
var c=this.canvas[0].toDataURL("image/png",1);this.posterImg.attr("src",c);isIE()?this.pcDownload.bind("click",function(){if(navigator.msSaveBlob)return navigator.msSaveBlob(this.getDataURLtoBlob(c),"poster.png")}.bind(this)):(this.pcDownload.attr("href",c),this.pcDownload.attr("download","poster"));this.hasPoster=!0}catch(d){this.isloadFail=!0,this.afterFailLoad(),console.log(d)}},getDataURLtoBlob:function(a){var b=a.split(",");a=b[0].match(/:(.*?);/)[1];b=atob(b[1]);for(var c=b.length,d=new Uint8Array(c);c--;)d[c]=
b.charCodeAt(c);return new Blob([d],{type:a})},drawBottomShadow:function(a,b,c){this.ctx.save();this.ctx.shadowBlur=40;this.ctx.shadowColor="rgba(11,11,11,0.7)";this.ctx.fillStyle="#ffffff";this.ctx.shadowOffsetY=20;this.ctx.fillRect(a.left+b+.03*a.width,c+a.top+a.height-147,.94*a.width,146);this.ctx.restore()},drawLeftShadow:function(a,b,c){this.ctx.save();if(rightToLeft){var d=this.ctx.createLinearGradient(a.left+b+a.width-8,c+a.top+a.height-a.height,a.left+b+a.width,c+a.top+a.height-a.height);
d.addColorStop(0,"rgba(255,255,255,0)");d.addColorStop(1,"rgba(58,58,58,0.8)")}else d=this.ctx.createLinearGradient(a.left+b,c+a.top+a.height-a.height,a.left+b+8,c+a.top+a.height-a.height),d.addColorStop(0,"rgba(58,58,58,0.8)"),d.addColorStop(1,"rgba(255,255,255,0)");this.ctx.fillStyle=d;this.ctx.fillRect(a.left+b+a.width-8,c+a.top+a.height-a.height,8,a.height);this.ctx.restore()},drawCvsBorder:function(a,b,c){for(var d=a.height,e=0;5>e;e++)this.ctx.fillStyle=0==e%2?"#e5e5e5":"#f2f2f2",rightToLeft?
this.ctx.fillRect(Math.floor(a.left+b-5+1*e),c+a.top+(5-e),1,d-2*(5-e)):this.ctx.fillRect(Math.floor(a.left+b+a.width+1*e),c+a.top+1*e,1,d-2*e)},drawTitleText:function(a,b){b&&(this.ctx.font="20px Arial");var c=this.ctx.measureText(a).width;b=957;this.ctx.textBaseline="top";274<c?(b=943,c=this.getLinitText(a,274),a=this.getLinitText(a.replace(c,""),266,!0),this.ctx.fillText(c,15,b),this.ctx.fillText(a,15,b+26)):this.ctx.fillText(a,15+(274-c)/2,b)},getLinitText:function(a,b,c){var d="",e="";textArr=
a;for(a=0;a<textArr.length;a++){if(this.ctx.measureText(d).width>b)return c?e+"...":e;e=d;d+=textArr[a]}return d},drawAlertText:function(){this.ctx.font="20px Arial";var a=954;this.ctx.textBaseline="top";this.ctx.fillStyle="#db9a67";var b=this.getLinitText(getLanguage("infLongPressToIndentify","Long press to identify QR code"),267,!0),c=this.getLinitText(getLanguage("infScanCodeToView","Scan code to read"),227,!0),d=323+(226-this.ctx.measureText(c).width)/2;if(getLanguage("infLongPressToIndentify")){a=
943;this.ctx.font="14px Arial";var e=323+(226-this.ctx.measureText(b).width)/2;this.ctx.fillText(b,e,a);this.ctx.font="20px Arial";this.ctx.fillText(c,d,a+26)}else this.ctx.fillText(c,323,a)},drawQrcode:function(){this.ctx.fillStyle="#ffffff";this.ctx.fillRect(561,911,110,110);this.ctx.drawImage(this.qrcodeBox.find("img")[0],566,916,100,100);var a=new Image;a.src=bookConfig.appLogoIcon;a.setAttribute("crossOrigin","Anonymous");bookConfig.appLogoIcon&&this.ctx.drawImage(a,611,961,20,20)},getCloseSrc:function(){return"./style/icon/close.svg"},
initPosterImgPanel:function(){this.topTitle=$("<div style='transition:transform 0.3s;-webkit-transition:transform 0.3s;-webkit-transform:translateY(-30px);transform:translateY(-30px);font-size:14px;color:#fff;width:100%;position:absolute;top:0;left:0;height:28px;background:rgba(11,11,11,0.5) '></div>");this.pcDownload=$("<a style='position:absolute;padding-left:24px;left:6px;color:#fff;text-decoration:none;line-height:28px;height:28px;cursor:pointer;'><span style='position:absolute;left:0;width:20px;height:20px;top:4px;background: url("+
uiBaseURL+"download.png) center center no-repeat;background-size:contain;'></span>"+getLanguage("btnDownloadPosterPrompt","Click to download the poster")+"</a>");this.alertText=$("<div style='font-size:14px;width: "+(this.width-37)+"px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;position:absolute;left:10px;top:0;line-height:28px;height:28px;'>"+getLanguage("infLongPressToSavePoster","Long press to identify QR code")+"</div>");this.closeBtn=$('<span style="cursor:pointer;z-index:1112;position:absolute;width:16px;height:17px;top:2px;right:2px;padding: 3px 4px 4px;">'+
phoneSvgIcons.close+"</span>");this.loading=$("<img style='position:absolute;transform : translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);left : 50%;top : 50%;z-index:1112' src='"+uiBaseURL+"loading.gif' />");this.posterImgOuter=$("<div></div>");this.posterImg=$("<img />");this.popPosterBox=$("<div></div>");this.popPosterBg=$("<div></div>");this.topTitle.append(this.alertText).append(this.closeBtn).append(this.pcDownload);this.posterImgOuter.append(this.posterImg).append(this.topTitle);
this.popPosterBox.append(this.popPosterBg).append(this.posterImgOuter).append(this.loading);this.pContainer.append(this.popPosterBox);this.posterImgOuter.fadeOut()},onResize:function(){this.initConfig();this.resizeCss()},showPosterHtml:function(){this.canvas.css({display:"block",left:"50%",top:"50%",transform:"translate(-50%,-50%) scale("+this.scale+")"})},initCss:function(){this.posterImgOuter.css({overflow:"hidden",transform:"translate(-50%,-50%)","-webkit-transform":"translate(-50%,-50%)",left:"50%",
top:"50%","z-index":"1111",position:"absolute",display:"none",width:684*this.scale+"px",height:1036*this.scale+"px"});this.posterImg.css({width:684*this.scale+"px",height:1036*this.scale+"px"});this.pContainer.css({display:"none","z-index":"1001",position:"absolute",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(11,11,11,0.7)"});this.popPosterBox.css({"z-index":"1001",position:"absolute",left:"0",top:"0",width:"100%",height:"100%"});this.popPosterBg.css({"z-index":"0",position:"absolute",
left:"0",top:"0",width:"100%",height:"100%"});isPhone()||isPad()?(this.topTitle.css({"-webkit-transform":"translateY(0)",transform:"translateY(0)"}),this.alertText.css({display:"block"}),this.pcDownload.css({display:"none"})):(this.topTitle.css({"-webkit-transform":"translateY(-30px)",transform:"translateY(-30px)"}),this.pcDownload.css({display:"block"}),this.alertText.css({display:"none"}))},resizeCss:function(){this.alertText.css({width:this.width-37+"px"});this.posterImgOuter.css({width:684*this.scale+
"px",height:1036*this.scale+"px"});this.posterImg.css({width:684*this.scale+"px",height:1036*this.scale+"px"});this.canvas.css({"-webkit-transform":"translate(-50%,-50%) scale("+this.scale+")",transform:"translate(-50%,-50%) scale("+this.scale+")"})},initEvent:function(){this.popPosterBg.bind(_event._down,function(a){a.stopPropagation();this.pContainer.fadeOut()}.bind(this));this.posterImg.on("load",function(){this.posterImgOuter.fadeIn()}.bind(this));isPC()&&(this.closeBtn.bind(_event._enter,function(a){a.stopPropagation();
this.closeBtn.css({opacity:"0.65"})}.bind(this)),this.closeBtn.bind(_event._leave,function(a){a.stopPropagation();this.closeBtn.css({opacity:"1"})}.bind(this)),this.pcDownload.bind(_event._enter,function(a){a.stopPropagation();this.pcDownload.css({opacity:"0.65"})}.bind(this)),this.pcDownload.bind(_event._leave,function(a){a.stopPropagation();this.pcDownload.css({opacity:"1"})}.bind(this)));this.closeBtn.bind(_event._click,function(a){a.stopPropagation();this.hide()}.bind(this));isPhone()||isPad()||
(this.posterImgOuter.bind("mouseenter",function(){this.topTitle.css({transform:"translateY(0)","-webkit-transform":"translateY(0)"})}.bind(this)),this.posterImgOuter.bind("mouseleave",function(){this.topTitle.css({transform:"translateY(-30px)","-webkit-transform":"translateY(-30px)"})}.bind(this)))},beforeCreatePoster:function(){this.canvas.css({display:"block"});this.loading.css({display:"block"})},afterCreatedPoster:function(){this.canvas.css({display:"none",left:"110%",top:"110%",transform:"scale("+
this.scale+")"});this.loading.css({display:"none"})},afterFailLoad:function(){this.beforeCreatePoster();this.showPosterHtml();this.loading.css({display:"none"});this.canvas.css({"z-index":"1002"})},show:function(){this.pContainer.fadeIn();this.hasPoster?this.posterImgOuter.fadeIn():this.isloadFail?this.afterFailLoad():this.initPosterImg();global.sharePanel&&global.sharePanel.hide();this.onShow()},hide:function(){this.pContainer.fadeOut();this.onHide()},onShow:function(){},onHide:function(){}});
(function(a){tmpBookConfig.ShareButtonVisible&&(a=window.location.href.toLowerCase(),!(-1<a.indexOf("fliphtml5.com")||-1<a.indexOf("pubhtml5.com")||-1<a.indexOf("anyflip.com")||-1<a.indexOf("flipbuilder.com")||tmpBookConfig.facebookAppId)||a.indexOf("amazonaws.com"))})(global);
var share_url=window.location.href.removeStartFrom("#p="),share_title=window.document.title+(-1<share_url.indexOf("fliphtml5.com")?" on FlipHTML5":""),share_description="",share_screenshot,facebook_screenshot,AnalysisShare=Class({create:function(){var a=share_url.removeStartFrom("/mobile","");a=a.substring(0,a.lastIndexOf("/")+1);var b=this.getThumbUrl();b?(share_screenshot=getRealURL(b),facebook_screenshot=bookConfig.facebookShotImageURL?a+bookConfig.facebookShotImageURL:b,facebook_screenshot=getRealURL(facebook_screenshot)):
facebook_screenshot=share_screenshot="";$('meta[name="description"]').attr("content")&&(share_description=$('meta[name="description"]').attr("content"));bookConfig.socialShareLink&&(share_url=bookConfig.socialShareLink);this.refreshList()},getList:function(){return this.shareList},getThumbUrl:function(){var a=getMeta("og:image");a.match(/^none/)&&(a="");return-1<a.indexOf("../")?a.replace("../","/"):a},refreshList:function(){this.url=Metacharacter(share_url);this.title=Metacharacter(share_title);
this.screenshot=Metacharacter(share_screenshot);this.description=Metacharacter(share_description);this.shareList=window.shareObj&&0<window.shareObj.length?this.initShareList():this.initDefaultShareList()},initShareList:function(){if(!window.shareObj||0>=window.shareObj.length)return[];for(var a=window.shareObj.length,b=[],c=0;c<a;c++){var d=window.shareObj[c];if("mobile"!=d.filter||isPC())if("pc"!=d.filter||!isPC()||d.specail)d=this.fixItemInfo(d),b.push(d)}return b},fixItemInfo:function(a){if(a){var b=
share_url,c="",d="";try{c=window.parent.location.href,d=window.top.location.href}catch(h){}var e=window.document.title,g=share_screenshot;a.name&&"facebook"==a.name.toLowerCase()&&(g=facebook_screenshot);var f=a.url+"";0<=f.indexOf("${url_no_page}")&&(f=f.remove("${url_no_page}"),b=b.removeStartFrom("#p="),c=c.removeStartFrom("#p="),d=d.removeStartFrom("#p="));f=f.replaceAll("${url}",b,!0);f=f.replaceAll("${url_no_page}",b,!0);f=f.replaceAll("${url_parent}",c,!0);f=f.replaceAll("${url_top}",d,!0);
"baidutieba"==a.type?(b=g.replace("https","http"),f=f.replaceAll("${shot-img}",b,!0)):f=f.replaceAll("${shot-img}",g,!0);f=f.replaceAll("${title}",e,!0);share_description||(f=f.replace("&desc=${description}",""),f=f.replace("&text=${description}",""));e=a.logo+"";bookConfig.isFlipPdf&&e.startsWith("./")&&(e="."+e);b=a.title+"";c=a.popUp;return a.name&&"facebook"==a.name.toLowerCase()?{logo:e,url:"javascript:ShareToFaceBook({url:share_url, title:share_title, screenshot:facebook_screenshot, description:share_description})",
title:b,type:a.type}:"qrcode"==a.name?{url:"javascript:openQRCode()",logo:e,title:b,type:a.type}:c?{url:"javascript:openPopUp("+c+")",logo:e,title:b}:"qqShare"==a.type&&(isPhone()||isPad())?{url:"javascript:sharePhoneQQ()",logo:e,title:b,type:a.type}:"poster"==a.type?{url:"javascript:showPoster()",type:"poster",logo:e,title:b}:"copy"==a.type?{url:"",type:"copy",logo:e,title:b}:{url:f,logo:e,title:b,type:a.type}}},initDefaultShareList:function(){var a=[{logo:uiBaseURL+(isBelowIE9()?"facebook.png":
"facebook.svg"),url:"javascript:ShareToFaceBook({url:share_url, title:share_title, screenshot:facebook_screenshot, description:share_description})",title:"Facebook",name:"facebook",type:"facebook"},{logo:uiBaseURL+(isBelowIE9()?"twitter.png":"twitter.svg"),url:"https://twitter.com/intent/tweet?url="+this.url+"&text="+this.title,title:"Twitter",name:"twitter",type:"twitter"},{logo:uiBaseURL+"instagram.svg",url:"javascript:ShareToInstagram()",title:"Instagram",name:"instagram",type:"instagram"},{logo:uiBaseURL+
"pinterest.svg",url:"https://www.pinterest.com/pin/create/button/?url="+this.url,title:"Pinterest",name:"pinterest",type:"pinterest"},{logo:uiBaseURL+"whatsapp.svg",url:"https://wa.me/?text="+this.url,title:"WhatsApp",name:"whatsapp",type:"whatsapp"},{logo:uiBaseURL+(isBelowIE9()?"email.png":"email.svg"),url:getEmailUrl(),title:"Email",name:"email",type:"email"},{logo:uiBaseURL+(isBelowIE9()?"copy.png":"link.svg"),url:"",type:"copy",title:"Copy",filter:"pc"},{logo:uiBaseURL+(isBelowIE9()?"qrcode.png":
"qrcode.svg"),url:"javascript:openQRCode()",type:"qrcode",title:"QRcode",filter:"pc",specail:!0},{logo:uiBaseURL+"poster.svg",url:"javascript:showPoster()",title:"Poster",name:"poster",type:"poster"}],b={logo:uiBaseURL+(isBelowIE9()?"more.png":"more.svg"),url:"javascript:openNavigator({url:share_url, title:share_title,description:share_description})",title:"More",name:"share_more",type:"share_more"};navigator&&navigator.share&&a.push(b);return"string"===typeof bookConfig.socialSharingList||Array.isArray(bookConfig.socialSharingList)?
0<bookConfig.socialSharingList.length?a.filter(function(c){return bookConfig.socialSharingList.includes(c.type)}):[]:a}}),openNavigator=function(a){if(navigator&&navigator.share)try{navigator.share({title:a.title,text:a.description,url:a.url&&a.url.toString()})}catch(b){console.log("\u5206\u4eab\u5931\u8d25")}else console.log("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u7cfb\u7edf\u5206\u4eab")},openQRCode=function(){sharePanel&&sharePanel.showQRCode&&sharePanel.showQRCode()},openPopUp=function(a){var b=
$("<div style='position:absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;'></div>");a=$("<img style='position:absolute;top:0;right:0;max-width:90%;max-height:90%;' src='"+a+"'/>");b.append(a);$("body").append(b);b.onClick(function(){b.hide();b.remove()})},ShareToFaceBook=function(a){var b=function(){var d=getHost(window.location.href).toLowerCase();if(-1<d.indexOf("fliphtml5.com"))return"759223277462081";if(-1<d.indexOf("pubhtml5.com"))return"552959651503135";if(-1<
d.indexOf("anyflip.com"))return"3188867394510608";if(-1<d.indexOf("flipbuilder.com"))return"506045156879233";if(bookConfig.facebookAppId)return bookConfig.facebookAppId},c=function(){FB.ui({method:"share",href:share_url.toString()},function(d){})};(function(){var d=getHost(window.location.href).toLowerCase();(-1<d.indexOf("fliphtml5.com")||-1<d.indexOf("pubhtml5.com")||-1<d.indexOf("anyflip.com")||-1<d.indexOf("flipbuilder.com")||bookConfig.facebookAppId)&&global.FB?(FB.init({appId:b(),status:!0,
xfbml:!1,version:"v2.4"}),c()):window.open("http://www.facebook.com/sharer.php?u="+share_url.toString())})()},getEmailUrl=function(){if(!bookConfig.btnShareWithEmailSubject&&!bookConfig.btnShareWithEmailBody)return"https://mail.google.com/mail/u/0/?view=cm&fs=1&tf=1&su="+share_title+"&body="+(share_title+"%0D%0A"+encodeURIComponent(share_url));var a=bookConfig.btnShareWithEmailSubject?bookConfig.btnShareWithEmailSubject:share_title,b=bookConfig.btnShareWithEmailBody?bookConfig.btnShareWithEmailBody:
share_description,c=bookConfig.btnShareWithEmailTo||"";b=b.replaceAll("{link}",share_url,!0);b=b.replaceAll("{thumb}",share_screenshot,!0);b=b.replaceAll("{title}",share_title,!0);c&&(c=encodeURIComponent(c));a&&(a=encodeURIComponent(a));b&&(b=encodeURIComponent(b));return"mailto:"+c+"?subject="+a+"&body="+b};
function sharePhoneQQ(){var a=navigator.appVersion,b=1<a.split("UCBrowser/").length?1:0,c=1<a.split("MQQBrowser/").length?2:0,d=a.toLowerCase().match(/ qq/i)||null!=a.toLowerCase().match(/ qqtheme/i);a=a.match(/MicroMessenger/i)&&"micromessenger"==a.match(/MicroMessenger/i).toString().toLowerCase();if((b||c&&!a)&&!d)(new mShare({title:share_title,url:share_url,desc:share_description,img:share_screenshot})).init(3);else{var e=$('<div style="text-align:center;position:fixed;top:0;left:0;right:0;bottom:0;z-index:1111;width:100%;height:100%;background:rgba(0,0,0,0.85);"></div>');
b=$('<div style="width:92%;height:96%;margin:2% 4%;background:url('+phoneSvgIcons.shareHelpSvg+') center top no-repeat"></div>');e.append(b);$("body").append(e);e.bind("click",function(){e.unbind("click");e.remove()})}}
function sharePhoneWeChat(){var a=$('<div style="text-align:center;position:fixed;top:0;left:0;right:0;bottom:0;z-index:1111;width:100%;height:100%;background:rgba(0,0,0,0.85);"></div>'),b=$('<div style="width:92%;height:96%;margin:2% 4%;background:url('+phoneSvgIcons.shareToWeChat+') center top no-repeat"></div>');a.append(b);$("body").append(a);a.bind("click",function(){a.unbind("click");a.remove()})}
(function(a){function b(m){if(!g)return m&&m();var n=document.createElement("script");n.onload=function(){m&&m()};n.onerror=function(){};n.src=1==+g?"//3gimg.qq.com/html5/js/qb.js":"//jsapi.qq.com/get?api=app.share";$("body").append(n)}function c(m){var n="";1==m.type?n=8:2==m.type?n=1:3==m.type?n=4:4==m.type?n=11:0==m.type&&(n="undefined");var p=function(){var q={url:m.url,title:m.title,description:m.desc,img_url:m.img,img_title:m.title,to_app:n,cus_txt:""};window.browser?browser.app&&browser.app.share(q):
window.qb&&qb.share&&qb.share(q)};l?p():b(p)}var d=navigator.appVersion;var e=1<d.split("UCBrowser/").length?1:0;var g=1<d.split("MQQBrowser/").length?2:0;var f=d.match(/MicroMessenger/i)&&"micromessenger"==d.match(/MicroMessenger/i).toString().toLowerCase();var h=g?parseFloat(d.split("MQQBrowser/")[1]):0;d=e?parseFloat(d.split("UCBrowser/")[1]):0;var k=function(){var m=navigator.userAgent;return/iphone|ipod/i.test(m)?1:/android/i.test(m)?2:0}();var l=!1;g&&5.4>h&&1==k||g&&5.3>h&&1==k?g=0:g&&5.4>
h&&2==k?g=1:e&&(10.2>d&&1==k||9.7>d&&2==k)&&(e=0);b(function(){l=!0});a.mShare=function(m){this.check=function(n,p,q){e?n():g&&!f?n():f?p():q()};this.config=m;this.init=function(n){"undefined"!=typeof n&&(this.config.type=n);try{if(e){var p=this.config;n="";p.type&&(2==k?1==p.type?n="WechatTimeline":2==p.type?n="WechatFriends":3==p.type?n="QQ":4==p.type?n="SinaWeibo":0==p.type&&(n="undefined"):1==k&&(1==p.type?n="kWeixinFriend":2==p.type?n="kWeixin":3==p.type?n="kQQ":4==p.type?n="kSinaWeibo":0==p.type&&
(n="undefined")));var q=[p.title,p.desc,p.url,n,"","",""];window.ucweb?ucweb.startRequest&&ucweb.startRequest("shell.page_share",q):window.ucbrowser&&ucbrowser.web_share&&ucbrowser.web_share.apply(null,q)}else g&&!f&&c(this.config)}catch(r){}}}})(this);function showPoster(){global.sharePoster||(global.sharePoster=new SharePoster(tmpContainer));global.sharePoster.show();onShowPoster()}function onShowPoster(){}
function ShareToInstagram(){var a=Metacharacter(share_url);copyTextToClipboard(a);window.open("https://instagram.com/","_blank")}
var PhoneShareItem=Class({create:function(a){a&&(this.info=a,this.initItem(),this.initEvent())},initItem:function(){-1<this.info.url.indexOf("javascript")?this.link=$("<a ></a>"):this.info.type&&"copy"==this.info.type?(this.link=$("<a id='copy_url' data-clipboard-action='copy' ></a>"),copyHref(this.link[0])):this.link=$("<a target='_blank' href='"+this.info.url+"'></a>");this.item=$("<div class='item'></div>");this.logo=$("<img class='logo' src='"+this.info.logo+"'/>");this.title=$('<div class="logo_title">'+
this.info.title+"</div>");this.link.append(this.item);this.info.logo&&this.item.append(this.logo);this.item.append(this.title);this.item.css({color:this.info.fontColor})},initEvent:function(){this.link.bind("touchend",function(){BookEvent.trigger("share",[BookInfo.getCurrentPageIndex(),this.info.title,!1])}.bind(this));-1<this.info.url.indexOf("javascript")&&this.link.bind(_event._click,function(){eval(this.info.url.remove("javascript:"));return!1}.bind(this))},appendTo:function(a){this.parent=a;
this.parent.append(this.link)}}),ShareElements=Class({create:function(a){this._super(a);this.itemArray=[];global.share_url=window.location.href.removeStartFrom("#p=");this.initElements();this.initEvent(a);this.pickElements(a);this.added=!1;this.setCurrentBoxStyle()},initElements:function(){this.shareCurrentChecked=!1;this.searchOnUrl=form_icons.print_on?"data:image/png;base64,"+form_icons.print_on:uiBaseURL+"print_on.png";this.searchOffUrl=form_icons.print_off?"data:image/png;base64,"+form_icons.print_off:
uiBaseURL+"print_off.png";this.analysisShare=new AnalysisShare;this.sharePanelTitle=$("<div class='link_title share_title'>"+getLanguage("frmPanelTitle","Share to")+":</div>");this.linkBox=$("<div class='link_Box'></div>");this.linkTitle=$("<div class='link_title'>"+getLanguage("frmLinkLabel","Link")+":</div>");this.linkArea=$("<input aria-label='"+getLanguage("ariaShareLink","Book link")+"' class='link_input'></input>");this.copy1=$("<div role='button' tabindex=0 aria-label='"+getLanguage("ariaCopy",
"copy")+"' class='copy button_hover'>"+getLanguage("lblCopy","Copy")+"</div>");this.codeBox=$("<div class='codeBox'></div>");this.codeButton=$("<div class='codeButton'><span class='qrcode active' title="+getLanguage("frmShareQRcode","QRCode")+">"+getLanguage("frmShareQRcode","QRCode")+"</span><span class='miniProgram' title="+getLanguage("frmShareSmallProgram","smallProgram")+">"+getLanguage("frmShareSmallProgram","smallProgram")+"</span></div>");this.shareCode=$("<div class='shareCode' style='cursor:pointer;'><div class='QRcode' style='width:100px;height:100px;'></div></div>");
this.miniProgramCode=$("<div class='miniProgramCode' style='background:url("+bookConfig.SmallProgramUrl+") center center no-repeat;background-size:cover'></div>");this.shareCode.find(".QRcode").qrcode({width:100,height:100,render:global.isIE8()?"":"image",text:share_url});this.codeBox.append(this.codeButton);this.bigCodeBox=$("<div class='bigCodeBox' style='display:none;position:absolute;width:160px;height:160px;top:-41px;border:1px solid #dedede;padding:10px;background-color:#fff;border-radius:2px'></div>");
this.bigMiniProgramCode=$("<div class='bigMiniProgram' style='display:none;position:absolute;width:180px;height:180px;top:-29px;border:1px solid #dedede;background:url("+bookConfig.SmallProgramUrl+") center center no-repeat;background-size:cover;border-radius:2px'></div>");this.shareCodeArrowBorder=$("<div></div>");this.shareCodeArrow=$("<div class='shareCodeArrow'></div>");bookConfig.RightToLeft?"popular"==global.templeteName?(this.shareCodeArrowBorder.css({width:"0",height:"0","border-top":"6px solid transparent",
"border-left":"12px solid #dedede","border-bottom":"6px solid transparent",position:"absolute",right:"-12px",top:"84px"}),this.shareCodeArrow.css({width:"0",height:"0","border-top":"5px solid transparent","border-left":"10px solid #fff","border-bottom":"5px solid transparent",position:"absolute",right:"-10px",top:"85px"})):(this.shareCodeArrowBorder.css({width:"0",height:"0","border-top":"6px solid transparent","border-right":"12px solid #dedede","border-bottom":"6px solid transparent",position:"absolute",
left:"-12px",top:"84px"}),this.shareCodeArrow.css({width:"0",height:"0","border-top":"5px solid transparent","border-right":"10px solid #fff","border-bottom":"5px solid transparent",position:"absolute",left:"-10px",top:"85px"})):(this.shareCodeArrowBorder.css({width:"0",height:"0","border-top":"6px solid transparent","border-left":"12px solid #dedede","border-bottom":"6px solid transparent",position:"absolute",right:"-12px",top:"84px"}),this.shareCodeArrow.css({width:"0",height:"0","border-top":"5px solid transparent",
"border-left":"10px solid #fff","border-bottom":"5px solid transparent",position:"absolute",right:"-10px",top:"85px"}));this.bigCodeBox.append(this.shareCodeArrowBorder);this.bigCodeBox.append(this.shareCodeArrow);this.bigMiniProgramCode.append(this.shareCodeArrow.clone(!0));bookConfig.RightToLeft?("popular"==global.templeteName?this.bigCodeBox.css({"z-index":"2",left:"-200px"}):this.bigCodeBox.css("right","-200px"),this.bigMiniProgramCode.css("right","-195px")):(this.bigCodeBox.css("left","-200px"),
this.bigMiniProgramCode.css("left","-195px"));this.shareCode.append(this.bigCodeBox);this.miniProgramCode.append(this.bigMiniProgramCode);this.shareCurrentPageBox=$("<div class='shareCurrentPageBox shareCurrentPageLink'></div>");this.shareCurrentCheck=$("<img class='shareCurrentPage' src="+this.searchOffUrl+" />");this.shareCurrentPageTitle1=$("<div class='shareCurrentPageTitle'>"+getLanguage("DownloadCurrentPage","Current Page")+"</div>");this.sharePanel=$("<div class='sharePanel'></div>");this.initQRCode()},
getQrCodeBoxStatus:function(){var a=this,b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(a.hasQrcode(),2);b=d.yieldResult;c=a.hasMiniProgram();return d.return(b||c)})},hasQrcode:function(){var a=this,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return bookConfig.socialSharingList&&0<bookConfig.socialSharingList.length?c.return(bookConfig.socialSharingList.includes("qrcode")):c.yield(a.analysisShare.getList(),
2);b=c.yieldResult;return c.return(b.length&&b.find(function(d){return"qrcode"==d.type}))})},hasMiniProgram:function(){return bookConfig.socialSharingList&&0<bookConfig.socialSharingList.length?bookConfig.socialSharingList.includes("miniCode"):bookConfig.SmallProgramUrl},setCurrentBoxStyle:function(){bookConfig.addCurrentPage?(this.shareCurrentPageBox.css({display:"block"}),this.shareCurrentPageBox.parent().css({height:"215px"})):(this.shareCurrentPageBox.css({display:"none"}),this.shareCurrentPageBox.parent().css({height:"200px"}))},
showOrHideCheck:function(){bookConfig.addCurrentPage?(this.shareCurrentChecked=!0,this.fillArea(!0,"link"),this.shareCurrentCheck.attr("src",this.searchOnUrl),this.shareCurrentCheck[0].colorChanged=!1):this.fillArea(!1,"link")},initQRCode:function(){var a=this,b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return a.qrcode=$("<div class='qrcode'>\n      <div class='QRcode'></div>\n      <div class='miniProgram'><img /></div>\n      <p class='title'></p>\n      </div>"),
g.yield(a.hasQrcode(),2);if(b=g.yieldResult)a.codeBox.append(a.shareCode),a.qrcode.find(".QRcode").qrcode({width:100,height:100,render:"image",text:share_url}),c=$("<span class='checked left' >"+getLanguage("frmShareQRcode","QRCode")+"</span>"),a.title1=c,$(a.qrcode.find("p")).append(c),a.qrcode.find(".QRcode").addClass("showQR"),c.onTap(function(){this.title2&&this.title2.removeClass("checked");c.addClass("checked");this.qrcode.find(".QRcode").addClass("showQR");this.qrcode.find(".miniProgram").removeClass("showQR")}.bind(a));
if(d=a.hasMiniProgram())a.codeBox.append(a.miniProgramCode),a.title1&&a.title1.css({cursor:""}),a.qrcode.find(".miniProgram img").attr("src",bookConfig.SmallProgramUrl),e=$("<span class='right'>"+getLanguage("frmShareSmallProgram","smallProgram")+"</span>"),a.title2=e,$(a.qrcode.find("p")).append(e),b||a.qrcode.find(".miniProgram").addClass("showQR"),e.onTap(function(){this.title1&&this.title1.removeClass("checked");e.addClass("checked");this.qrcode.find(".QRcode").removeClass("showQR");this.qrcode.find(".miniProgram").addClass("showQR")}.bind(a));
b&&d&&a.qrcode.addClass("two");a.initCodeCss(b,d);a.showOrHideCheck();g.jumpToEnd()})},initCodeCss:function(a,b){b||(this.codeButton.find(".miniProgram").css({display:"none"}),this.codeButton.find(".qrcode").css({width:"100%",background:"transparent",opacity:"1",cursor:"auto"}),"popular"!==global.templeteName&&this.shareCode.css({"margin-top":"10px"}));a?this.miniProgramCode.css({display:"none"}):(this.codeButton.find(".qrcode").css({display:"none"}),this.codeButton.find(".miniProgram").css({width:"100%",
background:"transparent",opacity:"1",cursor:"auto"}))},fillArea:function(a,b){var c=share_url;0<=c.toLowerCase().indexOf("file:")&&(c="index.html");a&&(this.shareCurrentChecked=a,c=c+"#p="+getShownPageNumber(BookInfo.getCurrentPageIndex()));"link"==b&&this.linkArea&&this.linkArea.val(c);this.shareCurrentCheck.attr("src",this.shareCurrentChecked?this.searchOnUrl:this.searchOffUrl);this.shareCurrentCheck[0].colorChanged=!1;this.qrcode.find(".QRcode").empty().qrcode({width:100,height:100,render:"image",
text:c});this.shareCode.find(".QRcode").empty().qrcode({width:100,height:100,render:global.isIE8()?"":"image",text:c})},addItem:function(a){var b=this,c,d,e,g,f,h,k,l,m,n,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(q){if(1==q.nextAddress){if(b.added)return q.return();b.added=!0;b.sharePanel.hide();return q.yield(b.analysisShare.getList(),2)}c=q.yieldResult;console.log("ShareElements shareList",c);if(!c||0>c.length)return q.return();d=c.filter(function(r){return"mobile"===r.filter&&
!isPC()||"pc"===r.filter&&isPC()?!1:!0});if(!d.length)return b.sharePanel.show(),null==(e=b.codeBox)||e.css({left:"50%",transform:"translateX(-50%)"}),a&&a(!0),q.return();b.loading=$('<img src="'+uiBaseURL+'loading.gif" style="position: absolute;left: 0;top: 0;right: 0;bottom: 0;margin: auto;"/>');$(b.sharePanel[0].parentElement.parentElement).append(b.loading);for(g=0;g<d.length;g++)f=d[g],h=void 0,f.type&&"copy"==f.type?(h=$("<a aria-label='"+f.title+"' tabindex='0' class='share-item' id='copy_url' data-clipboard-action='copy' title='"+
f.title+"'>\n            <img src='"+f.logo+"'/>\n          </a>"),copyHref(h[0])):h=-1<f.url.indexOf("javascript")?$("<a data-type='"+f.type+"' aria-label='"+f.title+"' tabindex='0' class='share-item' onclick='"+f.url.remove("javascript:")+";return false;' title='"+f.title+"'>\n            <img src='"+f.logo+"'/>\n          </a>"):$("<a data-type='"+f.type+"' aria-label='"+f.title+"' tabindex='0' class='share-item' target = '_blank' href='"+f.url+"' title='"+f.title+"'>\n            <img src='"+
f.logo+"'/>\n          </a>"),b.sharePanel.append(h),b.itemArray.push(h),k=b,h.bind(_event._end,function(){var r=$(this).attr("title");BookEvent.trigger("share",[BookInfo.getCurrentPageIndex(),r,k.shareCurrentChecked])});for(m=l=0;m<b.itemArray.length;m++)n=b.itemArray[m],p=n.find("img")[0],p.onload=function(){l++;l==b.itemArray.length&&(b.loading.remove(),b.sharePanel.show(),a&&a())};q.jumpToEnd()})},initEvent:function(a){this.copy1.bind(_event._click,function(){BookEvent.trigger("share",[BookInfo.getCurrentPageIndex(),
getLanguage("lblCopy","Copy"),self.shareCurrentChecked]);this.copyFrom(this.linkArea)}.bind(this));this.linkArea.bind(_event._click,function(){this.linkArea.select()}.bind(this));this.shareCurrentCheck.bind(_event._click,function(){this.shareCurrentChecked=!this.shareCurrentChecked;this.afterCheckClick()}.bind(this));this.linkArea.bind("mousedown touchstart pointerdown mouseover mousemove",function(b){b.stopPropagation()});this.initCodeEvent();this.linkInputChnagedEvent()},afterCheckClick:function(){this.fillArea(this.shareCurrentChecked,
"link");this.shareCurrentCheck.attr("src",this.shareCurrentChecked?this.searchOnUrl:this.searchOffUrl);this.shareCurrentCheck[0].colorChanged=!1;this.shareCurrentCheck.changeButtonColor(this.fontColor)},initCodeEvent:function(){bookConfig.SmallProgramUrl&&(this.codeButton.find(".qrcode").bind("click",function(){this.codeButton.find(".qrcode").addClass("active");this.codeButton.find(".miniProgram").removeClass("active");this.shareCode.show();this.miniProgramCode.hide();BookEvent.trigger("share",[BookInfo.getCurrentPages().join("-"),
getLanguage("frmShareQRcode","QRCode"),this.shareCurrentChecked])}.bind(this)),this.codeButton.find(".miniProgram").bind("click",function(){this.codeButton.find(".qrcode").removeClass("active");this.codeButton.find(".miniProgram").addClass("active");this.miniProgramCode.show();this.shareCode.hide();BookEvent.trigger("share",[BookInfo.getCurrentPages().join("-"),getLanguage("frmShareSmallProgram","smallProgram"),this.shareCurrentChecked])}.bind(this)),this.miniProgramCode.bind("mouseenter",function(){this.bigMiniProgramCode.fadeIn("100")}.bind(this)),
this.miniProgramCode.bind("mouseleave",function(){this.bigMiniProgramCode.fadeOut("100")}.bind(this)));this.shareCode&&(this.shareCode.bind("mouseenter",function(){this.initBigCode();this.bigCodeBox.fadeIn("100")}.bind(this)),this.shareCode.bind("mouseleave",function(){this.bigCodeBox.fadeOut("100")}.bind(this)))},initBigCode:function(){this.bigShareCode||(this.bigShareCode=$("<div class='bigShareCode'></div>"),this.bigCodeBox.append(this.bigShareCode));this.bigShareCode.empty().qrcode({width:160,
height:160,render:global.isIE8()?"":"image",text:share_url})},linkInputChnagedEvent:function(){if(this.linkArea)this.linkArea.on("input propertychange change",function(){var a=this,b,c,d,e,g,f,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return console.log("linkInputChnagedEvent"),b=a.linkArea.val(),0<=b.toLowerCase().indexOf("file:")&&(b="index.html"),share_url=b,a.analysisShare.refreshList(),(c=a.analysisShare.shareList)?k.jumpTo(2):k.yield(a.analysisShare.getList(),
3);2!=k.nextAddress&&(c=k.yieldResult);d=c;e={};for(g=0;g<a.itemArray.length;e={$jscomp$loop$prop$type$4:e.$jscomp$loop$prop$type$4},g++)f=a.itemArray[g],e.$jscomp$loop$prop$type$4=f.attr("data-type"),(h=d.find(function(l){return function(m){return m.type===l.$jscomp$loop$prop$type$4}}(e)))&&(-1<h.url.indexOf("javascript")?f.attr("onclick",h.url.remove("javascript:")+";return false;"):f.attr("href",h.url));k.jumpToEnd()})}.bind(this))},copyFrom:function(a){if(a){a.focus();a.select();try{document.execCommand("Copy")}catch(b){a=
a.val(),copyToClipboard(a)}}},pickElements:function(a){a.itemArray=this.itemArray;a.analysisShare=this.analysisShare;a.shareList=this.shareList;a.shareCode=this.shareCode;a.linkArea=this.linkArea;a.copy1=this.copy1;a.linkBox=this.linkBox;a.codeBox=this.codeBox;a.bigCodeBox=this.bigCodeBox;a.sharePanel=this.sharePanel;a.sharePanelTitle=this.sharePanelTitle;a.shareCurrentPageBox=this.shareCurrentPageBox;a.shareCurrentCheck=this.shareCurrentCheck;a.shareCurrentPageTitle1=this.shareCurrentPageTitle1;
a.qrcode=this.qrcode;a.getQrCodeStatus=this.getQrCodeBoxStatus;a.hasQrcode=this.hasQrcode;a.hasMiniProgram=this.hasMiniProgram},changeLanguage:function(){this.sharePanelTitle.html(getLanguage("frmPanelTitle","Share it")+":");this.shareCurrentPageTitle1.html(getLanguage("DownloadCurrentPage","Current Page"));this.copy1.html(getLanguage("lblCopy","Copy"));this.codeButton.find(".qrcode").html(getLanguage("frmShareQRcode","QRCode"));this.codeButton.find(".miniProgram").html(getLanguage("frmShareSmallProgram",
"smallProgram"));this.qrcode.find(".title").find(".left").html(getLanguage("frmShareQRcode","QRCode"));this.qrcode.find(".title").find(".right").html(getLanguage("frmShareSmallProgram","smallProgram"))}}).extend(FormElements),PcShareFrame=Class({create:function(a){this.elements=new ShareElements(this);this._super(a)},onCreate:function(){this.initColorCss();bookConfig.addCurrentPage&&this.content.css({height:"215px"});this._super()},initColorCss:function(){this.elements.fontColor=this.fontColor;this.stage.css({"background-color":this.mainColorObj.rgba(this.formOpacity),
color:this.fontColor,display:"none"})},initSwiperCss:function(){var a=this,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(a.getQrCodeStatus(),2);(b=c.yieldResult)?bookConfig.RightToLeft?a.swiperContainer.css({"border-right":"1px solid "+a.fontColorObj.rgba(.3)}):a.swiperContainer.css({"border-left":"1px solid "+a.fontColorObj.rgba(.3)}):a.swiperContainer.css({right:"initial",left:"0px"});c.jumpToEnd()})},initSwiper:function(){this.swiperContainer=
$("<div class='swiperContainer'></div>");this.shareStage=$("<div class='shareStage stage'></div>");this.shareSwiper=$("<div class='shareSwiper swiper'></div>");this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.shareSwiper.append(this.sharePanel);this.shareStage.append(this.shareSwiper);this.shareStage.append(this.progress);this.progress.append(this.progressBar);this.swiperContainer.append(this.shareStage);this.shareStage.scroll({},Direction.top,
"win10")},initHtml:function(){this._super()},resetColorChanged:function(){this._super();bookConfig.addCurrentPage&&(this.shareCurrentCheck[0].colorChanged=!1,this.elements.shareCurrentChecked?this.shareCurrentCheck.attr("src",this.elements.searchOnUrl):this.shareCurrentCheck.attr("src",this.elements.searchOffUrl))},changeIconColor:function(){this._super();this.changeItemColor()},changeItemColor:function(){this.elements.fontColor=this.fontColor;this.shareCurrentCheck.changeButtonColor(this.fontColor)},
onShow:function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(1==b.nextAddress)return b.yield(a.initSwiperCss(),2);a.changeIconColor();a.shareStage.refreshData();a.elements.addItem(function(c){a.stage[0].style.display="inline-block";a.setA11yAndFocus();var d;c&&(null==(d=a.swiperContainer)?0:d.length)&&a.swiperContainer.css({display:"none"})});b.jumpToEnd()})}}).extend(FadeOutFadeForm),PhoneShareForm=Class({create:function(a){this.elements=new ShareElements(this);
this._super(a)},onCreate:function(){this.stage.css({color:this.fontColor});this.close.changeButtonColor(this.fontColor);this.back.css({color:this.fontColor});this.favicon&&this.favicon.changeButtonColor(this.fontColor);this._super()},initHtml:function(){var a="Back";"Chinese"==UserGroups&&(a="\u8fd4\u56de");a=getLanguage("btnBack",a);this.back=$("<div class='back'><img src='"+(window.zoom_icons&&zoom_icons["arrow-left"]?"data:image/png;base64,"+zoom_icons["arrow-left"]:uiBaseURL+"arrow-left.png")+
"'/><span>"+a+"</span></div>");this.stage.append(this.back);this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.stage.append(this.qrcode);this.hideQRCode()},initSwiper:function(){var a=this,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return a.shareSwiper=$("<div class='shareSwiper stage'></div>"),a.shareSwiperList=$("<div class='swiper'></div>"),
c.yield(a.analysisShare.getList(),2);b=c.yieldResult;if(!b||0>b.length)return c.return();a.refreshSwiper(a.shareSwiperList,b);a.shareSwiper.append(a.shareSwiperList);isPhone()||isPad()?a.shareSwiper.css({"overflow-y":"auto","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}):(a.shareSwiper.css({overflow:"hidden"}),a.shareSwiperList.css({top:0,left:0,width:"100%",position:"absolute"}),a.progress=$("<div class='progress'></div>"),a.progressBar=$("<div class='progressBar'></div>"),a.shareSwiper.append(a.progress),
a.progress.append(a.progressBar),a.shareSwiper.scroll({},Direction.top));a.stage.append(a.shareSwiper);c.jumpToEnd()})},refreshSwiper:function(a,b){for(var c=b.length,d=0;d<c;d++)this.addItem(a,b[d])},addItem:function(a,b){b&&(b.fontColor=this.fontColor,(new PhoneShareItem(b)).appendTo(a))},refresh:function(){isPhone()||isPad()||!this.shareSwiper||this.shareSwiper.refreshData()},initEvent:function(){this.back.onTap(function(){this.hideQRCode()}.bind(this))},onShow:function(){this.close.changeButtonColor(this.fontColor);
this.favicon&&this.favicon.changeButtonColor(this.fontColor);this.shareSwiper||this.initSwiper()},onResize:function(){this._super();this.refresh()},showQRCode:function(){this.shareSwiper&&this.shareSwiper.hide();this.back.show();this.qrcode.show();$(this.back.find("img")).changeButtonColor(this.fontColor)},hideQRCode:function(){this.shareSwiper&&this.shareSwiper.show();this.back.hide();this.qrcode.hide()},changeLanguage:function(){this._super();this.back.find("span").html(getLanguage("btnBack","Back"))}}).extend(PhoneBottomFormFrame),
PhoneAboutForm=Class({create:function(a){this.elements=new AboutElements(this);this._super(a)},onCreate:function(){this._super();this.bookReadTimesVisible()},initHtml:function(){this.container=$("<div class='aboutSwpie' style='text-align:center;overflow:auto;position:relative;width:100%;height:"+(windowHeight-61)+"px;'></div>");this.title.append(this.close);this.stage.append(this.title);this.container.append(this.logo);this.container.append(this.description);this.container.append(this.author);this.container.append(this.address);
this.container.append(this.email);this.container.append(this.website);this.container.append(this.mobile);this.stage.append(this.container)},bookReadTimesVisible:function(){var a=setInterval(function(){try{0<global.aboutReadTimes?(this.container.append(this.views),clearInterval(a)):10<this.elements.iRead&&clearInterval(a)}catch(b){}}.bind(this),1E3)},changeItemColor:function(){},onResize:function(){this._super();this.container.css({height:windowHeight-61+"px"})},onShow:function(){this.favicon&&this.favicon.changeButtonColor(this.fontColor)},
initEvent:function(){}}).extend(PhoneFormFrame),PcAboutFrame=Class({create:function(a){this.elements=new AboutElements(this);this._super(a)},onCreate:function(){this.initColorCss();this._super()},initHtml:function(){this._super()},initColorCss:function(){this.stage.css({"background-color":this.mainColor,color:this.fontColor})},initLogo:function(){bookConfig.CompanyLogoFile||bookConfig.AboutDescription?(this.stage.find(".focus")[0]||(this.contactTitle.addClass("focus"),this.contactTitle.css("border",
"1px solid "+this.fontColor)),this.stage.find(this.descriptionTitle)[0]||this.stage.append(this.descriptionTitle),this.stage.find(this.contactTitle)[0]||this.stage.append(this.contactTitle),this.stage.find(this.content2)[0]||this.stage.append(this.content2),bookConfig.CompanyLogoFile&&!this.swiper.find(this.logo)[0]&&this.swiper.prepend(this.logo)):(this.stage.find(this.content2)[0]&&this.content2.remove(),this.stage.find(this.descriptionTitle)[0]&&this.descriptionTitle.remove(),this.stage.find(this.contactTitle)[0]&&
this.contactTitle.remove(),this.showContact())},onShow:function(){this.changeIconColor()}}).extend(FadeOutFadeForm),AboutElements=Class({create:function(a){this._super(a);decodeAboutInfo();this.initConfig();this.initElements();this.initEvent(a);this.pickElements(a);this.iRead=0},initConfig:function(){var a=setInterval(function(){try{this.iRead++,this.ReadTimes=global.aboutReadTimes?global.aboutReadTimes:0,0<this.ReadTimes?(this.resetAboutHtml(),clearInterval(a)):10<this.iRead&&clearInterval(a)}catch(b){}}.bind(this),
1E3)},initElements:function(){this.contactTitle=$("<span class='content_title contact_title'>"+getLanguage("frmaboutcaption","Contact")+"</span>");this.descriptionTitle=$("<span class='content_title description_title'>"+getLanguage("frmaboutDESCRIPTION","Description")+"</span>");this.logo=$("<a class='aboutLogo' rel='noopener noreferrer' target='_blank' style=\"display:none;background:url('"+bookConfig.CompanyLogoFile+"') center center no-repeat;background-size:contain;\"></a>");this.initDom();this.resetAboutHtml();
bookConfig.AboutWebsite&&this.logo.attr("href",bookConfig.AboutWebsite)},resetAboutHtml:function(){bookConfig.CompanyLogoFile?this.logo.css({display:"inline-block",background:"url('"+bookConfig.CompanyLogoFile+"') center center no-repeat","background-size":"contain",marginBottom:"10px"}):this.logo.css({display:"none"});this.strViews=getLanguage("frmaboutViews",global.aboutReadTimesCaptions);rightToLeft?(this.author.html("<div class='content rtl'>"+bookConfig.AboutAuthor+"</div><span class='title'>:  "+
getLanguage("frmaboutAUTHOR","Author")+"</span>"),this.address.html("<div class='content rtl'>"+bookConfig.AboutAddress+"</div><span class='title'>:  "+getLanguage("frmaboutADDRESS","Address")+"</span>"),this.email.html("<a href='mailto:"+bookConfig.AboutEmail+"' target='_blank'><span class='content'>"+bookConfig.AboutEmail+"</span></a><span class='title'>:  "+getLanguage("frmaboutEMAIL","Email")+"</span>"),this.website.html("<a href='"+bookConfig.AboutWebsite+"' target='_blank'><span class='content'>"+
bookConfig.AboutWebsite+"</span></a><span class='title'>:  "+getLanguage("frmaboutWEBSITE","Website")+"</span>"),this.mobile.html("<a href='tel:"+bookConfig.AboutMobile+"' target='_blank'><span class='content'>"+bookConfig.AboutMobile+"</span></a><span class='title'>:  "+getLanguage("frmaboutMOBILE","Mobile")+"</span>"),this.description.html("<span class='content rtl'>"+bookConfig.AboutDescription.replaceAll("  ","&ensp;")+"</span></div>"),this.views.html("<div class='content rtl'>"+this.ReadTimes+
"</div><span class='title'>:  "+getLanguage("frmaboutViews",this.strViews)+"</span>")):(this.author.html("<span class='title'>"+getLanguage("frmaboutAUTHOR","Author")+":  </span><span class='content'>"+bookConfig.AboutAuthor+"</span>"),this.address.html("<span class='title'>"+getLanguage("frmaboutADDRESS","Address")+":  </span><span class='content'>"+bookConfig.AboutAddress+"</span>"),this.email.html("<span class='title'>"+getLanguage("frmaboutEMAIL","Email")+":  </span><a href='mailto:"+bookConfig.AboutEmail+
"' target='_blank'><span class='content'>"+bookConfig.AboutEmail+"</span></a>"),this.website.html("<span class='title'>"+getLanguage("frmaboutWEBSITE","Website")+":  </span><a href='"+bookConfig.AboutWebsite+"' target='_blank'><span class='content'>"+bookConfig.AboutWebsite+"</span></a>"),this.mobile.html("<span class='title'>"+getLanguage("frmaboutMOBILE","Mobile")+":  </span><a href='tel:"+bookConfig.AboutMobile+"' target='_blank'><span class='content'>"+bookConfig.AboutMobile+"</span></a>"),this.description.html("<span class='content'>"+
bookConfig.AboutDescription.replaceAll("  ","&ensp;")+"</span>"),this.views.html("<span class='title'>"+getLanguage("frmaboutViews",this.strViews)+":  </span><div class='content'>"+this.ReadTimes+"</div>"));this.email.bind(_event._down,function(){BookEvent.trigger("jumpLink",["about email",BookInfo.getCurrentPages().join("-"),bookConfig.AboutEmail])});this.website.bind(_event._down,function(){BookEvent.trigger("jumpLink",["about website",BookInfo.getCurrentPages().join("-"),bookConfig.AboutWebsite])});
this.mobile.bind(_event._down,function(){BookEvent.trigger("jumpLink",["about mobile",BookInfo.getCurrentPages().join("-"),bookConfig.AboutMobile])});this.showOrHideContent()},showOrHideContent:function(){var a="contents";if(isPhone()||isPad()||"brief"==global.templeteName)a="block";this.views.css({display:this.ReadTimes?a:"none"});this.author.css({display:bookConfig.AboutAuthor?a:"none"});this.address.css({display:bookConfig.AboutAddress?a:"none"});this.email.css({display:bookConfig.AboutEmail?a:
"none"});this.website.css({display:bookConfig.AboutWebsite?a:"none"});this.mobile.css({display:bookConfig.AboutMobile?a:"none"});this.description.css({display:bookConfig.AboutDescription?"inline-block":"none"})},initDom:function(){this.views=$("<div class='views item'></div>");this.author=$("<div class='author item'></div>");this.address=$("<div class='address item'></div>");this.email=$("<div class='email item'></div>");this.website=$("<div class='website item'></div>");this.mobile=$("<div class='mobile item'></div>");
this.description=$("<div class='description item'></div>")},pickElements:function(a){a&&(a.contactTitle=this.contactTitle,a.descriptionTitle=this.descriptionTitle,a.logo=this.logo,a.author=this.author,a.address=this.address,a.email=this.email,a.website=this.website,a.mobile=this.mobile,a.description=this.description,a.views=this.views,a.ReadTimes=this.ReadTimes)},initEvent:function(a){this.contactTitle.onTap(function(){a.showContact()});this.descriptionTitle.onTap(function(){a.showDescription()})},
changeLanguage:function(){this.contactTitle.html(getLanguage("frmaboutcaption","Contact"));this.descriptionTitle.html(getLanguage("frmaboutDESCRIPTION","Description"));this.rightToLeft?(this.author.find(".title").html(":"+getLanguage("frmaboutAUTHOR","Author")),this.address.find(".title").html(":"+getLanguage("frmaboutADDRESS","Address")),this.email.find(".title").html(":"+getLanguage("frmaboutEMAIL","Email")),this.website.find(".title").html(":"+getLanguage("frmaboutWEBSITE","Website")),this.mobile.find(".title").html(":"+
getLanguage("frmaboutMOBILE","Mobile")),this.views.find(".title").html(":"+getLanguage("frmaboutViews",this.strViews))):(this.author.find(".title").html(getLanguage("frmaboutAUTHOR","Author")+":"),this.address.find(".title").html(getLanguage("frmaboutADDRESS","Address")+":"),this.email.find(".title").html(getLanguage("frmaboutEMAIL","Email")+":"),this.website.find(".title").html(getLanguage("frmaboutWEBSITE","Website")+":"),this.mobile.find(".title").html(getLanguage("frmaboutMOBILE","Mobile")+":"),
this.views.find(".title").html(getLanguage("frmaboutViews",this.strViews)+":"))}}).extend(FormElements);
Class("WindowMagnifierBox",{create:function(a){this.parent=a;this.canZoom=global.canMagnifierZoom=!1;this.loadH=this.loadW=0;this.maxScale=2;this.magnifierH=this.magnifierW=130;this.shadowSize=this.maxScale*this.magnifierW*.03;this.drawH=this.drawW=0;this.ratioW=this.ratioH=1;this.config=[];this.initHtml();this.initCss()},initHtml:function(){this.magnifierZoom=$("<div class='magnifierZoom'></div>");this.bg=$("<div></div>");this.canvas=$("<canvas width='0' height='0'></canvas>");this.ctx=this.canvas[0].getContext("2d");
this.magnifierZoom.append(this.canvas).append(this.bg);tmpContainer.append(this.magnifierZoom)},initCss:function(){this.magnifierZoom.css({background:"#fff",position:"absolute","pointer-events":"none","border-radius":"50%",display:"none","box-shadow":"0 0 "+this.shadowSize/3+"px #999","-ms-box-shadow":"0 0 "+this.shadowSize/3+"px #999","-moz-box-shadow":"0 0 "+this.shadowSize/3+"px #999","-webkit-box-shadow":"0 0 "+this.shadowSize/3+"px #999","z-index":"1000"});this.bg.css({position:"absolute","pointer-events":"none",
"border-radius":"50%",width:"100%",height:"100%","box-shadow":"0 0 "+this.shadowSize+"px #999 inset","-ms-box-shadow":"0 0 "+this.shadowSize+"px #999 inset","-moz-box-shadow":"0 0 "+this.shadowSize+"px #999 inset","-webkit-box-shadow":"0 0 "+this.shadowSize+"px #999 inset","z-index":"2"});this.canvas.css({background:"#fff","border-radius":"50%","pointer-events":"none","transform-origin":"0 0","-o-transform-origin":"0 0","-ms-transform-origin":"0 0","-moz-transform-origin":"0 0","-webkit-transform-origin":"0 0",
position:"absolute","z-index":"1"})},onResize:function(){},setImg:function(a,b){this.side=a;imgs=a.find("img");imgs.each(function(c,d){d=$(d);this.config[c]||(this.config[c]={});this.config[c].offset=d.offset();var e=d.attr("src");bookConfig.isEncryptionBook||(e=e.removeStartFrom("?"));this.config[c].showImg=$('<img src="'+e+'">');this.config[c].loadW?this.beforeDraw(b,this.config[c],d):(a.css({cursor:"wait"}),this.config[c].showImg.on("load",function(){a.css({cursor:"none"});this.config[c].loadW=
this.config[c].showImg[0].naturalWidth;this.config[c].loadH=this.config[c].showImg[0].naturalHeight;this.beforeDraw(b,this.config[c],d)}.bind(this)))}.bind(this))},beforeDraw:function(a,b,c){this.freshWidthAndHeight(b,c);this.drawBg(a,b)},freshWidthAndHeight:function(a,b){a.rateW=a.loadW/b.width();a.rateH=a.loadH/b.height();var c=a.loadW/a.loadH;b=b.width()/b.height();a.ratioH=c/b;a.ratioW=b/c;a.drawW=a.rateW*this.magnifierW;a.drawW<this.magnifierW&&(a.drawW=this.magnifierW);a.drawW>this.magnifierW*
this.maxScale&&(a.drawW=this.magnifierW*this.maxScale);a.drawH=a.rateH*this.magnifierH*a.ratioH;a.drawH<this.magnifierH&&(a.drawH=this.magnifierH);a.drawH>this.magnifierH*this.maxScale&&(a.drawH=this.magnifierH*this.maxScale);this.drawW<a.drawW&&(this.drawW=a.drawW,this.drawH=a.drawH)},drawBg:function(a,b){this.canvas[0].width=this.drawW;this.canvas[0].height=this.drawH;b?this.drawOnceImg(a,b):this.config.forEach(function(c){this.drawOnceImg(a,c)}.bind(this))},freshPageScale:function(){1<this.config.length?
(this.config[0].scale=this.config[0].loadW/this.config[1].loadW,this.config[1].scale=this.config[1].loadW/this.config[0].loadW):this.config[0].scale=1},drawOnceImg:function(a,b){this.canvas.css({display:"block"});var c=a.pageX-b.offset.left-this.magnifierW/2,d=a.pageY-b.offset.top-this.magnifierH/2;this.magnifierZoom.css({left:a.pageX-this.drawW/2+"px",top:a.pageY-this.drawH/2+"px"});this.drawImg(b.showImg,c*b.rateW,d*b.rateH,b.rateW*this.magnifierW,b.rateH*this.magnifierH,this.drawW,this.drawH)},
drawImg:function(a,b,c,d,e,g,f){this.magnifierZoom.css({width:g+"px",height:f+"px"});this.ctx.beginPath();this.ctx.drawImage(a[0],b,c,d,e,0,0,g,f);this.ctx.closePath()},show:function(){this.magnifierZoom.css({display:"block"});this.canvas.css({display:"block"})},hide:function(){this.magnifierZoom.css({display:"none"});this.canvas.css({display:"none"})}});
var JSColorPanel=Class({create:function(a){this.parent=a||tmpContainer;this.initColorPanel();this.initColorPanelCss();this.initEvent()},initColorPanel:function(){this.stage=$("<div></div>");this.colorPanel=$("<div></div>");this.colorSlider=$("<div></div>");this.alphaSlider=$("<div></div>");this.colorPoint=$('<div class="point"></div>');this.sliderPoint=$('<div class="point"></div>');this.alphaPoint=$('<div class="point"></div>');this.stage.append(this.colorPanel).append(this.colorSlider).append(this.alphaSlider);
this.colorPanel.append(this.colorPoint);this.colorSlider.append(this.sliderPoint);this.alphaSlider.append(this.alphaPoint);this.parent.append(this.stage)},initColorPanelCss:function(){this.stage.css({display:"none","z-index":"11111",position:"absolute",width:"auto",padding:"0 1px",height:"152px",background:"#fff",border:"1px solid #CCCCCC",left:"120px",top:"50px"});this.colorPanel.css({position:"relative",float:"left",top:"1px",left:"0px",width:"150px",height:"150px",background:"url("+uiBaseURL+"jsColorPanel.png) -120px 0 no-repeat",
"background-color":"#ff0000",cursor:"crosshair"});this.colorSlider.css({position:"relative",float:"left",top:"1px","margin-left":"1px",width:"20px",height:"150px",background:"white url("+uiBaseURL+"jsColorPanel.png) 0 0",cursor:"row-resize"});this.alphaSlider.css({position:"relative",float:"left",top:"1px","margin-left":"1px",width:"20px",height:"150px",background:"white url("+uiBaseURL+"jsColorPanel.png) -40px 0 no-repeat",cursor:"row-resize"});this.colorPoint.css({position:"absolute",top:"0px",
left:"150px",width:"8px",height:"8px",border:"solid 2px #bbb","border-radius":"10px","margin-top":"-6px","margin-left":"-6px",background:"none"});this.sliderPoint.css({position:"absolute",top:"0",left:"0",width:"18px",height:"2px",background:"white",border:"solid 1px black","margin-top":"-2px","-moz-box-sizing":"content-box","-webkit-box-sizing":"content-box","box-sizing":"content-box"});this.alphaPoint.css({position:"absolute",top:"0",left:"0",width:"18px",height:"2px",background:"white",border:"solid 1px black",
"margin-top":"-2px","-moz-box-sizing":"content-box","-webkit-box-sizing":"content-box","box-sizing":"content-box"})},destroy:function(){this.stage.remove()},showColorSelection:function(a){a=a.toUpperCase();this.selection.setColor(a)},colorSelected:function(a){this.hide();a=a.toUpperCase();this.selection.setColor(a)},showOrHide:function(a){a.elem&&(this.visible&&a.elem[0]==this.curElem[0]?this.hide():this.show(a))},hide:function(){this.stage.fadeOut(200,function(){this.visible=!1}.bind(this))},show:function(a){a.elem&&
(a.closeAlpha?this.alphaSlider.css({display:"none"}):this.alphaSlider.css({display:"block"}),this.visible=!0,this.curElem=a.elem,this.curInput=a.input?a.input:"",this.freshPanelCss(),this.updateFromOuter(this.curElem),this.stage.fadeIn(200))},freshPanelCss:function(){var a=this.curElem.offset(),b=this.stage.width(),c=this.stage.height(),d=this.curElem.width(),e=this.curElem.height();var g=a.left;var f=a.top+e+5;a.left+d+b+5>windowWidth&&(g=a.left-b+d-5);a.top+e+c+5>windowHeight&&(f=a.top-c-5);this.stage.css({top:f+
"px",left:g+"px"})},updateFromOuter:function(a){this.curColor=$(a).attr("color")?$(a).attr("color"):"#ff0000";this.curAlpha=$(a).attr("alpha")?$(a).attr("alpha"):"1.00";hex=this.convertCase(this.parseHex(this.curColor,!0));hsb=this.hex2hsb(hex);this.curAlpha&&(this.curAlpha=""===this.curAlpha?1:this.keepWithin(parseFloat(this.curAlpha).toFixed(2),0,1),b=this.keepWithin(this.alphaSlider.height()-this.alphaSlider.height()*this.curAlpha,0,this.alphaSlider.height()),this.alphaPoint.css("top",b+"px"));
a=this.keepWithin(Math.ceil(hsb.s/(100/this.colorPanel.width())),0,this.colorPanel.width());var b=this.keepWithin(this.colorPanel.height()-Math.ceil(hsb.b/(100/this.colorPanel.height())),0,this.colorPanel.height());this.colorPoint.css({top:b+"px",left:a+"px"});b=this.keepWithin(this.colorSlider.height()-hsb.h/(360/this.colorSlider.height()),0,this.colorSlider.height());this.sliderPoint.css("top",b+"px");this.colorPanel.css("backgroundColor",this.hsb2hex({h:hsb.h,s:100,b:100}))},getColorConfig:function(){return{color:this.curColor,
alpha:this.curAlpha}},setPosition:function(a,b){this.stage.css({left:a+"px",top:b+"px"})},updateColor:function(){gridPos=this.getCoords(this.colorPoint,this.colorPanel);sliderPos=this.getCoords(this.sliderPoint,this.colorSlider);opacityPos=this.getCoords(this.alphaPoint,this.alphaSlider);hue=this.keepWithin(360-parseInt(sliderPos.y*(360/this.colorSlider.height()),10),0,360);saturation=this.keepWithin(Math.floor(gridPos.x*(100/this.colorPanel.width())),0,100);brightness=this.keepWithin(100-Math.floor(gridPos.y*
(100/this.colorPanel.height())),0,100);this.curColor=this.hsb2hex({h:hue,s:saturation,b:brightness});var a=this.hsb2hex({h:hue,s:100,b:100});this.curAlpha=parseFloat(1-opacityPos.y/this.alphaSlider.height()).toFixed(2);this.curElem.css({"background-color":this.curColor,opacity:this.curAlpha});this.curElem.attr("color",this.curColor);this.curElem.attr("alpha",this.curAlpha);this.curInput&&this.curInput.val(this.curColor);this.colorPanel.css({"background-color":a})},getCoords:function(a,b){if(!a.length||
!b)return null;var c=a.offset().left;var d=a.offset().top;return{x:c-b.offset().left+a.outerWidth()/2,y:d-b.offset().top+a.outerHeight()/2}},initEvent:function(){this.stage.bind(_event._down,function(a){this.isFocus=!0;this.curPoint=$(a.target);this.curSlider=$(a.target);if(a.target==this.colorPoint[0]||a.target==this.sliderPoint[0]||a.target==this.alphaPoint[0])this.curPoint=$(a.target),this.curSlider=$(a.target).parent();this.curSlider[0]==this.colorPanel[0]&&(this.curPoint=this.colorPoint);this.curSlider[0]==
this.colorSlider[0]&&(this.curPoint=this.sliderPoint);this.curSlider[0]==this.alphaSlider[0]&&(this.curPoint=this.alphaPoint);a=this.getEventPos(a);this.curPoint[0]==this.colorPoint[0]?this.curPoint.animate({left:a.x+"px",top:a.y+"px"},50,this.updateColor.bind(this)):this.curPoint.animate({top:a.y+"px"},50,this.updateColor.bind(this))}.bind(this));this.stage.bind(_event._move,function(a){this.isFocus&&(a=this.getEventPos(a),this.curPoint[0]==this.colorPoint[0]?this.curPoint.stop(!0).animate({left:a.x+
"px",top:a.y+"px"},0,this.updateColor.bind(this)):this.curPoint.stop(!0).animate({top:a.y+"px"},0,this.updateColor.bind(this)))}.bind(this));this.stage.bind(_event._up,function(a){a.stopPropagation();this.isFocus=!1}.bind(this));tmpContainer.bind(_event._up,function(a){this.isFocus=!1;this.hide()}.bind(this))},getEventPos:function(a){a=a.originalEvent&&a.originalEvent.changedTouches?a.originalEvent.changedTouches:a.changedTouches?a.changedTouches:[a];var b=this.curSlider.offset().left,c=this.curSlider.offset().top;
b=Math.round(a[0].pageX-b);a=Math.round(a[0].pageY-c);b=this.keepWithin(b,0,this.curSlider.width());a=this.keepWithin(a,0,this.curSlider.height());return{x:b,y:a}},rgbObject:function(a){var b=parseHex($(a).val(),!0);b=hex2rgb(b);a=$(a).attr("data-opacity");if(!b)return null;void 0!==a&&$.extend(b,{a:parseFloat(a)});return b},rgbString:function(a,b){var c=parseHex($(a).val(),!0);c=hex2rgb(c);a=$(a).attr("data-opacity");if(!c)return null;void 0===a&&(a=1);return b?"rgba("+c.r+", "+c.g+", "+c.b+", "+
parseFloat(a)+")":"rgb("+c.r+", "+c.g+", "+c.b+")"},convertCase:function(a,b){return"uppercase"===b?a.toUpperCase():a.toLowerCase()},parseHex:function(a,b){a=a.replace(/[^A-F0-9]/gi,"");if(3!==a.length&&6!==a.length)return"";3===a.length&&b&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);return"#"+a},keepWithin:function(a,b,c){a<b&&(a=b);a>c&&(a=c);return a},hsb2rgb:function(a){var b,c;var d=Math.round(a.h);var e=Math.round(255*a.s/100);a=Math.round(255*a.b/100);if(0===e)d=b=c=a;else{e=(255-e)*a/255;var g=d%60*
(a-e)/60;360===d&&(d=0);60>d?(d=a,c=e,b=e+g):120>d?(b=a,c=e,d=a-g):180>d?(b=a,d=e,c=e+g):240>d?(c=a,d=e,b=a-g):300>d?(c=a,b=e,d=e+g):360>d?(d=a,b=e,c=a-g):c=b=d=0}return{r:Math.round(d),g:Math.round(b),b:Math.round(c)}},rgb2hex:function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(c,d){1===d.length&&(b[c]="0"+d)});return"#"+b.join("")},hsb2hex:function(a){return this.rgb2hex(this.hsb2rgb(a))},hex2hsb:function(a){a=this.rgb2hsb(this.hex2rgb(a));0===a.s&&(a.h=360);
return a},rgb2hsb:function(a){var b={h:0,s:0,b:0},c=Math.max(a.r,a.g,a.b),d=c-Math.min(a.r,a.g,a.b);b.b=c;b.s=0!==c?255*d/c:0;b.h=0!==b.s?a.r===c?(a.g-a.b)/d:a.g===c?2+(a.b-a.r)/d:4+(a.r-a.g)/d:-1;b.h*=60;0>b.h&&(b.h+=360);b.s*=100/255;b.b*=100/255;return b},hex2rgb:function(a){a=parseInt(-1<a.indexOf("#")?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}}}),getRandomColor=function(){return"#"+Math.floor(1118481+14540253*Math.random()).toString(16)},BookmarkElements=Class({create:function(a){this._super(a);
this.initElements();this.initEvent(a);this.pickElements(a)},initElements:function(){this.input=$("<input aria-label='"+getLanguage("ariaAddBookmark","add bookmark")+"' class='input_title ' placeholder='"+FormInfo.getFormTitle("bookmark")+"'></input>");this.colorSelection=$("<input aria-label='"+getLanguage("ariaColorSelection","color selection")+"' class='colorSelection' readonly type='text' color='#ff0000' style='background:#ff0000;'></input>");this.setRandom();this.rightToLeft?this.initRightToLeftDefaultDom():
this.initLeftToRightDefaultDom();this.remove=$("<div class='removeAll button_hover'>"+getLanguage("lblRemoveAll","Remove All")+"</div>")},initRightToLeftDefaultDom:function(){this.leftAddPage=$("<div class='add_page button_hover'><span class='pageIndex'></span> <span class='title'>"+getLanguage("lblAddToPage","Add To Page")+"</span></div>");this.rightAddPage=$("<div class='add_page left button_hover'><span class='pageIndex'></span> <span class='title'>"+getLanguage("lblAddToPage","Add To Page")+"</span></div>");
this.bookmarkListTitle=$("<div class='list_title'><span class='edit'>"+getLanguage("lblEdit","Edit")+"</span><span class='description'>"+getLanguage("lblDescription","Title")+"</span><span class='page'>"+getLanguage("lblPage","Page")+"</span></div>")},initLeftToRightDefaultDom:function(){this.leftAddPage=$("<div class='add_page left'><span class='title'>"+getLanguage("lblAddToPage","Add To Page")+"</span> <span class='pageIndex'></span></div>");this.rightAddPage=$("<div class='add_page'><span class='title'>"+
getLanguage("lblAddToPage","Add To Page")+"</span> <span class='pageIndex'></span></div>");this.bookmarkListTitle=$("<div class='list_title'><span class='page'>"+getLanguage("lblPage","Page")+"</span><span class='description'>"+getLanguage("lblDescription","Title")+"</span><span class='edit'>"+getLanguage("lblEdit","Edit")+"</span></div>")},getColor:function(){return this.colorSelection.attr("color")},pickElements:function(a){a&&(a.input=this.input,a.colorSelection=this.colorSelection,a.remove=this.remove,
a.leftAddPage=this.leftAddPage,a.rightAddPage=this.rightAddPage,a.bookmarkListTitle=this.bookmarkListTitle)},setRandom:function(){var a=getRandomColor();this.colorSelection.attr("color",a);this.colorSelection.css("background",a)},initEvent:function(a){this.leftAddPage.click(function(){var b={pageIndex:this.leftPageIndex,caption:this.input.val(),color:this.getColor()};a.addItem(b)}.bind(this));this.rightAddPage.click(function(){var b={pageIndex:this.rightPageIndex,caption:this.input.val(),color:this.getColor()};
a.addItem(b)}.bind(this));this.remove.click(function(){a.removeAll()}.bind(this));this.input.bind("mousedown touchstart pointerdown mouseover mousemove",function(b){b.stopPropagation()});this.colorSelection.bind(_event._up,function(b){b.stopPropagation();global.colorPanel&&global.colorPanel.showOrHide({e:b,elem:this.colorSelection,closeAlpha:!0})}.bind(this))},refreshElements:function(){this.refreshAddPageButtonOnPc();this.refreshAddPageButtonOnPhone()},refreshAddPageButtonOnPc:function(){if(!isPhone()&&
!isPad()){0>=this.bookmarkList.getLength()?this.remove.hide():this.remove.show();var a=BookInfo.getCurrentPages();this.leftPageIndex=parseInt(a[0]);this.rightPageIndex=parseInt(a[1]);this.showOrHideAddPageBtn();this.focusAddPageBtn()}},refreshAddPageButtonOnPhone:function(){if((isPhone()||isPad())&&toolBar.buttons&&toolBar.buttons.find("PhoneBookmarkButton",!0).get(0)){for(var a=BookInfo.getCurrentPages(),b=0;b<a.length;b++)if(this.bookmarkList.inList(a[b])){toolBar.buttons.find("PhoneBookmarkButton",
!0).get(0).setAsAdded();return}toolBar.buttons.find("PhoneBookmarkButton",!0).get(0).setAsUnAdded()}},showOrHideAddPageBtn:function(){this.leftPageIndex?(this.leftAddPage.find(".pageIndex").html(getShownPageNumber(this.leftPageIndex)),this.leftAddPage.show()):this.leftAddPage.hide();this.rightPageIndex?(this.rightAddPage.find(".pageIndex").html(getShownPageNumber(this.rightPageIndex)),this.rightAddPage.show()):this.rightAddPage.hide()},focusAddPageBtn:function(){this.leftPageIndex&&!this.bookmarkList.inList(this.leftPageIndex)?
(this.leftAddPage.removeClass("disable"),this.leftAddPage.addClass("usable"),this.leftAddPage.addClass("button_hover")):(this.leftAddPage.addClass("disable"),this.leftAddPage.removeClass("usable"),this.leftAddPage.removeClass("button_hover"));this.rightPageIndex&&!this.bookmarkList.inList(this.rightPageIndex)?(this.rightAddPage.removeClass("disable"),this.rightAddPage.addClass("usable"),this.rightAddPage.addClass("button_hover")):(this.rightAddPage.addClass("disable"),this.rightAddPage.removeClass("usable"),
this.rightAddPage.removeClass("button_hover"))},changeLanguage:function(){this.input.attr("placeholder",FormInfo.getFormTitle("tableOfContent"));this.remove.html(getLanguage("lblRemoveAll","Remove All"));this.leftAddPage.find(".title").html(getLanguage("lblAddToPage","Add To Page"));this.rightAddPage.find(".title").html(getLanguage("lblAddToPage","Add To Page"));this.bookmarkListTitle.find(".edit").html(getLanguage("lblEdit","Edit"));this.bookmarkListTitle.find(".description").html(getLanguage("lblDescription",
"Title"));this.bookmarkListTitle.find(".page").html(getLanguage("lblPage","Page"));var a=this.bookmarkListPanel.bookmarkSwiperList;a.find(".save").attr("title",getLanguage("lblSave","Save"));a.find(".cancel").attr("title",getLanguage("lblCancel","Cancel"));a.find(".edit").attr("title",getLanguage("lblEdit","Edit"));a.find(".delete").attr("title",getLanguage("lblDelete","Delete"))}}).extend(FormElements),BookmarkItem=Class({create:function(a,b){this.callback=b;this.parm={color:a.color,caption:a.caption,
pageIndex:parseInt(a.pageIndex)};this.item=$("<div class='item' pageIndex='"+parseInt(a.pageIndex)+"' id='bookmark_item"+parseInt(a.pageIndex)+"'></div>");this.saveUrl=form_icons.save?"data:image/png;base64,"+form_icons.save:uiBaseURL+"save.png";this.cancelUrl=form_icons.cancel?"data:image/png;base64,"+form_icons.cancel:uiBaseURL+"cancel.png";this.editUrl=form_icons.edit?"data:image/png;base64,"+form_icons.edit:uiBaseURL+"edit.png";this.deleteUrl=form_icons["delete"]?"data:image/png;base64,"+form_icons["delete"]:
uiBaseURL+"delete.png";this.fontColor=a.fontColor;this.color=a.color;this.caption=a.caption;this.pageCaption=getShownPageNumber(parseInt(a.pageIndex));this.pageIndex=parseInt(a.pageIndex);this.colorObj=Color(this.fontColor);this.initDefaultDom();this.initHtml();this.initEvent()},resetColor:function(a){this.fontColor=a;this.colorObj=Color(this.fontColor)},initHtml:function(){rightToLeft?this.initRightToLeftHtml():this.initLeftToRightHtml();this.deleteIcon.changeButtonColor(this.fontColor);this.edit.changeButtonColor(this.fontColor);
this.cancel.changeButtonColor(this.fontColor);this.save.changeButtonColor(this.fontColor)},initRightToLeftHtml:function(){this.item.append(this.deleteIcon);this.item.append(this.edit);this.item.append(this.cancel);this.item.append(this.save);this.item.append(this.title);this.item.append(this.colorSelection);this.item.append(this.page)},initLeftToRightHtml:function(){this.item.append(this.page);this.item.append(this.title);this.item.append(this.colorSelection);this.item.append(this.save);this.item.append(this.cancel);
this.item.append(this.edit);this.item.append(this.deleteIcon)},initDefaultDom:function(){this.page=$("<span class='page'>"+this.pageCaption+"</span>");this.title=$("<input class='title' title='"+this.caption+"' value='"+this.caption+"' disabled='disabled'></input>");this.colorSelection=$("<input class='colorSelection' readonly type='text' style='background:"+this.color+"'></input>");this.colorSelection.attr("color",this.color);this.save=$("<img class='save' title='"+getLanguage("lblSave","Save")+
"' src='"+this.saveUrl+"'/>");this.cancel=$("<img class='cancel' title='"+getLanguage("lblCancel","Cancel")+"' src='"+this.cancelUrl+"'/>");this.edit=$("<img class='edit' title='"+getLanguage("lblEdit","Edit")+"' src='"+this.editUrl+"'/>");this.deleteIcon=$("<img class='delete' title='"+getLanguage("lblDelete","Delete")+"' src='"+this.deleteUrl+"'/>");this.title.css({color:this.fontColor})},appendTo:function(a){a.append(this.item)},insertBefore:function(a){this.item.insertBefore(a)},insertAfter:function(a){this.item.insertAfter(a)},
initEvent:function(){this.edit.onTap(function(){this.startEdit()}.bind(this));this.cancel.onTap(function(){this.endEdit();this.cancelData()}.bind(this));this.save.onTap(function(){this.endEdit();this.saveData()}.bind(this));this.deleteIcon.onTap(function(){this.item.remove();this.callback.deleteItem(this.parm.pageIndex)}.bind(this));this.item.onTap(function(){this.judgeToSaveOrCancel();gotoPageFun(this.pageIndex,!1,"bookmark")}.bind(this));this.title.bind("keypress",function(a){"13"==a.keyCode&&(this.endEdit(),
this.saveData())}.bind(this));this.item.bind("mouseover",function(){global.bookmark.editingItem!=this&&this.item.css({background:this.colorObj.rgba(.1)})}.bind(this));this.item.bind("mouseleave",function(){global.bookmark.editingItem!=this&&this.item.css({"background-color":"transparent"})}.bind(this));this.colorSelection.bind(_event._up,function(a){a.stopPropagation();global.colorPanel&&global.colorPanel.showOrHide({e:a,elem:this.colorSelection,closeAlpha:!0})}.bind(this))},saveData:function(){var a=
this.colorSelection.attr("color"),b=this.title.val();if(b!=this.caption||a!=this.color)this.caption=b,this.color=a,this.parm={pageIndex:this.pageIndex,caption:this.caption,color:this.color},this.callback.editItem(this.parm)},cancelData:function(){var a=this.colorSelection.attr("color");this.title.val()!=this.caption&&this.title.val(this.caption);a!=this.color&&this.colorSelection.attr("color",this.color)},endEdit:function(){this.colorSelection.hide();this.cancel.hide();this.save.hide();this.edit.show();
this.title.css({background:"transparent",color:this.fontColor});this.title.attr("disabled","disabled");global.bookmark.editingItem=null},startEdit:function(){this.judgeToSaveOrCancel();this.lightItem();this.colorSelection.show();this.cancel.show();this.save.show();this.edit.hide();this.title.css({background:"#ffffff",color:"#000000"});this.title.removeAttr("disabled");global.bookmark.editingItem=this;this.cancel.changeButtonColor(this.fontColor);this.save.changeButtonColor(this.fontColor)},judgeToSaveOrCancel:function(){global.bookmark.editingItem&&
global.bookmark.editingItem!=this&&(global.bookmark.editingItem.cancelData(),global.bookmark.editingItem.endEdit())},lightItem:function(){$(".bookmarkItem_focus").css({background:"transparent"});$(".bookmarkItem_focus").removeClass("bookmarkItem_focus");this.item.addClass("bookmarkItem_focus");this.item.css({background:this.colorObj.rgba(.25)})},changeLanguage:function(){this.save.attr("title",getLanguage("lblSave","Save"));this.cancel.attr("title",getLanguage("lblCancel","Cancel"));this.edit.attr("title",
getLanguage("lblEdit","Edit"));this.deleteIcon.attr("title",getLanguage("lblDelete","Delete"))},refreshImage:function(){getPageDir(this.pageIndex,"thumb",originTotalPageCount).then(function(a){a.match(/^none/)?self.itemImg.css({background:bookConfig.pageBackgroundColor}):self.itemImg.css({background:"url("+a+") center center no-repeat","background-size":"contain"})})}}),PhoneBookmarkItem=Class({create:function(a,b){this.parm=a;this.color=a.color;this.pageCaption="P:"+parseInt(a.pageIndex);this.pageIndex=
parseInt(a.pageIndex);this.callback=b;this.item=$("<div class='item'></div>");this.page=$("<span class='page'>P:"+getShownPageNumber(this.pageIndex)+"</span>");this.caption=$("<span class='title'>page:"+getShownPageNumber(this.pageIndex)+"</span>");this.deleteBtn=$("<span class='delete button' role='button'></span>");this.item.append(this.page);passwardType()||this.refreshImage();this.item.append(this.caption);this.item.append(this.deleteBtn);this.initEvent()},appendTo:function(a){a.append(this.item)},
initEvent:function(){this.deleteBtn.on(_event._click,function(){this.item.remove();this.callback.deleteItem(this.pageIndex)}.bind(this));this.item.on(_event._click,function(){gotoPageFun(this.pageIndex,!1,"bookmark");bookmark.hide()}.bind(this))},changeLanguage:function(){},refreshImage:function(){var a=this;getPageDir(this.pageIndex,"thumb",originTotalPageCount).then(function(b){a.item.find(".thumbnail").remove();b.match(/^none/)?a.image=$("<div class='thumbnail' style='display: inline-block;background:"+
bookConfig.pageBackgroundColor+";width:60px;'></div>"):a.image=$("<img class='thumbnail' src='"+b+"'/>");isPhone()||isPad()?bookConfig.EnableRecognizeQRcodePressOnMobile||a.image.css({"pointer-events":"none"}):bookConfig.isStopMouseMenu&&a.image.css({"pointer-events":"none"});a.item.append(a.image)})}}),AnalysisBookmark=Class({create:function(){this.bookmarkList=[];this.bookmarkDetaildList=[];this.key=window.location.href.replace(window.location.hash,"").replace(window.location.search,"")+"BookMark";
this.refresh()},refresh:function(){var a=this.getListFromLocalStorage();if(a&&0!=a.length){for(var b=0;b<a.length;b++)parseInt(a[b].pageIndex)&&this.bookmarkList.push(parseInt(a[b].pageIndex));this.bookmarkDetaildList=a}},getListFromLocalStorage:function(){var a=this.getLocalStorage(this.key);return Instance.parse(a)},getList:function(){return this.bookmarkList},getItem:function(a){for(var b,c=0;c<this.bookmarkDetaildList.length;c++)if(parseInt(this.bookmarkDetaildList[c].pageIndex)==parseInt(a)){b=
this.bookmarkDetaildList[c];break}return b},editItem:function(a){for(var b=a.pageIndex,c=0;c<this.bookmarkDetaildList.length;c++)if(parseInt(this.bookmarkDetaildList[c].pageIndex)==parseInt(b)){this.bookmarkDetaildList[c].caption=a.caption;this.bookmarkDetaildList[c].color=a.color;break}this.refreshLocalStorage()},addItem:function(a){var b=a.pageIndex;0>this.bookmarkList.indexOf(b)&&(this.bookmarkList.push(b),this.bookmarkDetaildList.push(a),this.sortList())},deleteItem:function(a){for(var b=0;b<
this.bookmarkDetaildList.length;b++)if(parseInt(this.bookmarkDetaildList[b].pageIndex)==parseInt(a)){this.bookmarkDetaildList.remove(b);this.bookmarkList.remove(b);break}this.refreshLocalStorage()},removeAll:function(){this.bookmarkList=[];this.bookmarkDetaildList=[];this.deleteLocalStorage(this.key)},sortList:function(){this.bookmarkList.sort(function(e,g){return e-g});for(var a=[],b=0;b<this.bookmarkList.length;b++)for(var c=this.bookmarkList[b],d=0;d<this.bookmarkDetaildList.length;d++)if(parseInt(this.bookmarkDetaildList[d].pageIndex)==
parseInt(c)){a.push(this.bookmarkDetaildList[d]);break}this.bookmarkDetaildList=a;this.refreshLocalStorage()},getLocalStorage:function(a){try{if(window.localStorage[a])return window.localStorage.getItem(a)}catch(b){}},refreshLocalStorage:function(){try{window.localStorage&&window.localStorage.setItem(this.key,Instance.JSON(this.bookmarkDetaildList))}catch(a){}},deleteLocalStorage:function(a){try{window.localStorage[a]&&window.localStorage.setItem(a,"")}catch(b){}}}),BookmarkListData=Class({create:function(){this.initStaticList();
this.initBookmarkList()},initBookmarkList:function(){this.analysisData=new AnalysisBookmark;this.bookmarkList=this.analysisData.getList()},initStaticList:function(){this.staticList=[];if(!isPhone()&&!isPad()&&bmtConfig){var a=bmtConfig;bmtConfig.tabs&&(a=bmtConfig.tabs);if(0!=a.length)for(var b=a.length,c=0;c<b;c++)this.staticList.push(a[c].pageIndex)}},addItem:function(a){this.inList(a.pageIndex)||this.analysisData.addItem(a)},deleteItem:function(a){this.analysisData.deleteItem(a)},editItem:function(a){this.analysisData.editItem(a)},
refresh:function(){this.bookmarkList=this.analysisData.getList()},inList:function(a){return 0<=this.staticList.indexOf(a)||0<=this.bookmarkList.indexOf(a)?!0:!1},removeAll:function(){this.analysisData.removeAll()},getItem:function(a){return this.analysisData.getItem(a)},getList:function(){return this.bookmarkList},getNextItem:function(a){for(var b=0,c=this.bookmarkList.length,d=0;d<c;d++)if(this.bookmarkList[d]>a){b=this.bookmarkList[d];break}return b},getPrevItem:function(a){for(var b=0,c=this.bookmarkList.length,
d=0;d<c;d++)if(this.bookmarkList[d]>a){b=this.bookmarkList[d-1];break}return b},getLength:function(){return this.bookmarkList.length}}),BookmarkListPanel=Class({create:function(a){this.callback=a;this.bookmarkList=new BookmarkListData;this.initSwiper()},onCreate:function(){},initSwiper:function(){this.bookmarkSwiper=$("<div class='bookmarkSwiper stage'></div>");this.bookmarkSwiperList=$("<div class='swiper'></div>");this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");
this.itemList=[];this.refreshSwiper();this.bookmarkSwiper.append(this.bookmarkSwiperList);isPhone()||isPad()?this.bookmarkSwiper.css({"overflow-y":"auto","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}):(this.progress=$("<div class='progress'></div>"),this.progressBar=$("<div class='progressBar'></div>"),this.bookmarkSwiper.append(this.progress),this.progress.append(this.progressBar),this.bookmarkSwiper.scroll({},Direction.top))},initColorCss:function(){this.mainColor=bookConfig.formBackgroundColor?
bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor)},resetSwiperHtml:function(){this.bookmarkSwiperList.html("");this.refreshSwiper()},refreshSwiper:function(){for(var a=this.bookmarkList.getList(),b=a.length,c=0;c<b;c++)this.refreshItem(a[c]);this.refreshSideEdge()},refreshItem:function(a){a=this.bookmarkList.getItem(a);a=this.newItem(a);
a.appendTo(this.bookmarkSwiperList);this.itemList.push(a)},refreshItemsImage:function(){this.itemList.forEach(function(a){a.refreshImage()})},newItem:function(a){return new BookmarkItem(a,this.callback)},refreshListPanel:function(){if(!isPhone()&&!isPad()){this.bookmarkSwiper.css({height:"auto"});this.bookmarkSwiperList.css({position:"relative"});var a=this.bookmarkSwiper.height();this.bookmarkSwiper.find(".swiper").height();a>=this.maxHeight?(this.bookmarkSwiper.css({height:this.maxHeight+"px"}),
this.bookmarkSwiperList.css({position:"absolute"})):this.bookmarkSwiperList.css({top:0});this.bookmarkSwiper.refreshData&&this.bookmarkSwiper.refreshData()}},addItem:function(a){if(!this.bookmarkList.inList(a.pageIndex)){BookEvent.trigger("addBookmark",[BookInfo.getCurrentPagesByIndex(a.pageIndex).join("-"),a.caption,a.color]);var b=this.newItem(a);this.bookmarkList.addItem(a);if(1==this.bookmarkList.getLength())b.appendTo(this.bookmarkSwiperList),this.refreshPanel(),this.refreshSideEdge();else{var c=
this.getPrevItem(a.pageIndex);a=this.getNextItem(a.pageIndex);c.attr("pageIndex")?b.insertAfter(c):a.attr("pageIndex")?b.insertBefore(a):b.appendTo(this.bookmarkSwiperList);this.refreshPanel()}}},deleteItem:function(a){BookEvent.trigger("deleteItem",[BookInfo.getCurrentPagesByIndex(a).join("-")]);this.bookmarkList.deleteItem(a);this.refreshPanel();this.bookmarkList.getLength()||this.refreshSideEdge(!0)},editItem:function(a){BookEvent.trigger("editItem",[BookInfo.getCurrentPagesByIndex(a.pageIndex).join("-"),
a.caption,a.color]);this.bookmarkList.editItem(a);this.refreshPanel()},refresh:function(){this.bookmarkList.refresh()},getLength:function(){},inList:function(a){return this.bookmarkList.inList(a)?!0:!1},removeAll:function(){BookEvent.trigger("deleteItem",["all"]);this.bookmarkSwiperList.empty();this.bookmarkList.removeAll();this.refreshSideEdge(!0)},getNextItem:function(a){a=this.bookmarkList.getNextItem(a);return $("#bookmark_item"+a)},getPrevItem:function(a){a=this.bookmarkList.getPrevItem(a);return $("#bookmark_item"+
a)},refreshPanel:function(){this.refresh();this.refreshListPanel();var a;null==(a=BookInfo.getBook().bookAttachments)||a.Items.find("BookmarkTab").each(function(b){b.reload()})},onResize:function(a,b){this.maxHeight=b;this.bookmarkSwiper.css("height",b+"px")},refreshSideEdge:function(a){setBookVerticalMargin({bookmarkHeight:(void 0===a?0:a)?0:70})}}),PhoneBookmarkListPanel=Class({create:function(a){this._super(a)},onCreate:function(){},newItem:function(a){return new PhoneBookmarkItem(a,this.callback)}}).extend(BookmarkListPanel),
PcBookmarkFrame=Class({create:function(a){this.elements=new BookmarkElements(this);this.bookmarkListPanel=new PcBookmarkListPanel(this);this.elements.bookmarkList=this.bookmarkListPanel.bookmarkList;this.elements.bookmarkListPanel=this.bookmarkListPanel;this._super(a)},onCreate:function(){this.initColorCss()},initColorCss:function(){this.stage.css({"background-color":this.mainColor,color:this.fontColor});this.bookmarkListPanel.initColorCss();this.bookmarkListPanel.resetSwiperHtml()},initHtml:function(){this.stage.append(this.title);
this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.content=$("<div class='bookmark_content'></div>");this.stage.append(this.content);var a=$("<p class='inputForm'></p>");a.append(this.input);a.append(this.colorSelection);this.content.append(a);this.content.append(this.leftAddPage);this.content.append(this.rightAddPage);this.content.append(this.bookmarkListPanel.bookmarkListTitle);this.content.append(this.bookmarkListPanel.bookmarkSwiper);
this.content.append(this.remove);this.parent.append(this.stage);this.refreshPanel()},refreshPanel:function(){this.bookmarkListPanel.refreshPanel();this.elements.refreshElements()},setRandom:function(){var a=getRandomColor();this.colorSelection.attr("color",a);this.colorSelection.css("background",a)},addItem:function(a){a&&a.caption&&a.pageIndex&&!this.bookmarkListPanel.inList(a.pageIndex)&&(this.bookmarkListPanel.addItem(a),this.input.val(""),this.setRandom(),this.refreshPanel())},deleteItem:function(a){this.bookmarkListPanel.deleteItem(a);
this.refreshPanel()},editItem:function(a){this.bookmarkListPanel.editItem(a);this.refreshPanel()},refreshItem:function(a){this.bookmarkListPanel.refreshItem(a)},removeAll:function(){this.bookmarkListPanel.removeAll();this.refreshPanel()},onResize:function(){var a=Math.max(windowHeight-bookConfig.topMargin-bookConfig.bottomMargin-toolBar.getHeight(),1);toolBar.getWidth();var b=toolBar.getTopHeight()+10;this.width=250;this.height=a-87;this.maxHeight=this.height-188;this.stage.css({height:this.height+
"px",top:b+"px"});this.bookmarkListPanel.onResize(this.width,this.maxHeight);this.refreshPanel()},onShow:function(){this.changeIconColor();this.refreshItemsImage()},refreshItemsImage:function(){this.bookmarkListPanel.refreshItemsImage()}}).extend(SlideForm),PhoneBookmarkFrame=Class({create:function(a){this.elements=new BookmarkElements(this);this.bookmarkListPanel=new PhoneBookmarkListPanel(this);this.elements.bookmarkList=this.bookmarkListPanel.bookmarkList;this.elements.bookmarkListPanel=this.bookmarkListPanel;
this._super(a)},onCreate:function(){this.favicon&&this.favicon.changeButtonColor(this.fontColor);this._super()},initHtml:function(){this.title.append(this.close);this.stage.append(this.title);this.stage.append(this.bookmarkListPanel.bookmarkSwiper);this.refreshPanel()},refreshPanel:function(){this.bookmarkListPanel.refreshPanel();this.elements.refreshElements()},addItem:function(a){a&&a.pageIndex&&!this.bookmarkListPanel.inList(a.pageIndex)&&(this.bookmarkListPanel.addItem(a),this.refreshPanel())},
deleteItem:function(a){this.bookmarkListPanel.deleteItem(a);this.refreshPanel()},refreshItem:function(a){this.bookmarkListPanel.refreshItem(a)},refreshItemsImage:function(){this.bookmarkListPanel.refreshItemsImage()},onResize:function(){this._super();this.bookmarkListPanel.onResize(this.width,windowHeight-61);this.refreshPanel()},initEvent:function(){},onShow:function(){this.favicon&&this.favicon.changeButtonColor(this.fontColor);this.refreshItemsImage()}}).extend(PhoneFormFrame),PhoneBookmarkForm=
Class({}).extend(PhoneBookmarkFrame),TableOfContentElements=Class({create:function(a){this._super(a);this.callBack=a;this.tableItems=[];this.checkConfig();this.initElements();this.initEvent(a);this.pickElements(a)},checkConfig:function(){for(var a=function(d){if(d&&d.children&&0!=d.children.length)for(var e=d.children.length,g=0;g<e;g++)d.children[g].level=parseInt(d.children[g].level)+1,a(d.children[g])},b=ols.length,c=0;c<b;c++)0==parseInt(ols[c].level)&&(ols[c].level=parseInt(ols[c].level)+1,a(ols[c]))},
initElements:function(){this.searchButtonUrl=form_icons.search_form?"data:image/png;base64,"+form_icons.search_form:uiBaseURL+"search_form.png";this.input=$("<input aria-label='"+getLanguage("ariaSearchTableOfContents","search table of contents")+"' class='input_search' placeholder='"+FormInfo.getFormTitle("tableOfContent")+"'></input>");bookConfig.RightToLeft&&this.input.attr("dir","rtl");this.searchButton=$("<img class='searchButton button' role='button' src='"+this.searchButtonUrl+"'/>");this.result=
$("<p style='display:none;margin:0 27px;'>"+getLanguage("lblPages","Found Pages")+" <span style='color:"+bookConfig.searchKeywordFontColor+";'>0</span></p>");this.tableofcontentSwiper=$("<div class='stage'></div>");this.tableofcontentSwiperList=$("<ul class='swiper'></ul>");this.refreshSwiper(this.tableofcontentSwiperList,ols);this.tableofcontentSwiper.append(this.tableofcontentSwiperList);isPhone()||isPad()?this.tableofcontentSwiper.css({overflow:"auto","-webkit-overflow-scrolling":"touch"}):(this.progress=
$("<div class='progress'></div>"),this.progressBar=$("<div class='progressBar'></div>"),this.tableofcontentSwiper.append(this.progress),this.progress.append(this.progressBar),this.tableofcontentSwiper.scroll({},Direction.top))},expandItems:function(){for(var a=0;a<this.tableItems.length;a++)this.tableItems[a].expand()},collapseItems:function(){for(var a=0;a<this.tableItems.length;a++)this.tableItems[a].collapse()},refreshItems:function(a){for(var b=0;b<this.tableItems.length;b++)this.tableItems[b].fontColor=
a,this.tableItems[b].colorObj=Color(a),this.tableItems[b].resetItemColor&&this.tableItems[b].resetItemColor()},refreshSwiper:function(a,b){for(var c=b.length,d=0;d<c;d++)this.addItem(a,b[d])},addItem:function(a,b){b=this.callBack.newItem(a,b,this.refresh.bind(this));a.append(b.getItem());b.unfolding();this.tableItems.push(b)},refresh:function(){isPhone()||isPad()||this.tableofcontentSwiper.refreshData()},initEvent:function(a){this.searchButton.onTap(function(b){this.searchStart()}.bind(this));this.input.on("input propertychange change",
function(b){this.searchStart();b.stopPropagation()}.bind(this));this.input.bind("mousedown touchstart pointerdown mouseover mousemove",function(b){b.stopPropagation()})},searchStart:function(){this.tableofcontentSwiperList.empty();var a=this.input.val().toLowerCase();BookEvent.trigger("search",[BookInfo.getCurrentPages().join("-"),a,"table of content"]);""===a?(this.result.css({display:"none"}),this.refreshSwiper(this.tableofcontentSwiperList,ols),this.refresh()):(a=this.matchKey(a),this.refreshSwiper(this.tableofcontentSwiperList,
a),this.refresh(),a.length?this.result.css({display:"none"}):this.result.css({display:"block"}))},matchKey:function(a){var b=[],c=function(d){for(var e=[],g=0;g<d.length;g++){var f={caption:d[g].caption,page:d[g].page,level:d[g].level,url:d[g].url};d[g].children&&0<d[g].children.length&&(f.children=c(d[g].children));if(0<=d[g].caption.toLowerCase().indexOf(a))e.push(f);else if(f.children&&0<f.children.length)for(var h=0;h<f.children.length;h++)e.push(f.children[h])}return e};return b=c(ols)},pickElements:function(a){a.input=
this.input;a.searchButton=this.searchButton;a.result=this.result;a.searchButtonUrl=this.searchButtonUrl;a.tableofcontentSwiper=this.tableofcontentSwiper;a.tableofcontentSwiperList=this.tableofcontentSwiperList;a.progress=this.progress;a.progressBar=this.progressBar},changeLanguage:function(){this.input.attr("placeholder",FormInfo.getFormTitle("tableOfContent"))}}).extend(FormElements),PcTableOfContentFrame=Class({create:function(a){this.elements=new TableOfContentElements(this);this._super(a)},onCreate:function(){this.initColorCss()},
initColorCss:function(){this.stage.css({"background-color":this.mainColorObj.rgba(.9*this.formOpacity),color:this.fontColor})},resetFormItems:function(){this.elements.refreshItems(this.fontColor)},initHtml:function(){this.stage.addClass("win10_border");this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));bookConfig.isTabelOfContentSearchBarVisible&&(this.stage.append(this.input),this.stage.append(this.searchButton));
this.stage.append(this.close);this.stage.append(this.tableofcontentSwiper);this.parent.append(this.stage)},newItem:function(a,b,c){return new PcTableOfContentItem(a,b,c)},onResize:function(){var a=Math.max(windowHeight-bookConfig.topMargin-bookConfig.bottomMargin-toolBar.getHeight(),1);toolBar.getWidth();var b=toolBar.getTopHeight()+10;this.width=250;this.height=a-87;this.maxHeight=this.height-75;this.stage.css({height:this.height+"px",top:b+"px"});this.tableofcontentSwiper.css("height",this.maxHeight+
"px");this.elements.refresh()},onShow:function(){this.changeIconColor()}}).extend(SlideForm),TableOfContentItem=Class({create:function(a,b,c){this.callback=c;this.level=parseInt(ols[0].level)?parseInt(b.level):parseInt(b.level)+1;this.children=[];this.parent=a;this.parm=b;this.parm.caption=HTMLString.toText(this.parm.caption);this.hasChild=b.children&&0<b.children.length;this.item=$("<li aria-label='"+getLanguage("ariaPage","page")+" "+this.parm.page+"' class='item'></li>");this.fontColor=b.fontColor;
this.colorObj=Color(this.fontColor);this.initArrowUrl();this.initDefaultDom();this.initHtml(a,b);this.initCss();this.initEvent()},initArrowUrl:function(){this.expandUrl=form_icons.arrow?"data:image/png;base64,"+form_icons.arrow:uiBaseURL+"arrow.png";this.collapseUrl=rightToLeft?form_icons.arrow3?"data:image/png;base64,"+form_icons.arrow3:uiBaseURL+"arrow3.png":form_icons.arrow2?"data:image/png;base64,"+form_icons.arrow2:uiBaseURL+"arrow2.png"},getItem:function(){return this.item},initDefaultDom:function(){rightToLeft?
this.initRightToLeftDefaultDom():this.initLeftToRightDefaultDom();this.arrow&&(this.arrow[0].colorChanged=!1,this.arrow.changeButtonColor(this.fontColor))},initRightToLeftDefaultDom:function(){LanguageTool.isRightToLeft(this.parm.caption)?this.description=$("<p class='description rtl'>"+this.parm.caption+"</p>"):this.description=$("<p class='description'>"+this.parm.caption+"</p>");this.hasChild&&(this.arrow=$("<img class='arrow' src='"+this.collapseUrl+"'/>"),this.arrow.css("right",10*(this.level-
1)+"px"));bookConfig.isTableOfContentPagesVisible?(this.page=$("<span class='page'>"+this.parm.page+"</span>"),this.page.css("margin-right",10*(this.level-1)+15+"px")):this.description.css("margin-right",10*(this.level-1)+15+"px")},initLeftToRightDefaultDom:function(){this.description=$("<p class='description'>"+this.parm.caption+"</p>");this.hasChild&&(this.arrow=$("<img class='arrow' src='"+this.collapseUrl+"'/>"),this.arrow.css("left",10*(this.level-1)+"px"));this.description.css("margin-left",
10*(this.level-1)+15+"px");bookConfig.isTableOfContentPagesVisible&&(this.page=$("<span class='page'>"+this.parm.page+"</span>"))},initHtml:function(a,b){rightToLeft?this.initRightToLeftHtml():this.initLeftToRightHtml()},initCss:function(){bookConfig.isTableOfContentPagesVisible&&this.item.css({display:"flex","justify-content":"space-between","align-items":"center"})},initRightToLeftHtml:function(){this.item.append(this.description);bookConfig.isTableOfContentPagesVisible&&this.item.append(this.page);
this.arrow&&this.item.append(this.arrow)},initLeftToRightHtml:function(){this.arrow&&this.item.append(this.arrow);this.item.append(this.description);bookConfig.isTableOfContentPagesVisible&&this.item.append(this.page)},initEvent:function(){this.item.onTap(function(){this.parm.url?window.open(getRealURL(this.parm.url),"_blank"):(gotoPageFun(parseInt(this.parm.page),!1,"table of content"),(isPhone()||isPad())&&global.frmTableOfContent.hide())}.bind(this));this.item.bind("mouseover",function(){this.item.css({background:this.colorObj.rgba(.1)})}.bind(this));
this.item.bind("mouseleave",function(){this.isExpand||this.item.css({"background-color":"transparent"})}.bind(this));this.hasChild&&(this.arrow&&this.arrow.click(function(){this.onSwitch()}.bind(this)),this.arrow.bind("mousedown touchstart pointerdown mouseover mousemove click",function(a){a.stopPropagation()}))},expand:function(a){this.hasChild&&(0==this.children.length?this.addChildren():this.showChildren(),this.setAsExpand(),a&&this.callback())},collapse:function(a){if(this.hasChild){for(var b=
0;b<this.children.length;b++)this.children[b].hide(),this.children[b].collapse();this.setAsCollapse();a&&this.callback()}},setAsExpand:function(){this.isExpand=!0;this.arrow&&(this.arrow.attr("src",this.expandUrl),this.arrow[0].colorChanged=!1,this.arrow.changeButtonColor(this.fontColor));this.item.css({"font-weight":"bold","background-color":this.colorObj.rgba(.1)})},setAsCollapse:function(){this.isExpand=!1;this.arrow&&(this.arrow.attr("src",this.collapseUrl),this.arrow[0].colorChanged=!1,this.arrow.changeButtonColor(this.fontColor));
this.item.css({"font-weight":"","background-color":""})},addChildren:function(){var a=this.parm.children.length;this.itemList=$("<ul class='itemList'></ul>");for(var b=0;b<a;b++){this.parm.children[b].fontColor=this.fontColor;var c=new (global[this.getClassName()])(this.parent,this.parm.children[b],this.callback);this.itemList.append(c.getItem());this.children.push(c)}this.itemList.insertAfter(this.item)},showChildren:function(){for(var a=this.children.length,b=0;b<a;b++)this.children[b].show(),this.children[b].getIsExpand()&&
this.children[b].expand()},onSwitch:function(){this.opened?this.collapse(!0):this.expand(!0);this.opened=!this.opened},getIsExpand:function(){return this.opened},unfolding:function(){if(!bookConfig.isHideTabelOfContentNodes){this.expand();for(var a=this.children.length,b=0;b<a;b++)this.children[b].unfolding();this.opened=!0}},show:function(){this.item.show()},hide:function(){this.item.hide()}}),PhoneTableOfContentItem=Class({create:function(a,b,c){b.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:
bookConfig.iconColor;this._super(a,b,c)},initArrowUrl:function(){this.expandUrl=phone_toolbar_icons.arrow?"data:image/png;base64,"+phone_toolbar_icons.arrow:phoneBaseURL+"arrow.png";this.collapseUrl=phone_toolbar_icons.arrow2?"data:image/png;base64,"+phone_toolbar_icons.arrow2:phoneBaseURL+"arrow2.png"},initCss:function(){this._super();this.description&&"Chinese"!==UserGroups&&this.description.css({"text-align":"left"})}}).extend(TableOfContentItem),PhoneTableOfContentForm=Class({create:function(a){this.elements=
new TableOfContentElements(this);this._super(a)},onCreate:function(){this.stage.css({color:this.fontColor});this.favicon&&this.favicon.changeButtonColor(this.fontColor);this._super()},initHtml:function(){this.title.append(this.close);this.stage.append(this.title);bookConfig.isTabelOfContentSearchBarVisible&&(this.stage.append(this.input),this.stage.append(this.searchButton));this.stage.append(this.result);this.stage.append(this.tableofcontentSwiper)},newItem:function(a,b,c){return new PhoneTableOfContentItem(a,
b,c)},onResize:function(){this._super();this.tableofcontentSwiper.css("height",this.height-135+"px");this.input.css("width",this.width-75+"px");this.elements.refresh()},initEvent:function(){},onShow:function(){}}).extend(PhoneFormFrame),TelephoneNumberItem=Class({create:function(a,b){this.parent=a;this.parm=b?b:{};this.parm.number||(this.parm.number="");this.item=$("<div class='item'></div>");this.number=this.parm.label?$("<span class='number'>"+(this.parm.label?this.parm.label+":":"")+this.parm.number+
"</span>"):$("<span class='number'>"+this.parm.number+"</span>");this.button=$("<a href='tel:"+this.parm.number+"'><span class='button'>"+getLanguage("btnDialing","call")+"</span></a>");this.initHtml();this.initCss()},initHtml:function(){this.item.append(this.number);this.item.append(this.button);this.parent.append(this.item)},initCss:function(){},changeLanguage:function(){this.button.find("span").html(getLanguage("btnDialing","call"))}}),TelephoneNumberElements=Class({create:function(a){this._super(a);
this.initElements();this.initEvent(a);this.pickElements(a)},initElements:function(){this.initSwiper();this.addItem()},initSwiper:function(){this.numberSwiper=$("<div class='stage'></div>");this.stageArrow=$("<div class='stageArrow'></div>");this.numberSwiperList=$("<div class='swiper'></div>");this.numberSwiper.append(this.numberSwiperList);isPhone()||isPad()?this.numberSwiper.css({"overflow-y":"auto","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}):(this.progress=$("<div class='progress'></div>"),
this.progressBar=$("<div class='progressBar'></div>"),this.numberSwiper.append(this.progress),this.progress.append(this.progressBar),this.numberSwiper.scroll({},Direction.top))},addItem:function(){this.numberArray=global.phoneNumber;this.itemArray=[];for(var a=0;a<this.numberArray.length;a++){var b=new TelephoneNumberItem(this.numberSwiperList,this.numberArray[a]);this.itemArray.push(b)}},refresh:function(){isPhone()||isPad()||this.numberSwiper.refreshData()},initEvent:function(a){},pickElements:function(a){a.numberSwiper=
this.numberSwiper;a.stageArrow=this.stageArrow;a.itemArray=this.itemArray},changeLanguage:function(){for(var a=0;a<this.itemArray.length;a++)this.itemArray[a]&&this.itemArray[a].changeLanguage()}}).extend(FormElements),TelephoneNumberForm=Class({create:function(a){this.elements=new TelephoneNumberElements(this);this._super(a)},onCreate:function(){this.title.css({"background-color":this.mainColor,color:this.fontColor});this.numberSwiper.css({"background-color":this.mainColorObj.rgba(.8),color:this.fontColorObj.rgba(.9)});
this.numberSwiper.find("a").css({color:this.fontColorObj.rgba(.9),border:"1px solid "+this.fontColorObj.rgba(.9)});this._super()},initHtml:function(){this.stage.append(this.title);this.stage.append(this.numberSwiper);this._super()},initEvent:function(){this.stage.bind(_event._down,function(a){a.stopPropagation()})},onShow:function(){},onResize:function(){this._super();this.numberSwiper.css("max-height",windowHeight/2+"px");this.elements.refresh()}}).extend(FadeOutFadeForm),VideoGalleryElements=Class({create:function(a){this._super(a);
this.initVideoList();this.videoList&&0!=this.videoList.length&&(this.initElements(),this.initEvent(a),this.pickElements(a))},initVideoList:function(){this.videoList=videoList},initElements:function(){this.content=$("<div class='video_content'></div>");this.video=$("<iframe type='text/html' class='video' src='' allowfullscreen frameborder='0'></iframe>");rightToLeft?this.initRightToLeftDefaultDom():this.initLeftToRightDefaultDom();this.initSwiper()},initRightToLeftDefaultDom:function(){this.info=$("<div class='info'><span class='title rtl'>"+
this.videoList[0].title+"</span><p class='description rtl'>"+this.videoList[0].description+"</p></div>")},initLeftToRightDefaultDom:function(){this.info=$("<div class='info'><span class='title'>"+this.videoList[0].title+"</span><p class='description'>"+this.videoList[0].description+"</p></div>")},initSwiper:function(){if(this.videoList&&!(1>=this.videoList.length)){this.videoListTitle=$("<sapn class='title'>"+getLanguage("frmVideoListTitle","Video list")+"</span>");this.videoSwiper=$("<div class='videoSwiper stage'></div>");
var a=$("<div class='swiper' style=''></div>");this.progress=$("<div class='progress'></div>");var b=$("<div class='progressBar'></div>");this.refreshSwiper(a,this.videoList);this.videoSwiper.append(a);this.videoSwiper.append(this.progress);this.progress.append(b)}},refreshSwiper:function(a,b){for(var c=b.length,d=0;d<c;d++)this.addItem(a,b[d])},addItem:function(a,b){if(a&&b){var c=function(){this.playVideo(b)}.bind(this);c=new VideoGalleryItem(b,c);a.append(c.getDom())}},playVideo:function(a){BookEvent.trigger("playMedia",
["video gallery",BookInfo.getCurrentPages().join("-"),a.id,a.type,(new Date).getTime()]);var b=getProtocal();if("youtube"===a.type){var c=getYouTubeIdFromUrl(a.id);c=b+"www.youtube.com/embed/"+c+"?autoplay=1&wmode=transparent"}"vimeo"===a.type&&(c=getVimeoIdFromUrl(a.id),c=b+"player.vimeo.com/video/"+c+"?autoplay=1&wmode=transparent&portrait=0");this.video.attr("src",c);b=this.info.find(".description");this.info.find(".title").html(a.title);b.html(a.description)},initEvent:function(a){this.videoSwiper&&
(isPhone()||isPad()?this.videoSwiper.scroll({},Direction.left):this.videoSwiper.scroll({},Direction.top,"win10"))},pickElements:function(a){a.videoList=this.videoList;a.content=this.content;a.video=this.video;a.info=this.info;a.videoListTitle=this.videoListTitle;a.videoSwiper=this.videoSwiper;a.progress=this.progress},changeLanguage:function(){this.videoListTitle&&this.videoListTitle.html(getLanguage("frmVideoListTitle","Video list"))}}).extend(FormElements),PcVideoGalleryFrame=Class({create:function(a){this.elements=
new VideoGalleryElements(this);this._super(a)},onCreate:function(){this.initColorCss();this.stage.appearance("",function(){this.visible=!1;this.onHide()}.bind(this),{defaultHide:!0});this.parent.append(this.stage.getDom());this.title&&this.title.css({cursor:"default"})},initColorCss:function(){this.stage.css({"background-color":this.mainColor,color:this.fontColor})},initHtml:function(){this._super()},onShow:function(){this.changeIconColor();this.elements.playVideo(this.videoList[0]);this.videoList&&
1<this.videoList.length&&this.videoSwiper.refreshData()},onHide:function(){this.video.attr("src","")}}).extend(FadeOutFadeForm),PhoneVideoGalleryForm=Class({create:function(a){this.elements=new VideoGalleryElements(this);this.disableDrag=!0;this._super(a)},onCreate:function(){this.stage.css({"background-color":this.mainColor,color:this.fontColor});this.stage.appearance("",function(){this.visible=!1;this.onHide()}.bind(this),{defaultHide:!0});this.parent.append(this.stage.getDom());this.title&&this.title.css({cursor:"default"})},
initHtml:function(){this.stage.addClass("win10_border");this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.stage.append(this.video);this.stage.append(this.info);if(this.videoList&&1<this.videoList.length){var a=$("<div class='video_list'></div>");a.append(this.videoListTitle);a.append(this.videoSwiper);this.stage.append(a)}else this.stage.css("width","335px");this._super()},onShow:function(){this.close.changeButtonColor(this.fontColor);
this.favicon&&this.favicon.changeButtonColor(this.fontColor);this.elements.playVideo(this.videoList[0]);this.videoList&&1<this.videoList.length&&this.videoSwiper.refreshData()},onHide:function(){this.video.attr("src","")}}).extend(FadeOutFadeForm),VideoGalleryItem=Class({create:function(a,b){a&&(this.parm=a,this.callback=b,this.initDom(),this.initEvent())},initDom:function(){this.item=$("<div class='item'></div>");this.image=$("<div class='thumbnail'></div>");this.parm.thumbnail&&this.image.css({"background-image":"url("+
this.parm.thumbnail+")"});this.parm.title&&(this.title=rightToLeft?$("<div class='title rtl'>"+this.parm.title+"</div>"):$("<div class='title'>"+this.parm.title+"</div>"));this.parm.description&&(this.description=rightToLeft?$("<div class='description rtl'>"+this.handleData(this.parm.description)+"</div>"):$("<div class='description'>"+this.handleData(this.parm.description)+"</div>"));this.item.append(this.image);this.title&&this.item.append(this.title);this.description&&this.item.append(this.description)},
handleData:function(a){a=a.replaceAll("<","&lt");a=a.replaceAll(">","&gt");return a=handleData(a,"")},initEvent:function(){this.item.onTap(this.callback)},getDom:function(){return this.item}}),PhotoGallery=Class({create:function(a,b){!b||0>=b.length||(this.parent=a,this.photoArray=b,this.index=0,this.visible=!1,this.pageWidth=$(window).width(),this.pageHeight=$(window).height(),this.images=[],this.thumbnails=[],this.initHtml(),this.initEvent())},initHtml:function(){this.leftBtnUrl=uiBaseURL+"photo_prev.png";
this.rightBtnUrl=uiBaseURL+"photo_next.png";this.closeBtnUrl=uiBaseURL+"photoGallery_close.png";this.stage=$("<div class='photogallery' style=\"display:none\"></div>");this.close=$("<div tabindex='0' class='close'><img alt='close' width='auto' height='auto' src=\""+this.closeBtnUrl+'" /></div>');this.stage.append(this.close);this.initImgThumb();this.initImgContainer();this.initImages();this.setThumbnal();this.setPhotoImage();this.imgChange();this.parent.append(this.stage);this.images[0].css({display:"block"})},
initImgContainer:function(){this.imgContainer=$("<div class='imgContainer'></div>");this.leftBtn=$("<div class='leftBtn'><img src=' "+this.leftBtnUrl+"' /></div>");this.rightBtn=$("<div class='rightBtn'><img src='"+this.rightBtnUrl+"'/></div>");this.containerBG=$("<div class='photoBG'></div>");this.imgContainer.append(this.leftBtn);this.imgContainer.append(this.rightBtn);this.stage.append(this.imgContainer).append(this.containerBG)},initImgThumb:function(){this.thumbContainer=$("<div class='thumbContainer'></div>");
this.stage.append(this.thumbContainer)},initEvent:function(){this.stage.bind("mousedown touchstart",function(a){a.stopPropagation()});1<this.photoArray.length&&(this.imgContainer.bind("mouseenter",function(){this.leftBtn.animate({left:"0"},300);this.rightBtn.animate({right:"0"},300)}.bind(this)),this.imgContainer.bind("mouseleave",function(){this.leftBtn.animate({left:"-32px"},300);this.rightBtn.animate({right:"-32px"},300)}.bind(this)));this.imgContainer.bind("click",function(a){this.moving||(a.stopPropagation(),
this.stopAutoPlay(),this.index+=1,this.index>this.images.length-1&&(this.index=0),this.imgChange(),this.autoPlay())}.bind(this));this.containerBG.bind(_event._click,function(){this.hide();this.visible=!1}.bind(this));this.leftBtn.bind("click",function(a){this.moving||(a.stopPropagation(),this.stopAutoPlay(),--this.index,0>this.index&&(this.index=this.images.length-1),this.imgChange(),this.autoPlay())}.bind(this));this.rightBtn.bind("click",function(a){this.moving||(a.stopPropagation(),this.stopAutoPlay(),
this.index+=1,this.index>this.images.length-1&&(this.index=0),this.imgChange(),this.autoPlay())}.bind(this));this.close.bind(_event._click,function(){this.hide();this.visible=!1}.bind(this));$(window).resize(function(){this.onResize()}.bind(this))},onResize:function(){this.pageWidth=$(window).width();this.pageHeight=$(window).height();this.setImageCss(this.images[this.index]);this.setThumbnal()},thumbEvent:function(a){a.bind(_event._click,function(){this.moving||(this.stopAutoPlay(),parseInt(a.attr("id").substring(5))!=
this.index&&(this.index=parseInt(a.attr("id").substring(5)),this.imgChange(a)),this.autoPlay())}.bind(this,a))},autoPlay:function(){if(bookConfig.SlideshowAutoPlay){var a=bookConfig.SlideshowPlayInterval?1E3*parseInt(bookConfig.SlideshowPlayInterval):3E3;this.timer=setInterval(function(){this.index+=1;this.index>this.images.length-1&&(this.index=0);this.imgChange()}.bind(this),a)}},changeLanguage:function(){},stopAutoPlay:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},imgChange:function(a){1>=
this.photoArray.length||this.moving||(a||(a=this.thumbnails[this.index]),a.siblings().removeClass("focus"),a.addClass("focus"),this.newImg=this.images[this.index],this.setImageCss(this.images[this.index]),this.moving=!0,this.newImg.fadeIn(300,function(){this.oldImg&&this.oldImg.fadeOut();this.oldImg=this.newImg;this.moving=!1}.bind(this)))},initImages:function(){for(var a=0;a<this.photoArray.length;a++){var b=$("<img src='"+this.photoArray[a]+"'/>"),c=$('<div id="thumb'+a+'" class="thumbBox"><img src=\''+
this.photoArray[a]+'\'/><div class="thumbBG"></div></div>');this.images.push(b);this.thumbnails.push(c)}},setThumbnal:function(){this.thumbLeft=0;this.thumbLeft=65*this.thumbnails.length>this.pageWidth?this.thumbLeft:(this.pageWidth-65*this.thumbnails.length)/2;for(var a=0;a<this.thumbnails.length;a++){var b=this.thumbnails[a],c=b.find("img");this.thumbEvent(b);c.css({position:"relative",width:"100%",height:"100%","object-fit":"contain"});this.setThumbImg(c,b);b.css({left:this.thumbLeft+"px"});this.thumbContainer.append(b);
this.thumbLeft+=65}},setThumbImg:function(a,b){a.on("load",function(c,d){d.append(c)}.bind(this,a,b))},setPhotoImage:function(){var a=this.images[this.index];a.on("load",function(b,c){for(var d=0;d<b.images.length;d++)b.images[b.index]!=b.images[d]&&b.images[d].css({display:"none"});return function(){b.setImageCss(c)}}(this,a))},setImageCss:function(a){this.imgTop=this.imgLeft=0;this.imgRadio=a[0].naturalWidth/a[0].naturalHeight;this.windowRadio=this.pageWidth/(this.pageHeight-80);this.imgHeight=
this.imgWidth=this.radio=0;this.resetImageCss(a);a.css({width:this.imgWidth+"px",height:this.imgHeight+"px",left:0,top:0});this.imgContainer.css({width:this.imgWidth+"px",height:this.imgHeight+"px",left:this.imgLeft,top:this.imgTop+"px"});this.leftBtn.css({top:(this.imgHeight-38)/2+"px"});this.rightBtn.css({top:(this.imgHeight-38)/2+"px"});this.imgContainer.append(a)},resetImageCss:function(a){this.imgRadio>this.windowRadio?(a[0].naturalWidth<this.pageWidth?(this.imgHeight=a[0].naturalHeight,this.imgWidth=
a[0].naturalWidth,this.imgLeft=(this.pageWidth-this.imgWidth-16)/2):(this.imgWidth=this.pageWidth-16,this.radio=this.pageWidth/a[0].naturalWidth,this.imgHeight=a[0].naturalHeight*this.radio,this.imgLeft=0),this.imgTop=(this.pageHeight-this.imgHeight-80)/2):a[0].naturalHeight<this.pageHeight-80?(this.imgWidth=a[0].naturalWidth,this.imgHeight=a[0].naturalHeight,this.imgLeft=(this.pageWidth-this.imgWidth-16)/2,this.imgTop=(this.pageHeight-this.imgHeight-80)/2):(this.imgHeight=this.pageHeight-80,this.radio=
this.imgHeight/a[0].naturalHeight,this.imgWidth=a[0].naturalWidth*this.radio,this.imgLeft=(this.pageWidth-this.imgWidth-16)/2,this.imgTop=0)},show:function(){this.visible=!0;this.stage.fadeIn(200);this.autoPlay();this.setA11y();this.stage.focus();FormManager.register(this)},hide:function(){this.visible=!1;this.stage.fadeOut(200);this.interval&&this.interval.stop();this.stopAutoPlay();this.close&&this.close.off("keydown.a11y");this.leftBtn&&this.leftBtn.off("keydown.a11y");this.rightBtn&&this.rightBtn.off("keydown.a11y");
if(this.thumbnails)for(var a=0;a<this.thumbnails.length;a++)this.thumbnails[a].off("keydown.a11y");FormManager.unregister(this)},showOrHide:function(){this.visible?this.hide():this.show()},setA11y:function(){this.close&&(this.close.attr("tabindex",0),this.close.off("keydown.a11y").on("keydown.a11y",function(c){"Enter"!==c.key&&" "!==c.key||$(this).trigger("click")}));this.leftBtn&&(this.leftBtn.attr("tabindex",0),this.leftBtn.off("keydown.a11y").on("keydown.a11y",function(c){"Enter"!==c.key&&" "!==
c.key||$(this).trigger("click")}));this.rightBtn&&(this.rightBtn.attr("tabindex",0),this.rightBtn.off("keydown.a11y").on("keydown.a11y",function(c){"Enter"!==c.key&&" "!==c.key||$(this).trigger("click")}));if(this.thumbnails)for(var a=0;a<this.thumbnails.length;a++){var b=this.thumbnails[a];b.attr("tabindex",0);b.off("keydown.a11y").on("keydown.a11y",function(c){"Enter"!==c.key&&" "!==c.key||$(this).trigger("click")})}this.stage.attr("tabindex",-1)}});
function initForms(){if(isPhone()||isPad()){bookConfig.ShareButtonVisible&&!global.sharePanel&&(global.sharePanel=new PhoneShareForm({parent:tmpContainer,formType:"share",rightToLeft:rightToLeft}));if("article4"==global.templeteName)return;bookConfig.PrintButtonVisible&&!global.printBody&&(global.printBody=new PhonePrintForm({parent:tmpContainer,formType:"print",rightToLeft:rightToLeft}));bookConfig.DownloadButtonVisible&&global.downloadconfig&&!global.downLoadBody&&(global.downLoadBody=new PhoneDownloadForm({parent:tmpContainer,
formType:"download",rightToLeft:rightToLeft}));language&&1<language.length&&!global.languagePanel&&(global.languagePanel=new PhoneLanguageForm({parent:tmpContainer,formType:"language",rightToLeft:rightToLeft}));bookConfig.aboutButtonVisible&&!global.aboutBody&&(global.aboutBody=new PhoneAboutForm({parent:tmpContainer,formType:"about",rightToLeft:rightToLeft}));bookConfig.BookMarkButtonVisible&&!global.bookmark&&(global.bookmark=new PhoneBookmarkForm({parent:tmpContainer,formType:"bookmark",rightToLeft:rightToLeft}));
bookConfig.TableOfContentButtonVisible&&!global.frmTableOfContent&&(global.frmTableOfContent=new PhoneTableOfContentForm({parent:tmpContainer,formType:"tableOfContent",rightToLeft:rightToLeft}),"table of contents"===bookConfig.mobileLeftRightPnlShowOption&&setTimeout(function(){return global.frmTableOfContent.show()},200));bookConfig.VideoButtonVisible&&!global.videoGallery&&(global.videoGallery=new PhoneVideoGalleryForm({parent:tmpContainer,formType:"videoGallery",rightToLeft:rightToLeft,isPhone:!0},
global.videoList))}else{bookConfig.ShareButtonVisible&&!global.sharePanel&&(global.sharePanel=new PcShareForm({parent:tmpContainer,formType:"share",rightToLeft:rightToLeft}));if("article4"==global.templeteName)return;bookConfig.PrintButtonVisible&&!global.printBody&&(global.printBody=new PcPrintForm({parent:tmpContainer,formType:"print",rightToLeft:rightToLeft}));bookConfig.DownloadButtonVisible&&global.downloadconfig&&!global.downLoadBody&&(global.downLoadBody=new PcDownloadForm({parent:tmpContainer,
formType:"download",rightToLeft:rightToLeft}));1<language.length&&!global.languagePanel&&(global.languagePanel=new PcLanguageForm({parent:tmpContainer,formType:"language",rightToLeft:rightToLeft}));bookConfig.HelpButtonVisible&&!global.helpBody&&(global.helpBody=new PcHelpForm({parent:tmpContainer,formType:"help",rightToLeft:rightToLeft}));bookConfig.aboutButtonVisible&&!global.aboutBody&&(global.aboutBody=new PcAboutForm({parent:tmpContainer,formType:"about",rightToLeft:rightToLeft}));isBelowIE9()||
!bookConfig.BookMarkButtonVisible||global.bookmark||(global.bookmark=new PcBookmarkForm({parent:tmpContainer,formType:"bookmark",rightToLeft:rightToLeft}));bookConfig.TableOfContentButtonVisible&&!global.frmTableOfContent&&(global.frmTableOfContent=new PcTableOfContentForm({parent:tmpContainer,formType:"tableOfContent",rightToLeft:rightToLeft}),"table of contents"==bookConfig.leftRightPnlShowOption&&global.frmTableOfContent.show());bookConfig.VideoButtonVisible&&!global.videoGallery&&(global.videoGallery=
new PcVideoGalleryForm({parent:tmpContainer,formType:"videoGallery",rightToLeft:rightToLeft},global.videoList));bookConfig.SlideshowButtonVisible&&!global.photoGallery&&(global.photoGallery=new PhotoGallery(tmpContainer,global.slideshow))}!bookConfig.MagnifierButtonVisible||global.magnifierZoomBox||global.isBelowIE11()||(global.magnifierZoomBox=new WindowMagnifierBox(tmpContainer));initColorPanel();bookConfig.AnnotationButtonVisible&&!global.annotationPannel&&(isPhone()||isPad()?global.annotationPannel=
new PhoneAnnotationPannel(tmpContainer):global.annotationPannel=new AnnotationPannel(tmpContainer))}function initColorPanel(){global.colorPanel||(global.colorPanel=new JSColorPanel(tmpContainer))}
function resizeComponents(){if(global.printBody)printBody.onResize();if(global.downLoadBody)downLoadBody.onResize();if(global.helpBody)helpBody.onResize();if(global.aboutBody)aboutBody.onResize();if(global.sharePanel)sharePanel.onResize();if(global.languagePanel)languagePanel.onResize();if(global.frmTableOfContent)frmTableOfContent.onResize();if(global.bookmark)bookmark.onResize();if(bookConfig.AnnotationButtonVisible&&global.annotationPannel)global.annotationPannel.onResize()};var PcAboutForm=Class({create:function(a){this.parent=a.parent;this.visible=!0;this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;decodeAboutInfo();this.initHtml();this.initEvent();this.bookReadTimesVisible()},initHtml:function(){this.stage=$("<div class='about_form' style='display:none;'></div>");this.arrow=$("<div class='arrow' ></div>");this.logo=$("<a class='logo' target='_blank' style='display:none;background:url("+
bookConfig.CompanyLogoFile+") no-repeat center center;background-size:contain;'></a>");bookConfig.AboutWebsite&&this.logo.attr("href",bookConfig.AboutWebsite);this.description=$("<div class='description stage' style='height:200px;display:none;'><div class='swiper' style='position:absolute;width:95%;left:3px;word-break:break-word;'>"+bookConfig.AboutDescription.replaceAll("  ","&ensp;")+"</div><div class='progress' style='margin-top:5px;'><div class='progressBar'></div></div></div>");this.readViews=
$("<div class='views item' title="+this.strViews+"><span style='float:left;width:20px;height:20px;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNi4wMTYiIGhlaWdodD0iOS43NzUiIHZpZXdCb3g9IjAgMCAxNi4wMTYgOS43NzUiPg0KICA8cGF0aCBpZD0i6Lev5b6EXzE2MDUiIGRhdGEtbmFtZT0i6Lev5b6EIDE2MDUiIGQ9Ik0xNi4wMTYsMjA0LjM4MmMwLDEuNTYxLTMuMyw0Ljg5LTguMDA4LDQuODlDMy40MjIsMjA5LjI3MiwwLDIwNiwwLDIwNC4zODJTMy40MzcsMTk5LjUsOC4wMDgsMTk5LjVjNC43NDMsMCw4LjAwOSwzLjI3LDguMDA4LDQuODg1Wm0tOC0zLjk5M2E0LDQsMCwwLDAsMCw3Ljk5MSw0LDQsMCwwLDAsMC03Ljk5MVptLS4wMDcsMS40NDVhMi41NDYsMi41NDYsMCwwLDAsMCw1LjA4OSwyLjU0NiwyLjU0NiwwLDAsMCwwLTUuMDg5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTk5LjQ5NykiIGZpbGw9IiM4ZjhmOGYiLz4NCjwvc3ZnPg0K) center center no-repeat'></span><span class='content'>"+
this.ReadTimes+"</span></div>");this.author=$("<div class='author item' title="+getLanguage("frmaboutAUTHOR","Author")+"><span style='float:left;width:20px;height:20px;background:url(data:image/png;base64,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) center center no-repeat'></span><span class='content'>"+
bookConfig.AboutAuthor+"</span></div>");this.mobile=$("<div class='mobile item' title="+getLanguage("frmaboutMOBILE","Mobile")+"><span style='float:left;width:20px;height:20px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI4QzIzNTcyOTA3MzExRTg5NUJCRTZDREZBQ0IzNEJDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI4QzIzNTczOTA3MzExRTg5NUJCRTZDREZBQ0IzNEJDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjhDMjM1NzA5MDczMTFFODk1QkJFNkNERkFDQjM0QkMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MjhDMjM1NzE5MDczMTFFODk1QkJFNkNERkFDQjM0QkMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7x9s2iAAABBklEQVR42mL8//8/AyWACZkzYcIEdSDmIMsAoMY8IHUdiPcA2XzEGsAI8gJQAxeQ/QaIOaHiJ4HYvaCg4COxLlBF0gwC5kBcSYoX/qKJvwTi6aQYAPL7ayTxfqDzHxJtAFAxyAWTkcSLgeEiTmo0dgPxNShbFIhXAw3hJCoWkNMBkDoOxIJQocNAHA504XOgHCigU4G4Gcj/jNUAqCGgGNgFxLC08AHqvWwgFgLiY9Ao/oLVAKgh1kBqKxDz43D5QSB2AxryiwmbLFDiKJCyAuIbOAywAWJJjLyAZggoQI2AuA6IXyFJfQXiDFg0MxKTG4FeYgZSoABmAeLbQM3fcQYiqQAgwABvx12e7mX9bgAAAABJRU5ErkJggg==) center center no-repeat'></span><a  href='tel:"+
bookConfig.AboutMobile+"' target='_blank'><span class='content'>"+bookConfig.AboutMobile+"</span></a></div>");this.email=$("<div class='email item' title="+getLanguage("frmaboutEMAIL","Email")+"><span style='float:left;width:20px;height:20px;background:url(data:image/png;base64,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) center center no-repeat'></span><a  href='mailto:"+
bookConfig.AboutEmail+"' target='_blank'><span class='content'>"+bookConfig.AboutEmail+"</span></a></div>");this.website=$("<div class='website item' title="+getLanguage("frmaboutWEBSITE","Website")+"><span style='float:left;width:20px;height:20px;background:url(data:image/png;base64,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) center center no-repeat'></span><a  href='"+
bookConfig.AboutWebsite+"' target='_blank'><span class='content'>"+bookConfig.AboutWebsite+"</span></a></div>");this.address=$("<div class='address item' title="+getLanguage("frmaboutADDRESS","Address")+"><span style='float:left;width:20px;height:20px;background:url(data:image/png;base64,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) center center no-repeat'></span><span class='content'>"+
bookConfig.AboutAddress+"</span></div>");this.stage.append(this.logo);this.stage.append(this.description);this.stage.append(this.author);this.stage.append(this.mobile);this.stage.append(this.email);this.stage.append(this.website);this.stage.append(this.address);this.stage.append(this.arrow);this.parent.append(this.stage);this.description.scroll({},Direction.top,"win10");this.initLogo();this.initColorCss()},bookReadTimesVisible:function(){var a=setInterval(function(){try{this.strViews=getLanguage("frmaboutViews",
global.aboutReadTimesCaptions),this.ReadTimes=global.aboutReadTimes?global.aboutReadTimes:0,0<this.ReadTimes?(this.initHtml(),this.author.before(this.readViews),clearInterval(a)):10<this.elements.iRead&&clearInterval(a)}catch(b){}}.bind(this),1E3)},initLogo:function(){bookConfig.CompanyLogoFile?(this.logo.css({display:"block",background:"url("+bookConfig.CompanyLogoFile+") no-repeat center center","background-size":"contain"}),bookConfig.AboutWebsite&&this.logo.attr("href",bookConfig.AboutWebsite)):
this.logo.css({display:"none"});bookConfig.AboutDescription?(this.description.css({display:"block"}).find(".swiper").html(bookConfig.AboutDescription.replaceAll("  ","&ensp;")),this.description.refreshData()):this.description.css({display:"none"});this.ReadTimes&&this.readViews.find(".content").html(this.ReadTimes);bookConfig.AboutAuthor&&this.author.find(".content").html(bookConfig.AboutAuthor);bookConfig.AboutAddress&&this.address.find(".content").html(bookConfig.AboutAddress);bookConfig.AboutMobile&&
(this.mobile.find("a").attr("href","tel:"+bookConfig.AboutMobile),this.mobile.find(".content").html(bookConfig.AboutMobile));bookConfig.AboutEmail&&(this.email.find("a").attr("href","mailto:"+bookConfig.AboutEmail),this.email.find(".content").html(bookConfig.AboutEmail));bookConfig.AboutWebsite&&(this.website.find("a").attr("href",bookConfig.AboutWebsite),this.website.find(".content").html(bookConfig.AboutWebsite))},initColorConfig:function(){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:
bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor)},initColorCss:function(){this.stage.css({background:Color(this.mainColor).rgba(.95),color:Color(this.fontColor)});this.setColor()},resetFormColor:function(){this.initColorConfig();this.resetIconSrc();this.resetColorChanged();this.changeIconColor();this.initColorCss&&this.initColorCss()},resetColorChanged:function(){},
resetIconSrc:function(){},changeIconColor:function(){},initEvent:function(){this.parent.bind(_event._click,function(){this.hide()}.bind(this));this.stage.bind("click mousewheel",function(a){a.stopPropagation()}.bind(this))},changeLanguage:function(){},setColor:function(){this.arrow.css({"border-bottom-color":this.mainColor});this.logo.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.description.css({border:"1px solid "+Color(this.mainColor).add(32),
"background-color":Color(this.mainColor).add(64)});this.readViews.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.author.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.mobile.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.email.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});
this.website.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.address.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)})},onResize:function(){},showOrHide:function(a){this.visible?this.show(a):this.hide()},show:function(a){this.stage.css({left:a.left-263+a.width+"px",top:a.top+a.height+20+"px"});this.stage.fadeIn(function(){this.description.refreshData();this.visible=!1}.bind(this))},
hide:function(){this.stage.fadeOut(function(){this.visible=!0}.bind(this))}});var PcBookmarkItem=Class({create:function(a,b){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;a.fontColor=this.fontColor;this._super(a,b)},initHtml:function(){this._super();this.initColorOrder(this.item);this.itemImg=$("<div class='itemImg' ></div>");this.item.append(this.itemImg);this.item.css({border:"1px solid "+Color(this.mainColor).add(32),background:Color(this.mainColor).add(64)});
this.refreshImage()},refreshImage:function(){var a=this;getPageDir(this.pageIndex,"thumb",originTotalPageCount).then(function(b){b.match(/^none/)?a.itemImg.css({background:bookConfig.pageBackgroundColor}):a.itemImg.css({background:"url("+b+") center center no-repeat","background-size":"contain"})})},resetColor:function(){for(var a="#66D566 #64D3ED #9D80D7 #ED8383 #ED9933 #A6A19B #3398ED".split(" "),b=0;b<a.length;b++)this.colorOrder.find(".item"+b).css({"background-image":"radial-gradient("+a[b]+
" 40%,transparent 48%,transparent 53%,transparent 63%)"}),this.colorOrder.find(".item"+b).removeClass("active")},resetItemColor:function(){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.item.css({border:"1px solid "+Color(this.mainColor).add(32),background:Color(this.mainColor).add(64)})},setElemColor:function(a){this.colorSelection.attr("color",a);this.colorSelection.css({background:a})},
initColorOrder:function(a){var b="#66D566 #64D3ED #9D80D7 #ED8383 #ED9933 #A6A19B #3398ED".split(" ");this.colorOrder=$("<div class='color_order' ></div>");for(var c=0;c<b.length;c++){var d=$("<div class='color_item item"+c+"' color='"+b[c]+"' ></div>");d.css({cursor:"pointer","background-image":"radial-gradient("+b[c]+" 40%,transparent 48%,transparent 53%,transparent 63%)"});(function(e,g,f){g.bind("click",function(){e.resetColor(e.colorOrder);g.addClass("active");e.setElemColor(f);g.css({"background-image":"radial-gradient("+
f+" 40%, transparent 48%, transparent 53%,"+f+" 63%)"})}.bind(e))})(this,d,b[c]);this.colorOrder.append(d)}a.append(this.colorOrder);this.colorSelection.bind(_event._click,function(){this.resetColor()}.bind(this))},lightItem:function(){$(".bookmarkItem_focus").removeClass("bookmarkItem_focus");this.item.addClass("bookmarkItem_focus")},startEdit:function(){this.judgeToSaveOrCancel();this.lightItem();this.cancel.show();this.save.show();this.edit.hide();this.title.css({background:"#ffffff",color:"#000000"});
this.title.removeAttr("disabled");this.title.addClass("focus");this.item.addClass("edit");global.bookmark.editingItem=this;this.cancel.changeButtonColor(this.fontColor);this.deleteIcon.hide()},endEdit:function(){this._super();this.title.removeClass("focus");this.item.removeClass("edit");this.colorSelection.show();this.deleteIcon.show()}}).extend(BookmarkItem);var PcBookmarkListPanel=Class({create:function(a){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor);this._super(a)},onCreate:function(){},newItem:function(a){return new PcBookmarkItem(a,this.callback)}}).extend(BookmarkListPanel);var PcBookmarkForm=Class({create:function(a){this.elements=new BookmarkElements(this);this.bookmarkListPanel=new PcBookmarkListPanel(this);this.elements.bookmarkList=this.bookmarkListPanel.bookmarkList;this._super(a)},onCreate:function(){this.bookmarkListPanel.onCreate();this.setElemColor("#66D566")},resetColor:function(a){a||(a=this.colorOrder);for(var b="#66D566 #64D3ED #9D80D7 #ED8383 #ED9933 #A6A19B #3398ED".split(" "),c=0;c<b.length;c++)a.find(".item"+c).css({"background-image":"radial-gradient("+
b[c]+" 40%,transparent 48%,transparent 53%,transparent 63%)"}),a.find(".item"+c).removeClass("active")},setElemColor:function(a){this.colorSelection.attr("color",a);this.colorSelection.css({background:a})},initColorCss:function(){this.stage.css({background:Color(this.mainColor).rgba(.95),color:Color(this.fontColor)});this.leftAddPage.css({border:"1px solid "+Color(this.mainColor).add(32),color:this.fontColor,background:Color(this.mainColor).add(64)});this.rightAddPage.css({border:"1px solid "+Color(this.mainColor).add(32),
color:this.fontColor,background:Color(this.mainColor).add(64)});this.remove.css({border:"1px solid "+Color(this.mainColor).add(32),background:Color(this.mainColor).add(64)});this.bookmarkListPanel.initColorCss();this.bookmarkListPanel.resetSwiperHtml();var a=this.colorOrder.find(".active").attr("color");this.colorOrder.find(".active").css({"background-image":"radial-gradient("+a+" 40%, transparent 48%, transparent 53%,"+a+" 63%)"})},initColorOrder:function(a){var b="#66D566 #64D3ED #9D80D7 #ED8383 #ED9933 #A6A19B #3398ED".split(" ");
this.colorOrder=$("<div class='color_order' style='height:22px;margin:11px 0 1px;'></div>");for(var c=0;c<b.length;c++){var d=$("<div class='color_item item"+c+"' color='"+b[c]+"' style='cursor:pointer;width:20px;height:20px;border-radius:11px;display:inline-block;margin:0 2px;'></div>");d.css({"background-image":"radial-gradient("+b[c]+" 40%,transparent 48%,transparent 53%,transparent 63%)"});0==c&&(d.addClass("active"),d.css({"background-image":"radial-gradient("+b[c]+" 40%, transparent 48%, transparent 53%,"+
b[c]+" 63%)"}));(function(e,g,f){g.bind("click",function(){e.resetColor(e.colorOrder);g.addClass("active");e.setElemColor(f);g.css({"background-image":"radial-gradient("+f+" 40%, transparent 48%, transparent 53%,"+f+" 63%)"})}.bind(e))})(this,d,b[c]);this.colorOrder.append(d)}a.append(this.colorOrder);this.colorSelection.bind(_event._click,function(){this.resetColor()}.bind(this))},onResize:function(){this._super();var a=windowHeight;this.stage.find(".bookmark_content").css({height:a-87+"px"});toolBar.getTopHeight();
this.width=240;this.height=a-20;this.stage.css({height:this.height+"px"});this.bookmarkListPanel.onResize(this.width,this.height-205);this.refreshPanel()},initHtml:function(){this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.content=$("<div class='bookmark_content'></div>");this.stage.append(this.content);var a=$("<p class='inputForm'></p>");a.append(this.input);a.append(this.colorSelection);
this.content.append(a);this.initColorOrder(this.content);this.content.append(this.leftAddPage);this.content.append(this.rightAddPage);this.content.append(this.bookmarkListPanel.bookmarkListTitle);this.content.append(this.bookmarkListPanel.bookmarkSwiper);this.content.append(this.remove);this.parent.append(this.stage);this.initColorCss();this.refreshPanel()},refreshPanel:function(){this.bookmarkListPanel.refreshPanel();this.elements.refreshElements()},addItem:function(a){a&&a.caption&&a.pageIndex&&
!this.bookmarkListPanel.inList(a.pageIndex)&&(this.bookmarkListPanel.addItem(a),this.input.val(""),this.setRandom(),this.refreshPanel())},setRandom:function(){this.resetColor();var a=getRandomColor();this.colorSelection.attr("color",a);this.colorSelection.css("background",a)},deleteItem:function(a){this.bookmarkListPanel.deleteItem(a);this.refreshPanel()},editItem:function(a){this.bookmarkListPanel.editItem(a);this.refreshPanel()},refreshItem:function(a){this.bookmarkListPanel.refreshItem(a)},removeAll:function(){this.bookmarkListPanel.removeAll();
this.refreshPanel()},onShow:function(){this.close.changeButtonColor(this.fontColor);this.favicon&&this.favicon.changeButtonColor(this.fontColor);this.refreshItemsImage()},refreshItemsImage:function(){this.bookmarkListPanel.refreshItemsImage()}}).extend(SlideRightForm);var PcHelpForm=Class({create:function(a){this.parent=a.parent;this.visible=!0;this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.initHtml();this.hideEvent();bookConfig.showHelpContentAtFirst?this.stage.css({display:"block"}):this.stage.css({display:"none"})},initHtml:function(){this.stage=$("<div class='help_form'></div>");this.arrow=$("<div class='arrow' ></div>");
bookConfig.helpContentFileURL?(this.image=$("<div></div>"),this.stage.css({width:bookConfig.helpWidth+"px",height:bookConfig.helpHeight+"px"}),this.image.css({background:"url("+bookConfig.helpContentFileURL+") center no-repeat","background-size":"contain",width:"100%",height:"100%"})):(this.helpUrl=form_icons.help_form?"data:image/png;base64,"+form_icons.help_form:uiBaseURL+"help_form.png",this.image=$("<img class='logo' src='"+this.helpUrl+"'/>"),this.title1=$("<p class='description'>"+getLanguage("lblHelp1",
"Drag the page corner to view")+"</p>"),this.title2=$("<p class='description'>"+getLanguage("lblHelp2","Double click to zoom in, out")+"</p>"));this.title1&&this.stage.append(this.title1);this.title2&&this.stage.append(this.title2);this.stage.append(this.image);this.stage.append(this.arrow);this.parent.append(this.stage);this.initColorCss()},initColorConfig:function(){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?
bookConfig.formFontColor:bookConfig.iconColor;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor)},initColorCss:function(){this.stage.css({background:Color(this.mainColor).rgba(.95),color:Color(this.fontColor)});this.arrow.css({"border-bottom-color":this.mainColor});this.title1&&this.title1.css({"background-color":Color(this.mainColor).add(64)});this.title2&&this.title2.css({"background-color":Color(this.mainColor).add(64)})},resetFormColor:function(){this.initColorConfig();
this.resetIconSrc();this.resetColorChanged();this.changeIconColor();this.initColorCss&&this.initColorCss()},resetColorChanged:function(){!bookConfig.helpContentFileURL&&this.image&&(this.image[0].colorChanged=!1)},resetIconSrc:function(){!bookConfig.helpContentFileURL&&this.image&&this.image.attr("src",this.helpUrl)},changeIconColor:function(){!bookConfig.helpContentFileURL&&this.image&&this.image.changeButtonColor(this.fontColor)},onResize:function(){},hideEvent:function(){this.parent.bind(_event._click,
function(){this.hide()}.bind(this))},showOrHide:function(a){this.visible?this.show(a):this.hide()},show:function(a){var b=59;a&&(b=a.top+a.height+20);this.stage.css({right:0,left:"auto",top:b+"px"});this.stage.fadeIn(function(){this.visible=!1}.bind(this))},hide:function(){this.stage.fadeOut(function(){this.visible=!0;this.changeIconColor()}.bind(this))}});var PcPrintForm=Class({create:function(a){this.elements=new PrintElements(this);this._super(a)},onCreate:function(){this._super()},initHtml:function(){this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.appendPrintOptions();this.initColorCss();this._super()},onResize:function(){this._super();this.stage.css({height:this.height+"px",top:"0"})},initColorCss:function(){this.stage.css({background:Color(this.mainColor).rgba(.95*
this.formOpacity),color:Color(this.fontColor)});this.printCurrent.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.printRange.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.printAll.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)});this.printButton.css({border:"1px solid "+Color(this.mainColor).add(32),"background-color":Color(this.mainColor).add(64)})},
resetColorChanged:function(){this._super();this.printAll.find("img")[0].colorChanged=!1;this.printCurrent.find("img")[0].colorChanged=!1;this.printRange.find("img")[0].colorChanged=!1},resetIconSrc:function(){this._super();this.stage.find(".item").find("img").attr("src",this.elements.printOffUrl);this.stage.find(".on").find("img").attr("src",this.elements.printOnUrl)},changeItemColor:function(){this.printCurrent.changeButtonColor(this.fontColor);this.printRange.changeButtonColor(this.fontColor);this.printAll.changeButtonColor(this.fontColor)},
changeIconColor:function(){this._super();this.changeItemColor()},initEvent:function(){this._super()},onShow:function(){this._super();this.pictureListForm.leftBtn.changeButtonColor(this.fontColor);this.pictureListForm.rightBtn.changeButtonColor(this.fontColor);this.changeItemColor()},onHide:function(){},appendPrintOptions:function(){this.emptyTips=$('<div><span class="no-files-prompt" >'+getLanguage("emptyPrintOptionsTips","No printing options.")+"</span></div>");this.emptyTips.css({height:"150px",
width:"100%",display:"flex","align-items":"center","justify-content":"center","font-size":"20px"});var a=this.stage;bookConfig.printOptions&&0<bookConfig.printOptions.length?(0<=bookConfig.printOptions.indexOf("all")&&a.append(this.printAll),0<=bookConfig.printOptions.indexOf("current")&&a.append(this.printCurrent),0<=bookConfig.printOptions.indexOf("range")&&a.append(this.printRange),a.append(this.printButton)):a.append(this.emptyTips)}}).extend(SlideRightForm);var PcTableOfContentItem=Class({create:function(a,b,c){b.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this._super(a,b,c)},initHtml:function(){this._super();this.resetItemColor()},resetItemColor:function(){this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.mainColorObj=Color(this.mainColor);this.formOpacity=bookConfig.formBackgroundOpacity?bookConfig.formBackgroundOpacity:bookConfig.ToolBarAlpha;this.item.css({border:"1px solid "+
Color(this.mainColorObj.add(32)).rgba(this.formOpacity),background:Color(this.mainColorObj.add(64)).rgba(this.formOpacity)})},setAsExpand:function(){this.isExpand=!0;this.arrow&&(this.arrow.attr("src",this.expandUrl),this.arrow[0].colorChanged=!1,this.arrow.changeButtonColor(this.fontColor));this.item.css({"font-weight":"bold","background-color":Color(this.mainColor).add(96)})},setAsCollapse:function(){this.isExpand=!1;this.arrow&&(this.arrow.attr("src",this.collapseUrl),this.arrow[0].colorChanged=
!1,this.arrow.changeButtonColor(this.fontColor));this.item.css({"font-weight":"",background:Color(this.mainColor).add(64)})},initRightToLeftDefaultDom:function(){LanguageTool.isRightToLeft(this.parm.caption)?this.description=$("<p class='description rtl'>"+this.parm.caption+"</p>"):this.description=$("<p class='description'>"+this.parm.caption+"</p>");this.hasChild&&(this.arrow=$("<img class='arrow' src='"+this.collapseUrl+"'/>"),this.arrow.css("left",10*(this.level-1)+"px"),this.description.css("margin-left",
10*(this.level-1)+15+"px"));this.page=$("<span class='page'>"+this.parm.page+"</span>")},initLeftToRightDefaultDom:function(){this.description=$("<p class='description'>"+this.parm.caption+"</p>");this.hasChild&&(this.arrow=$("<img class='arrow' src='"+this.collapseUrl+"'/>"),this.arrow.css("right",10*(this.level-1)+"px"));bookConfig.isTableOfContentPagesVisible?(this.page=$("<span class='page'>"+this.parm.page+"</span>"),this.page.css("margin-right",10*(this.level-1)+15+"px")):this.description.css("margin-right",
10*(this.level-1)+15+"px")},initEvent:function(){this.item.onTap(function(){if(this.parm.url){var a="";try{a=getRealURL(this.parm.url)||""}catch(b){a=""}a&&window.open(a,"_blank")}else gotoPageFun(parseInt(this.parm.page),!1,"table of content"),(isPhone()||isPad())&&global.frmTableOfContent.hide()}.bind(this));if(this.hasChild){if(this.arrow)this.arrow.onTap(function(){this.onSwitch()}.bind(this));this.arrow.bind("mousedown touchstart pointerdown mouseover mousemove click",function(a){a.stopPropagation()})}}}).extend(TableOfContentItem);var PcTableOfContentForm=Class({create:function(a){this.elements=new TableOfContentElements(this);this._super(a)},onCreate:function(){this._super()},resetFormItems:function(){this.elements.refreshItems(this.fontColor)},initColorCss:function(){this.stage.css({background:this.mainColorObj.rgba(.95*this.formOpacity),color:Color(this.fontColor)});this.resetFormItems()},initHtml:function(){this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));
this.stage.append(this.close);this.stage.append(this.tableofcontentSwiper);this.parent.append(this.stage);this.initColorCss()},newItem:function(a,b,c){return new PcTableOfContentItem(a,b,c)},onResize:function(){this._super();this.stage.css({height:this.height+"px",top:"0px",right:2*-this.width+"px"});this.tableofcontentSwiper.css("height",this.height-29+"px");this.elements.refresh()},onShow:function(){this.changeIconColor()}}).extend(SlideRightForm);var PcVideoGalleryForm=Class({create:function(a){this._super(a)},onCreate:function(){this._super()},initHtml:function(){this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.stage.append(this.video);this.stage.append(this.info);if(this.videoList&&1<this.videoList.length){var a=$("<div class='video_list'></div>");a.append(this.videoListTitle);a.append(this.videoSwiper);this.stage.append(a)}else this.stage.css("width",
"335px");this._super()}}).extend(PcVideoGalleryFrame);var PcShareForm=Class({create:function(a){this.elements=new ShareElements(this);this.parent=a.parent;this.direction="top";this.shareCurrentChecked=this.visible=!0;this.mainColor=bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor);this.formOpacity=bookConfig.formBackgroundOpacity?bookConfig.formBackgroundOpacity:
bookConfig.ToolBarAlpha;this.itemArray=[];global.share_url=bookConfig.socialShareLink?bookConfig.socialShareLink:window.location.href.removeStartFrom("#p=");this.initElements();this.initHtml();this.initEvent()},initHtml:function(){var a=this;this.initSwiper();this.getQrCodeStatus().then(function(b){b&&a.stage.append(a.codeBox)}).catch(function(b){console.error("Error getting QR code status:",b)});this.stage.append(this.swiperContainer);this.stage.append(this.linkArea);this.shareCurrentPageBox.append(this.shareCurrentCheck).append(this.shareCurrentPageTitle1);
this.stage.append(this.shareCurrentPageBox);this.stage.append(this.insertToSite);this.stage.append(this.insertArea);this.stage.append(this.arrow);this.parent.append(this.stage);this.initColorCss();this.initSwiperCss();this.hasMiniProgram()||this.codeBox.find(".qrcode").css({padding:"0","border-radius":"4px"});this.hasQrcode().then(function(b){b||a.codeBox.find(".miniProgram").css({padding:"0","border-radius":"4px"})}).catch(function(b){console.error("Error getting QR code status:",b)})},initElements:function(){this.codeBox=
this.elements.codeBox;this.itemArray=this.elements.itemArray;this.analysisShare=this.elements.analysisShare;this.linkArea=this.elements.linkArea;this.copy1=this.elements.copy1;this.insertToSite=this.elements.insertToSite;this.sharePanel=this.elements.sharePanel;this.sharePanelTitle=this.elements.sharePanelTitle;this.shareCurrentPageBox=this.elements.shareCurrentPageBox;this.shareCurrentCheck=this.elements.shareCurrentCheck;this.shareCurrentPageTitle1=this.elements.shareCurrentPageTitle1;this.arrow=
$("<div class='arrow' ></div>");this.stage=$("<div class='share_form' style='display:none;'></div>");rightToLeft&&this.stage.addClass("rightToLeft")},initSwiper:function(){this.swiperContainer=$("<div class='swiperContainer'></div>");this.shareStage=$("<div class='shareStage stage'></div>");this.shareSwiper=$("<div class='shareSwiper swiper'></div>");this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.shareSwiper.append(this.sharePanel);this.shareStage.append(this.shareSwiper);
this.shareStage.append(this.progress);this.progress.append(this.progressBar);this.swiperContainer.append(this.shareStage);this.shareStage.scroll({},Direction.top,"win10")},onResize:function(){},fillArea:function(a,b){var c=share_url;0<=c.toLowerCase().indexOf("file:")&&(c="index.html");a&&(c=c+"#p="+getShownPageNumber(BookInfo.getCurrentPageIndex()));"link"==b&&this.linkArea&&this.linkArea.val(c)},addItem:function(a){var b=this,c,d,e,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==
f.nextAddress)return f.yield(b.elements.analysisShare.getList(),2);c=f.yieldResult;if(!c||0>c.length)return f.return();for(d=0;d<c.length;d++)e=c[d],g=void 0,g=-1<e.url.indexOf("javascript")?$("<a data-type='"+e.type+"' target = '_blank' href='#' onclick='"+e.url.remove("javascript:")+";return false;' title='"+e.title+"'><img src='"+e.logo+"'/></a>"):$("<a data-type='"+e.type+"' target = '_blank' href='"+e.url+"' title='"+e.title+"'><img src='"+e.logo+"'/></a>"),b.sharePanel.append(g),b.itemArray.push(g);
f.jumpToEnd()})},initEvent:function(){this.copy1.onTap(function(){this.copyFrom(this.linkArea)}.bind(this));this.linkArea.onTap(function(){this.linkArea.select()}.bind(this));this.shareCurrentCheck.onTap(function(){this.shareCurrentChecked=!this.shareCurrentChecked;this.fillArea(this.shareCurrentChecked,"link");this.shareCurrentCheck.attr("src",this.shareCurrentChecked?this.elements.searchOnUrl:this.elements.searchOffUrl);this.shareCurrentCheck[0].colorChanged=!1;this.changeItemColor()}.bind(this));
this.linkArea.bind("mousedown touchstart pointerdown mouseover mousemove",function(a){a.stopPropagation()});this.parent.bind(_event._click,function(a){this.hide()}.bind(this));this.stage.bind(_event._click,function(a){a.stopPropagation()}.bind(this));this.linkInputChnagedEvent()},linkInputChnagedEvent:function(){if(this.linkArea)this.linkArea.on("input propertychange change",function(){var a=this,b,c,d,e,g,f,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return b=
a.linkArea.val(),0<=b.toLowerCase().indexOf("file:")&&(b="index.html"),c="<iframe frameborder='0'  width='240' height='210'  title='"+window.document.title+"' src='"+b+"' type='text/html' allowfullscreen='true' scrolling='no' marginwidth='0' marginheight='0'></iframe>",a.insertArea&&a.insertArea.val(c),share_url=b,a.analysisShare.refreshList(),k.yield(a.analysisShare.getList(),2);d=k.yieldResult;e={};for(g=0;g<a.itemArray.length;e={$jscomp$loop$prop$type$6:e.$jscomp$loop$prop$type$6},g++)f=a.itemArray[g],
e.$jscomp$loop$prop$type$6=f.attr("data-type"),(h=d.find(function(l){return function(m){return m.type===l.$jscomp$loop$prop$type$6}}(e)))&&(-1<h.url.indexOf("javascript")?f.attr("onclick",h.url.remove("javascript:")+";return false;"):f.attr("href",h.url));k.jumpToEnd()})}.bind(this))},copyFrom:function(a){if(a){a.focus();a.select();try{document.execCommand("Copy")}catch(b){a=a.val(),copyToClipboard(a)}}},changeLanguage:function(){this.copy1.html(getLanguage("lblCopy","Copy"))},initColorConfig:function(){this.mainColor=
bookConfig.formBackgroundColor?bookConfig.formBackgroundColor:bookConfig.toolbarColor;this.fontColor=bookConfig.formFontColor?bookConfig.formFontColor:bookConfig.iconColor;this.formOpacity=bookConfig.formBackgroundOpacity?bookConfig.formBackgroundOpacity:bookConfig.ToolBarAlpha;this.mainColorObj=Color(this.mainColor);this.fontColorObj=Color(this.fontColor)},initColorCss:function(){this.stage.css({background:Color(this.mainColor).rgba(.95*this.formOpacity),color:Color(this.fontColor)});this.codeBox.find(".qrcode").css({"background-color":this.mainColor,
color:this.fontColor});this.codeBox.find(".miniProgram").css({"background-color":this.mainColor,color:this.fontColor});this.arrow.css({"border-top-color":Color(this.mainColor).rgba(.95)})},initSwiperCss:function(){var a=this,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(a.getQrCodeStatus(),2);(b=c.yieldResult)?bookConfig.RightToLeft?a.swiperContainer.css({"border-right":"1px solid "+a.fontColorObj.rgba(.3)}):a.swiperContainer.css({"border-left":"1px solid "+
a.fontColorObj.rgba(.3)}):a.swiperContainer.css({right:"initial",left:"0px"});c.jumpToEnd()})},resetFormColor:function(){this.initColorConfig();this.resetIconSrc();this.resetColorChanged();this.changeIconColor();this.initColorCss&&this.initColorCss();this.initSwiperCss()},resetColorChanged:function(){this.shareCurrentCheck[0].colorChanged=!1},resetIconSrc:function(){this.shareCurrentCheck.attr("src",this.shareCurrentChecked?this.elements.searchOnUrl:this.elements.searchOffUrl)},changeIconColor:function(){this.changeItemColor()},
showOrHide:function(a){this.visible?this.show(a):this.hide()},show:function(a){var b=0,c=0;b=0;this.arrow.css({"border-top-color":Color(this.mainColor).rgba(.95)});"top"==this.direction?(b=0>a.left-179?0:a.left+343>windowWidth?windowWidth-343:a.left-179,c=a.top-258-17,0>c&&(c=0),this.stage.css({left:b+"px",top:c+"px"}),this.arrow.css({transform:"rotate(0)",left:a.left-b-6+"px",bottom:"-22px",right:"auto",top:"auto"})):(c=a.top-129,this.arrow.css({transform:"rotate(-90deg)",left:"auto",bottom:"auto",
right:"-22px",top:"133px"}),c+258>windowHeight&&(c=windowHeight-258,b=258-(windowHeight-4-a.top),this.arrow.css({top:b+"px"})),0>c&&(c=0),b=0>a.left-368?0:a.left-368,this.stage.css({left:b+"px",top:c+"px"}));this.stage.fadeIn(function(){this.visible=!1}.bind(this));this.shareStage.refreshData();this.onShow()},changeItemColor:function(){this.shareCurrentCheck.changeButtonColor(this.fontColor)},onShow:function(){var a=this;this.changeItemColor();this.elements.addItem(function(b){a.stage[0].style.display=
"inline-block";if(b){var c;null==(c=a.swiperContainer)||c.css({display:"none"})}})},hide:function(){this.stage.fadeOut(function(){this.visible=!0}.bind(this));this.onHide()},onHide:function(){}});var PcDownloadForm=Class({get hasFiles(){return window.downloadconfig?!downloadconfig.hideDownloadSinglePage||downloadconfig.pdf||downloadconfig.attachments&&0<downloadconfig.attachments.length:!1},create:function(a){this.elements=new DownloadElements(this);this._super(a)},onCreate:function(){this.initColorCss();this._super()},initColorCss:function(){this.stage.css({"background-color":this.mainColorObj.rgba(.95*this.formOpacity),color:this.fontColor});this.borderColor=this.mainColorObj.add(32);this.itemBgColor=
this.mainColorObj.add(64);this.content.find(".item").css({border:"1px solid "+this.borderColor,background:this.itemBgColor});this.content.find(".item a").css({border:"1px solid "+this.borderColor,background:this.itemBgColor});this.selectContent.css({border:"1px solid "+this.borderColor,background:this.itemBgColor})},changeIconColor:function(){this._super();this.changeItemColor()},changeItemColor:function(){this.downloadCurrent.changeButtonColor(this.fontColor);this.downloadAttachments.changeButtonColor(this.fontColor);
this.downloadAll.changeButtonColor(this.fontColor);this.pictureListForm.leftBtn.changeButtonColor(this.fontColor);this.pictureListForm.rightBtn.changeButtonColor(this.fontColor)},initHtml:function(){var a=this;this.stage.append(this.title);this.favicon&&(bookConfig.RightToLeft?this.title.append(this.favicon):this.title.prepend(this.favicon));this.stage.append(this.close);this.downloadContent=$("<div class='download_content'></div>");this.stage.append(this.downloadContent);this.content=$("<div class='content'></div>");
this.content1=$("<div class='content1'></div>");downloadconfig.pdf&&this.content1.append(this.downloadAll);downloadconfig.hideDownloadSinglePage||this.content1.append(this.downloadCurrent);this.selectContent=$("<div class='select_content'></div>");this.selectContent.append(this.selectAttachments);downloadconfig.attachments&&0<downloadconfig.attachments.length&&(this.content1.append(this.downloadAttachments),this.content1.append(this.selectAttachments));this.hasFiles?this.content1.append(this.downloadButton):
this.content1.append(this.noFilesAvailablePrompt);this.content2=$("<div class='content2'></div>");this.content2.append(this.pictureListForm.getDom());this.content.append(this.content2);this.content.append(this.content1);this.downloadContent.append(this.content);this.restricted&&(this.loadingBox=$("<img src='"+uiBaseURL+"loading.svg'/>"),this.loadingBox.css({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),this.content.css({height:"100%"}),this.downloadContent.css({height:"100%"}),
this.content1.append(this.restrictedTips),BookRestrict.isLoaded||(this.content1.hide(),this.content2.hide(),this.content.append(this.loadingBox),BookEvent.bindEvent("onLoadBookRestrict",function(b,c){c&&a.removeRestrictMode()})));this._super()},removeRestrictMode:function(){this.content1.show();this.content2.show();this.loadingBox&&this.loadingBox.remove()},gotoPage:function(a){this.pictureListForm.fillContent(a)},onResize:function(){this._super();this.stage.css({height:this.height+4+"px",top:0,right:2*
-this.width+"px"})},initEvent:function(){this._super()}}).extend(SlideRightForm);
